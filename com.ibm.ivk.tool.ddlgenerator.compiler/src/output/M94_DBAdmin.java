package output;

import org.apache.poi.ss.usermodel.*;
import java.nio.file.*;
import java.text.*;
import java.util.Date;

public class M94_DBAdmin {




private static final int processingStepAdmin = 4;

private static final String pc_tempTabNameExcludeSchema = "SESSION.ExcludeSchema";
private static final String pc_tempTabNameExcludeName = "SESSION.ExcludeName";

public static final String tempTabNameGrant = "SESSION.Grant";
public static final String tempTabNameStatement = "SESSION.Statements";
public static final String tempTabNameTableCfg = "SESSION.TableCfg";
public static final String tempTabNameReorgChk = "SESSION.ReorgChk";


public static void genDdlForTempStatement(int fileNo, Integer indentW, Boolean withReplaceW, Long maxStatementLengthW, Boolean autoSeqW, Boolean onCommitPreserveW, Boolean onRollbackPreserveW, Boolean includeCommentColW, String tabNameSuffixW, Boolean includeSeqColW, Boolean includeExecTimeColW, Boolean includeFlagColW, Boolean skipNlW, String extraColNameW, String extraColTypeW, String extraColName2W, String extraColType2W) {
int indent; 
if (indentW == null) {
indent = 1;
} else {
indent = indentW;
}

boolean withReplace; 
if (withReplaceW == null) {
withReplace = false;
} else {
withReplace = withReplaceW;
}

long maxStatementLength; 
if (maxStatementLengthW == null) {
maxStatementLength = 400;
} else {
maxStatementLength = maxStatementLengthW;
}

boolean autoSeq; 
if (autoSeqW == null) {
autoSeq = false;
} else {
autoSeq = autoSeqW;
}

boolean onCommitPreserve; 
if (onCommitPreserveW == null) {
onCommitPreserve = true;
} else {
onCommitPreserve = onCommitPreserveW;
}

boolean onRollbackPreserve; 
if (onRollbackPreserveW == null) {
onRollbackPreserve = true;
} else {
onRollbackPreserve = onRollbackPreserveW;
}

boolean includeCommentCol; 
if (includeCommentColW == null) {
includeCommentCol = false;
} else {
includeCommentCol = includeCommentColW;
}

String tabNameSuffix; 
if (tabNameSuffixW == null) {
tabNameSuffix = "";
} else {
tabNameSuffix = tabNameSuffixW;
}

boolean includeSeqCol; 
if (includeSeqColW == null) {
includeSeqCol = true;
} else {
includeSeqCol = includeSeqColW;
}

boolean includeExecTimeCol; 
if (includeExecTimeColW == null) {
includeExecTimeCol = false;
} else {
includeExecTimeCol = includeExecTimeColW;
}

boolean includeFlagCol; 
if (includeFlagColW == null) {
includeFlagCol = false;
} else {
includeFlagCol = includeFlagColW;
}

boolean skipNl; 
if (skipNlW == null) {
skipNl = false;
} else {
skipNl = skipNlW;
}

String extraColName; 
if (extraColNameW == null) {
extraColName = "";
} else {
extraColName = extraColNameW;
}

String extraColType; 
if (extraColTypeW == null) {
extraColType = "";
} else {
extraColType = extraColTypeW;
}

String extraColName2; 
if (extraColName2W == null) {
extraColName2 = "";
} else {
extraColName2 = extraColName2W;
}

String extraColType2; 
if (extraColType2W == null) {
extraColType2 = "";
} else {
extraColType2 = extraColType2W;
}

int colNameLength;
colNameLength = 9;

if (extraColName + "".length() > colNameLength) {
colNameLength = extraColName.length();
}
if (extraColName2 + "".length() > colNameLength) {
colNameLength = extraColName2.length();
}

M11_LRT.genProcSectionHeader(fileNo, "temporary table for statements", indent, skipNl);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 0) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + M94_DBAdmin.tempTabNameStatement + tabNameSuffix);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 0) + "(");

if (includeSeqCol) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + M04_Utilities.paddRight("seqNo", colNameLength, null) + " INTEGER" + (autoSeq ? " GENERATED ALWAYS AS IDENTITY (START WITH 1 INCREMENT BY 1)" : "") + ",");
}
if (maxStatementLength > 32672) {
M04_Utilities.logMsg("CLOB larger than 32672 bytres may not be used in temporary Statement-table", M01_Common.LogLevel.ellError, null, null, null);
maxStatementLength = 32672;
}

if (includeCommentCol) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + M04_Utilities.paddRight("comment", colNameLength, null) + " VARCHAR(100),");
}

if (includeExecTimeCol) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + M04_Utilities.paddRight("execTime", colNameLength, null) + " TIME,");
}

if (includeFlagCol) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + M04_Utilities.paddRight("flag", colNameLength, null) + " CHAR(1),");
}

if (extraColName + "" != "") {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + M04_Utilities.paddRight(extraColName, colNameLength, null) + " " + extraColType + ",");
}

if (extraColName2 + "" != "") {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + M04_Utilities.paddRight(extraColName2, colNameLength, null) + " " + extraColType2 + ",");
}

if (maxStatementLength > 32672) {
M04_Utilities.logMsg("CLOB larger than 32000 bytes may not be used in temporary table", M01_Common.LogLevel.ellError, null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + M04_Utilities.paddRight("statement", colNameLength, null) + " CLOB(" + String.valueOf(maxStatementLength) + ")");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + M04_Utilities.paddRight("statement", colNameLength, null) + " VARCHAR(" + String.valueOf(maxStatementLength) + ")");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 0) + ")");

M11_LRT.genDdlForTempTableDeclTrailer(fileNo, indent, withReplace, onCommitPreserve, onRollbackPreserve);
}


public static void genDdlForTempGrants(int fileNo, Integer indentW, Boolean withReplaceW, Boolean onCommitPreserveW, Boolean onRollbackPreserveW, Boolean includeParmSignatureColW) {
int indent; 
if (indentW == null) {
indent = 1;
} else {
indent = indentW;
}

boolean withReplace; 
if (withReplaceW == null) {
withReplace = false;
} else {
withReplace = withReplaceW;
}

boolean onCommitPreserve; 
if (onCommitPreserveW == null) {
onCommitPreserve = true;
} else {
onCommitPreserve = onCommitPreserveW;
}

boolean onRollbackPreserve; 
if (onRollbackPreserveW == null) {
onRollbackPreserve = true;
} else {
onRollbackPreserve = onRollbackPreserveW;
}

boolean includeParmSignatureCol; 
if (includeParmSignatureColW == null) {
includeParmSignatureCol = false;
} else {
includeParmSignatureCol = includeParmSignatureColW;
}

M11_LRT.genProcSectionHeader(fileNo, "temporary table for GRANTs", indent, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 0) + "DECLARE GLOBAL TEMPORARY TABLE");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + M94_DBAdmin.tempTabNameGrant);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 0) + "(");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + "schemaName    " + M01_Globals.g_dbtDbSchemaName + "  NOT NULL,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + "objectName    VARCHAR(100) NOT NULL,");
if (includeParmSignatureCol) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + "parmSignature VARCHAR(500) NOT NULL,");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + "grantee       VARCHAR(100) NOT NULL,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + "granteeType   CHAR(1)      NOT NULL,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + "privilege     VARCHAR(10)  NOT NULL");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 0) + ")");

M11_LRT.genDdlForTempTableDeclTrailer(fileNo, indent, withReplace, onCommitPreserve, onRollbackPreserve);
}


public static void genDdlForTempTableCfg(int fileNo, Integer indentW, Boolean withReplaceW, Boolean onCommitPreserveW, Boolean onRollbackPreserveW) {
int indent; 
if (indentW == null) {
indent = 1;
} else {
indent = indentW;
}

boolean withReplace; 
if (withReplaceW == null) {
withReplace = false;
} else {
withReplace = withReplaceW;
}

boolean onCommitPreserve; 
if (onCommitPreserveW == null) {
onCommitPreserve = true;
} else {
onCommitPreserve = onCommitPreserveW;
}

boolean onRollbackPreserve; 
if (onRollbackPreserveW == null) {
onRollbackPreserve = true;
} else {
onRollbackPreserve = onRollbackPreserveW;
}

M11_LRT.genProcSectionHeader(fileNo, "temporary table for table configuration", indent, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 0) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + M94_DBAdmin.tempTabNameTableCfg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 0) + "(");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + "tabSchema           " + M01_Globals.g_dbtDbSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + "tabName             VARCHAR(50),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + "pctFree             SMALLINT,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + "isVolatile          " + M01_Globals.g_dbtBoolean + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + "useCompression      " + M01_Globals.g_dbtBoolean + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 1) + "useIndexCompression " + M01_Globals.g_dbtBoolean);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 0) + ")");

M11_LRT.genDdlForTempTableDeclTrailer(fileNo, indent, withReplace, onCommitPreserve, onRollbackPreserve);
}


public static void genDbAdminDdl(Integer ddlType) {
if (ddlType == M01_Common.DdlTypeId.edtPdm) {
int thisPoolIndex;
int thisOrgIndex;

for (thisPoolIndex = 1; thisPoolIndex <= 1; thisPoolIndex += (1)) {
for (thisOrgIndex = 1; thisOrgIndex <= 1; thisOrgIndex += (1)) {
if (M72_DataPool.poolIsValidForOrg(thisPoolIndex, thisOrgIndex)) {
M94_SnapShot.genDbAdminDdlByPool(thisOrgIndex, thisPoolIndex, M01_Common.DdlTypeId.edtPdm);
}
}
}
}

int fileNo;
fileNo = M04_Utilities.openDdlFile(M01_Globals.g_targetDir, M01_Globals.g_sectionIndexDbAdmin, processingStepAdmin, ddlType, null, null, null, M01_Common.phaseDbSupport, null);

//On Error GoTo ErrorExit 

M94_DBAdmin.genDbAdminDdl0(fileNo, ddlType);
M94_DBAdmin.genDbAdminDdl1(fileNo, ddlType);
M94_DBAdmin.genDdlSetgrants1(fileNo, ddlType);
M94_DBAdmin.genDdlSetgrants2(fileNo, ddlType);
// ### IF IVK ###
genDdlAutoDeploy(fileNo, ddlType);
// ### ENDIF IVK ###
genDdlRedirRestore(fileNo, ddlType);
genDbAdminDdl2(fileNo, ddlType);
genDbAdminDdl3(fileNo, ddlType);
genDbAdminDdl4(fileNo, ddlType);
genDdlSetTabCfg(fileNo, ddlType);
genDbAdminDdl5(fileNo, ddlType);
genDbAdminDdlCompressionEstimation(fileNo, ddlType);
genDbAdminDdl6(fileNo, ddlType);
genDbAdminDdl7(fileNo, ddlType);
genDbAdminDdl9(fileNo, ddlType);
genDbAdminDdl10(fileNo, ddlType);
// ### IF IVK ###
genDbAdminDdl11(fileNo, ddlType);
genDbAdminDdlOrgInitMetaBus(fileNo, ddlType);
genDbAdminDdlOrgInitDupCode(fileNo, ddlType);
genDbAdminDdlOrgInitEnp(fileNo, ddlType);
genDbAdminDdlOrgInit(fileNo, ddlType);
genDbAdminDdlOrgInit2(fileNo, ddlType);
genDbAdminDdlDivCreate(fileNo, ddlType);
genDbAdminDdlMessageUpdate(fileNo, ddlType);
genDdlAddTestUser(fileNo, ddlType);
// ### ENDIF IVK ###
genDdlDbCompact(fileNo, ddlType);

NormalExit:
//On Error Resume Next 
M00_FileWriter.closeFile(fileNo);
return;

ErrorExit:
errMsgBox(Err.description);
Resume(NormalExit);
}


public static void genDbMoveScript(int fileNo, int sectionNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

String qualViewNameMoveExp;
qualViewNameMoveExp = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnPdmExportStmntMove, M01_ACM.vnsPdmExportStmntMove, ddlType, null, null, null, null, null, null, null, null, null, null);

String qualViewNameMoveImp;
qualViewNameMoveImp = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnPdmImportStmntMove, M01_ACM.vnsPdmImportStmntMove, ddlType, null, null, null, null, null, null, null, null, null, null);

String qualViewNameMoveLoad;
qualViewNameMoveLoad = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnPdmLoadStmntMove, M01_ACM.vnsPdmLoadStmntMove, ddlType, null, null, null, null, null, null, null, null, null, null);

String qualViewNameMoveStmnts;
qualViewNameMoveStmnts = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnPdmMoveScript, M01_ACM.vnsPdmMoveScript, ddlType, null, null, null, null, null, null, null, null, null, null);

if (sectionNo == 1) {
goto Sect1;
} else if (sectionNo == 2) {
goto Sect2;
} else if (sectionNo == 3) {
goto Sect3;
} else {
return;
}

Sect1:
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'#!/usr/bin/ksh' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'##########################################################################################' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# Script parameter:' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'dbName=' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'dbUser=' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'dbPw=' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'srcDbName=' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'force=0' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'silent=0' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'##########################################################################################' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# Utility procedures:' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'dbConnect() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local dbName=${1}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local dbUser=${2}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local dbPw=${3}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  db2 \"TERMINATE\" > /dev/null' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  if [ \"${dbUser}\" ]; then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    db2 \"CONNECT TO $dbName USER $dbUser USING ${dbPw}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  else' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    db2 \"CONNECT TO ${dbName}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  fi' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  rc=$?' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  [ ${rc} -gt 2 ] && exit ${rc}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'dbTerminate() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  db2 \"TERMINATE\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'ts() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  date +''[ %Y.%m.%d-%H:%M:%S ] ''' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'setCodePage1208() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local dbName=${1}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local dbUser=${2}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local dbPw=${3}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  dbTerminate > /dev/null' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  db2set DB2CODEPAGE=1208' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  sleep 5' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  dbConnect ${dbName} ${dbUser} ${dbPw} > /dev/null' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'resetCodePage() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  db2set DB2CODEPAGE=' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'tb() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  tr -d ''\\r'' | sed ''s/[ ]*$//''' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'busy() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local interval=${1}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  i=1' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  while true; do' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    sleep $interval' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    printf \".\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    i=`expr ${i} + 1`' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    if [ ${i} = 60 ]; then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      i=0' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      printf \"\\n\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    fi' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  done' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'startBusy() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local msg=${1}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local interval=${2}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  if [ \"${interval}\" = 0 ]; then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    if [ \"${msg}\" ]; then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      printf \"%s%s\" \"`ts`\" \"${msg}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    fi' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    busyPid=' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    return 0' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  fi' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  if [ \"${silent}\" = 0 ]; then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    [ \"${msg}\" ] && printf \"%s%s [''.'' ~ %s sec]\\n.\" \"`ts`\" \"${msg}\" \"${interval}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    busy ${interval} &' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    busyPid=$!' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  else' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    [ \"${msg}\" ] && printf \"%s%s\" \"`ts`\" \"${msg}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  fi' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'stopBusy() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local msg=${1}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  [ \"${busyPid}\" ] && kill -9 \"${busyPid}\" 2>&1 > /dev/null' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  printf \"\\n\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  [ \"${msg}\" ] && printf \"%s%s\\n\" \"`ts`\" \"${msg}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'busyPid=' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'assertDb2Rc() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local rc=${1:-0}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local logFile=${2}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local rcThreshold=${3}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  [ -z \"${rcThreshold}\" ] && rcThreshold=2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  if [ \"${rc}\" -gt \"${rcThreshold}\"  ]; then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    stopBusy \"failed. [rc=${rc}]\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    printf \"\\n\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    if [ \"${logFile}\" ]; then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      printf \"##########################################\\n\\n\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      tail -30 \"${logFile}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      printf \"\\n##########################################\\n\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    fi' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    if [ \"${force}\" -ne 1 ]; then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      resetCodePage' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      exit ${rc}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    fi' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  fi' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'execDb2Script() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local msg=${1}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local scriptBaseName=${2}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local interval=${3}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local refDir=${4}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local rcThreshold=${5}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local cmdTermChar=${6}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  [ -z \"${rcThreshold}\" ] && rcThreshold=2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local rc' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  [ -z \"${interval}\" ] && interval=1' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local db2CmdArgs' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  db2CmdArgs=\"-v -s\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  [ -z \"${cmdTermChar}\" ] || db2CmdArgs=\"${db2CmdArgs} -td${cmdTermChar}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local infix=\"\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  case \"${scriptBaseName}\" in' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    export*) infix=\".${dbName}\";;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    import*) infix=\".${dbName}\";;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    load*)   infix=\".${dbName}\";;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  esac' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  [ \"${msg}\" ] && startBusy \"${msg} (output logged in ${scriptBaseName}${infix}.log)\" \"${interval}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  db2 ${db2CmdArgs} -f \"${refDir}${scriptBaseName}.db2\" > \"${refDir}${scriptBaseName}${infix}.log\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  rc=$?' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  assertDb2Rc \"${rc}\" \"${refDir}${scriptBaseName}${infix}.log\" \"${rcThreshold}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  [ \"${msg}\" ] && stopBusy \"done. [rc=${rc}]\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  return ${rc}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'execDb2Cmd() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local msg=${1}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local cmd=${2}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local scriptName=${3}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local interval=${4}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local rcThreshold=${5}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  [ -z \"${rcThreshold}\" ] && rcThreshold=2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local rc' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  [ -z \"${interval}\" ] && interval=1' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  [ \"${msg}\" ] && startBusy \"${msg}\" \"${interval}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  db2 -x \"${cmd}\" | tb > ${scriptName}.db2'  || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  rc=$?' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  assertDb2Rc \"${rc}\" \"${scriptName}.db2\" \"${rcThreshold}\" ' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  [ \"${msg}\" ] && stopBusy \"done. [rc=${rc}]\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  return ${rc}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'checkForReject() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local logFile=${1}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local operation=${2}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local refDir=${3}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  if grep ''rejected  '' \"${refDir}${logFile}\" | grep -q -v ''= 0''; then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    printf \"%s%s:\\n\\n\" \"`ts`\" \"${operation}-error reported. Check file ${logFile}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    printf \"##########################################\\n\\n\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    tail -30 \"${logFile}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    printf \"\\n##########################################\\n\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    resetCodePage' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    exit 1' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  fi;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'resolveBackupPending() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local dbName=${1}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local dbUser=${2}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local dbPw=${3}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local msg=${4}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local scriptBaseName=${5}-backup' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local interval=${6}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local refDir=${7}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local rcThreshold=${8}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local cmdTermChar=${9}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local doQuiesce=${10}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local rc=0' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local restarted=0' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  [ -z \"${doQuiesce}\" ] && doQuiesce=1' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  if db2 -x \"SELECT 1 FROM TABLE(SYSPROC.SNAPSHOT_TBS_CFG(CURRENT SERVER,-1)) AS SN WHERE (MOD(TABLESPACE_STATE, 64) / 32) > 0 FETCH FIRST 1 ROW ONLY\" | grep -q 1; then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    echo BACKUP DB \"${dbName}\" TO /dev/null > \"${refDir}/${scriptBaseName}\".db2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    chmod 644 \"${refDir}/${scriptBaseName}\".db2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    dbTerminate > /dev/null' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    sleep 5' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    execDb2Script \"${msg}\" \"${scriptBaseName}\" \"${interval}\" \"${refDir}\" \"4\" \"${cmdTermChar}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    rc=$?' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    if [ \"${rc}\" = 4 ]; then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      sleep 5' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      execDb2Script \"${msg}\" \"${scriptBaseName}\" \"${interval}\" \"${refDir}\" \"4\" \"${cmdTermChar}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      rc=$?' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      if [ \"${rc}\" = 4 ]; then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        db2stop FORCE >> ${refDir}${scriptBaseName}.${dbName}.log' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        db2start >> ${refDir}${scriptBaseName}.${dbName}.log' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        execDb2Script \"${msg}\" \"${scriptBaseName}\" \"${interval}\" \"${refDir}\" \"${rcThreshold}\" \"${cmdTermChar}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        restarted=1' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      fi' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    fi' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    dbConnect ${dbName} ${dbUser} ${dbPw} >> ${refDir}${scriptBaseName}.${dbName}.log' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    if [ \"${restarted}\" = 1 -a \"${doQuiesce}\" = 1 ]; then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      db2 \"QUIESCE DB IMMEDIATE FORCE CONNECTIONS\" >> ${refDir}${scriptBaseName}.${dbName}.log' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    fi' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  fi' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'##########################################################################################' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# Verify usage:' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'cmd=`basename ${0}`' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'case \"${cmd}\" in' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  import*) scriptUsage=\"-d <dbName> [ -u <dbUser> -p <dbPw> ] -s <srcDbName>\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'           ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  load*)   scriptUsage=\"-d <dbName> [ -u <dbUser> -p <dbPw> ] -s <srcDbName>\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'           ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  *)       scriptUsage=\"-d <dbName> [ -u <dbUser> -p <dbPw> ]\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'           ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'esac' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'usage() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  local ec=${1:-250}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  printf \"Usage: $scriptUsage\\n\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  exit ${ec}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'while getopts d:u:p:s:fSx opt 2> /dev/null' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'do' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  case ${opt} in' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    f)  force=1            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    d)  dbName=${OPTARG}   ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    u)  dbUser=${OPTARG}   ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    p)  dbPw=${OPTARG}     ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    s)  srcDbName=${OPTARG};;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    S)  silent=1           ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    *)  usage              ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  esac' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'done' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'shift `expr ${OPTIND} - 1`' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'case \"${cmd}\" in' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  how*) ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  *)    [ -z \"${dbName}\"              ] && usage' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        [ -z \"${dbUser}\" -a \"${dbPw}\" ] && usage' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        [ -z \"${dbPw}\" -a \"${dbUser}\" ] && usage' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'esac' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'dbName=`echo ${dbName} | tr ''[:upper:]'' ''[:lower:]''`' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'srcDbName=`echo ${srcDbName} | tr ''[:upper:]'' ''[:lower:]''`' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'case \"${cmd}\" in' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  import*) [ -z \"${srcDbName}\" ] && usage;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  load*)   [ -z \"${srcDbName}\" ] && usage;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'esac' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10)");

return;

Sect2:
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'##########################################################################################' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# main routines' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'setup() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  dbConnect ${dbName} ${dbUser} ${dbPw}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  startBusy \"Retrieve shell-script setup.sh\" 0' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  db2 -x \"SELECT stmnt FROM " + qualViewNameMoveStmnts + " ORDER BY seqno\" | tb > setup.sh' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  rc=$?' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  assertDb2Rc \"${rc}\" \"setup.sh\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  stopBusy \"done. [rc=${rc}]\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  chmod 755 setup.sh' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ln -sf ./setup.sh genStatements.sh' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ln -sf ./setup.sh exportDb.sh' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ln -sf ./setup.sh importDb.sh' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ln -sf ./setup.sh loadDb.sh' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ln -sf ./setup.sh howto.sh' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  genStatements ${dbName} ${dbUser} ${dbPw}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'###########' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'genStatements() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  dbConnect ${dbName} ${dbUser} ${dbPw}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve export script export.1-prep.db2\"   \"SELECT STMNT FROM " + qualViewNameMoveExp + " WHERE PHASE = 1 ORDER BY SEQUENCENO\" export.1-prep'   || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve export script export.3-seq.db2\"    \"SELECT STMNT FROM " + qualViewNameMoveExp + " WHERE PHASE = 2 ORDER BY SEQUENCENO\" export.3-seq'    || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve export script export.4-org.db2\"    \"SELECT STMNT FROM " + qualViewNameMoveExp + " WHERE PHASE = 3 ORDER BY SEQUENCENO\" export.4-org'    || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve export script export.5-data.db2\"   \"SELECT STMNT FROM " + qualViewNameMoveExp + " WHERE PHASE = 4 ORDER BY SEQUENCENO\" export.5-data'   || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve export script export.6-finish.db2\" \"SELECT STMNT FROM " + qualViewNameMoveExp + " WHERE PHASE = 5 ORDER BY SEQUENCENO\" export.6-finish' || CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve import script import.1-prep.db2\"   \"SELECT STMNT FROM " + qualViewNameMoveImp + " WHERE PHASE = 1 ORDER BY SEQUENCENO\" import.1-prep' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve import script import.2-base.db2\"   \"SELECT STMNT FROM " + qualViewNameMoveImp + " WHERE PHASE = 2 ORDER BY SEQUENCENO\" import.2-base' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve import script import.3-part.db2\"   \"SELECT STMNT FROM " + qualViewNameMoveImp + " WHERE PHASE = 3 ORDER BY SEQUENCENO\" import.3-part' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve import script import.4-data.db2\"   \"SELECT STMNT FROM " + qualViewNameMoveImp + " WHERE PHASE = 4 ORDER BY SEQUENCENO\" import.4-data' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve import script import.7-finish.db2\" \"SELECT STMNT FROM " + qualViewNameMoveImp + " WHERE PHASE = 5 ORDER BY SEQUENCENO\" import.7-finish' || CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve load script load.1-prep.db2\"       \"SELECT STMNT FROM " + qualViewNameMoveLoad + " WHERE PHASE = 1 ORDER BY SEQUENCENO\" load.1-prep'   || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve load script load.2-base.db2\"       \"SELECT STMNT FROM " + qualViewNameMoveLoad + " WHERE PHASE = 2 ORDER BY SEQUENCENO\" load.2-base'   || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve load script load.3-part.db2\"       \"SELECT STMNT FROM " + qualViewNameMoveLoad + " WHERE PHASE = 3 ORDER BY SEQUENCENO\" load.3-part'   || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve load script load.4-data.db2\"       \"SELECT STMNT FROM " + qualViewNameMoveLoad + " WHERE PHASE = 4 ORDER BY SEQUENCENO\" load.4-data'   || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Cmd \"Retrieve load script load.7-finish.db2\"     \"SELECT STMNT FROM " + qualViewNameMoveLoad + " WHERE PHASE = 5 ORDER BY SEQUENCENO\" load.7-finish' || CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  chmod 644 export.1-prep.db2 export.3-seq.db2 export.4-org.db2 export.5-data.db2 export.6-finish.db2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ls ./MDSDB-*Rel*-Prep.db2 2> /dev/null | xargs chmod 644' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  chmod 644 import.1-prep.db2 import.2-base.db2 import.3-part.db2 import.4-data.db2 import.7-finish.db2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  chmod 644 load.1-prep.db2 load.2-base.db2 load.3-part.db2 load.4-data.db2 load.7-finish.db2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  chmod 777 .' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'###########' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'exportDb() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  resetCodePage' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  dbConnect ${dbName} ${dbUser} ${dbPw}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Quiesce source database\" \"export.1-prep\" 0' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  prepFile=`ls ./MDSDB-*Rel*-Prep.db2 2> /dev/null | sort -r | head -1`' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  if [ -f \"$prepFile\" ]; then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    ln -sf \"$prepFile\" \"export.2-prep.db2\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    execDb2Script \"Update DB structure\" \"export.2-prep\" 1 \"\" \"\" \"@\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  fi' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Export sequences\" \"export.3-seq\" 1' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  grep ALTER export.3-seq.${dbName}.log > import.5-seq.${dbName}.db2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  grep ALTER export.3-seq.${dbName}.log > load.5-seq.${dbName}.db2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  chmod 644 import.5-seq.${dbName}.db2 load.5-seq.${dbName}.db2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Export Organization OIDs\" \"export.4-org\" 1' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  grep UPDATE export.4-org.${dbName}.log | grep -v SELECT > import.6-org.${dbName}.db2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  grep UPDATE export.4-org.${dbName}.log | grep -v SELECT > load.6-org.${dbName}.db2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  chmod 644 import.6-org.${dbName}.db2 load.6-org.${dbName}.db2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  mkdir -p \"${dbName}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  cd \"${dbName}\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  chmod 755 .' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  setCodePage1208 ${dbName} ${dbUser} ${dbPw}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Export data\" \"export.5-data\" 10 \"../\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  resetCodePage' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ls | xargs chmod 644' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  cd ..' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Unquiesce source database\" \"export.6-finish\" 0' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'###########' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'importDb() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  dbConnect ${dbName} ${dbUser} ${dbPw}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  cd ${srcDbName}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Prepare database for import\" \"import.1-prep\"              1 \"../\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  setCodePage1208 ${dbName} ${dbUser} ${dbPw}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Import base data\"            \"import.2-base\"             10 \"../\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  resetCodePage' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Add table partitions\"        \"import.3-part\"             10 \"../\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  setCodePage1208 ${dbName} ${dbUser} ${dbPw}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Import data\"                 \"import.4-data\"             10 \"../\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  resetCodePage' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  checkForReject \"import.4-data.${dbName}.log\" \"Import\" \"../\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Import sequence values\"      \"import.5-seq.${srcDbName}\"  1 \"../\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Import Organization OIDs\"    \"import.6-org.${srcDbName}\"  1 \"../\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Finalizing database\"         \"import.7-finish\"            1 \"../\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'###########' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'loadDb() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  dbConnect ${dbName} ${dbUser} ${dbPw}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  cd ${srcDbName}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Prepare database for load\" \"load.1-prep\"              1 \"../\"'   || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  setCodePage1208 ${dbName} ${dbUser} ${dbPw}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Load base data\"            \"load.2-base\"             10 \"../\" 2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  resetCodePage' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  resolveBackupPending \"${dbName}\" \"${dbUser}\" \"${dbPw}\" \"Resolving ''Backup Pending'' state\" \"load.2-base\" 10 \"../\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Add table partitions\"      \"load.3-part\"             10 \"../\"'   || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  setCodePage1208 ${dbName} ${dbUser} ${dbPw}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Load data\"                 \"load.4-data\"             10 \"../\" 2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  resetCodePage' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  checkForReject \"load.4-data.${dbName}.log\" \"Load\" \"../\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  resolveBackupPending \"${dbName}\" \"${dbUser}\" \"${dbPw}\" \"Resolving ''Backup Pending'' state\" \"load.4-data\" 10 \"../\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Import sequence values\"    \"load.5-seq.${srcDbName}\"  1 \"../\"'   || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Import Organization OIDs\"  \"load.6-org.${srcDbName}\"  1 \"../\"'   || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  execDb2Script \"Finalizing database\"       \"load.7-finish\"            1 \"../\" 3' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'###########' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10)");

return;

Sect3:

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'howTo() {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  cat << __EOF' || CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'Steps to move data between MDS-databases:' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'* Prerequisites:' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - Take a copy of a R1.1.1 database (BACKUP & RESTORE) - called ''source database'' below. This backup is' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    then being used as source for the R1.2 load.' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    Note: During step 2 below this database copy will structurally be modified so that it is equivalent' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'          to release 1.2. Thus, this copy afterwards should not be used for any MDS-environment.' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - The source database is at least release 1.1.1.' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - The new database - called ''target database'' below - is a release 1.2 database. (This supports Range Partitioning.)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - Setup of a shared directory (e.g. /mig12/expImpDir) called <expImpDir> which is accessible from both database' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    servers, source and target.' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - If data for ''extra'' MPCs is supposed to be imported from source to target database, the DDL for the extra MPCs must be' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    deployed in the target database before and MPCs ''Meta Data'' must initialized before step 1. This corresponds to chapters' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    ''DDL-Deployment for New MPC'' and ''Initialize MPC-Meta Data'' in document ''DR09 - Databases and Files''.' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    In case that directory <expImpDir> is NOT a shared directory accessible from source as well as target database,' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    directory <expImpDir> needs to be re-copied to the other environment after each Step such that it can be' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    accessed from target database. In this case <expImpDir> in the description of of step 3 refers to the copy' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    of this directory in the target environment.' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    Notes:' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      - When copying directory <expImpDir> make sure that file system permissions are NOT modified.' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      - Make sure directory <expImpDir> provides sufficient disk space for export-data.' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        (~ 80GB assuming 3 MPCs and standard product structures)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'* Step1: Create Shell- and DB2-scripts from target database:' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  As instance owner of the target database (or user with sufficient GRANTs) execute the following commands' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  which in a first step create a shell-script. In a second step this script is used to create further' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  scripts for actually exporting data from source database and loading into target database.' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - mkdir -p <expImpDir> # where <expImpDir> is an appropriate empty directory, user should own this directory' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - cd <expImpDir>' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - cp <...>/MDSDB-Rel1.2-Prep.db2 .' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'    # where <...>/MDSDB-Rel1.2-Prep.db2 is the ''src DB update script'' from the ddlfix/releaseupdate/rel1.2 folder' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - db2 \"CONNECT TO <targetDbName>\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - db2 -x \"SELECT stmnt FROM " + qualViewNameMoveStmnts + " ORDER BY seqno\" | sed ''s/[ ]*$//'' > setupTmp.sh' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - chmod 755 setupTmp.sh' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - ./setupTmp.sh -d <targetDbName>' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'* Step 2: Export data from source database:' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  As instance owner of the source database (or user with sufficient GRANTs) execute the following commands' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  which create a subdirectory <sourceDbName> and export data from source database into this directory.' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - cd <expImpDir>' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - nohup ./exportDb.sh -d <sourceDbName> > exportDb.log&' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - tail -f exportDb.log' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'* Step 3:' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  As instance owner of the target database (or user with sufficient GRANTs) execute the following commands' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  which load the exported data into the target database.' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - cd <expImpDir>' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - nohup ./loadDb.sh -d <targetDbName> -s <sourceDbName> > loadDb.log&' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  - tail -f loadDb.log' || CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'__EOF' || CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'}' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'##########################################################################################' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# select routine to call' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'silent=1' || CHR(10) ||");
//  Print #fileNo, addTab(2); "'[ -t 1 ] || silent=1' || CHR(10) ||"
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'case $cmd in' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  genStat*) silent=1' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            genStatements' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  export*)  exportDb' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  import*)  importDb' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  load*)    loadDb' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  how*)     howTo' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  *)        silent=1' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            setup' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'esac'");
}


public static void genDbAdminDdl0(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
// we do not support this for LDM
return;
}

// ####################################################################################################################
// #    SP for querying 'DB2 Level'
// ####################################################################################################################

String qualProcedureNameGetDb2Level;
qualProcedureNameGetDb2Level = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGetDb2Level, ddlType, null, null, null, null, null, null);
M22_Class_Utilities.printSectionHeader("SP for querying 'DB2 Level'", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameGetDb2Level);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "OUT", "major_out", "INTEGER", true, "major DB2 release level");
M11_LRT.genProcParm(fileNo, "OUT", "minor_out", "INTEGER", true, "minor DB2 release level");
M11_LRT.genProcParm(fileNo, "OUT", "level_out", "INTEGER", true, "minor DB2 version level");
M11_LRT.genProcParm(fileNo, "OUT", "fp_out", "INTEGER", false, "DB2 fixpack number");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "READS SQL DATA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_levelStr", "VARCHAR(100)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_elem", "VARCHAR(100)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_strPos", "INTEGER", "NULL", null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET major_out = NULL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET minor_out = NULL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET level_out = NULL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET fp_out    = NULL;");

M11_LRT.genProcSectionHeader(fileNo, "determine DB2-level as string", null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "UPPER(SERVICE_LEVEL),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FIXPACK_NUM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "v_levelStr,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "fp_out");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TABLE(SYSPROC.ENV_GET_INST_INFO()) AS INSTANCEINFO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FETCH FIRST 1 ROW ONLY;");

M11_LRT.genProcSectionHeader(fileNo, "parse DB2-level", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR elemLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "POSINDEX           AS c_posIndex,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RTRIM(LTRIM(ELEM)) AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(v_levelStr, CAST('.' AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "POSINDEX ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "strip off non-numeric characters", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_elem = c_elem;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_strPos = POSSTR(c_elem, ' ');");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_strPos > 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_elem = REPLACE(TRANSLATE(RIGHT(v_elem, LENGTH(v_elem) - v_strPos), '                          ', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'), ' ', '');");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "retrieve result values", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "    IF (c_posIndex = 0) THEN SET major_out = INTEGER(v_elem);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSEIF (c_posIndex = 1) THEN SET minor_out = INTEGER(v_elem);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSEIF (c_posIndex = 2) THEN SET level_out = INTEGER(v_elem);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    UDF retrieving 'DB2 Release'
// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("Function retrieving 'DB2 (minor) Release'", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE FUNCTION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_qualFuncNameDb2Release);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RETURNS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_dbtDbRelease);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "DETERMINISTIC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "NO EXTERNAL ACTION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN ATOMIC");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_major", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_minor", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_level", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_fp", "INTEGER", "NULL", null, null);

M11_LRT.genProcSectionHeader(fileNo, "determine DB2-level", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameGetDb2Level + "(v_major, v_minor, v_level, v_fp);");

M11_LRT.genProcSectionHeader(fileNo, "return result", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "RETURN v_major + (DECIMAL(v_minor)/100) + (DECIMAL(v_level)/100000);");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for creating Aliases for LRT-tables in 'private-only Alias Schema'
// ####################################################################################################################

String qualProcedureNameCreateLrtAliases;
qualProcedureNameCreateLrtAliases = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnCreateLrtAliases, ddlType, null, null, null, null, null, null);
M22_Class_Utilities.printSectionHeader("SP for creating Aliases for LRT-tables in 'private-only Alias Schema'", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameCreateLrtAliases);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "organizationId_in", M01_Globals.g_dbtEnumId, true, "(optional) identifies the organization to create Aliases for");
M11_LRT.genProcParm(fileNo, "IN", "accessMode_in", M01_Globals.g_dbtEnumId, true, "(optional) identifies the access mode of the data pool to create Aliases for");
M11_LRT.genProcParm(fileNo, "OUT", "aliasCount_out", "INTEGER", true, "number of Aliases created");
M11_LRT.genProcParm(fileNo, "OUT", "viewCount_out", "INTEGER", false, "number of Views created");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "objectNotExists", "42704", null);
M11_LRT.genCondDecl(fileNo, "aliasIsView", "42809", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(1000)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_colList", "VARCHAR(500)", "''", null, null);
M11_LRT.genVarDecl(fileNo, "v_colValList", "VARCHAR(500)", "''", null, null);
M11_LRT.genVarDecl(fileNo, "v_seqNo", "INTEGER", "1", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR objectNotExists");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR aliasIsView");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 1000, null, null, null, null, null, null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameCreateLrtAliases, ddlType, null, "mode_in", "organizationId_in", "accessMode_in", "aliasCount_out", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET aliasCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET viewCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "loop over matching LRT-tables and create Alias for 'private only'", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPRIV." + M01_Globals.g_anPdmFkSchemaName + " AS c_schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "S.PRIVATESCHEMANAME AS c_privSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPRIV." + M01_Globals.g_anPdmTableName + " AS c_privTableName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPUB." + M01_Globals.g_anPdmTableName + " AS c_pubTableName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameAcmEntity + " A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " LPRIV");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityType + " = LPRIV." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityName + " = LPRIV." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntitySection + " = LPRIV." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(LPRIV." + M01_Globals.g_anLdmIsLrt + " = 1 OR A." + M01_Globals.g_anAcmIsLrtMeta + " = 1)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPRIV." + M01_Globals_IVK.g_anLdmIsMqt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " LPUB");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityType + " = LPUB." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityName + " = LPUB." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntitySection + " = LPUB." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPUB." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPUB." + M01_Globals_IVK.g_anLdmIsMqt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " PPRIV");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPRIV." + M01_Globals.g_anPdmLdmFkSchemaName + " = LPRIV." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPRIV." + M01_Globals.g_anPdmLdmFkTableName + " = LPRIV." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " PPUB");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPUB." + M01_Globals.g_anPdmLdmFkSchemaName + " = LPUB." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPUB." + M01_Globals.g_anPdmLdmFkTableName + " = LPUB." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmPrimarySchema + " S");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "S." + M01_Globals.g_anOrganizationId + " = PPUB." + M01_Globals.g_anOrganizationId);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "S." + M01_Globals.g_anPoolTypeId + " = PPUB." + M01_Globals.g_anPoolTypeId);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "S.PRIVATESCHEMANAME IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPRIV." + M01_Globals.g_anLdmIsNl + " = LPUB." + M01_Globals.g_anLdmIsNl);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPRIV." + M01_Globals.g_anLdmIsGen + " = LPUB." + M01_Globals.g_anLdmIsGen);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPRIV." + M01_Globals.g_anOrganizationId + " = PPUB." + M01_Globals.g_anOrganizationId);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPRIV." + M01_Globals.g_anPoolTypeId + " = PPUB." + M01_Globals.g_anPoolTypeId);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(organizationId_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(COALESCE(PPUB." + M01_Globals.g_anOrganizationId + ", organizationId_in) = organizationId_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(accessMode_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(COALESCE(PPUB." + M01_Globals.g_anPoolTypeId + ", accessMode_in) = accessMode_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "drop Alias / View - if exists", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP ALIAS ' || c_privSchemaName || '.' || c_pubTableName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP VIEW ' || c_privSchemaName || '.' || c_pubTableName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "create Alias", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'CREATE ALIAS ' || c_privSchemaName || '.' || c_pubTableName || ' FOR ' || c_schemaName || '.' || c_privTableName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET aliasCount_out = aliasCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "aliasCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "loop over matching LRT-tables and create Alias / View for 'public only'", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals_IVK.g_anAcmCondenseData + " AS c_condenseData,");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(CASE WHEN A." + M01_Globals.g_anAcmEntityType + " = 'C' AND A." + M01_Globals.g_anAcmEntityId + " = A." + M01_Globals.g_anAhCid + " THEN 1 ELSE 0 END) AS c_isAggHead,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPUB." + M01_Globals.g_anPdmFkSchemaName + " AS c_schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "S.PUBLICSCHEMANAME AS c_pubSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPUB." + M01_Globals.g_anPdmTableName + " AS c_pubTableName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameAcmEntity + " A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " LPUB");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityType + " = LPUB." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityName + " = LPUB." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntitySection + " = LPUB." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPUB." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPUB." + M01_Globals_IVK.g_anLdmIsMqt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " PPUB");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPUB." + M01_Globals.g_anPdmLdmFkSchemaName + " = LPUB." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPUB." + M01_Globals.g_anPdmLdmFkTableName + " = LPUB." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmPrimarySchema + " S");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PPUB." + M01_Globals.g_anOrganizationId + " IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(S." + M01_Globals.g_anOrganizationId + " = PPUB." + M01_Globals.g_anOrganizationId + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PPUB." + M01_Globals.g_anPoolTypeId + " IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(S." + M01_Globals.g_anPoolTypeId + " = PPUB." + M01_Globals.g_anPoolTypeId + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(organizationId_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(COALESCE(S." + M01_Globals.g_anOrganizationId + ", organizationId_in) = organizationId_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(accessMode_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(COALESCE(S." + M01_Globals.g_anPoolTypeId + ", accessMode_in) = accessMode_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "drop Alias / View - if exists", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP ALIAS ' || c_pubSchemaName || '.' || c_pubTableName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP VIEW ' || c_pubSchemaName || '.' || c_pubTableName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (c_condenseData = 1) AND (c_isAggHead = 1) THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_colList    = '';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_colValList = '';");

M11_LRT.genProcSectionHeader(fileNo, "loop over columns to build column lists", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR colLoop AS");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "V_MandatoryColumns");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "colName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "defaultValue");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "VALUES('" + M01_Globals.g_anInLrt + "', 'CAST(NULL AS " + M01_Globals.g_dbtOid + ")')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "VALUES('" + M01_Globals.g_anAhOid + "', 'CAST(NULL AS " + M01_Globals.g_dbtOid + ")')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "V_ExistingColumns");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "colName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "colNo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "COLNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "COLNO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SYSCAT.COLUMNS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "TABSCHEMA = c_schemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "TABNAME = c_pubTableName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE(E.colNo, -1) AS c_colNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE(E.colName, M.colName) AS c_colName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "M.defaultValue");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "V_ExistingColumns E");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FULL OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "V_MandatoryColumns M");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.colName = M.colName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY COALESCE(E.colNo, -1)");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_colList = v_colList || (CASE WHEN v_colList = '' THEN '' ELSE ',' END) || c_colName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_colValList = v_colValList || (CASE WHEN v_colValList = '' THEN '' ELSE ',' END) || (CASE WHEN c_colNo < 0 THEN defaultValue ELSE c_colName END);");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "create View (to include 'missing column(s))", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'CREATE VIEW ' || c_pubSchemaName || '.' || c_pubTableName || ' (' || v_colList || ') AS SELECT ' || v_colValList || ' FROM ' || c_schemaName || '.' || c_pubTableName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET viewCount_out = viewCount_out + 1;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");

M11_LRT.genProcSectionHeader(fileNo, "create Alias", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'CREATE ALIAS ' || c_pubSchemaName || '.' || c_pubTableName || ' FOR ' || c_schemaName || '.' || c_pubTableName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET aliasCount_out = aliasCount_out + 1;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
// ### ELSE IVK ###
// genProcSectionHeader fileNo, "create Alias", 3, True
// Print #fileNo, addTab(2); "SET v_stmntTxt = 'CREATE ALIAS ' || c_pubSchemaName || '.' || c_pubTableName || ' FOR ' || c_schemaName || '.' || c_pubTableName;"
// Print #fileNo, addTab(2); "SET aliasCount_out = aliasCount_out + 1;"
// ### ENDIF IVK ###

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "aliasCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmntCursor;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameCreateLrtAliases, ddlType, null, "mode_in", "organizationId_in", "accessMode_in", "aliasCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
}


public static void genDbAdminDdl1(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (M03_Config.generateFwkTest) {
return;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
// ### IF IVK ###
// we do not support most of this for LDM
goto LdmEntryPoint;
// ### ELSE IVK ###
//   ' we do not support this for LDM
//   Exit Sub
// ### ENDIF IVK ###
}

// ### IF IVK ###
String unqualTabNameApplVersion;
unqualTabNameApplVersion = M04_Utilities.getUnqualObjName(M01_Globals_IVK.g_qualTabNameApplVersion);

String unqualTabNameApplHistory;
unqualTabNameApplHistory = M04_Utilities.getUnqualObjName(M01_Globals_IVK.g_qualTabNameApplHistory);

// ### ENDIF IVK ###
String qualProcedureNameTrigDisable;
qualProcedureNameTrigDisable = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnTriggerDisable, ddlType, null, null, null, null, null, null);
String qualProcedureNameTrigEnable;
qualProcedureNameTrigEnable = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnTriggerEnable, ddlType, null, null, null, null, null, null);

// ### IF IVK ###
// ####################################################################################################################
// #    View defining the ACM 'core class-IDs'
// ####################################################################################################################

String qualViewNameCore;
qualViewNameCore = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnAcmCoreEntityId, M01_ACM.vsnAcmCoreEntityId, ddlType, null, null, null, null, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("View defining the ACM 'core class-IDs'", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE VIEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualViewNameCore);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmEntityId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

boolean firstClass;
firstClass = true;
String typeKey;
typeKey = M01_Globals.gc_acmEntityTypeKeyClass;

int i;
for (int i = 1; i <= M22_Class.g_classes.numDescriptors; i++) {
if (M22_Class.g_classes.descriptors[i].isCore) {
if (!(firstClass)) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "UNION");
}
firstClass = false;
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES('" + M22_Class.g_classes.descriptors[i].classIdStr + "','" + typeKey + "')");
}
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ### ENDIF IVK ###
String qualTabName;
String unqualTabName;
String schemaName;

// ####################################################################################################################
// #    View for 'PDM tables involved in IMPORT / EXPORT'
// ####################################################################################################################

String qualViewNameExpImpTab;
qualViewNameExpImpTab = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnPdmExportTabList, M01_ACM.vnsPdmExportTabList, ddlType, null, null, null, null, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("View for 'PDM tables involved in IMPORT / EXPORT'", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE VIEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualViewNameExpImpTab);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmFkSequenceNo + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPdmTypedTableName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmEntityId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmEntityType + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anOrganizationId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPoolTypeId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsNl + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsGen + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsLrt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anLdmIsMqt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsCto + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsCtp + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsRangePartAll + ",");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anAcmIsPs + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ISORGIDTAGGED,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anAcmIsPsForming);
// ### ELSE IVK ###
// Print #fileNo, addTab(1); "ISORGIDTAGGED"
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_SysTables");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "RTRIM(TABSCHEMA) AS tabSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "RTRIM(TABNAME) AS tabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "type");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_ExtraTables");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tabSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "isOrgIdTagged,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "seqNo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M24_Attribute_Utilities.AttributeListTransformation transformation;
M24_Attribute_Utilities.EntityColumnDescriptors tabColumns;
boolean firstRow;
firstRow = true;
boolean isOrgIdTagged;
// ### IF IVK ###
for (int i = 1; i <= M22_Class.g_classes.numDescriptors; i++) {
if (M22_Class.g_classes.descriptors[i].includeInPdmExportSeqNo >= 0) {
isOrgIdTagged = false;
qualTabName = M04_Utilities.genQualTabNameByClassIndex(M22_Class.g_classes.descriptors[i].classIndex, ddlType, null, null, null, null, null, null, null, null, null);
unqualTabName = M04_Utilities.getUnqualObjName(qualTabName);
schemaName = M04_Utilities.getSchemaName(qualTabName);

if (M22_Class.g_classes.descriptors[i].isCommonToOrgs) {
tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 0, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
M24_Attribute.genTransformedAttrListForEntityWithColReuse(M22_Class.g_classes.descriptors[i].classIndex, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

int k;
for (int k = 1; k <= tabColumns.numDescriptors; k++) {
if (tabColumns.descriptors[k].columnName.compareTo(M01_Globals.g_anOrganizationId) == 0) {
isOrgIdTagged = true;
}
}
}

if (firstRow) {
firstRow = false;
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT T.TABSCHEMA, T.TABNAME, " + M01_Globals.g_dbtBoolean + "(" + (isOrgIdTagged ? M01_LDM.gc_dbTrue : M01_LDM.gc_dbFalse) + "), " + String.valueOf(M22_Class.g_classes.descriptors[i].includeInPdmExportSeqNo) + " FROM V_SysTables T WHERE");

M00_FileWriter.printToFile(fileNo, " T.TABSCHEMA LIKE '" + schemaName.toUpperCase() + "%'");
M00_FileWriter.printToFile(fileNo, " AND");
M00_FileWriter.printToFile(fileNo, " T.TABNAME = '" + unqualTabName.toUpperCase() + "'");
M00_FileWriter.printToFile(fileNo, " AND");
M00_FileWriter.printToFile(fileNo, " T.TYPE = 'T'");
}
}

for (int i = 1; i <= M23_Relationship.g_relationships.numDescriptors; i++) {
if (M23_Relationship.g_relationships.descriptors[i].includeInPdmExportSeqNo >= 0 & ! )) {
if (firstRow) {
firstRow = false;
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT T.TABSCHEMA, T.TABNAME, " + M01_Globals.g_dbtBoolean + "(0), " + String.valueOf(M23_Relationship.g_relationships.descriptors[i].includeInPdmExportSeqNo) + " FROM V_SysTables T WHERE");

qualTabName = M04_Utilities.genQualTabNameByRelIndex(M23_Relationship.g_relationships.descriptors[i].relIndex, ddlType, null, null, null, null, null, null, null, null);
unqualTabName = M04_Utilities.getUnqualObjName(qualTabName);
schemaName = M04_Utilities.getSchemaName(qualTabName);

M00_FileWriter.printToFile(fileNo, " T.TABSCHEMA LIKE '" + schemaName.toUpperCase() + "%'");
M00_FileWriter.printToFile(fileNo, " AND");
M00_FileWriter.printToFile(fileNo, " T.TABNAME = '" + unqualTabName.toUpperCase() + "'");
M00_FileWriter.printToFile(fileNo, " AND");
M00_FileWriter.printToFile(fileNo, " T.TYPE = 'T'");
}
}

// ### ENDIF IVK ###
if (firstRow) {
// no extra tables defined
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(NULL AS VARCHAR(1)),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(NULL AS VARCHAR(1)),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(NULL AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(NULL AS INTEGER)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSIBM.SYSDUMMY1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(0 = 1)");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "L." + M01_Globals.g_anLdmFkSequenceNo + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "P." + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "P." + M01_Globals.g_anPdmTableName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "A." + M01_Globals.g_anAcmEntityId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "A." + M01_Globals.g_anAcmEntityType + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "P." + M01_Globals.g_anOrganizationId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "P." + M01_Globals.g_anPoolTypeId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "L." + M01_Globals.g_anLdmIsNl + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "L." + M01_Globals.g_anLdmIsGen + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "L." + M01_Globals.g_anLdmIsLrt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "L." + M01_Globals_IVK.g_anLdmIsMqt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "A." + M01_Globals.g_anAcmIsCto + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "A." + M01_Globals.g_anAcmIsCtp + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "A." + M01_Globals.g_anAcmIsRangePartAll + ",");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "A." + M01_Globals_IVK.g_anAcmIsPs + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "A." + M01_Globals_IVK.g_anAcmIsPsForming);
// ### ELSE IVK ###
// Print #fileNo, addTab(2); "CAST(0 AS "; g_dbtBoolean; ")"
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_qualTabNameLdmTable + " L,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_qualTabNamePdmTable + " P,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_qualTabNameAcmEntity + " A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "P." + M01_Globals.g_anPdmLdmFkSchemaName + " = L." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "P." + M01_Globals.g_anPdmLdmFkTableName + " = L." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "A." + M01_Globals.g_anAcmEntitySection + " = L." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "A." + M01_Globals.g_anAcmEntityName + " = L." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "A." + M01_Globals.g_anAcmEntityType + " = L." + M01_Globals.g_anAcmEntityType);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "0,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T.tabSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T.tabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(NULL AS " + M01_Globals.g_dbtEntityId + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'M',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "1,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "0,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_SysTables T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T.tabSchema LIKE '" + M04_Utilities.genSchemaName("%", "%", ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals_IVK.g_migDataPoolIndex) + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T.type = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNamePdmTable + " P");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anPdmTableName + " = T.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T.seqNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T.tabSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T.tabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(NULL AS " + M01_Globals.g_dbtEntityId + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'M',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(NULL AS " + M01_Globals.g_dbtEnumId + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(NULL AS " + M01_Globals.g_dbtEnumId + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T.isOrgIdTagged,");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(0 AS " + M01_Globals.g_dbtBoolean + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ExtraTables T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T.tabSchema NOT LIKE '" + M04_Utilities.genSchemaName("%", "%", ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals_IVK.g_migDataPoolIndex) + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNamePdmTable + " P");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anPdmTableName + " = T.tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    View for 'EXPORT statements for PDM tables'
// ####################################################################################################################

String qualViewNameExp;
qualViewNameExp = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnPdmExportStmnt, M01_ACM.vnsPdmExportStmnt, ddlType, null, null, null, null, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("View for 'EXPORT statements for PDM tables'", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE VIEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualViewNameExp);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmFkSequenceNo + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPdmTypedTableName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmEntityId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmEntityType + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anOrganizationId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPoolTypeId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsNl + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsGen + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsLrt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anLdmIsMqt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsCto + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsCtp + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsRangePartAll + ",");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anAcmIsPs + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anAcmIsPsForming + ",");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_ColSeq");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "level,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "colSeq,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "tabschema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "tabname");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "0,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(C.COLNAME AS VARCHAR(8000)),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "C.TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "C.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.COLUMNS C,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.TABLES T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "C.COLNO = 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "C.TABSCHEMA = T.TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "C.TABNAME = T.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T.TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "S.LEVEL + 1,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(S.colSeq || ',' || C.COLNAME AS VARCHAR(8000)),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "C.TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "C.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ColSeq S,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.COLUMNS C");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "S.tabSchema = C.TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "S.tabName = C.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "C.COLNO = S.level + 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "S.level < 5000");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + " V_ColSeqMaxLevel");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "level,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "tabschema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "tabname");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "MAX(LEVEL),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ColSeq");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "GROUP BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_ColSeqMax");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "colSeq,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "tabschema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "tabname");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "colSeq,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ColSeq.tabSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ColSeq.tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ColSeq,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ColSeqMaxLevel");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ColSeq.level = V_ColSeqMaxLevel.level");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ColSeq.tabSchema = V_ColSeqMaxLevel.tabSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ColSeq.tabName = V_ColSeqMaxLevel.tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anLdmFkSequenceNo + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anPdmTypedTableName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmEntityId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmEntityType + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anOrganizationId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anPoolTypeId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anLdmIsNl + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anLdmIsGen + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anLdmIsLrt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals_IVK.g_anLdmIsMqt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmIsCto + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmIsCtp + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmIsRangePartAll + ",");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals_IVK.g_anAcmIsPs + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals_IVK.g_anAcmIsPsForming + ",");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'EXPORT TO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T." + M01_Globals.g_anPdmFkSchemaName + " || '.' || T." + M01_Globals.g_anPdmTypedTableName + " ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'.ixf OF IXF LOBFILE ' || T." + M01_Globals.g_anPdmFkSchemaName + " || '.' || T." + M01_Globals.g_anPdmTypedTableName + " ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "' MODIFIED BY LOBSINFILE SELECT ' || COALESCE(C.colSeq, '*') || ' FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T." + M01_Globals.g_anPdmFkSchemaName + " || '.' || T." + M01_Globals.g_anPdmTypedTableName + " ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(CASE T.ISORGIDTAGGED WHEN 1 THEN ' WHERE (" + M01_Globals.g_anOrganizationId + " < " + String.valueOf(M71_Org_Utilities.getMinOrgId()) + " OR " + M01_Globals.g_anOrganizationId + " > " + String.valueOf(M71_Org_Utilities.getMaxOrgId()) + ")' ELSE '' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AS VARCHAR(4000)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualViewNameExpImpTab + " T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ColSeqMax C");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anPdmFkSchemaName + " = C.tabSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anPdmTypedTableName + " = C.tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    View for 'EXPORT statements for PDM tables for DB-Move'
// ####################################################################################################################

String qualViewNameMoveExp;
qualViewNameMoveExp = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnPdmExportStmntMove, M01_ACM.vnsPdmExportStmntMove, ddlType, null, null, null, null, null, null, null, null, null, null);

String qualViewNameMoveImp;
qualViewNameMoveImp = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnPdmImportStmntMove, M01_ACM.vnsPdmImportStmntMove, ddlType, null, null, null, null, null, null, null, null, null, null);

String qualViewNameMoveLoad;
qualViewNameMoveLoad = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnPdmLoadStmntMove, M01_ACM.vnsPdmLoadStmntMove, ddlType, null, null, null, null, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("View for 'EXPORT statements for PDM tables for DB-Move'", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE VIEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualViewNameMoveExp);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SEQUENCENO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "PHASE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_ExportBase");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROWNUMBER() OVER (ORDER BY " + M01_Globals.g_anLdmFkSequenceNo + " ASC, " + M01_Globals.g_anOrganizationId + " ASC, " + M01_Globals.g_anPoolTypeId + " ASC),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualViewNameExp);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmEntityType + " IN ('M', '" + M01_Globals.gc_acmEntityTypeKeyClass + "', '" + M01_Globals.gc_acmEntityTypeKeyRel + "')");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "COALESCE(" + M01_Globals.g_anPoolTypeId + ", " + String.valueOf(M01_Globals.g_workDataPoolId) + ") IN (" + String.valueOf(M01_Globals.g_workDataPoolId) + ", " + String.valueOf(M01_Globals_IVK.g_productiveDataPoolId) + ", " + String.valueOf(M01_Globals_IVK.g_archiveDataPoolId) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anPdmTypedTableName + " NOT IN ('" + unqualTabNameApplVersion + "', '" + unqualTabNameApplHistory + "')");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_ExportMisc");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "phase,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

// ### IF IVK ###
final int PhaseExportQuiesce = 1;
final int PhaseExportSequence = 2;
final int PhaseExportOrgOid = 3;
final int PhaseExportData = 4;
final int PhaseExportUnQuiesce = 5;

M11_LRT.genProcSectionHeader(fileNo, "export OIDs of Organization", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "1,");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + String.valueOf(PhaseExportOrgOid) + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'SELECT ''UPDATE " + M01_Globals.g_qualTabNamePdmOrganization + " SET ORGOID = '' || RTRIM(CHAR(ORGOID)) || '' WHERE ID = '' || RTRIM(CHAR(ID)) ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'" + M01_Globals.g_qualTabNamePdmOrganization + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");
// ### ELSE IVK ###
// Const PhaseExportQuiesce = 1
// Const PhaseExportSequence = 2
// Const PhaseExportData = 3
// Const PhaseExportUnQuiesce = 4
// ### ENDIF IVK ###

M11_LRT.genProcSectionHeader(fileNo, "export values of sequences", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "1,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + String.valueOf(PhaseExportSequence) + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'VALUES(''ALTER SEQUENCE ' || RTRIM(SEQSCHEMA) || '.' || SEQNAME || ' RESTART WITH '' || RTRIM(CHAR(NEXTVAL FOR ' || RTRIM(SEQSCHEMA) || '.' || SEQNAME || ')))'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.SEQUENCES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SEQSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SEQSCHEMA NOT LIKE '" + M04_Utilities.genSchemaName("%", "%", ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals_IVK.g_migDataPoolIndex) + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SEQSCHEMA NOT LIKE '" + M01_Globals.g_schemaNameCtoDbMonitor + "%'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SEQNAME NOT LIKE 'RUNNINGNMB%'");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "quiesce DB", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (1, " + String.valueOf(PhaseExportQuiesce) + ", 'QUIESCE DB IMMEDIATE FORCE CONNECTIONS')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "make sure that Snapshot-Tables are available", 1, true);
String qualProcNameReCreateSnapshots;
qualProcNameReCreateSnapshots = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbMonitor, M01_ACM.spnReCreateSnapshotTables, ddlType, null, null, null, null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (2, " + String.valueOf(PhaseExportQuiesce) + ", 'CALL " + qualProcNameReCreateSnapshots + "(2, ?)')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "unquiesce DB", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (1, " + String.valueOf(PhaseExportUnQuiesce) + ", 'UNQUIESCE DB')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_StmntAll");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "phase,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + String.valueOf(PhaseExportData) + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ExportBase");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "phase,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ExportMisc");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROWNUMBER() OVER (ORDER BY phase ASC, sequenceNo ASC),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "phase,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_StmntAll");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");

M00_FileWriter.printToFile(fileNo, M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    View for 'IMPORT statements for PDM tables'
// ####################################################################################################################

String qualViewNameImp;
qualViewNameImp = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnPdmImportStmnt, M01_ACM.vnsPdmImportStmnt, ddlType, null, null, null, null, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("View for 'IMPORT statements for PDM tables'", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE VIEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualViewNameImp);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmFkSequenceNo + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPdmTypedTableName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmEntityId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmEntityType + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anOrganizationId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPoolTypeId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsNl + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsGen + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsLrt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anLdmIsMqt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsCto + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsCtp + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsRangePartAll + ",");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anAcmIsPs + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anAcmIsPsForming + ",");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anLdmFkSequenceNo + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anPdmTypedTableName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmEntityId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmEntityType + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anOrganizationId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anPoolTypeId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anLdmIsNl + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anLdmIsGen + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anLdmIsLrt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals_IVK.g_anLdmIsMqt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmIsCto + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmIsCtp + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmIsRangePartAll + ",");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals_IVK.g_anAcmIsPs + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals_IVK.g_anAcmIsPsForming + ",");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'IMPORT FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T." + M01_Globals.g_anPdmFkSchemaName + " || '.' || T." + M01_Globals.g_anPdmTypedTableName + " ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'.ixf OF IXF COMMITCOUNT 10000 INSERT INTO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T." + M01_Globals.g_anPdmFkSchemaName + " || '.' || T." + M01_Globals.g_anPdmTypedTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AS VARCHAR(400)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualViewNameExpImpTab + " T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    View for 'IMPORT statements for PDM tables for DB-Move'
// ####################################################################################################################

// ### IF IVK ###
String qualProcedureNameAddTablePartitionByPs;
qualProcedureNameAddTablePartitionByPs = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnAddTablePartitionByPs, ddlType, null, null, null, null, null, null);
String qualProcedureNameAddTablePartitionByDiv;
qualProcedureNameAddTablePartitionByDiv = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnAddTablePartitionByDiv, ddlType, null, null, null, null, null, null);

// ### ENDIF IVK ###
M22_Class_Utilities.printSectionHeader("View for 'IMPORT statements for PDM tables for DB-Move'", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

// ### IF IVK ###
final int PhaseImportPrologue = 1;
final int PhaseImportDataNonPs = 2;
final int PhaseImportPartition = 3;
final int PhaseImportDataPs = 4;
final int PhaseImportEpilogue = 5;
// ### ELSE IVK ###
// Const PhaseImportPrologue = 1
// Const PhaseImportData = 2
// Const PhaseImportEpilogue = 3
// ### ENDIF IVK ###

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE VIEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualViewNameMoveImp);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SEQUENCENO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "PHASE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_ImportBase");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROWNUMBER() OVER (ORDER BY " + M01_Globals.g_anAcmIsCto + " DESC, " + M01_Globals.g_anAcmIsCtp + " DESC, " + M01_Globals.g_anLdmIsGen + " ASC, " + M01_Globals.g_anLdmIsLrt + " ASC, " + M01_Globals_IVK.g_anLdmIsMqt + " DESC, " + M01_Globals.g_anLdmIsNl + " ASC, " + M01_Globals.g_anLdmFkSequenceNo + " ASC),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualViewNameImp);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(" + M01_Globals.g_anOrganizationId + " IS NULL AND " + M01_Globals_IVK.g_anAcmIsPs + " = 0)");
// ### ELSE IVK ###
// Print #fileNo, addTab(2); g_anOrganizationId; " IS NULL"
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmEntityType + " IN ('M', '" + M01_Globals.gc_acmEntityTypeKeyClass + "', '" + M01_Globals.gc_acmEntityTypeKeyRel + "')");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "COALESCE(" + M01_Globals.g_anPoolTypeId + ", " + M01_Globals.g_workDataPoolId + ") IN (" + M01_Globals.g_workDataPoolId + ", " + M01_Globals_IVK.g_productiveDataPoolId + ", " + M01_Globals_IVK.g_archiveDataPoolId + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anPdmTypedTableName + " NOT IN ('" + unqualTabNameApplVersion + "', '" + unqualTabNameApplHistory + "')");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_ImportData");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROWNUMBER() OVER (ORDER BY " + M01_Globals.g_anAcmIsCto + " DESC, " + M01_Globals.g_anAcmIsCtp + " DESC, " + M01_Globals.g_anLdmFkSequenceNo + " ASC, " + M01_Globals.g_anOrganizationId + " ASC, " + M01_Globals.g_anPoolTypeId + " ASC, " + M01_Globals.g_anLdmIsGen + " ASC, " + M01_Globals.g_anLdmIsLrt + " ASC, " + M01_Globals_IVK.g_anLdmIsMqt + " ASC, " + M01_Globals.g_anLdmIsNl + " ASC),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualViewNameImp);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(" + M01_Globals.g_anOrganizationId + " IS NOT NULL OR " + M01_Globals_IVK.g_anAcmIsPs + " <> 0)");
// ### ELSE IVK ###
// Print #fileNo, addTab(2); g_anOrganizationId; " IS NOT NULL"
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmEntityType + " IN ('M', '" + M01_Globals.gc_acmEntityTypeKeyClass + "', '" + M01_Globals.gc_acmEntityTypeKeyRel + "')");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "COALESCE(" + M01_Globals.g_anPoolTypeId + ", " + M01_Globals.g_workDataPoolId + ") IN (" + M01_Globals.g_workDataPoolId + ", " + M01_Globals_IVK.g_productiveDataPoolId + ", " + M01_Globals_IVK.g_archiveDataPoolId + ")");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_ImportMisc");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "phase,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M11_LRT.genProcSectionHeader(fileNo, "quiesce DB", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (1, " + String.valueOf(PhaseImportPrologue) + ", 'QUIESCE DB IMMEDIATE FORCE CONNECTIONS')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "disable trigger before IMPORT", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (2, " + String.valueOf(PhaseImportPrologue) + ", 'CALL " + qualProcedureNameTrigDisable + "(NULL, NULL, ?, ?)')");

// ### IF IVK ###
if (M03_Config.supportRangePartitioningByPsOid) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "setup table partitions by PS", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (1, " + String.valueOf(PhaseImportPartition) + ", 'CALL " + qualProcedureNameAddTablePartitionByPs + "(1, NULL, NULL, ?)')");
}

if (M03_Config.supportRangePartitioningByDivOid) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "setup table partitions by DIV_OID", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (1, " + String.valueOf(PhaseImportPartition) + ", 'CALL " + qualProcedureNameAddTablePartitionByDiv + "(1, NULL, NULL, ?)')");
}

// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "re-enable trigger after IMPORT", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (1, " + String.valueOf(PhaseImportEpilogue) + ", 'CALL " + qualProcedureNameTrigEnable + "(NULL, NULL, ?, ?)')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

String qualProcedureNameRunstats;
qualProcedureNameRunstats = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRunstats, ddlType, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "update statistics", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (2, " + String.valueOf(PhaseImportEpilogue) + ", 'CALL " + qualProcedureNameRunstats + "(2, ?)')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

String qualProcedureNameRevalidate;
qualProcedureNameRevalidate = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRevalidate, ddlType, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "revalidate invalid objects", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (2, " + String.valueOf(PhaseImportEpilogue) + ", 'CALL " + qualProcedureNameRevalidate + "(2, ?)')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

String qualProcedureNameRebindProcs;
qualProcedureNameRebindProcs = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRebind, ddlType, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "rebind packages", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (3, " + String.valueOf(PhaseImportEpilogue) + ", 'CALL " + qualProcedureNameRebindProcs + "(2, 1, ?)')");

// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "keep track of data load (table \"" + M01_Globals_IVK.g_qualTabNameDataHistory + "\"", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (4, " + String.valueOf(PhaseImportEpilogue) + ", 'DELETE FROM " + M01_Globals_IVK.g_qualTabNameDataHistory + " WHERE EVENT = ''RELEASE-UPDATE 1.2''')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (5, " + String.valueOf(PhaseImportEpilogue) + ", 'INSERT INTO " + M01_Globals_IVK.g_qualTabNameDataHistory + "(EVENTDATE, EVENTTIME, EVENT, DBNAME) VALUES (CURRENT DATE, CURRENT TIME, ''RELEASE-UPDATE 1.2'', CURRENT SERVER)')");

// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "unquiesce DB", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (6, " + String.valueOf(PhaseImportEpilogue) + ", 'UNQUIESCE DB')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_StmntAll");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "phase,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "sequenceNo,");

// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_dbtEnumId + "(" + String.valueOf(PhaseImportDataNonPs) + "),");
// ### ELSE IVK ###
// Print #fileNo, addTab(2); g_dbtEnumId; "("; CStr(PhaseImportData); "),"
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ImportBase");

// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_dbtEnumId + "(" + String.valueOf(PhaseImportDataPs) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ImportData");

// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "phase,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ImportMisc");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROWNUMBER() OVER (ORDER BY phase ASC, sequenceNo ASC),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "phase,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_StmntAll");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");

M00_FileWriter.printToFile(fileNo, M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    View for 'LOAD statements for PDM tables'
// ####################################################################################################################

String qualViewNameLoad;
qualViewNameLoad = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnPdmLoadStmnt, M01_ACM.vnsPdmLoadStmnt, ddlType, null, null, null, null, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("View for 'LOAD statements for PDM tables'", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE VIEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualViewNameLoad);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmFkSequenceNo + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPdmTypedTableName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmEntityId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmEntityType + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anOrganizationId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPoolTypeId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsNl + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsGen + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsLrt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anLdmIsMqt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsCto + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsCtp + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsRangePartAll + ",");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anAcmIsPs + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anAcmIsPsForming + ",");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anLdmFkSequenceNo + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anPdmTypedTableName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmEntityId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmEntityType + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anOrganizationId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anPoolTypeId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anLdmIsNl + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anLdmIsGen + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anLdmIsLrt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals_IVK.g_anLdmIsMqt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmIsCto + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmIsCtp + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals.g_anAcmIsRangePartAll + ",");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals_IVK.g_anAcmIsPs + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "T." + M01_Globals_IVK.g_anAcmIsPsForming + ",");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'LOAD FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T." + M01_Globals.g_anPdmFkSchemaName + " || '.' || T." + M01_Globals.g_anPdmTypedTableName + " ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'.ixf OF IXF REPLACE INTO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T." + M01_Globals.g_anPdmFkSchemaName + " || '.' || T." + M01_Globals.g_anPdmTypedTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AS VARCHAR(400)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualViewNameExpImpTab + " T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    View for 'LOAD statements for PDM tables for DB-Move'
// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("View for 'LOAD statements for PDM tables for DB-Move'", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

// ### IF IVK ###
final int PhaseLoadPrologue = 1;
final int PhaseLoadDataNonPs = 2;
final int PhaseLoadPartition = 3;
final int PhaseLoadDataPs = 4;
final int PhaseLoadEpilogue = 5;
// ### ELSE IVK ###
// Const PhaseLoadPrologue = 1
// Const PhaseLoadData = 2
// Const PhaseLoadEpilogue = 3
// ### ENDIF IVK ###

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE VIEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualViewNameMoveLoad);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SEQUENCENO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "PHASE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_ImportBase");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROWNUMBER() OVER (ORDER BY " + M01_Globals.g_anLdmFkSequenceNo + " ASC, " + M01_Globals.g_anOrganizationId + " ASC, " + M01_Globals.g_anPoolTypeId + " ASC),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualViewNameLoad);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(" + M01_Globals.g_anOrganizationId + " IS NULL AND " + M01_Globals_IVK.g_anAcmIsPs + " = 0)");
// ### ELSE IVK ###
// Print #fileNo, addTab(2); g_anOrganizationId; " IS NULL"
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmEntityType + " IN ('M', '" + M01_Globals.gc_acmEntityTypeKeyClass + "', '" + M01_Globals.gc_acmEntityTypeKeyRel + "')");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "COALESCE(" + M01_Globals.g_anPoolTypeId + ", " + M01_Globals.g_workDataPoolId + ") IN (" + M01_Globals.g_workDataPoolId + ", " + M01_Globals_IVK.g_productiveDataPoolId + ", " + M01_Globals_IVK.g_archiveDataPoolId + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anPdmTypedTableName + " NOT IN ('" + unqualTabNameApplVersion + "', '" + unqualTabNameApplHistory + "')");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_ImportData");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROWNUMBER() OVER (ORDER BY " + M01_Globals.g_anAcmIsCto + " DESC, " + M01_Globals.g_anAcmIsCtp + " DESC, " + M01_Globals.g_anLdmIsGen + " ASC, " + M01_Globals.g_anLdmIsLrt + " ASC, " + M01_Globals_IVK.g_anLdmIsMqt + " ASC, " + M01_Globals.g_anLdmIsNl + " ASC, " + M01_Globals.g_anLdmFkSequenceNo + " ASC),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualViewNameLoad);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(" + M01_Globals.g_anOrganizationId + " IS NOT NULL OR " + M01_Globals_IVK.g_anAcmIsPs + " <> 0)");
// ### ELSE IVK ###
// Print #fileNo, addTab(2); g_anOrganizationId; " IS NOT NULL"
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmEntityType + " IN ('M', '" + M01_Globals.gc_acmEntityTypeKeyClass + "', '" + M01_Globals.gc_acmEntityTypeKeyRel + "')");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "COALESCE(" + M01_Globals.g_anPoolTypeId + ", " + M01_Globals.g_workDataPoolId + ") IN (" + M01_Globals.g_workDataPoolId + ", " + M01_Globals_IVK.g_productiveDataPoolId + ", " + M01_Globals_IVK.g_archiveDataPoolId + ")");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_ImportMisc");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "phase,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M11_LRT.genProcSectionHeader(fileNo, "quiesce DB", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (1, " + String.valueOf(PhaseLoadPrologue) + ", 'QUIESCE DB IMMEDIATE FORCE CONNECTIONS')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "disable trigger before IMPORT", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (2, " + String.valueOf(PhaseLoadPrologue) + ", 'CALL " + qualProcedureNameTrigDisable + "(NULL, NULL, ?, ?)')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

String qualProcNameSetIntegrity;
qualProcNameSetIntegrity = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnIntegrity, ddlType, null, null, null, null, null, null);

// ### IF IVK ###
M11_LRT.genProcSectionHeader(fileNo, "set integrity", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (1, " + String.valueOf(PhaseLoadPartition) + ", 'CALL " + qualProcNameSetIntegrity + "(2, ?)')");

if (M03_Config.supportRangePartitioningByPsOid) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "setup table partitions by " + M01_Globals_IVK.g_anPsOid, 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (3, " + String.valueOf(PhaseLoadPartition) + ", 'CALL " + qualProcedureNameAddTablePartitionByPs + "(1, NULL, NULL, ?)')");
}

if (M03_Config.supportRangePartitioningByDivOid) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "setup table partitions by DIV_OID", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (2, " + String.valueOf(PhaseLoadPartition) + ", 'CALL " + qualProcedureNameAddTablePartitionByDiv + "(1, NULL, NULL, ?)')");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

// ### ENDIF IVK ###
M11_LRT.genProcSectionHeader(fileNo, "set integrity", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (1, " + String.valueOf(PhaseLoadEpilogue) + ", 'CALL " + qualProcNameSetIntegrity + "(2, ?)')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "re-enable trigger after LOAD", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (2, " + String.valueOf(PhaseLoadEpilogue) + ", 'CALL " + qualProcedureNameTrigEnable + "(NULL, NULL, ?, ?)')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "revalidate invalid objects", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (3, " + String.valueOf(PhaseLoadEpilogue) + ", 'CALL " + qualProcedureNameRevalidate + "(2, ?)')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "update statistics", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (4, " + String.valueOf(PhaseLoadEpilogue) + ", 'CALL " + qualProcedureNameRunstats + "(2, ?)')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "rebind packages", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (5, " + String.valueOf(PhaseLoadEpilogue) + ", 'CALL " + qualProcedureNameRebindProcs + "(2, 1, ?)')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

// ### IF IVK ###
M11_LRT.genProcSectionHeader(fileNo, "keep track of data load (table \"" + M01_Globals_IVK.g_qualTabNameDataHistory + "\"", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (6, " + String.valueOf(PhaseLoadEpilogue) + ", 'DELETE FROM " + M01_Globals_IVK.g_qualTabNameDataHistory + " WHERE EVENT = ''RELEASE-UPDATE 1.2''')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (7, " + String.valueOf(PhaseLoadEpilogue) + ", 'INSERT INTO " + M01_Globals_IVK.g_qualTabNameDataHistory + "(EVENTDATE, EVENTTIME, EVENT, DBNAME) VALUES (CURRENT DATE, CURRENT TIME, ''RELEASE-UPDATE 1.2'', CURRENT SERVER)')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

// ### ENDIF IVK ###
M11_LRT.genProcSectionHeader(fileNo, "unquiesce DB", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES (8, " + String.valueOf(PhaseLoadEpilogue) + ", 'UNQUIESCE DB')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_StmntAll");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "phase,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "sequenceNo,");

// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_dbtEnumId + "(" + String.valueOf(PhaseLoadDataNonPs) + "),");
// ### ELSE IVK ###
// Print #fileNo, addTab(2); g_dbtEnumId; "("; CStr(PhaseLoadData); "),"
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ImportBase");

// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_dbtEnumId + "(" + String.valueOf(PhaseLoadDataPs) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ImportData");

// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "phase,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ImportMisc");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROWNUMBER() OVER (ORDER BY phase ASC, sequenceNo ASC),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "phase,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_StmntAll");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");

M00_FileWriter.printToFile(fileNo, M01_LDM.gc_sqlCmdDelim);

// ### IF IVK ###
// ####################################################################################################################
// #    View for 'EXPORT statements for tables corresponding to ACM core classes'
// ####################################################################################################################

String qualViewNameExpCore;
qualViewNameExpCore = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnPdmCoreExportStmnt, M01_ACM.vnsPdmCoreExportStmnt, ddlType, null, null, null, null, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("View for 'EXPORT statements for tables corresponding to ACM core classes'", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE VIEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualViewNameExpCore);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmFkSequenceNo + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPdmTypedTableName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmEntityId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmEntityType + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anOrganizationId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPoolTypeId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsNl + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsGen + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsLrt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anLdmIsMqt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsCto + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsCtp + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsRangePartAll + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anAcmIsPs + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anAcmIsPsForming + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anLdmFkSequenceNo + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anPdmTypedTableName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmEntityId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmEntityType + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anOrganizationId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anPoolTypeId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anLdmIsNl + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anLdmIsGen + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anLdmIsLrt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals_IVK.g_anLdmIsMqt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmIsCto + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmIsCtp + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmIsRangePartAll + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals_IVK.g_anAcmIsPs + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals_IVK.g_anAcmIsPsForming + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualViewNameExp);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(" + M01_Globals.g_anAcmEntityId + "," + M01_Globals.g_anAcmEntityType + ")" + "IN (SELECT " + M01_Globals.g_anAcmEntityId + "," + M01_Globals.g_anAcmEntityType + " FROM " + qualViewNameCore + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "COALESCE(" + M01_Globals.g_anOrganizationId + ",1) = 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "COALESCE(" + M01_Globals.g_anPoolTypeId + ",1) = 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    View for 'IMPORT statements for tables corresponding to ACM core classes'
// ####################################################################################################################

String qualViewNameImpCore;
qualViewNameImpCore = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnPdmCoreImportStmnt, M01_ACM.vnsPdmCoreImportStmnt, ddlType, null, null, null, null, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("View for 'IMPORT statements for tables corresponding to ACM core classes'", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE VIEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualViewNameImpCore);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmFkSequenceNo + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPdmTypedTableName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmEntityId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmEntityType + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anOrganizationId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anPoolTypeId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsNl + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsGen + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anLdmIsLrt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsCto + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsCtp + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_anAcmIsRangePartAll + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anAcmIsPs + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals_IVK.g_anAcmIsPsForming + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anLdmFkSequenceNo + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anPdmTypedTableName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmEntityId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmEntityType + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anOrganizationId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anPoolTypeId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anLdmIsNl + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anLdmIsGen + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anLdmIsLrt + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmIsCto + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmIsCtp + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anAcmIsRangePartAll + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals_IVK.g_anAcmIsPs + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals_IVK.g_anAcmIsPsForming + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualViewNameImp);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(" + M01_Globals.g_anAcmEntityId + "," + M01_Globals.g_anAcmEntityType + ")" + "IN (SELECT " + M01_Globals.g_anAcmEntityId + "," + M01_Globals.g_anAcmEntityType + " FROM " + qualViewNameCore + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "COALESCE(" + M01_Globals.g_anOrganizationId + ",1) = 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "COALESCE(" + M01_Globals.g_anPoolTypeId + ",1) = 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M01_LDM.gc_sqlCmdDelim);

// ### ENDIF IVK ###
// ####################################################################################################################
// #    View retrieving statements generating statement for moving data between databases
// ####################################################################################################################

String qualViewNameMoveStmnts;
qualViewNameMoveStmnts = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnPdmMoveScript, M01_ACM.vnsPdmMoveScript, ddlType, null, null, null, null, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("View retrieving statements generating statement for moving data between databases", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE VIEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualViewNameMoveStmnts);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "seqNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES(");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "1,");
M94_DBAdmin.genDbMoveScript(fileNo, 1, ddlType);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES(");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "2,");
M94_DBAdmin.genDbMoveScript(fileNo, 2, ddlType);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "VALUES(");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "3,");
M94_DBAdmin.genDbMoveScript(fileNo, 3, ddlType);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");

M00_FileWriter.printToFile(fileNo, M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    View for DML-Statements to export and drop triggers'
// ####################################################################################################################

String qualViewNameDropTrigger;
qualViewNameDropTrigger = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnDropTrigger, M01_ACM.vsnDropTrigger, ddlType, null, null, null, null, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("View for DML-Statements to export and drop triggers", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE VIEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualViewNameDropTrigger);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALUES (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "1,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CAST('EXPORT TO MDSDB-Trigger.ddl OF DEL LOBFILE ''MDSDB-Trigger.ddl'' MODIFIED BY LOBSINFILE SELECT TEXT || CHR(10) || ''@'' || CHR(10) FROM SYSCAT.TRIGGERS WHERE TRIGSCHEMA LIKE ''" + M01_Globals.g_allSchemaNamePattern + "''' AS VARCHAR(200))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "2,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'DROP TRIGGER ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TRIGSCHEMA || '.' || TRIGNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.TRIGGERS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M01_LDM.gc_sqlCmdDelim);

// ### IF IVK ###
LdmEntryPoint:
// ####################################################################################################################
// #    SP for maintaining records in table APPLVERSION, APPLHISTORY and DATAFIXHISTORY
// ####################################################################################################################

String qualProcedureNameSetApplVersion;
qualProcedureNameSetApplVersion = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnSetApplVersion, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for maintaining records in table APPLVERSION, APPLHISTORY and DATAFIXHISTORY", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameSetApplVersion);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "version_in", "VARCHAR(20)", true, "version-info");
M11_LRT.genProcParm(fileNo, "IN", "revision_in", "VARCHAR(20)", true, "revision-info");
M11_LRT.genProcParm(fileNo, "IN", "lrtOid_in", M01_Globals.g_dbtOid, true, "(optional) for data fixes: OID of LRT if fix is implemented via LRT");
M11_LRT.genProcParm(fileNo, "IN", "onlyOnce_in", M01_Globals.g_dbtBoolean, true, "(optional) for data fixes: if set to '1' register the fix as 'once-only-fix'");
M11_LRT.genProcParm(fileNo, "IN", "description_in", "VARCHAR(100)", false, "description text to store");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, !(M03_Config.supportSpLogging | ! M03_Config.generateSpLogMessages));
M11_LRT.genVarDecl(fileNo, "v_stmnt", "STATEMENT", null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameSetApplVersion, ddlType, null, "'version_in", "'revision_in", "lrtOid_in", "onlyOnce_in", "'description_in", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF POSSTR(UPPER(version_in), '-HF') = 0 THEN");
M11_LRT.genProcSectionHeader(fileNo, "record version in table \"" + M04_Utilities.getUnqualObjName(M01_Globals_IVK.g_qualTabNameDataFixHistory) + "\"", 2, true);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals_IVK.g_qualTabNameDataFixHistory);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VERSION, REVISION, " + M01_Globals.g_anLrtOid + ", DEPLOYDATE, DEPLOYTIME, DESCRIPTION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "version_in, revision_in, lrtOid_in, CURRENT DATE, CURRENT TIME, description_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ");");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF onlyOnce_in = 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + M01_Globals_IVK.g_qualTabNameDataFixIgnored + " (VERSION, REVISION, REASON) VALUES (version_in, revision_in, 'IBM: use only once');");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSE");

M11_LRT.genProcSectionHeader(fileNo, "record version in table \"" + M04_Utilities.getUnqualObjName(M01_Globals_IVK.g_qualTabNameApplVersion) + "\"", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DELETE FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals_IVK.g_qualTabNameApplVersion);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VERSION = version_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals_IVK.g_qualTabNameApplVersion);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VERSION, REVISION, DEPLOYDATE, DEPLOYTIME, DESCRIPTION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "version_in, revision_in, CURRENT DATE, CURRENT TIME, description_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ");");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals_IVK.g_qualTabNameApplHistory);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VERSION, REVISION, DEPLOYDATE, DEPLOYTIME, DESCRIPTION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "version_in, revision_in, CURRENT DATE, CURRENT TIME, description_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ");");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameSetApplVersion, ddlType, null, "'version_in", "'revision_in", "lrtOid_in", "onlyOnce_in", null, "'description_in", null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for maintaining records in table APPLVERSION, APPLHISTORY and DATAFIXHISTORY", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameSetApplVersion);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "version_in", "VARCHAR(20)", true, "version-info");
M11_LRT.genProcParm(fileNo, "IN", "revision_in", "VARCHAR(20)", true, "revision-info");
M11_LRT.genProcParm(fileNo, "IN", "lrtOid_in", M01_Globals.g_dbtOid, true, "(optional) for data fixes: OID of LRT if fix is implemented via LRT");
M11_LRT.genProcParm(fileNo, "IN", "description_in", "VARCHAR(100)", false, "description text to store");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameSetApplVersion, ddlType, null, "'version_in", "'revision_in", "'description_in", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameSetApplVersion + "(version_in, revision_in, lrtOid_in, 0, description_in);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameSetApplVersion, ddlType, null, "'version_in", "'revision_in", "'description_in", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for maintaining records in table APPLVERSION, APPLHISTORY and DATAFIXHISTORY", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameSetApplVersion);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "version_in", "VARCHAR(20)", true, "version-info");
M11_LRT.genProcParm(fileNo, "IN", "revision_in", "VARCHAR(20)", true, "revision-info");
M11_LRT.genProcParm(fileNo, "IN", "description_in", "VARCHAR(100)", false, "description text to store");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameSetApplVersion, ddlType, null, "'version_in", "'revision_in", "'description_in", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameSetApplVersion + "(version_in, revision_in, CAST(NULL AS " + M01_Globals.g_dbtBoolean + "), 0, description_in);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameSetApplVersion, ddlType, null, "'version_in", "'revision_in", "'description_in", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for maintaining records in table APPLVERSION, APPLHISTORY and DATAFIXHISTORY", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameSetApplVersion);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "version_in", "VARCHAR(20)", true, "version-info");
M11_LRT.genProcParm(fileNo, "IN", "description_in", "VARCHAR(100)", false, "description text to store");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameSetApplVersion, ddlType, null, "'version_in", "'description_in", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameSetApplVersion + "(version_in, CAST(NULL AS VARCHAR(20)), CAST(NULL AS " + M01_Globals.g_dbtBoolean + "), 0, description_in);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameSetApplVersion, ddlType, null, "'version_in", "'description_in", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
// ### ENDIF IVK ###
}


public static void genDdlSetgrants1(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

final int commitCount = 10000;

String tempTabNameStatementGrant;
tempTabNameStatementGrant = M94_DBAdmin.tempTabNameStatement + "Grants";

//On Error GoTo ErrorExit 

// ####################################################################################################################
// #    SP for granting access rights on schemas
// ####################################################################################################################

String qualProcedureNameSchema;
qualProcedureNameSchema = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "SCH", null, null);

M22_Class_Utilities.printSectionHeader("SP for granting access rights on schemas", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameSchema);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePatternOpt_in", M01_Globals.g_dbtDbSchemaName, true, "optional user-supplied additional filter for schemas");
M11_LRT.genProcParm(fileNo, "IN", "filterTemplate_in", "VARCHAR(100)", true, "optional filter-pattern to apply (may use placeholder '<%S>')");
M11_LRT.genProcParm(fileNo, "IN", "opType_in", "VARCHAR(6)", true, "either 'GRANT' or 'REVOKE'");
M11_LRT.genProcParm(fileNo, "IN", "privilege_in", "VARCHAR(100)", true, "privilege to grant resp. revoke");
M11_LRT.genProcParm(fileNo, "IN", "granteeType_in", "VARCHAR(6)", true, "either 'USER', 'GROUP' or 'PUBLIC'");
M11_LRT.genProcParm(fileNo, "IN", "grantee_in", "VARCHAR(100)", true, "determines the user / group");
M11_LRT.genProcParm(fileNo, "IN", "withGrant_in", M01_Globals.g_dbtBoolean, true, "apply 'WITH GRANT OPTION' if and only if 'withGrant_in = 1'");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "INOUT", "rowCount_inout", "INTEGER", false, "number of GRANT-/REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);
M11_LRT.genCondDecl(fileNo, "privCannotBeRevoked", "42504", null);
M11_LRT.genCondDecl(fileNo, "doesNotHavePrivOnObject", "42501", null);
M11_LRT.genCondDecl(fileNo, "failedToExecAsSpecified", "42502", null);
M11_LRT.genCondDecl(fileNo, "unexpectedToken", "42601", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_schemaName", M01_Globals.g_dbtDbSchemaName, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_csrStmntTxt", "VARCHAR(800)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "SQLCODE", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_objCsrStmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare cursor", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE objCursor CURSOR WITH HOLD FOR v_objCsrStmnt;");

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR privCannotBeRevoked");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR doesNotHavePrivOnObject");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR failedToExecAsSpecified");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR unexpectedToken");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, null, null, null, null, null, null, "Grants", null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameSchema, ddlType, null, "'schemaNamePattern_in", "'schemaNamePatternOpt_in", "'filterTemplate_in", "'opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout", null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_csrStmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'SELECT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SCHEMANAME ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SYSCAT.SCHEMATA ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(SCHEMANAME) LIKE ''' || schemaNamePattern_in || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(SCHEMANAME) LIKE ''' || COALESCE(schemaNamePatternOpt_in, '%') || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(CASE WHEN COALESCE(filterTemplate_in, '') = '' THEN '' ELSE 'AND (' || REPLACE(filterTemplate_in, '<%S>', 'SCHEMANAME') || ') ' END) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FOR READ ONLY'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "PREPARE v_objCsrStmnt FROM v_csrStmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "OPEN objCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FETCH objCursor INTO v_schemaName;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHILE (SQLCODE = 0) DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (opType_in = 'GRANT') THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'GRANT ' || privilege_in || ' ON SCHEMA ' || RTRIM(v_schemaName ) || ' TO ' || granteeType_in || COALESCE(' ' || grantee_in,'') || (CASE WHEN withGrant_in = 1 THEN ' WITH GRANT OPTION' ELSE '' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'REVOKE ' || privilege_in || ' ON SCHEMA ' || RTRIM(v_schemaName) || ' FROM ' || granteeType_in || COALESCE(' ' || grantee_in,'')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_inout = rowCount_inout + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

if (commitCount > 0) {
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF MOD(rowCount_inout, " + String.valueOf(commitCount) + ") = 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + tempTabNameStatementGrant);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "rowCount_inout,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FETCH objCursor INTO v_schemaName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END WHILE;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CLOSE objCursor;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameSchema, ddlType, null, "'schemaNamePattern_in", "'schemaNamePatternOpt_in", "'filterTemplate_in", "'opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout", null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for granting access rights on tables, views and aliases
// ####################################################################################################################

String qualProcedureNameTab;
qualProcedureNameTab = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "TAB", null, null);

M22_Class_Utilities.printSectionHeader("SP for granting access rights on tables, views and aliases", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameTab);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "type_in", "CHAR(1)", true, "distinguishes between table ('T'), alias ('A') and view ('V')");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePatternOpt_in", M01_Globals.g_dbtDbSchemaName, true, "optional user-supplied additional filter for schemas");
M11_LRT.genProcParm(fileNo, "IN", "tableNamePattern_in", "VARCHAR(80)", true, "determines the tables that apply");
M11_LRT.genProcParm(fileNo, "IN", "tableNamePatternOpt_in", "VARCHAR(80)", true, "optional user-supplied additional filter for tables");
M11_LRT.genProcParm(fileNo, "IN", "filterTemplate_in", "VARCHAR(100)", true, "optional filter-pattern to apply (may use placeholder '<%S>', '<%N>')");
M11_LRT.genProcParm(fileNo, "IN", "opType_in", "VARCHAR(6)", true, "either 'GRANT' or 'REVOKE'");
M11_LRT.genProcParm(fileNo, "IN", "privilege_in", "VARCHAR(100)", true, "privilege to grant resp. revoke");
M11_LRT.genProcParm(fileNo, "IN", "granteeType_in", "VARCHAR(6)", true, "either 'USER', 'GROUP' or 'PUBLIC'");
M11_LRT.genProcParm(fileNo, "IN", "grantee_in", "VARCHAR(100)", true, "determines the user / group");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "INOUT", "rowCount_inout", "INTEGER", false, "number of GRANT-/REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);
M11_LRT.genCondDecl(fileNo, "privCannotBeRevoked", "42504", null);
M11_LRT.genCondDecl(fileNo, "doesNotHavePrivOnObject", "42501", null);
M11_LRT.genCondDecl(fileNo, "failedToExecAsSpecified", "42502", null);
M11_LRT.genCondDecl(fileNo, "unexpectedToken", "42601", null);
M11_LRT.genCondDecl(fileNo, "inoperative", "51024", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_tabSchema", M01_Globals.g_dbtDbSchemaName, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_tabName", M01_Globals.g_dbtDbTableName, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_csrStmntTxt", "VARCHAR(800)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "SQLCODE", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_objCsrStmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare cursor", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE objCursor CURSOR WITH HOLD FOR v_objCsrStmnt;");

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR privCannotBeRevoked");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR doesNotHavePrivOnObject");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR failedToExecAsSpecified");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR unexpectedToken");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR inoperative");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, null, null, null, null, null, null, "Grants", null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameTab, ddlType, null, "'type_in", "'schemaNamePattern_in", "'schemaNamePatternOpt_in", "'tableNamePattern_in", "'tableNamePatternOpt_in", "'filterTemplate_in", "opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_csrStmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'SELECT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'TABSCHEMA,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'TABNAME ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SYSCAT.TABLES ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(TABSCHEMA) LIKE ''' || schemaNamePattern_in || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(TABSCHEMA) LIKE ''' || COALESCE(schemaNamePatternOpt_in, '%') || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(TABNAME) LIKE ''' || tableNamePattern_in || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(TABNAME) LIKE ''' || COALESCE(tableNamePatternOpt_in, '%') || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'TYPE = ''' || type_in || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(CASE WHEN COALESCE(filterTemplate_in, '') = '' THEN '' ELSE 'AND (' || REPLACE(REPLACE(filterTemplate_in, '<%S>', 'TABSCHEMA'), '<%N>', 'TABNAME') || ') ' END) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FOR READ ONLY'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "PREPARE v_objCsrStmnt FROM v_csrStmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "OPEN objCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FETCH objCursor INTO v_tabSchema, v_tabName;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHILE (SQLCODE = 0) DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (opType_in = 'GRANT') THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'GRANT ' || privilege_in || ' ON ' || RTRIM(v_tabSchema) || '.' || RTRIM(v_tabName) || ' TO ' || granteeType_in || COALESCE(' ' || grantee_in,'')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'REVOKE ' || privilege_in || ' ON ' || RTRIM(v_tabSchema) || '.' || RTRIM(v_tabName) || ' FROM ' || granteeType_in || COALESCE(' ' || grantee_in,'')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_inout = rowCount_inout + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

if (commitCount > 0) {
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF MOD(rowCount_inout, " + String.valueOf(commitCount) + ") = 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + tempTabNameStatementGrant);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "rowCount_inout,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FETCH objCursor INTO v_tabSchema, v_tabName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END WHILE;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CLOSE objCursor;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameTab, ddlType, null, "'type_in", "'schemaNamePattern_in", "'schemaNamePatternOpt_in", "'tableNamePattern_in", "'tableNamePatternOpt_in", "'filterTemplate_in", "opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for granting access rights on sequences
// ####################################################################################################################

String qualProcedureNameSeq;
qualProcedureNameSeq = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "SEQ", null, null);

M22_Class_Utilities.printSectionHeader("SP for granting access rights on sequences", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameSeq);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePatternOpt_in", M01_Globals.g_dbtDbSchemaName, true, "optional user-supplied additional filter for schemas");
M11_LRT.genProcParm(fileNo, "IN", "seqNamePattern_in", "VARCHAR(80)", true, "determines the sequences that apply");
M11_LRT.genProcParm(fileNo, "IN", "seqNamePatternOpt_in", "VARCHAR(80)", true, "optional user-supplied additional filter for sequences");
M11_LRT.genProcParm(fileNo, "IN", "filterTemplate_in", "VARCHAR(100)", true, "optional filter-pattern to apply (may use placeholder '<%S>', '<%N>')");
M11_LRT.genProcParm(fileNo, "IN", "opType_in", "VARCHAR(6)", true, "either 'GRANT' or 'REVOKE'");
M11_LRT.genProcParm(fileNo, "IN", "privilege_in", "VARCHAR(100)", true, "privilege to grant resp. revoke");
M11_LRT.genProcParm(fileNo, "IN", "granteeType_in", "VARCHAR(6)", true, "either 'USER', 'GROUP' or 'PUBLIC'");
M11_LRT.genProcParm(fileNo, "IN", "grantee_in", "VARCHAR(100)", true, "determines the user / group");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "INOUT", "rowCount_inout", "INTEGER", false, "number of GRANT-/REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);
M11_LRT.genCondDecl(fileNo, "privCannotBeRevoked", "42504", null);
M11_LRT.genCondDecl(fileNo, "doesNotHavePrivOnObject", "42501", null);
M11_LRT.genCondDecl(fileNo, "failedToExecAsSpecified", "42502", null);
M11_LRT.genCondDecl(fileNo, "unexpectedToken", "42601", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_seqSchema", M01_Globals.g_dbtDbSchemaName, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_seqName", "VARCHAR(50)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_csrStmntTxt", "VARCHAR(800)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "SQLCODE", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_objCsrStmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare cursor", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE objCursor CURSOR WITH HOLD FOR v_objCsrStmnt;");

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR privCannotBeRevoked");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR doesNotHavePrivOnObject");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR failedToExecAsSpecified");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR unexpectedToken");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, null, null, null, null, null, null, "Grants", null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameSeq, ddlType, null, "'schemaNamePattern_in", "'schemaNamePatternOpt_in", "'seqNamePattern_in", "'seqNamePatternOpt_in", "'filterTemplate_in", "'opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout", null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_csrStmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'SELECT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SEQSCHEMA,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SEQNAME ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SYSCAT.SEQUENCES ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(SEQSCHEMA) LIKE ''' || schemaNamePattern_in || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(SEQSCHEMA) LIKE ''' || COALESCE(schemaNamePatternOpt_in, '%') || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(SEQNAME) LIKE ''' || seqNamePattern_in || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(SEQNAME) LIKE ''' || COALESCE(seqNamePatternOpt_in, '%') || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(CASE WHEN COALESCE(filterTemplate_in, '') = '' THEN '' ELSE 'AND (' || REPLACE(REPLACE(filterTemplate_in, '<%S>', 'SEQSCHEMA'), '<%N>', 'SEQNAME') || ') ' END) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FOR READ ONLY'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "PREPARE v_objCsrStmnt FROM v_csrStmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "OPEN objCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FETCH objCursor INTO v_seqSchema, v_seqName;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHILE (SQLCODE = 0) DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (opType_in = 'GRANT') THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'GRANT ' || privilege_in || ' ON SEQUENCE ' || RTRIM(v_seqSchema )|| '.' || RTRIM(v_seqName) || ' TO ' || granteeType_in || COALESCE(' ' || grantee_in,'')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'REVOKE ' || privilege_in || ' ON SEQUENCE ' || RTRIM(v_seqSchema) || '.' || RTRIM(v_seqName) || ' FROM ' || granteeType_in || COALESCE(' ' || grantee_in,'')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_inout = rowCount_inout + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

if (commitCount > 0) {
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF MOD(rowCount_inout, " + String.valueOf(commitCount) + ") = 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + tempTabNameStatementGrant);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "rowCount_inout,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FETCH objCursor INTO v_seqSchema, v_seqName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END WHILE;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CLOSE objCursor;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameSeq, ddlType, null, "'schemaNamePattern_in", "'schemaNamePatternOpt_in", "'seqNamePattern_in", "'seqNamePatternOpt_in", "'filterTemplate_in", "'opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout", null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for granting access rights on packages
// ####################################################################################################################

String qualProcedureNamePkg;
qualProcedureNamePkg = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "PKG", null, null);

M22_Class_Utilities.printSectionHeader("SP for granting access rights on packages", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNamePkg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePatternOpt_in", M01_Globals.g_dbtDbSchemaName, true, "optional user-supplied additional filter for schemas");
M11_LRT.genProcParm(fileNo, "IN", "pkgNamePattern_in", "VARCHAR(80)", true, "determines the packages that apply");
M11_LRT.genProcParm(fileNo, "IN", "pkgNamePatternOpt_in", "VARCHAR(80)", true, "optional user-supplied additional filter for packages");
M11_LRT.genProcParm(fileNo, "IN", "filterTemplate_in", "VARCHAR(100)", true, "optional filter-pattern to apply (may use placeholder '<%S>', '<%N>')");
M11_LRT.genProcParm(fileNo, "IN", "opType_in", "VARCHAR(6)", true, "either 'GRANT' or 'REVOKE'");
M11_LRT.genProcParm(fileNo, "IN", "privilege_in", "VARCHAR(100)", true, "privilege to grant resp. revoke");
M11_LRT.genProcParm(fileNo, "IN", "granteeType_in", "VARCHAR(6)", true, "either 'USER', 'GROUP' or 'PUBLIC'");
M11_LRT.genProcParm(fileNo, "IN", "grantee_in", "VARCHAR(100)", true, "determines the user / group");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "INOUT", "rowCount_inout", "INTEGER", false, "number of GRANT-/REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);
M11_LRT.genCondDecl(fileNo, "privCannotBeRevoked", "42504", null);
M11_LRT.genCondDecl(fileNo, "doesNotHavePrivOnObject", "42501", null);
M11_LRT.genCondDecl(fileNo, "failedToExecAsSpecified", "42502", null);
M11_LRT.genCondDecl(fileNo, "unexpectedToken", "42601", null);
M11_LRT.genCondDecl(fileNo, "inoperative", "51024", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_pkgSchema", M01_Globals.g_dbtDbSchemaName, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_pkgName", "VARCHAR(50)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_csrStmntTxt", "VARCHAR(800)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "SQLCODE", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_objCsrStmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare cursor", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE objCursor CURSOR WITH HOLD FOR v_objCsrStmnt;");

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR privCannotBeRevoked");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR doesNotHavePrivOnObject");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR failedToExecAsSpecified");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR unexpectedToken");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR inoperative");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, null, null, null, null, null, null, "Grants", null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNamePkg, ddlType, null, "'schemaNamePattern_in", "'schemaNamePatternOpt_in", "'pkgNamePattern_in", "'pkgNamePatternOpt_in", "'filterTemplate_in", "'opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout", null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_csrStmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'SELECT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'PA.PKGSCHEMA,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'PA.PKGNAME ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SYSCAT.PACKAGES PA ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'LEFT OUTER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SYSCAT.ROUTINEDEP RD ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'ON ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RD.BNAME = PA.PKGNAME ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RD.ROUTINESCHEMA = PA.PKGSCHEMA ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'LEFT OUTER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SYSCAT.ROUTINES RT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'ON ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RD.ROUTINESCHEMA = RT.ROUTINESCHEMA ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RD.ROUTINENAME = RT.SPECIFICNAME ' ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(PA.PKGSCHEMA) LIKE ''' || schemaNamePattern_in || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(PA.PKGSCHEMA) LIKE ''' || COALESCE(schemaNamePatternOpt_in, '%') || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(PA.PKGNAME) LIKE ''' || pkgNamePattern_in || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(PA.PKGNAME) LIKE ''' || COALESCE(pkgNamePatternOpt_in, '%') || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(CASE WHEN COALESCE(filterTemplate_in, '') = '' THEN '' ELSE 'AND (' || REPLACE(REPLACE(filterTemplate_in, '<%S>', 'PA.PKGSCHEMA'), '<%N>', 'PA.PKGNAME') || ') ' END) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FOR READ ONLY'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "PREPARE v_objCsrStmnt FROM v_csrStmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "OPEN objCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FETCH objCursor INTO v_pkgSchema, v_pkgName;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHILE (SQLCODE = 0) DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (opType_in = 'GRANT') THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'GRANT ' || privilege_in || ' ON PACKAGE ' || RTRIM(v_pkgSchema )|| '.' || RTRIM(v_pkgName) || ' TO ' || granteeType_in || COALESCE(' ' || grantee_in,'')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'REVOKE ' || privilege_in || ' ON PACKAGE ' || RTRIM(v_pkgSchema) || '.' || RTRIM(v_pkgName) || ' FROM ' || granteeType_in || COALESCE(' ' || grantee_in,'')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_inout = rowCount_inout + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

if (commitCount > 0) {
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF MOD(rowCount_inout, " + String.valueOf(commitCount) + ") = 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + tempTabNameStatementGrant);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "rowCount_inout,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FETCH objCursor INTO v_pkgSchema, v_pkgName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END WHILE;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CLOSE objCursor;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNamePkg, ddlType, null, "'schemaNamePattern_in", "'schemaNamePatternOpt_in", "'pkgNamePattern_in", "'pkgNamePatternOpt_in", "'filterTemplate_in", "'opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout", null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for granting access rights on stored procedures
// ####################################################################################################################

String qualProcedureNamePro;
qualProcedureNamePro = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "PRO", null, null);

M22_Class_Utilities.printSectionHeader("SP for granting access rights on stored procedures", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNamePro);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePatternOpt_in", M01_Globals.g_dbtDbSchemaName, true, "optional user-supplied additional filter for schemas");
M11_LRT.genProcParm(fileNo, "IN", "procNamePattern_in", "VARCHAR(80)", true, "determines the procedures that apply");
M11_LRT.genProcParm(fileNo, "IN", "procNamePatternOpt_in", "VARCHAR(80)", true, "optional user-supplied additional filter for procedures");
M11_LRT.genProcParm(fileNo, "IN", "filterTemplate_in", "VARCHAR(100)", true, "optional filter-pattern to apply (may use placeholder '<%S>', '<%N>')");
M11_LRT.genProcParm(fileNo, "IN", "opType_in", "VARCHAR(6)", true, "either 'GRANT' or 'REVOKE'");
M11_LRT.genProcParm(fileNo, "IN", "privilege_in", "VARCHAR(100)", true, "privilege to grant resp. revoke");
M11_LRT.genProcParm(fileNo, "IN", "granteeType_in", "VARCHAR(6)", true, "either 'USER', 'GROUP' or 'PUBLIC'");
M11_LRT.genProcParm(fileNo, "IN", "grantee_in", "VARCHAR(100)", true, "determines the user / group");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "INOUT", "rowCount_inout", "INTEGER", false, "number of GRANT-/REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);
M11_LRT.genCondDecl(fileNo, "privCannotBeRevoked", "42504", null);
M11_LRT.genCondDecl(fileNo, "doesNotHavePrivOnObject", "42501", null);
M11_LRT.genCondDecl(fileNo, "failedToExecAsSpecified", "42502", null);
M11_LRT.genCondDecl(fileNo, "unexpectedToken", "42601", null);
M11_LRT.genCondDecl(fileNo, "inoperative", "51024", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_procSchema", M01_Globals.g_dbtDbSchemaName, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_procName", M01_Globals.g_dbtDbProcName, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_csrStmntTxt", "VARCHAR(800)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "SQLCODE", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_objCsrStmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare cursor", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE objCursor CURSOR WITH HOLD FOR v_objCsrStmnt;");

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR privCannotBeRevoked");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR doesNotHavePrivOnObject");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR failedToExecAsSpecified");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR unexpectedToken");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR inoperative");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, null, null, null, null, null, null, "Grants", null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNamePro, ddlType, null, "'schemaNamePattern_in", "'schemaNamePatternOpt_in", "'procNamePattern_in", "'procNamePatternOpt_in", "'filterTemplate_in", "'opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout", null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_csrStmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'SELECT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'PROCSCHEMA,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SPECIFICNAME ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SYSCAT.PROCEDURES ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(PROCSCHEMA) LIKE ''' || schemaNamePattern_in || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(PROCSCHEMA) LIKE ''' || COALESCE(schemaNamePatternOpt_in, '%') || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(PROCNAME) LIKE ''' || procNamePattern_in || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(PROCNAME) LIKE ''' || COALESCE(procNamePatternOpt_in, '%') || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(CASE WHEN COALESCE(filterTemplate_in, '') = '' THEN '' ELSE 'AND (' || REPLACE(REPLACE(filterTemplate_in, '<%S>', 'PROCSCHEMA'), '<%N>', 'PROCNAME') || ') ' END) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FOR READ ONLY'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "PREPARE v_objCsrStmnt FROM v_csrStmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "OPEN objCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FETCH objCursor INTO v_procSchema, v_procName;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHILE (SQLCODE = 0) DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (opType_in = 'GRANT') THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'GRANT ' || privilege_in || ' ON SPECIFIC PROCEDURE ' || RTRIM(v_procSchema )|| '.' || RTRIM(v_procName) || ' TO ' || granteeType_in || COALESCE(' ' || grantee_in,'')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'REVOKE ' || privilege_in || ' ON SPECIFIC PROCEDURE ' || RTRIM(v_procSchema) || '.' || RTRIM(v_procName) || ' FROM ' || granteeType_in || COALESCE(' ' || grantee_in,'') || ' RESTRICT'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_inout = rowCount_inout + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

if (commitCount > 0) {
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF MOD(rowCount_inout, " + String.valueOf(commitCount) + ") = 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + tempTabNameStatementGrant);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "rowCount_inout,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FETCH objCursor INTO v_procSchema, v_procName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END WHILE;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CLOSE objCursor;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNamePro, ddlType, null, "'schemaNamePattern_in", "'schemaNamePatternOpt_in", "'procNamePattern_in", "'procNamePatternOpt_in", "'filterTemplate_in", "'opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout", null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for granting access rights on User Defined Functions
// ####################################################################################################################

String qualProcedureNameUdf;
qualProcedureNameUdf = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "UDF", null, null);

M22_Class_Utilities.printSectionHeader("SP for granting access rights on user defined functions", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameUdf);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePatternOpt_in", M01_Globals.g_dbtDbSchemaName, true, "optional user-supplied additional filter for schemas");
M11_LRT.genProcParm(fileNo, "IN", "funcNamePattern_in", "VARCHAR(80)", true, "determines the functions that apply");
M11_LRT.genProcParm(fileNo, "IN", "funcNamePatternOpt_in", "VARCHAR(80)", true, "optional user-supplied additional filter for functions");
M11_LRT.genProcParm(fileNo, "IN", "filterTemplate_in", "VARCHAR(100)", true, "optional filter-pattern to apply (may use placeholder '<%S>', '<%N>')");
M11_LRT.genProcParm(fileNo, "IN", "opType_in", "VARCHAR(6)", true, "either 'GRANT' or 'REVOKE'");
M11_LRT.genProcParm(fileNo, "IN", "privilege_in", "VARCHAR(100)", true, "privilege to grant resp. revoke");
M11_LRT.genProcParm(fileNo, "IN", "granteeType_in", "VARCHAR(6)", true, "either 'USER', 'GROUP' or 'PUBLIC'");
M11_LRT.genProcParm(fileNo, "IN", "grantee_in", "VARCHAR(100)", true, "determines the user / group");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "INOUT", "rowCount_inout", "INTEGER", false, "number of GRANT-/REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);
M11_LRT.genCondDecl(fileNo, "privCannotBeRevoked", "42504", null);
M11_LRT.genCondDecl(fileNo, "doesNotHavePrivOnObject", "42501", null);
M11_LRT.genCondDecl(fileNo, "failedToExecAsSpecified", "42502", null);
M11_LRT.genCondDecl(fileNo, "unexpectedToken", "42601", null);
M11_LRT.genCondDecl(fileNo, "inoperative", "51024", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_funcSchema", M01_Globals.g_dbtDbSchemaName, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_funcName", M01_Globals.g_dbtDbProcName, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_csrStmntTxt", "VARCHAR(800)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "SQLCODE", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_objCsrStmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare cursor", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE objCursor CURSOR WITH HOLD FOR v_objCsrStmnt;");

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR privCannotBeRevoked");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR doesNotHavePrivOnObject");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR failedToExecAsSpecified");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR unexpectedToken");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR inoperative");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, null, null, null, null, null, null, "Grants", null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameUdf, ddlType, null, "'schemaNamePattern_in", "'schemaNamePatternOpt_in", "'funcNamePattern_in", "'funcNamePatternOpt_in", "'filterTemplate_in", "'opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout", null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_csrStmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'SELECT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'FUNCSCHEMA,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SPECIFICNAME ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SYSCAT.FUNCTIONS ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(FUNCSCHEMA) LIKE ''' || schemaNamePattern_in || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(FUNCSCHEMA) LIKE ''' || COALESCE(schemaNamePatternOpt_in, '%') || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(FUNCNAME) LIKE ''' || funcNamePattern_in || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(FUNCNAME) LIKE ''' || COALESCE(funcNamePatternOpt_in, '%') || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(CASE WHEN COALESCE(filterTemplate_in, '') = '' THEN '' ELSE 'AND (' || REPLACE(REPLACE(filterTemplate_in, '<%S>', 'FUNCSCHEMA'), '<%N>', 'FUNCNAME') || ') ' END) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FOR READ ONLY'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "PREPARE v_objCsrStmnt FROM v_csrStmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "OPEN objCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FETCH objCursor INTO v_funcSchema, v_funcName;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHILE (SQLCODE = 0) DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (opType_in = 'GRANT') THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'GRANT ' || privilege_in || ' ON SPECIFIC FUNCTION ' || RTRIM(v_funcSchema )|| '.' || RTRIM(v_funcName) || ' TO ' || granteeType_in || COALESCE(' ' || grantee_in,'')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'REVOKE ' || privilege_in || ' ON SPECIFIC FUNCTION ' || RTRIM(v_funcSchema) || '.' || RTRIM(v_funcName) || ' FROM ' || granteeType_in || COALESCE(' ' || grantee_in,'') || ' RESTRICT'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_inout = rowCount_inout + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

if (commitCount > 0) {
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF MOD(rowCount_inout, " + String.valueOf(commitCount) + ") = 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + tempTabNameStatementGrant);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "rowCount_inout,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FETCH objCursor INTO v_funcSchema, v_funcName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END WHILE;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CLOSE objCursor;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameUdf, ddlType, null, "'schemaNamePattern_in", "'schemaNamePatternOpt_in", "'funcNamePattern_in", "'funcNamePatternOpt_in", "'filterTemplate_in", "'opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout", null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for granting access rights on tablespaces
// ####################################################################################################################

String qualProcedureNameTSp;
qualProcedureNameTSp = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "TSP", null, null);

M22_Class_Utilities.printSectionHeader("SP for granting access rights on stored procedures", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameTSp);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "tabSpaceNamePattern_in", "VARCHAR(50)", true, "determines the tablespaces that apply");
M11_LRT.genProcParm(fileNo, "IN", "tabSpaceNamePatternOpt_in", "VARCHAR(50)", true, "optional user-supplied additional filter for tablespaces");
M11_LRT.genProcParm(fileNo, "IN", "filterTemplate_in", "VARCHAR(100)", true, "optional filter-pattern to apply (may use placeholder '<%S>')");
M11_LRT.genProcParm(fileNo, "IN", "opType_in", "VARCHAR(6)", true, "either 'GRANT' or 'REVOKE'");
M11_LRT.genProcParm(fileNo, "IN", "privilege_in", "VARCHAR(100)", true, "privilege to grant resp. revoke");
M11_LRT.genProcParm(fileNo, "IN", "granteeType_in", "VARCHAR(6)", true, "either 'USER', 'GROUP' or 'PUBLIC'");
M11_LRT.genProcParm(fileNo, "IN", "grantee_in", "VARCHAR(100)", true, "determines the user / group");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "INOUT", "rowCount_inout", "INTEGER", false, "number of GRANT-/REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);
M11_LRT.genCondDecl(fileNo, "privCannotBeRevoked", "42504", null);
M11_LRT.genCondDecl(fileNo, "doesNotHavePrivOnObject", "42501", null);
M11_LRT.genCondDecl(fileNo, "failedToExecAsSpecified", "42502", null);
M11_LRT.genCondDecl(fileNo, "unexpectedToken", "42601", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_tbSpName", "VARCHAR(30)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_csrStmntTxt", "VARCHAR(800)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "SQLCODE", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_objCsrStmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare cursor", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE objCursor CURSOR WITH HOLD FOR v_objCsrStmnt;");

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR privCannotBeRevoked");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR doesNotHavePrivOnObject");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR failedToExecAsSpecified");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR unexpectedToken");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, null, null, null, null, null, null, "Grants", null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameTSp, ddlType, null, "'tabSpaceNamePattern_in", "'tabSpaceNamePatternOpt_in", "'filterTemplate_in", "'opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout", null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_csrStmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'SELECT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'TBSPACE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SYSCAT.TABLESPACES ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(TBSPACE) LIKE ''' || tabSpaceNamePattern_in || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RTRIM(TBSPACE) LIKE ''' || COALESCE(tabSpaceNamePatternOpt_in, '%') || ''' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(CASE WHEN COALESCE(filterTemplate_in, '') = '' THEN '' ELSE 'AND (' || REPLACE(filterTemplate_in, '<%N>', 'TBSPACE') || ') ' END) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'FOR READ ONLY'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "PREPARE v_objCsrStmnt FROM v_csrStmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "OPEN objCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FETCH objCursor INTO v_tbSpName;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHILE (SQLCODE = 0) DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (opType_in = 'GRANT') THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'GRANT ' || privilege_in || ' OF TABLESPACE ' || RTRIM(v_tbSpName) || ' TO ' || granteeType_in || COALESCE(' ' || grantee_in,'')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'REVOKE ' || privilege_in || ' OF TABLESPACE ' || RTRIM(v_tbSpName) || ' FROM ' || granteeType_in || COALESCE(' ' || grantee_in,'')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_inout = rowCount_inout + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

if (commitCount > 0) {
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF MOD(rowCount_inout, " + String.valueOf(commitCount) + ") = 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + tempTabNameStatementGrant);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "rowCount_inout,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FETCH objCursor INTO v_tbSpName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END WHILE;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CLOSE objCursor;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameTSp, ddlType, null, "'tabSpaceNamePattern_in", "'tabSpaceNamePatternOpt_in", "'filterTemplate_in", "'opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout", null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for granting access rights on database
// ####################################################################################################################

String qualProcedureNameDb;
qualProcedureNameDb = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "DB", null, null);

M22_Class_Utilities.printSectionHeader("SP for granting access rights on database", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameDb);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "opType_in", "VARCHAR(6)", true, "either 'GRANT' or 'REVOKE'");
M11_LRT.genProcParm(fileNo, "IN", "privilege_in", "VARCHAR(100)", true, "privilege to grant resp. revoke");
M11_LRT.genProcParm(fileNo, "IN", "granteeType_in", "VARCHAR(6)", true, "either 'USER', 'GROUP' or 'PUBLIC'");
M11_LRT.genProcParm(fileNo, "IN", "grantee_in", "VARCHAR(100)", true, "determines the user / group");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "INOUT", "rowCount_inout", "INTEGER", false, "number of GRANT-/REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);
M11_LRT.genCondDecl(fileNo, "privCannotBeRevoked", "42504", null);
M11_LRT.genCondDecl(fileNo, "doesNotHavePrivOnObject", "42501", null);
M11_LRT.genCondDecl(fileNo, "failedToExecAsSpecified", "42502", null);
M11_LRT.genCondDecl(fileNo, "unexpectedToken", "42601", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR privCannotBeRevoked");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR doesNotHavePrivOnObject");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR failedToExecAsSpecified");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR unexpectedToken");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, null, null, null, null, null, null, "Grants", null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameDb, ddlType, null, "'opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout", null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF (opType_in = 'GRANT') THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'GRANT ' || privilege_in || ' ON DATABASE TO ' || granteeType_in || COALESCE(' ' || grantee_in,'')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'REVOKE ' || privilege_in || ' ON DATABASE FROM ' || granteeType_in || COALESCE(' ' || grantee_in,'')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_inout = rowCount_inout + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");

if (commitCount > 0) {
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF MOD(rowCount_inout, " + String.valueOf(commitCount) + ") = 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 1, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + tempTabNameStatementGrant);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "rowCount_inout,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameDb, ddlType, null, "'opType_in", "'privilege_in", "'granteeType_in", "'grantee_in", "mode_in", "rowCount_inout", null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

NormalExit:
return;

ErrorExit:
errMsgBox(Err.description);
Resume(NormalExit);
}


public static void genDdlSetgrants2(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

String tempTabNameStatementGrant;
tempTabNameStatementGrant = M94_DBAdmin.tempTabNameStatement + "Grants";

String qualProcedureNameSchema;
qualProcedureNameSchema = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "SCH", null, null);
String qualProcedureNameTab;
qualProcedureNameTab = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "TAB", null, null);
String qualProcedureNameSeq;
qualProcedureNameSeq = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "SEQ", null, null);
String qualProcedureNamePkg;
qualProcedureNamePkg = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "PKG", null, null);
String qualProcedureNamePro;
qualProcedureNamePro = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "PRO", null, null);
String qualProcedureNameUdf;
qualProcedureNameUdf = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "UDF", null, null);
String qualProcedureNameTSp;
qualProcedureNameTSp = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "TSP", null, null);
String qualProcedureNameDb;
qualProcedureNameDb = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "DB", null, null);

//On Error GoTo ErrorExit 

// ####################################################################################################################
// #    SP for granting access rights (by environment / filtered)
// ####################################################################################################################

String qualProcedureNameGrantByEnvFltr;
qualProcedureNameGrantByEnvFltr = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "ByEnvFltr", M04_Utilities.ObjNameDelimMode.eondmNone, null);

M22_Class_Utilities.printSectionHeader("SP for granting access rights (by environment / filtered)", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameGrantByEnvFltr);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "environment_in", "CHAR(1)", true, "refers to column 'environment' in table 'DbPrivileges'");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "schemaFilter_in", M01_Globals.g_dbtDbSchemaName, true, "optional user-supplied additional filter for schemas");
M11_LRT.genProcParm(fileNo, "IN", "objFilter_in", "VARCHAR(80)", true, "optional user-supplied additional filter for objects");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of GRANT-/REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_typeSelector", "CHAR(1)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_grantee", "VARCHAR(100)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_enforcedOpType", "VARCHAR(6)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_filterCond", "VARCHAR(100)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare cursor", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE cfgParmCursor CURSOR FOR v_stmnt;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, null, null, null, null, null, "Grants", null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameGrantByEnvFltr, ddlType, null, "'environment_in", "mode_in", "'schemaFilter_in", "'objFilter_in", "rowCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "check if we want to enforce 'REVOKE'", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 10 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET mode_in = mode_in - 10;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_enforcedOpType = 'REVOKE';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF schemaFilter_in IS NULL AND objFilter_in IS NULL THEN");
M11_LRT.genProcSectionHeader(fileNo, "process privileges on DB", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR dbLoop AS dbCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COALESCE(v_enforcedOpType, UPPER(OPTYPE)) AS c_opType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(GRANTEETYPE)                        AS c_granteeType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(LTRIM(RTRIM(GRANTEE)))              AS c_grantee,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(PRIVILEGE)                          AS c_privilege");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameDbPrivileges);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "environment_in IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ENVIRONMENT IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "UPPER(ENVIRONMENT) = UPPER(environment_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OBJECTTYPE = 'DATABASE'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(v_enforcedOpType IS NULL OR UPPER(OPTYPE) = 'GRANT')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQUENCENO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_grantee = c_grantee;");
M11_LRT.genProcSectionHeader(fileNo, "check for grantee to resolve in DBM config", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF LEFT(v_grantee, 1) = '<' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = 'SELECT RTRIM(CAST(' || REPLACE(REPLACE(v_grantee, '<',''), '>', '') || ' AS CHAR(100))) FROM TABLE(SYSFUN.GET_DBM_CONFIG()) AS DBMCFG WHERE DBMCONFIG_TYPE = 0';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OPEN cfgParmCursor;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "cfgParmCursor");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_grantee");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CLOSE cfgParmCursor WITH RELEASE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF (COALESCE(v_grantee, '') <> '') AND c_granteeType <> 'PUBLIC' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CALL " + qualProcedureNameDb + "(c_opType, c_privilege, c_granteeType, v_grantee, mode_in, rowCount_out);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF schemaFilter_in IS NULL THEN");
M11_LRT.genProcSectionHeader(fileNo, "process privileges on tablespaces", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR tsLoop AS tsCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COALESCE(v_enforcedOpType, UPPER(OPTYPE)) AS c_opType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(OBJECTNAME)                         AS c_objectName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(FILTER)                             AS c_filter,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(GRANTEETYPE)                        AS c_granteeType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(LTRIM(RTRIM(GRANTEE)))              AS c_grantee,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(PRIVILEGE)                          AS c_privilege");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameDbPrivileges);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "environment_in IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ENVIRONMENT IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "UPPER(ENVIRONMENT) = UPPER(environment_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OBJECTTYPE = 'TABLESPACE'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(v_enforcedOpType IS NULL OR UPPER(OPTYPE) = 'GRANT')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQUENCENO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_grantee = c_grantee;");
M11_LRT.genProcSectionHeader(fileNo, "check for grantee to resolve in DBM config", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF LEFT(v_grantee, 1) = '<' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = 'SELECT RTRIM(CAST(' || REPLACE(REPLACE(v_grantee, '<',''), '>', '') || ' AS CHAR(100))) FROM TABLE(SYSFUN.GET_DBM_CONFIG()) AS DBMCFG WHERE DBMCONFIG_TYPE = 0';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OPEN cfgParmCursor;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "cfgParmCursor");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_grantee");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CLOSE cfgParmCursor WITH RELEASE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF (COALESCE(v_grantee, '') <> '') AND c_granteeType <> 'PUBLIC' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CALL " + qualProcedureNameTSp + "(c_objectName, objFilter_in, c_filter, c_opType, c_privilege, c_granteeType, v_grantee, mode_in, rowCount_out);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF objFilter_in IS NULL THEN");
M11_LRT.genProcSectionHeader(fileNo, "process privileges on schemas", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR schLoop AS schCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COALESCE(v_enforcedOpType, UPPER(OPTYPE)) AS c_opType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(SCHEMANAME)                         AS c_schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(FILTER)                             AS c_filter,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(GRANTEETYPE)                        AS c_granteeType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(LTRIM(RTRIM(GRANTEE)))              AS c_grantee,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(PRIVILEGE)                          AS c_privilege,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WITHGRANT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameDbPrivileges);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "environment_in IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ENVIRONMENT IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "UPPER(ENVIRONMENT) = UPPER(environment_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OBJECTTYPE = 'SCHEMA'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(v_enforcedOpType IS NULL OR UPPER(OPTYPE) = 'GRANT')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQUENCENO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_grantee = c_grantee;");
M11_LRT.genProcSectionHeader(fileNo, "check for grantee to resolve in DBM config", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF LEFT(v_grantee, 1) = '<' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = 'SELECT RTRIM(CAST(' || REPLACE(REPLACE(v_grantee, '<',''), '>', '') || ' AS CHAR(100))) FROM TABLE(SYSFUN.GET_DBM_CONFIG()) AS DBMCFG WHERE DBMCONFIG_TYPE = 0';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OPEN cfgParmCursor;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "cfgParmCursor");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_grantee");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CLOSE cfgParmCursor WITH RELEASE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF (COALESCE(v_grantee, '') <> '') AND c_granteeType <> 'PUBLIC' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CALL " + qualProcedureNameSchema + "(c_schemaName, schemaFilter_in, c_filter, c_opType, c_privilege, c_granteeType, v_grantee, WITHGRANT, mode_in, rowCount_out);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "process privileges on tables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS tabCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COALESCE(v_enforcedOpType, UPPER(OPTYPE)) AS c_opType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(OBJECTTYPE)                         AS c_objectType,");
if (ddlType == M01_Common.DdlTypeId.edtLdm) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'%'                                       AS c_schemaName,");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(SCHEMANAME)                         AS c_schemaName,");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(OBJECTNAME)                         AS c_objectName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(FILTER)                             AS c_filter,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(GRANTEETYPE)                        AS c_granteeType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(LTRIM(RTRIM(GRANTEE)))              AS c_grantee,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(PRIVILEGE)                          AS c_privilege");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDbPrivileges);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "environment_in IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ENVIRONMENT IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(ENVIRONMENT) = UPPER(environment_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OBJECTTYPE = 'TABLE'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OBJECTTYPE = 'VIEW'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OBJECTTYPE = 'ALIAS'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(v_enforcedOpType IS NULL OR UPPER(OPTYPE) = 'GRANT')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SEQUENCENO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_grantee = c_grantee;");
M11_LRT.genProcSectionHeader(fileNo, "check for grantee to resolve in DBM config", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF LEFT(v_grantee, 1) = '<' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'SELECT RTRIM(CAST(' || REPLACE(REPLACE(v_grantee, '<',''), '>', '') || ' AS CHAR(100))) FROM TABLE(SYSFUN.GET_DBM_CONFIG()) AS DBMCFG WHERE DBMCONFIG_TYPE = 0';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN cfgParmCursor;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "cfgParmCursor");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_grantee");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CLOSE cfgParmCursor WITH RELEASE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (COALESCE(v_grantee, '') <> '') AND c_granteeType <> 'PUBLIC' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_typeSelector = LEFT(c_objectType,1);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CALL " + qualProcedureNameTab + "(v_typeSelector, c_schemaName, schemaFilter_in, c_objectName, objFilter_in, c_filter, c_opType, c_privilege, c_granteeType, c_grantee, mode_in, rowCount_out);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "process privileges on sequences", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR seqLoop AS seqCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COALESCE(v_enforcedOpType, UPPER(OPTYPE)) AS c_opType,");
if (ddlType == M01_Common.DdlTypeId.edtLdm) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'%'                                       AS c_schemaName,");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(SCHEMANAME)                         AS c_schemaName,");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(OBJECTNAME)                         AS c_objectName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(FILTER)                             AS c_filter,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(GRANTEETYPE)                        AS c_granteeType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(LTRIM(RTRIM(GRANTEE)))              AS c_grantee,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(PRIVILEGE)                          AS c_privilege");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDbPrivileges);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "environment_in IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ENVIRONMENT IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(ENVIRONMENT) = UPPER(environment_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OBJECTTYPE = 'SEQUENCE'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(v_enforcedOpType IS NULL OR UPPER(OPTYPE) = 'GRANT')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SEQUENCENO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_grantee = c_grantee;");
M11_LRT.genProcSectionHeader(fileNo, "check for grantee to resolve in DBM config", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF LEFT(v_grantee, 1) = '<' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'SELECT RTRIM(CAST(' || REPLACE(REPLACE(v_grantee, '<',''), '>', '') || ' AS CHAR(100))) FROM TABLE(SYSFUN.GET_DBM_CONFIG()) AS DBMCFG WHERE DBMCONFIG_TYPE = 0';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN cfgParmCursor;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "cfgParmCursor");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_grantee");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CLOSE cfgParmCursor WITH RELEASE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (COALESCE(v_grantee, '') <> '') AND c_granteeType <> 'PUBLIC' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CALL " + qualProcedureNameSeq + "(c_schemaName, schemaFilter_in, c_objectName, objFilter_in, c_filter, c_opType, c_privilege, c_granteeType, v_grantee, mode_in, rowCount_out);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "process privileges on procedures", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR proLoop AS proCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COALESCE(v_enforcedOpType, UPPER(OPTYPE)) AS c_opType,");
if (ddlType == M01_Common.DdlTypeId.edtLdm) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'%'                                       AS c_schemaName,");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(SCHEMANAME)                         AS c_schemaName,");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(OBJECTNAME)                         AS c_objectName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(FILTER)                             AS c_filter,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(GRANTEETYPE)                        AS c_granteeType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(LTRIM(RTRIM(GRANTEE)))              AS c_grantee,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(PRIVILEGE)                          AS c_privilege");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDbPrivileges);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "environment_in IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ENVIRONMENT IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(ENVIRONMENT) = UPPER(environment_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OBJECTTYPE = 'PROCEDURE'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(v_enforcedOpType IS NULL OR UPPER(OPTYPE) = 'GRANT')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SEQUENCENO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_grantee = c_grantee;");
M11_LRT.genProcSectionHeader(fileNo, "check for grantee to resolve in DBM config", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF LEFT(v_grantee, 1) = '<' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'SELECT RTRIM(CAST(' || REPLACE(REPLACE(v_grantee, '<',''), '>', '') || ' AS CHAR(100))) FROM TABLE(SYSFUN.GET_DBM_CONFIG()) AS DBMCFG WHERE DBMCONFIG_TYPE = 0';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN cfgParmCursor;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "cfgParmCursor");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_grantee");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CLOSE cfgParmCursor WITH RELEASE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (COALESCE(v_grantee, '') <> '') AND c_granteeType <> 'PUBLIC' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CALL " + qualProcedureNamePro + "(c_schemaName, schemaFilter_in, c_objectName, objFilter_in, c_filter, c_opType, c_privilege, c_granteeType, v_grantee, mode_in, rowCount_out);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "process privileges on functions", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR udfLoop AS udfCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COALESCE(v_enforcedOpType, UPPER(OPTYPE)) AS c_opType,");
if (ddlType == M01_Common.DdlTypeId.edtLdm) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'%'                                       AS c_schemaName,");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(SCHEMANAME)                         AS c_schemaName,");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(OBJECTNAME)                         AS c_objectName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(FILTER)                             AS c_filter,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(GRANTEETYPE)                        AS c_granteeType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(LTRIM(RTRIM(GRANTEE)))              AS c_grantee,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(PRIVILEGE)                          AS c_privilege");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDbPrivileges);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "environment_in IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ENVIRONMENT IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(ENVIRONMENT) = UPPER(environment_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OBJECTTYPE = 'FUNCTION'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(v_enforcedOpType IS NULL OR UPPER(OPTYPE) = 'GRANT')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SEQUENCENO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_grantee = c_grantee;");
M11_LRT.genProcSectionHeader(fileNo, "check for grantee to resolve in DBM config", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF LEFT(v_grantee, 1) = '<' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'SELECT RTRIM(CAST(' || REPLACE(REPLACE(v_grantee, '<',''), '>', '') || ' AS CHAR(100))) FROM TABLE(SYSFUN.GET_DBM_CONFIG()) AS DBMCFG WHERE DBMCONFIG_TYPE = 0';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN cfgParmCursor;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "cfgParmCursor");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_grantee");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CLOSE cfgParmCursor WITH RELEASE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (COALESCE(v_grantee, '') <> '') AND c_granteeType <> 'PUBLIC' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CALL " + qualProcedureNameUdf + "(c_schemaName, schemaFilter_in, c_objectName, objFilter_in, c_filter, c_opType, c_privilege, c_granteeType, v_grantee, mode_in, rowCount_out);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "process privileges on packages", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR pkgLoop AS pkgCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COALESCE(v_enforcedOpType, UPPER(OPTYPE)) AS c_opType,");
if (ddlType == M01_Common.DdlTypeId.edtLdm) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'%'                                       AS c_schemaName,");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(SCHEMANAME)                         AS c_schemaName,");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(OBJECTNAME)                         AS c_objectName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(FILTER)                             AS c_filter,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(GRANTEETYPE)                        AS c_granteeType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(LTRIM(RTRIM(GRANTEE)))              AS c_grantee,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(PRIVILEGE)                          AS c_privilege");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDbPrivileges);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "environment_in IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ENVIRONMENT IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(ENVIRONMENT) = UPPER(environment_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OBJECTTYPE = 'PACKAGE'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(v_enforcedOpType IS NULL OR UPPER(OPTYPE) = 'GRANT')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SEQUENCENO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_grantee = c_grantee;");
M11_LRT.genProcSectionHeader(fileNo, "check for grantee to resolve in DBM config", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF LEFT(v_grantee, 1) = '<' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'SELECT RTRIM(CAST(' || REPLACE(REPLACE(v_grantee, '<',''), '>', '') || ' AS CHAR(100))) FROM TABLE(SYSFUN.GET_DBM_CONFIG()) AS DBMCFG WHERE DBMCONFIG_TYPE = 0';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN cfgParmCursor;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "cfgParmCursor");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_grantee");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CLOSE cfgParmCursor WITH RELEASE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (COALESCE(v_grantee, '') <> '') AND c_granteeType <> 'PUBLIC' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CALL " + qualProcedureNamePkg + "(c_schemaName, schemaFilter_in, c_objectName, objFilter_in, c_filter, c_opType, c_privilege, c_granteeType, v_grantee, mode_in, rowCount_out);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + tempTabNameStatementGrant);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmntCursor;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameGrantByEnvFltr, ddlType, null, "'environment_in", "mode_in", "'schemaFilter_in", "'objFilter_in", "rowCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for granting access rights (by environment)
// ####################################################################################################################

String qualProcedureNameGrantByEnv;
qualProcedureNameGrantByEnv = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "ByEnv", M04_Utilities.ObjNameDelimMode.eondmNone, null);

M22_Class_Utilities.printSectionHeader("SP for granting access rights (by environment)", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameGrantByEnv);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "environment_in", "CHAR(1)", true, "refers to column 'environment' in table 'DbPrivileges'");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of GRANT-/REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameGrantByEnv, ddlType, null, "'environment_in", "mode_in", "rowCount_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CALL " + qualProcedureNameGrantByEnvFltr + "(environment_in, mode_in, NULL, NULL, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameGrantByEnv, ddlType, null, "'environment_in", "mode_in", "rowCount_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for revoking access rights (by environment / filtered)
// ####################################################################################################################

String qualProcedureNameRevokeByEnvFltr;
qualProcedureNameRevokeByEnvFltr = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRevoke, ddlType, null, null, null, "ByEnvFltr", M04_Utilities.ObjNameDelimMode.eondmNone, null);

M22_Class_Utilities.printSectionHeader("SP for revoking access rights (by environment)", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameRevokeByEnvFltr);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "environment_in", "CHAR(1)", true, "refers to column 'environment' in table 'DbPrivileges'");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "schemaFilter_in", M01_Globals.g_dbtDbSchemaName, true, "optional additional filter for schemas");
M11_LRT.genProcParm(fileNo, "IN", "objFilter_in", "VARCHAR(50)", true, "optional additional filter for objects");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameRevokeByEnvFltr, ddlType, null, "'environment_in", "mode_in", "'schemaFilter_in", "'objFilter_in", "rowCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET mode_in = mode_in + 10;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameGrantByEnvFltr + "(environment_in, mode_in, schemaFilter_in, objFilter_in, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameRevokeByEnvFltr, ddlType, null, "'environment_in", "mode_in", "'schemaFilter_in", "'objFilter_in", "rowCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for revoking access rights (by environment)
// ####################################################################################################################

String qualProcedureNameRevokeByEnv;
qualProcedureNameRevokeByEnv = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRevoke, ddlType, null, null, null, "ByEnv", M04_Utilities.ObjNameDelimMode.eondmNone, null);

M22_Class_Utilities.printSectionHeader("SP for revoking access rights (by environment)", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameRevokeByEnv);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "environment_in", "CHAR(1)", true, "refers to column 'environment' in table 'DbPrivileges'");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameRevokeByEnv, ddlType, null, "'environment_in", "mode_in", "rowCount_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET mode_in = mode_in + 10;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameGrantByEnvFltr + "(environment_in, mode_in, NULL, NULL, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameRevokeByEnv, ddlType, null, "'environment_in", "mode_in", "rowCount_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for granting access rights (filtered)
// ####################################################################################################################

String qualProcedureNameGrantFltr;
qualProcedureNameGrantFltr = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "Fltr", M04_Utilities.ObjNameDelimMode.eondmNone, null);

M22_Class_Utilities.printSectionHeader("SP for granting access rights", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameGrantFltr);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "schemaFilter_in", M01_Globals.g_dbtDbSchemaName, true, "optional additional filter for schemas");
M11_LRT.genProcParm(fileNo, "IN", "objFilter_in", "VARCHAR(80)", true, "optional additional filter for objects");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of GRANT-/REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameGrantFltr, ddlType, null, "mode_in", "'schemaFilter_in", "'objFilter_in", "rowCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameGrantByEnvFltr + "(NULL, mode_in, schemaFilter_in, objFilter_in, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameGrantFltr, ddlType, null, "mode_in", "'schemaFilter_in", "'objFilter_in", "rowCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for granting access rights
// ####################################################################################################################

String qualProcedureNameGrant;
qualProcedureNameGrant = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for granting access rights", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameGrant);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of GRANT-/REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameGrant, ddlType, null, "mode_in", "rowCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameGrantByEnvFltr + "(NULL, mode_in, NULL, NULL, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameGrant, ddlType, null, "mode_in", "rowCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for revoking access rights (filtered)
// ####################################################################################################################

String qualProcedureNameRevokeFltr;
qualProcedureNameRevokeFltr = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRevoke, ddlType, null, null, null, "Fltr", M04_Utilities.ObjNameDelimMode.eondmNone, null);

M22_Class_Utilities.printSectionHeader("SP for revoking access rights", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameRevokeFltr);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "schemaFilter_in", M01_Globals.g_dbtDbSchemaName, true, "optional additional filter for schemas");
M11_LRT.genProcParm(fileNo, "IN", "objFilter_in", "VARCHAR(50)", true, "optional additional filter for objects");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameRevokeFltr, ddlType, null, "mode_in", "'schemaFilter_in", "'objFilter_in", "rowCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET mode_in = mode_in + 10;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameGrantFltr + "(mode_in, schemaFilter_in, objFilter_in, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameRevokeFltr, ddlType, null, "mode_in", "'schemaFilter_in", "'objFilter_in", "rowCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

NormalExit:
return;

ErrorExit:
errMsgBox(Err.description);
Resume(NormalExit);
}


// ### IF IVK ###
private static void genDdlAutoDeploy(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (M03_Config.generateFwkTest) {
return;
}

//On Error GoTo ErrorExit 

// ####################################################################################################################
// #    Utility-SP determining the data fixes deployable based on content in tables DATAFIX, DATAFIXDEPENDENCY and DATAFIXIGNORED
// ####################################################################################################################

String qualProcedureNameGetDataFixesToDeploy;
qualProcedureNameGetDataFixesToDeploy = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGetDataFixesToDeploy, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("Utility-SP determining the data fixes deployable based on content in tables DATAFIX, DATAFIXDEPENDENCY and DATAFIXIGNORED", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameGetDataFixesToDeploy);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M11_LRT.genProcParm(fileNo, "OUT", "fixCount_out", "INTEGER", false, "number of fixes satisfying preconditions for deployment");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(200)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_condValue", M01_Globals.g_dbtBoolean, "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntCond", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare cursor", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE c_cond CURSOR FOR v_stmntCond;");

String qualTabNameDataFixesToDeploy;
qualTabNameDataFixesToDeploy = "SESSION.DataFixesToDeploy";
String qualTabNameTempConditionValue;
qualTabNameTempConditionValue = "SESSION.ConditionValue";

M11_LRT.genProcSectionHeader(fileNo, "temporary table for datafixes to deploy", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualTabNameDataFixesToDeploy);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "version   VARCHAR(20),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "revision  VARCHAR(20),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ignoreMe  " + M01_Globals.g_dbtBoolean);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, true, true, true);

M11_LRT.genProcSectionHeader(fileNo, "temporary table for condition values", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualTabNameTempConditionValue);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "seqNo     INTEGER GENERATED ALWAYS AS IDENTITY (START WITH 1 INCREMENT BY 1),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "condValue " + M01_Globals.g_dbtBoolean + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "version   VARCHAR(20),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "revision  VARCHAR(20),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CONDITION VARCHAR(2048)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, true, true, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameGetDataFixesToDeploy, ddlType, null, "fixCount_out", null, null, null, null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET fixCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "initialize temp table with all available datafixes", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualTabNameDataFixesToDeploy);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "version,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "revision,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ignoreMe");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "F.VERSION,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "F.REVISION,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals_IVK.g_qualTabNameDataFix + " F");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals_IVK.g_qualTabNameDataFixIgnored + " I");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "F.VERSION = I.VERSION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "COALESCE(F.REVISION, '') = COALESCE(I.REVISION, '')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "I.VERSION IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M11_LRT.genProcSectionHeader(fileNo, "loop over Data Fixes to identify fixes satisfying preconditions", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR fixLoop AS fixCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "version  AS c_version,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "revision AS c_revision");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + qualTabNameDataFixesToDeploy);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VERSION,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "REVISION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR UPDATE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "condCheckLoop:");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR condLoop AS condCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PRECONDITION AS c_precondition");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals_IVK.g_qualTabNameDataFixPrecondition + " C");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "C.VERSION = c_version");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COALESCE(C.REVISION, '') = COALESCE(c_revision, '')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "determine condition value of 'c_precondition'", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'VALUES(CASE WHEN ' || c_precondition || ' THEN 1 ELSE 0 END)';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmntCond FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN c_cond;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FETCH c_cond INTO v_condValue;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CLOSE c_cond WITH RELEASE;");

M11_LRT.genProcSectionHeader(fileNo, "keep track of condition evaluated", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + qualTabNameTempConditionValue);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "condValue,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "version,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "revision,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "condition");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_condValue,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_version,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_revision,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_precondition");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");

M11_LRT.genProcSectionHeader(fileNo, "if this datafix does not satisfy condtion it must be ignored", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF v_condValue = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPDATE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + qualTabNameDataFixesToDeploy);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ignoreMe = " + M01_LDM.gc_dbTrue);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CURRENT OF fixCursor");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LEAVE condCheckLoop;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "count number of fixes to deploy", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET fixCount_out = (SELECT COUNT(*) FROM " + qualTabNameDataFixesToDeploy + " WHERE ignoreMe = 0);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    UPDATE / DELETE-Trigger prohibiting modification of 'IBM'-owned records defining 'FixIgnored'-records
// ####################################################################################################################

String qualTriggerName;
String qualTabName;

String thisClassName;
int thisClassIndex;
int i;
for (int i = 1; i <= 2; i++) {
thisClassIndex = (i == 1 ? M01_Globals_IVK.g_classIndexDataFixIgnored : M01_Globals_IVK.g_classIndexDdlFixIgnored);
thisClassName = (i == 1 ? M01_ACM_IVK.clnDataFixIgnored : M01_ACM_IVK.clnDdlFixIgnored);

qualTriggerName = M04_Utilities.genQualTriggerNameByClassIndex(thisClassIndex, ddlType, null, null, null, null, null, null, null, "UPD", M04_Utilities.ObjNameDelimMode.eondmSuffix, null);
qualTabName = M04_Utilities.genQualTabNameByClassIndex(thisClassIndex, ddlType, null, null, null, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("UPDATE-Trigger prohibiting modification of 'IBM'-owned records in table \"" + qualTabName + "\"", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE TRIGGER");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualTriggerName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "NO CASCADE BEFORE UPDATE ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualTabName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "REFERENCING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "NEW AS " + M01_Globals.gc_newRecordName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "OLD AS " + M01_Globals.gc_oldRecordName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "FOR EACH ROW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN ATOMIC");

M11_LRT.genProcSectionHeader(fileNo, "verify that update does not modify an IBM-owned record", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF " + M01_Globals.gc_oldRecordName + ".REASON LIKE 'IBM:%' AND " + M01_Globals.gc_newRecordName + ".REASON NOT LIKE 'ibm:%' THEN");
M79_Err.genSignalDdl("updateNotAllowed", fileNo, 2, thisClassName, null, null, null, null, null, null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

qualTriggerName = M04_Utilities.genQualTriggerNameByClassIndex(thisClassIndex, ddlType, null, null, null, null, null, null, null, "DEL", M04_Utilities.ObjNameDelimMode.eondmSuffix, null);

M22_Class_Utilities.printSectionHeader("DELETE-Trigger prohibiting delete of 'IBM'-owned records in table \"" + qualTabName + "\"", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE TRIGGER");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualTriggerName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "NO CASCADE BEFORE DELETE ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualTabName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "REFERENCING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "OLD AS " + M01_Globals.gc_oldRecordName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "FOR EACH ROW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN ATOMIC");

M11_LRT.genProcSectionHeader(fileNo, "verify that delete does not involve an IBM-owned record", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF " + M01_Globals.gc_oldRecordName + ".REASON LIKE 'IBM:%' THEN");
M79_Err.genSignalDdl("deleteNotAllowed", fileNo, 2, thisClassName, null, null, null, null, null, null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "END");
M00_FileWriter.printToFile(fileNo, M01_LDM.gc_sqlCmdDelim);
}
NormalExit:
return;

ErrorExit:
errMsgBox(Err.description);
Resume(NormalExit);
}


// ### ENDIF IVK ###
private static void genDdlRedirRestore(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

//On Error GoTo ErrorExit 

String qualFuncNameLastStrElem;
qualFuncNameLastStrElem = M04_Utilities.genQualFuncName(M01_Globals.g_sectionIndexMeta, M01_ACM.udfnLastStrElem, ddlType, null, null, null, null, null, null);

// ####################################################################################################################
// #    View retrieving a 'redirected-restore script'
// ####################################################################################################################

String qualViewNameRedirRestoreScript;
qualViewNameRedirRestoreScript = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnRedirectedRestoreScript, M01_ACM.vnsRedirectedRestoreScript, ddlType, null, null, null, null, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("View retrieving a 'redirected-restore script'", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE VIEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualViewNameRedirRestoreScript);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_TbSpaces");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "tbSpace,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "tbSpaceId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "seqno");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TBSPACE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TBSPACEID,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROWNUMBER() OVER (ORDER BY TBSPACEID ASC)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.TABLESPACES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_TbSpaceContainer");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "tbSpaceId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "tbSpace,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "containerType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "containerPath,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "totalPages,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "containerName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "seqno");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TABLESPACE_ID,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TABLESPACE_NAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(CASE WHEN CONTAINER_TYPE = 0 THEN 'PATH' WHEN CONTAINER_TYPE IN (2,6) THEN 'FILE' ELSE 'DEVICE' END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CONTAINER_NAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TOTAL_PAGES,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualFuncNameLastStrElem + "(CONTAINER_NAME, CHAR((CASE WHEN POSSTR(CONTAINER_NAME, '/') > 0 THEN '/' ELSE '\\' END), 1)),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROWNUMBER() OVER (PARTITION BY TABLESPACE_ID ORDER BY CONTAINER_ID ASC)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TABLE (SYSPROC.SNAPSHOT_CONTAINER(CURRENT SERVER, -1)) X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_TbSpaceContainerList");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "tbSpaceId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "commentList,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "list,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "card");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TC.tbSpaceId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'-- ' || TC.containerType || ' ''' || TC.containerPath || '''' || (CASE TC.containerType WHEN 'FILE' THEN ' ' || RTRIM(CHAR(TC.totalPages)) ELSE '' END) || CHR(10),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ' || TC.containerType || ' ''<#tsRootDir#>' || (CASE WHEN POSSTR(TC.containerPath, '/') > 0 THEN '/' ELSE '\\' END) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CASE TC.tbSpaceId");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHEN 0 THEN 'system1' || (CASE WHEN POSSTR(TC.containerPath, '/') > 0 THEN '/' ELSE '\\' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHEN 1 THEN 'temp1sms' || (CASE WHEN POSSTR(TC.containerPath, '/') > 0 THEN '/' ELSE '\\' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ELSE (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "CASE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "WHEN POSSTR(TC.tbSpace, 'SYS' ) > 0 THEN 'system1' || (CASE WHEN POSSTR(TC.containerPath, '/') > 0 THEN '/' ELSE '\\' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "WHEN POSSTR(TC.tbSpace, 'TEMP') > 0 THEN 'temp1sms' || (CASE WHEN POSSTR(TC.containerPath, '/') > 0 THEN '/' ELSE '\\' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "ELSE ''");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ") || TC.containerName ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(CASE TC.containerType WHEN 'FILE' THEN ' ' || RTRIM(CHAR(TC.totalPages)) ELSE '' END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_TbSpaceContainer TC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TC.seqno = 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TC.tbSpaceId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TCL.commentList || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'-- ' || TC.containerType || ' ''' || TC.containerPath || ''' ' || (CASE TC.containerType WHEN 'FILE' THEN ' ' || RTRIM(CHAR(TC.totalPages)) ELSE '' END) || CHR(10),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TCL.list || ',' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ' || TC.containerType || ' ''<#tsRootDir#>' || (CASE WHEN POSSTR(TC.containerPath, '/') > 0 THEN '/' ELSE '\\' END) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CASE TC.tbSpaceId");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHEN 0 THEN 'system1' || (CASE WHEN POSSTR(TC.containerPath, '/') > 0 THEN '/' ELSE '\\' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHEN 1 THEN 'temp1sms' || (CASE WHEN POSSTR(TC.containerPath, '/') > 0 THEN '/' ELSE '\\' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ELSE (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "CASE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "WHEN POSSTR(TC.tbSpace, 'SYS' ) > 0 THEN 'system1' || (CASE WHEN POSSTR(TC.containerPath, '/') > 0 THEN '/' ELSE '\\' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "WHEN POSSTR(TC.tbSpace, 'TEMP') > 0 THEN 'temp1sms' || (CASE WHEN POSSTR(TC.containerPath, '/') > 0 THEN '/' ELSE '\\' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "ELSE ''");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ") || TC.containerName ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(CASE TC.containerType WHEN 'FILE' THEN ' ' || RTRIM(CHAR(TC.totalPages)) ELSE '' END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TCL.card + 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_TbSpaceContainerList TCL,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_TbSpaceContainer TC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TCL.tbSpaceId = TC.tbSpaceId");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TC.seqno = TCL.card + 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TCL.card < 1000");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + " V_TbSpaceMap");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "map,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "seqNo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'-- tablespace ''' || TS.tbSpace || ''' (ID ' || RTRIM(CHAR(TS.tbSpaceId)) || ')' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TCL.commentList ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'SET TABLESPACE CONTAINERS FOR ' || RTRIM(CHAR(TS.tbSpaceId)) || ' USING'    || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'(' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TCL.list || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "')' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_LDM.gc_sqlCmdDelim + "' || CHR(10),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROWNUMBER() OVER (ORDER BY TS.tbSpaceId)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_TbSpaces TS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_TbSpaceContainerList TCL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TS.tbSpaceId = TCL.tbSpaceId");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_Script");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "script,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "seqNo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'----------------------------------------------------------------------'     || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'-- Description: Perform redirected restore for database ' || CURRENT SERVER || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'--              into new database .'                                        || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'--'                                                                         || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'-- Required authority: SYSADM or SYSCTRL'                                   || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'--'                                                                         || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'-- Usage: db2 -td" + M01_LDM.gc_sqlCmdDelim + " -f <scripName>'                                          || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'----------------------------------------------------------------------'     || CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'UPDATE COMMAND OPTIONS USING V ON" + M01_LDM.gc_sqlCmdDelim + "'                                         || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'UPDATE COMMAND OPTIONS USING S ON" + M01_LDM.gc_sqlCmdDelim + "'                                         || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'UPDATE COMMAND OPTIONS USING N ON" + M01_LDM.gc_sqlCmdDelim + "'                                         || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'UPDATE COMMAND OPTIONS USING X ON" + M01_LDM.gc_sqlCmdDelim + "'                                         || CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'RESTORE DATABASE'                                                           || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  ' || CURRENT SERVER                                                       || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'FROM'                                                                       || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  <#backupPath#>'                                                           || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'--TAKEN AT'                                                                 || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  -- <backup timestamp (format: YYYYMMDDHHMMSS)>'                           || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'INTO'                                                                       || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  <#newDbName#>'                                                            || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'--NEWLOGPATH <#logPath#>'                                                   || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'REDIRECT'                                                                   || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'WITHOUT PROMPTING'                                                          || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'" + M01_LDM.gc_sqlCmdDelim + "'                                                                          || CHR(10) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CHR(10)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AS VARCHAR(32000)),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSIBM.SYSDUMMY1");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TSC.script || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TSM.map");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AS VARCHAR(32000)),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TSC.seqNo +1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_TbSpaceMap TSM,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_Script TSC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TSM.seqno = TSC.seqno + 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TSC.seqno < 1000");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + " V_ScriptOrdered");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "script,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "seqno");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "script,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROWNUMBER() OVER (ORDER BY seqno DESC)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_Script");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "script  || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "'RESTORE DATABASE ' || CURRENT SERVER || ' CONTINUE' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'" + M01_LDM.gc_sqlCmdDelim + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "V_ScriptOrdered");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "seqNo = 1");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

NormalExit:
return;

ErrorExit:
errMsgBox(Err.description);
Resume(NormalExit);
}


private static void genDbAdminDdl2(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

//On Error GoTo ErrorExit 

// ####################################################################################################################
// #    SP for revoking access rights
// ####################################################################################################################

String qualProcedureNameGrant;
qualProcedureNameGrant = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, null, null, null);

String qualProcedureNameRevoke;
qualProcedureNameRevoke = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRevoke, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for revoking access rights", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameRevoke);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of REVOKE-statements executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameRevoke, ddlType, null, "mode_in", "rowCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET mode_in = mode_in + 10;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameGrant + "(mode_in, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameRevoke, ddlType, null, "mode_in", "rowCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
// we do not support this for LDM
return;
}

NormalExit:
return;

ErrorExit:
errMsgBox(Err.description);
Resume(NormalExit);
}


private static void genDbAdminDdl3(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

//On Error GoTo ErrorExit 

String qualViewNamePdmTable;
qualViewNamePdmTable = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbMeta, M01_ACM.vnPdmTable, M01_ACM.vnsPdmTable, ddlType, null, null, null, null, null, null, null, null, null, null);

// ####################################################################################################################
// #    SP for setting integrity on tables
// ####################################################################################################################

String qualProcName;
qualProcName = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnIntegrity, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for setting integrity on tables", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", false, "number of tables affected");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);
M11_LRT.genCondDecl(fileNo, "notCheckPending", "51027", null);
M11_LRT.genCondDecl(fileNo, "cannotCheckDepTab", "428A8", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(200)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_numTabsFound", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR notCheckPending");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR cannotCheckDepTab");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

String qualTabNameTempStatementSetIntegrity;
qualTabNameTempStatementSetIntegrity = M94_DBAdmin.tempTabNameStatement + "SetIntegrity";

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, null, null, true, true, null, "SetIntegrity", null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcName, ddlType, null, "mode_in", "tabCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET tabCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "loop as long as we find tables in 'check pending' state", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "tabLoop:");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "LOOP");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_numTabsFound = 0;");

M11_LRT.genProcSectionHeader(fileNo, "process each table in 'check pending state'", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR tabLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "T.TABSCHEMA AS c_schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "T.TABNAME AS c_tableName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABLES T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNamePdmTable + " P");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "T.TABNAME = P." + M01_Globals.g_anPdmTableName + "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "T.TABSCHEMA = P." + M01_Globals.g_anPdmFkSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameLdmTable + " L");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anPdmLdmFkSchemaName + " = L." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anPdmLdmFkTableName + " = L." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameAcmEntity + " A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntitySection + " = L." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntityName + " = L." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntityType + " = L." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "T.STATUS = 'C'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "L." + M01_Globals.g_anLdmFkSequenceNo);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'SET INTEGRITY FOR ' || c_schemaName || '.' || c_tableName || ' IMMEDIATE CHECKED';");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET tabCount_out = tabCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_numTabsFound = v_numTabsFound + 1;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + qualTabNameTempStatementSetIntegrity);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tabCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (v_numTabsFound = 0) OR (mode_in < 1) THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LEAVE tabLoop;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END LOOP tabLoop;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + qualTabNameTempStatementSetIntegrity);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmntCursor;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcName, ddlType, null, "mode_in", "tabCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for retrieving table status
// ####################################################################################################################

String qualProcedureNameTabStatus;
qualProcedureNameTabStatus = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGetTabStatus, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for retrieving table status", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameTabStatus);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(300)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "-- temporary table for table data");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.TabData");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "schema     " + M01_Globals.g_dbtDbSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "name       VARCHAR(50),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "status     CHAR(1),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "numRows    INTEGER");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameTabStatus, ddlType, null, null, null, null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DELETE FROM SESSION.TabData;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "-- loop over all tables in database");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS tabCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ST.TABSCHEMA AS c_schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ST.TABNAME AS c_tableName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ST.STATUS AS c_tableStatus,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PT.PDM_" + M01_Globals.g_anOrganizationId + " AS c_organizationId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PT.PDM_" + M01_Globals.g_anPoolTypeId + " AS c_poolTypeId");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.TABLES ST");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + qualViewNamePdmTable + " PT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ST.TABSCHEMA = PT." + M01_Globals.g_anPdmFkSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ST.TABNAME = PT." + M01_Globals.g_anPdmTypedTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ST.TABSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ST.TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ST.TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ST.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'INSERT INTO SESSION.TabData (schema,name,status,numRows) SELECT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'''' || c_schemaName || ''',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'''' || c_tableName || ''',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'''' || c_tableStatus || ''',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'COUNT(*) FROM ' || c_schemaName || '.' || c_tableName ;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "-- return result to application");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "*");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SESSION.TabData");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "schema ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "name   ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- leave cursor open for application");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "OPEN stmntCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameTabStatus, ddlType, null, null, null, null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for re-setting OID sequence
// ####################################################################################################################

qualProcName = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnResetOidSeq, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for re-setting OID-Sequence(s)", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "orgId_in", M01_Globals.g_dbtEnumId, true, "(optional) ID of the organization to reset the OID sequence number for");
M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", true, "number of tables inspected");
M11_LRT.genProcParm(fileNo, "OUT", "seqCount_out", "INTEGER", false, "number of sequences being reset");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);
M11_LRT.genCondDecl(fileNo, "oidNotExist", "42703", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR oidNotExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M11_LRT.genProcSectionHeader(fileNo, "temporary table for 'Max-OID' per table and organization", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.MaxOidPerTable");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "organizationId " + M01_Globals.g_dbtEnumId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "maxOid         " + M01_Globals.g_dbtOid);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcName, ddlType, null, "mode_in", "orgId_in", "tabCount_out", "seqCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET tabCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET seqCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DELETE FROM SESSION.MaxOidPerTable;");

M11_LRT.genProcSectionHeader(fileNo, "loop over all 'non-enumeration'-tables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P." + M01_Globals.g_anPdmFkSchemaName + " AS c_schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P." + M01_Globals.g_anPdmTableName + " AS c_tableName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " L,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " P,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameAcmEntity + " A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P." + M01_Globals.g_anPdmLdmFkSchemaName + " = L." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P." + M01_Globals.g_anPdmLdmFkTableName + " = L." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntitySection + " = L." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityName + " = L." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityType + " = L." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityType + " <> 'E'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'INSERT INTO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'SESSION.MaxOidPerTable ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'(organizationId,maxOid) ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SELECT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'O.ID,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'COALESCE(MAX(T." + M01_Globals.g_anOid + "),0)' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_schemaName || '.' || c_tableName || ' T,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'" + M01_Globals.g_qualTabNamePdmOrganization + " O ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'(T." + M01_Globals.g_anOid + "/1" + M01_LDM.gc_sequenceMinValue + ") = O.ID ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'GROUP BY ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'O.ID';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET tabCount_out = tabCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "default values - if no records were found", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.MaxOidPerTable");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "organizationId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "maxOid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ID,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_dbtOid + "(RTRIM(CAST(ID AS CHAR(3))) || '00000002000000000')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_qualTabNamePdmOrganization);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "COALESCE(orgId_in, ID) = ID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M11_LRT.genProcSectionHeader(fileNo, "determine number of affected sequences", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET seqCount_out = (SELECT COUNT(DISTINCT organizationId) FROM SESSION.MaxOidPerTable);");

M11_LRT.genProcSectionHeader(fileNo, "reset OID sequence(s)", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR tabLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "organizationId AS c_organizationId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "MAX(maxOid) AS c_maxOid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SESSION.MaxOidPerTable");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "orgId_in IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "organizationId = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "GROUP BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "organizationId");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'ALTER SEQUENCE " + M01_Globals.g_schemaNameCtoMeta + "' || RIGHT('00' || RTRIM(CAST(c_organizationId AS CHAR(2))),2) || '." + M01_LDM.gc_seqNameOid.toUpperCase() + " RESTART WITH ' || RTRIM(CAST((c_maxOid + " + String.valueOf(M01_LDM.gc_sequenceIncrementValue) + ") AS CHAR(40)));");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CAST(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "'ALTER SEQUENCE " + M01_Globals.g_schemaNameCtoMeta + "' || RIGHT('00' || RTRIM(CAST(organizationId AS CHAR(2))),2) || '." + M01_LDM.gc_seqNameOid.toUpperCase() + " RESTART WITH ' || RTRIM(CAST((MAX(maxOid) + " + String.valueOf(M01_LDM.gc_sequenceIncrementValue) + ") AS CHAR(40)))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AS VARCHAR(80)) AS STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SESSION.MaxOidPerTable");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "orgId_in IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "organizationId = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "GROUP BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "organizationId");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "organizationId ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmntCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcName, ddlType, null, "mode_in", "orgId_in", "tabCount_out", "seqCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for deleting LRT-related records
// ####################################################################################################################

qualProcName = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnClearLrt, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for 'clearing' LRT-related data", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "lrtOid_in", M01_Globals.g_dbtOid, true, "(optional) OID of the LRT to clear");
M11_LRT.genProcParm(fileNo, "IN", "cdUserId_in", M01_Globals.g_dbtUserId, true, "(optional) userId to clear LRTs for");
M11_LRT.genProcParm(fileNo, "IN", "orgId_in", M01_Globals.g_dbtEnumId, true, "(optional) Id of the organization to clear the LRTs for");
M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", true, "number of tables affected");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of rows affected");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(500)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_rowCount", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M11_LRT.genProcSectionHeader(fileNo, "temporary table for statements", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SEQNO     INTEGER,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "STATEMENT VARCHAR(1000)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcName, ddlType, null, "mode_in", "lrtOid_in", "'cdUserId_in", "orgId_in", "tabCount_out", "rowCount_out", null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET cdUserId_in = UPPER(cdUserId_in);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET tabCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DELETE FROM SESSION.Statements;");

M11_LRT.genProcSectionHeader(fileNo, "process each LRT table", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals_IVK.g_anAcmCondenseData + "    AS c_condenseData,");
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P1." + M01_Globals.g_anPdmFkSchemaName + " AS c_schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P1." + M01_Globals.g_anPdmTableName + " AS c_tableNamePub,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P2." + M01_Globals.g_anPdmTableName + " AS c_tableNamePriv,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P3." + M01_Globals.g_anPdmFkSchemaName + " AS c_schemaNameLrt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P3." + M01_Globals.g_anPdmTableName + " AS c_tableNameLrt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameAcmEntity + " A,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " L1,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " L2,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " L3,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " P1,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " P2,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " P3");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L1." + M01_Globals.g_anAcmEntitySection + " = A." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L1." + M01_Globals.g_anAcmEntityName + " = A." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L1." + M01_Globals.g_anAcmEntityType + " = A." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L1." + M01_Globals.g_anAcmEntitySection + " = L2." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L1." + M01_Globals.g_anAcmEntityName + " = L2." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L1." + M01_Globals.g_anAcmEntityType + " = L2." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L1." + M01_Globals.g_anLdmIsNl + " = L2." + M01_Globals.g_anLdmIsNl);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L1." + M01_Globals.g_anLdmIsGen + " = L2." + M01_Globals.g_anLdmIsGen);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L1." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L2." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbTrue);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L2." + M01_Globals_IVK.g_anLdmIsMqt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P1." + M01_Globals.g_anPdmLdmFkSchemaName + " = L1." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P1." + M01_Globals.g_anPdmLdmFkTableName + " = L1." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P2." + M01_Globals.g_anPdmLdmFkSchemaName + " = L2." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P2." + M01_Globals.g_anPdmLdmFkTableName + " = L2." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P1." + M01_Globals.g_anOrganizationId + " = P2." + M01_Globals.g_anOrganizationId);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P1." + M01_Globals.g_anPoolTypeId + " = P2." + M01_Globals.g_anPoolTypeId);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P1." + M01_Globals.g_anOrganizationId + " = P3." + M01_Globals.g_anOrganizationId);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "((orgId_in IS NULL) OR (P1." + M01_Globals.g_anOrganizationId + " = orgId_in))");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P3." + M01_Globals.g_anPdmLdmFkSchemaName + " = L3." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P3." + M01_Globals.g_anPdmLdmFkTableName + " = L3." + M01_Globals.g_anLdmTableName);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L3." + M01_Globals.g_anAcmEntitySection + " = '" + M22_Class.g_classes.descriptors[M01_Globals.g_classIndexLrt].sectionName.toUpperCase() + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L3." + M01_Globals.g_anAcmEntityName + " = '" + M22_Class.g_classes.descriptors[M01_Globals.g_classIndexLrt].className.toUpperCase() + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L3." + M01_Globals.g_anAcmEntityType + " = '" + M01_Globals.gc_acmEntityTypeKeyClass + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L3." + M01_Globals.g_anLdmIsNl + " = " + M01_LDM.gc_dbFalse);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P1." + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P2." + M01_Globals.g_anPdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "process public table", 2, true);

// ### IF IVK ###
final int indent = 1;
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF c_condenseData = " + M01_LDM.gc_dbFalse + " THEN");
// ### ELSE IVK ###
// Const indent = 0
// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 2) + "SET v_stmntTxt = 'UPDATE ' || c_schemaName || '.' || c_tableNamePub || ' SET " + M01_Globals.g_anInLrt + " = NULL WHERE " + M01_Globals.g_anInLrt + " IS NOT NULL';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 2) + "IF lrtOid_in IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 3) + "SET v_stmntTxt = v_stmntTxt || ' AND " + M01_Globals.g_anInLrt + " = ' || RTRIM(CHAR(lrtOid_in));");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 2) + "IF cdUserId_in IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 3) + "SET v_stmntTxt = v_stmntTxt || ' AND " + M01_Globals.g_anInLrt + " IN (' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 10) + " 'SELECT A." + M01_Globals.g_anOid + " FROM ' || c_schemaNameLrt ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 10) + " '.LRT A INNER JOIN " + M01_Globals.g_qualTabNameUser + " B ON UTROWN_OID = B." + M01_Globals.g_anOid + " AND UPPER(B." + M01_Globals.g_anUserId + ")=''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 10) + " cdUserId_in || ''')';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 2) + "SET tabCount_out = tabCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 2) + "INSERT INTO SESSION.statements (SEQNO, STATEMENT ) VALUES (tabCount_out, v_stmntTxt);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(indent + 2) + "END IF;");

// ### IF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
// ### ENDIF IVK ###

M11_LRT.genProcSectionHeader(fileNo, "process private table", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'DELETE FROM ' || c_schemaName || '.' || c_tableNamePriv || ' WHERE (1=1)';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF lrtOid_in IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt || ' AND " + M01_Globals.g_anInLrt + " = ' || RTRIM(CHAR(lrtOid_in));");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF cdUserId_in IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt || ' AND " + M01_Globals.g_anInLrt + " IN (' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " 'SELECT A." + M01_Globals.g_anOid + " FROM ' || c_schemaNameLrt ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " '.LRT A INNER JOIN " + M01_Globals.g_qualTabNameUser + " B ON UTROWN_OID = B." + M01_Globals.g_anOid + " AND UPPER(B." + M01_Globals.g_anUserId + ")=''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " cdUserId_in || ''')';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET tabCount_out = tabCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO SESSION.statements (SEQNO, STATEMENT ) VALUES (tabCount_out, v_stmntTxt);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "process meta tables for each involved organization", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anPdmFkSchemaName + " AS c_schemaNameLrt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anPdmTableName + " AS c_tableNameLrt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anOrganizationId + " AS c_organizationId");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNamePdmTable + " P");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameLdmTable + " L");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anPdmLdmFkSchemaName + " = L." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anPdmLdmFkTableName + " = L." + M01_Globals.g_anLdmTableName);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "L." + M01_Globals.g_anAcmEntitySection + " = '" + M22_Class.g_classes.descriptors[M01_Globals.g_classIndexLrt].sectionName.toUpperCase() + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "L." + M01_Globals.g_anAcmEntityName + " = '" + M22_Class.g_classes.descriptors[M01_Globals.g_classIndexLrt].className.toUpperCase() + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "L." + M01_Globals.g_anAcmEntityType + " = '" + M01_Globals.gc_acmEntityTypeKeyClass + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "L." + M01_Globals.g_anLdmIsNl + " = " + M01_LDM.gc_dbFalse);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "((orgId_in IS NULL) OR (P." + M01_Globals.g_anOrganizationId + " = orgId_in))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anOrganizationId);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "process table '" + M01_ACM.clnLrtAffectedEntity.toUpperCase() + "'", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'DELETE FROM ' || c_schemaNameLrt || '.LRTAFFECTEDENTITY WHERE (1=1)';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF lrtOid_in IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt || ' AND " + M01_Globals.g_anLrtOid + " = ' || RTRIM(CHAR(lrtOid_in));");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF cdUserId_in IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt || ' AND " + M01_Globals.g_anLrtOid + " IN (SELECT OID FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " c_schemaNameLrt || '.' || c_tableNameLrt ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " ' A WHERE UTROWN_OID = (SELECT B." + M01_Globals.g_anOid + " FROM " + M01_Globals.g_qualTabNameUser + " B WHERE UPPER(B." + M01_Globals.g_anUserId + ")=''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " cdUserId_in || '''))';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET tabCount_out = tabCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO SESSION.statements (SEQNO, STATEMENT ) VALUES (tabCount_out, v_stmntTxt);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "process table '" + M01_ACM.clnLrtExecStatus.toUpperCase() + "'", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'DELETE FROM ' || c_schemaNameLrt || '." + M01_ACM.clnLrtExecStatus.toUpperCase() + " WHERE (1=1)';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF lrtOid_in IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt || ' AND " + M01_Globals.g_anLrtOid + " = ' || RTRIM(CHAR(lrtOid_in));");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF cdUserId_in IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt || ' AND " + M01_Globals.g_anLrtOid + " IN (SELECT OID FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " c_schemaNameLrt || '.' || c_tableNameLrt ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " ' A WHERE UTROWN_OID = (SELECT B." + M01_Globals.g_anOid + " FROM " + M01_Globals.g_qualTabNameUser + " B WHERE UPPER(B." + M01_Globals.g_anUserId + ")=''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " cdUserId_in || '''))';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET tabCount_out = tabCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO SESSION.statements (SEQNO, STATEMENT ) VALUES (tabCount_out, v_stmntTxt);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "process NL-text table for '" + M01_ACM.clnLrt.toUpperCase() + "'", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'DELETE FROM ' || c_schemaNameLrt || '.' || c_tableNameLrt || '_NL_TEXT WHERE (1=1)';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF lrtOid_in IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt || ' AND LRT_OID = ' || RTRIM(CHAR(lrtOid_in));");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF cdUserId_in IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt || ' AND LRT_OID IN (SELECT OID FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " c_schemaNameLrt || '.' || c_tableNameLrt ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " ' A WHERE UTROWN_OID = (SELECT B." + M01_Globals.g_anOid + " FROM " + M01_Globals.g_qualTabNameUser + " B WHERE UPPER(B." + M01_Globals.g_anUserId + ")=''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " cdUserId_in || '''))';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET tabCount_out = tabCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO SESSION.statements (SEQNO, STATEMENT ) VALUES (tabCount_out, v_stmntTxt);");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "process table '" + M01_ACM.clnLrt.toUpperCase() + "'", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'DELETE FROM ' || c_schemaNameLrt || '.' || c_tableNameLrt || ' WHERE (1=1)';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF lrtOid_in IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt || ' AND OID = ' || RTRIM(CHAR(lrtOid_in));");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF cdUserId_in IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt || ' AND  UTROWN_OID = (SELECT B." + M01_Globals.g_anOid + " FROM " + M01_Globals.g_qualTabNameUser + " B WHERE UPPER(B." + M01_Globals.g_anUserId + ")=''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " cdUserId_in || ''')';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET tabCount_out = tabCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO SESSION.statements (SEQNO, STATEMENT ) VALUES (tabCount_out, v_stmntTxt);");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

// ### IF IVK ###
M11_LRT.genProcSectionHeader(fileNo, "process table '" + M01_ACM_IVK.clnRegistryDynamic.toUpperCase() + "'", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'DELETE FROM " + M01_Globals_IVK.g_qualTabNameRegistryDynamic + " R WHERE R.SECTION = ''" + M01_PDM_IVK.gc_regDynamicSectionAutoSetProd + "'' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + "'AND R." + M01_Globals_IVK.g_anKey + " = ''" + M01_PDM_IVK.gc_regDynamicKeyAutoSetProd + "'' AND LENGTH(R." + M01_Globals_IVK.g_anSubKey + ") > 3 AND LENGTH(R." + M01_Globals_IVK.g_anSubKey + ") <= " + String.valueOf(3 + M01_LDM.gc_dbMaxBigInt.length()) + " AND RIGHT(LEFT(R." + M01_Globals_IVK.g_anSubKey + ",3),1) = ''-'' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + "'AND CAST(LEFT(R." + M01_Globals_IVK.g_anSubKey + ",2) AS " + M01_Globals.g_dbtEnumId + ") = ' || RTRIM(CAST(c_organizationId AS CHAR(10)));");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF cdUserId_in IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt || ' AND CAST(RIGHT(R." + M01_Globals_IVK.g_anSubKey + ",LENGTH(" + M01_Globals_IVK.g_anSubKey + ")-3) AS " + M01_Globals.g_dbtOid + ") IN (' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + "'SELECT L.UTROWN_OID FROM ' || c_schemaNameLrt || '.' || c_tableNameLrt ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + "' L," + M01_Globals.g_qualTabNameUser + " U WHERE L.UTROWN_OID = U." + M01_Globals.g_anOid + " AND UPPER(U." + M01_Globals.g_anUserId + ")=''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " UPPER(cdUserId_in) || ''')';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET tabCount_out = tabCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO SESSION.statements (SEQNO, STATEMENT ) VALUES (tabCount_out, v_stmntTxt);");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

// ### ENDIF IVK ###
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", 1, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmntCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcName, ddlType, null, "mode_in", "lrtOid_in", "'cdUserId_in", "orgId_in", "tabCount_out", "rowCount_out", null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for deleting LRT-related records
// ####################################################################################################################

qualProcName = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnClearLrt, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for 'clearing' LRT-related data", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "cdUserId_in", M01_Globals.g_dbtUserId, true, "(optional) userId to clear LRTs for");
M11_LRT.genProcParm(fileNo, "IN", "orgId_in", M01_Globals.g_dbtEnumId, true, "(optional) Id of the organization to clear the LRTs for");
M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", true, "number of tables affected");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of rows affected");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_lrtOid", M01_Globals.g_dbtOid, "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcName, ddlType, null, "mode_in", "'cdUserId_in", "orgId_in", "tabCount_out", "rowCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcName + "(mode_in, v_lrtOid, cdUserId_in, orgId_in, tabCount_out, rowCount_out);");
M00_FileWriter.printToFile(fileNo, "");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcName, ddlType, null, "mode_in", "'cdUserId_in", "orgId_in", "tabCount_out", "rowCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

NormalExit:
return;

ErrorExit:
errMsgBox(Err.description);
Resume(NormalExit);
}


private static void genDbAdminDdl4(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
// we do not support most of this for LDM
goto LdmEntryPoint;
}

// ####################################################################################################################
// #    SP for verifying database configuration
// ####################################################################################################################

String qualProcName;
qualProcName = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnVerifyCfg, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for verification of database configuration", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M79_Err.genSigMsgVarDecl(fileNo, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcName, ddlType, null, null, null, null, null, null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "verify that database id running in UTC timezone", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF (CURRENT TIMEZONE <> 0) THEN");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcName, ddlType, 2, null, null, null, null, null, null, null, null, null, null, null, null);
M79_Err.genSignalDdlWithParms("noUtc", fileNo, 2, null, null, null, null, null, null, null, null, null, "RTRIM(CHAR(INTEGER(CURRENT TIMEZONE)))", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcName, ddlType, null, null, null, null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP executing data cleanup jobs
// ####################################################################################################################

String qualProcedureNameCleanup;
qualProcedureNameCleanup = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnCleanData, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP executing data cleanup jobs", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameCleanup);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' list cleanup-statements, '1' list and execute statements, '2' execute statements only");
M11_LRT.genProcParm(fileNo, "IN", "jobCategory_in", "VARCHAR(20)", true, "category of the clean-job to execute");
M11_LRT.genProcParm(fileNo, "IN", "jobName_in", "VARCHAR(20)", true, "(optional) name of the clean-job to execute");
M11_LRT.genProcParm(fileNo, "IN", "level_in", "INTEGER", true, "(optional) level to use for column filtering");
M11_LRT.genProcParm(fileNo, "IN", "parameter1_in", "VARCHAR(30)", true, "(optional) parameter 1 to use in condition term for job");
M11_LRT.genProcParm(fileNo, "IN", "parameter2_in", "VARCHAR(30)", true, "(optional) parameter 2 to use in condition term for job");
M11_LRT.genProcParm(fileNo, "IN", "parameter3_in", "VARCHAR(30)", true, "(optional) parameter 3 to use in condition term for job");

M11_LRT.genProcParm(fileNo, "OUT", "stmntCount_out", "INTEGER", true, "number of statements for this job");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of rows deleted in any table");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_condition", "VARCHAR(500)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_rowCount", "INTEGER", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_rowCountThisTable", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxtRaw", "VARCHAR(400)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

String qualTabNameTempStatement;
qualTabNameTempStatement = M94_DBAdmin.tempTabNameStatement + "CleanData";
M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 600, false, true, true, false, "CleanData", true, null, null, null, "numRowsDeleted", "INTEGER", null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameCleanup, ddlType, null, "mode_in", "'jobCategory_in", "'jobName_in", "level_in", "'parameter1_in", "'parameter2_in", "'parameter3_in", "stmntCount_out", "rowCount_out", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET stmntCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out   = 0;");

M11_LRT.genProcSectionHeader(fileNo, "normalize input parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET jobCategory_in = UPPER(RTRIM(jobCategory_in));");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET jobName_in     = UPPER(RTRIM(jobName_in));");

M11_LRT.genProcSectionHeader(fileNo, "loop over job-records and execute job-statements", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR jobEntryLoop AS jobCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(SCHEMANAME) AS c_schemaNamePattern,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(TABLENAME) AS c_tableNamePattern,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(TABLEREF) AS c_tableRef,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CONDITION AS c_condition,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COMMITCOUNT AS c_commitCount");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M04_Utilities.genQualTabNameByClassIndex(M01_Globals_IVK.g_classIndexCleanJobs, ddlType, null, null, null, null, null, null, null, null, null) + " J");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UPPER(J.JOBCATEGORY) = jobCategory_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(jobName_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "  OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(COALESCE(UPPER(J.JOBNAME), jobName_in) = jobName_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(level_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "  OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(J.LEVEL IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "  OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(COALESCE(J.LEVEL, level_in) >= level_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQUENCENO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_condition = c_condition;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (v_condition IS NOT NULL) THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF (parameter1_in IS NOT NULL) THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_condition = REPLACE(v_condition, '%1', parameter1_in);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF (parameter2_in IS NOT NULL) THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_condition = REPLACE(v_condition, '%2', parameter2_in);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF (parameter3_in IS NOT NULL) THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_condition = REPLACE(v_condition, '%3', parameter3_in);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");

M11_LRT.genProcSectionHeader(fileNo, "loop over matching tables", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR tabLoop AS tabCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "c_schemaNamePattern IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "RTRIM(TABSCHEMA) LIKE c_schemaNamePattern ESCAPE '\\'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RTRIM(TABNAME) LIKE c_tableNamePattern ESCAPE '\\'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DELETE FROM ' || RTRIM(TABSCHEMA) || '.' || RTRIM(TABNAME) || COALESCE(' ' || c_tableRef, '');");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF (v_condition IS NOT NULL) THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = v_stmntTxt || ' WHERE ' || v_condition;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxtRaw = v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_rowCountThisTable = 0;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF COALESCE(c_commitCount, 0) = 0 THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SET v_rowCountThisTable    = v_rowCount;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SET v_stmntTxt = REPLACE(v_stmntTxt, 'DELETE FROM', 'DELETE FROM (SELECT * FROM') || ' FETCH FIRST ' || RTRIM(CHAR(c_commitCount)) || ' ROWS ONLY)';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SET v_rowCount = c_commitCount;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHILE v_rowCount = c_commitCount DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SET v_rowCountThisTable    = v_rowCountThisTable + v_rowCount;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END WHILE;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET rowCount_out = rowCount_out + v_rowCountThisTable;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET stmntCount_out = stmntCount_out +1;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + qualTabNameTempStatement + "(seqNo, numRowsDeleted, statement) VALUES (stmntCount_out, v_rowCountThisTable, v_stmntTxtRaw);");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "numRowsDeleted,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + qualTabNameTempStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmntCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameCleanup, ddlType, null, "mode_in", "'jobCategory_in", "'jobName_in", "level_in", "'parameter1_in", "'parameter2_in", "'parameter3_in", "stmntCount_out", "rowCount_out", null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameCleanup);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' list cleanup-statements, '1' list and execute statements, '2' execute statements only");
M11_LRT.genProcParm(fileNo, "IN", "jobCategory_in", "VARCHAR(20)", true, "category of the clean-job to execute");
M11_LRT.genProcParm(fileNo, "IN", "jobName_in", "VARCHAR(20)", true, "name of the clean-job to execute");
M11_LRT.genProcParm(fileNo, "IN", "level_in", "INTEGER", true, "(optional) level to use for column filtering");
M11_LRT.genProcParm(fileNo, "IN", "parameter1_in", "VARCHAR(30)", true, "(optional) parameter 1 to use in condition term for job");
M11_LRT.genProcParm(fileNo, "IN", "parameter2_in", "VARCHAR(30)", true, "(optional) parameter 2 to use in condition term for job");

M11_LRT.genProcParm(fileNo, "OUT", "stmntCount_out", "INTEGER", true, "number of statements for this job");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of rows deleted in any table");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_parameter3", "VARCHAR(30)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameCleanup, ddlType, null, "mode_in", "'jobCategory_in", "'jobName_in", "level_in", "'parameter1_in", "'parameter2_in", "stmntCount_out", "rowCount_out", null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "call 'master' procedure", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameCleanup + "(mode_in, jobCategory_in, jobName_in, level_in, parameter1_in, parameter2_in, v_parameter3, stmntCount_out, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameCleanup, ddlType, null, "mode_in", "'jobCategory_in", "'jobName_in", "level_in", "'parameter1_in", "'parameter2_in", "stmntCount_out", "rowCount_out", null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameCleanup);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' list cleanup-statements, '1' list and execute statements, '2' execute statements only");
M11_LRT.genProcParm(fileNo, "IN", "jobCategory_in", "VARCHAR(20)", true, "category of the clean-job to execute");
M11_LRT.genProcParm(fileNo, "IN", "jobName_in", "VARCHAR(20)", true, "name of the clean-job to execute");
M11_LRT.genProcParm(fileNo, "IN", "level_in", "INTEGER", true, "(optional) level to use for column filtering");
M11_LRT.genProcParm(fileNo, "IN", "parameter1_in", "VARCHAR(30)", true, "(optional) parameter 1 to use in condition term for job");

M11_LRT.genProcParm(fileNo, "OUT", "stmntCount_out", "INTEGER", true, "number of statements for this job");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of rows deleted in any table");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_parameter2", "VARCHAR(30)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_parameter3", "VARCHAR(30)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameCleanup, ddlType, null, "mode_in", "'jobCategory_in", "'jobName_in", "level_in", "'parameter1_in", "stmntCount_out", "rowCount_out", null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "call 'master' procedure", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameCleanup + "(mode_in, jobCategory_in, jobName_in, level_in, parameter1_in, v_parameter2, v_parameter3, stmntCount_out, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameCleanup, ddlType, null, "mode_in", "'jobCategory_in", "'jobName_in", "level_in", "'parameter1_in", "stmntCount_out", "rowCount_out", null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameCleanup);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' list cleanup-statements, '1' list and execute statements, '2' execute statements only");
M11_LRT.genProcParm(fileNo, "IN", "jobCategory_in", "VARCHAR(20)", true, "category of the clean-job to execute");
M11_LRT.genProcParm(fileNo, "IN", "jobName_in", "VARCHAR(20)", true, "name of the clean-job to execute");
M11_LRT.genProcParm(fileNo, "IN", "level_in", "INTEGER", true, "(optional) level to use for column filtering");

M11_LRT.genProcParm(fileNo, "OUT", "stmntCount_out", "INTEGER", true, "number of statements for this job");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of rows deleted in any table");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_parameter1", "VARCHAR(30)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_parameter2", "VARCHAR(30)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_parameter3", "VARCHAR(30)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameCleanup, ddlType, null, "mode_in", "'jobCategory_in", "'jobName_in", "level_in", "stmntCount_out", "rowCount_out", null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "call 'master' procedure", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameCleanup + "(mode_in, jobCategory_in, jobName_in, level_in, v_parameter1, v_parameter2, v_parameter3, stmntCount_out, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameCleanup, ddlType, null, "mode_in", "'jobCategory_in", "'jobName_in", "level_in", "stmntCount_out", "rowCount_out", null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameCleanup);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' list cleanup-statements, '1' list and execute statements, '2' execute statements only");
M11_LRT.genProcParm(fileNo, "IN", "jobCategory_in", "VARCHAR(20)", true, "category of the clean-job to execute");
M11_LRT.genProcParm(fileNo, "IN", "jobName_in", "VARCHAR(20)", true, "name of the clean-job to execute");

M11_LRT.genProcParm(fileNo, "OUT", "stmntCount_out", "INTEGER", true, "number of statements for this job");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of rows deleted in any table");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_level", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_parameter1", "VARCHAR(30)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_parameter2", "VARCHAR(30)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_parameter3", "VARCHAR(30)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameCleanup, ddlType, null, "mode_in", "'jobCategory_in", "'jobName_in", "stmntCount_out", "rowCount_out", null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "call 'master' procedure", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameCleanup + "(mode_in, jobCategory_in, jobName_in, v_level, v_parameter1, v_parameter2, v_parameter3, stmntCount_out, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameCleanup, ddlType, null, "mode_in", "'jobCategory_in", "'jobName_in", "stmntCount_out", "rowCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

LdmEntryPoint:
// ####################################################################################################################
// #    SP for HELP on Stored Procedures
// ####################################################################################################################

String qualProcedureNameHelp;
qualProcedureNameHelp = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexHelp, M01_ACM.spnHelp, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for HELP on Stored Procedures (based on keyword and schema)", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameHelp);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "schema name pattern of SQL-stored procedure(s) to provide help for");
M11_LRT.genProcParm(fileNo, "IN", "objNamePattern_in", "VARCHAR(50)", true, "name pattern of procedure(s) / function(s) to provide help for");
M11_LRT.genProcParm(fileNo, "OUT", "text_out", "CLOB(200000)", false, "returns API-information for referred stored procedure(s) / function(s)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_delimLine", "VARCHAR(80)", "'--------------------------------------------------------------------------------'", null, null);
M11_LRT.genVarDecl(fileNo, "v_foundEntry", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameHelp, ddlType, null, "'schemaNamePattern_in", "'objNamePattern_in", "'text_out", null, null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET text_out = CHR(10) || CHR(10) || v_delimLine;");

M11_LRT.genProcSectionHeader(fileNo, "loop over all matching procedures", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR procLoop AS procCursor CURSOR FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TEXT,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PROCSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PROCNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PARM_COUNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "REPLACE(TEXT, 'CREATE ' , ''),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PROCSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PROCNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PARM_COUNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.PROCEDURES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LANGUAGE = 'SQL'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LEFT(TEXT, COALESCE(POSSTR(TEXT, CHR(10) || ')') + 1, 500)) AS TEXTHEADER");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "( PROCSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "' )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "( schemaNamePattern_in IS NULL )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "( RTRIM(PROCSCHEMA) LIKE UPPER(schemaNamePattern_in) )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "( objNamePattern_in IS NULL )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "( PROCNAME LIKE UPPER(objNamePattern_in) )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PROCSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PROCNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PARM_COUNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET text_out = text_out || CHR(10) || CHR(10) || TEXTHEADER || CHR(10);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_foundEntry = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "add delimiter line", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF v_foundEntry = 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET text_out = text_out || CHR(10) || v_delimLine || CHR(10);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_foundEntry = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "loop over all matching functions", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR funcLoop AS funcCursor CURSOR FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TEXT,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FUNCSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FUNCNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PARM_COUNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "REPLACE(BODY, 'CREATE ' , ''),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FUNCSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FUNCNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PARM_COUNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.FUNCTIONS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LANGUAGE = 'SQL'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LEFT(TEXT, COALESCE(POSSTR(TEXT, CHR(10) || ')') + 1,500)) AS TEXTHEADER");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "( FUNCSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "' )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "( schemaNamePattern_in IS NULL )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "( FUNCSCHEMA LIKE '%' || UPPER(schemaNamePattern_in) || '%' )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "( objNamePattern_in IS NULL )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "( FUNCNAME LIKE '%' || UPPER(objNamePattern_in) || '%' )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FUNCSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FUNCNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PARM_COUNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET text_out = text_out || CHR(10) || CHR(10) || TEXTHEADER || CHR(10) ;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_foundEntry = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF v_foundEntry = 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET text_out = text_out || CHR(10) || v_delimLine || CHR(10) ;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameHelp, ddlType, null, "'schemaNamePattern_in", "'objNamePattern_in", "'text_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

M22_Class_Utilities.printSectionHeader("SP for HELP on Stored Procedures (based on keyword)", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameHelp);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "objNamePattern_in", "VARCHAR(50)", true, "name pattern of SQL-stored procedure(s) to provide help for");
M11_LRT.genProcParm(fileNo, "OUT", "text_out", "CLOB(200000)", false, "returns API-information for referred stored procedures");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_schemaNamePattern", M01_Globals.g_dbtDbSchemaName, "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameHelp, ddlType, null, "'objNamePattern_in", "'text_out", null, null, null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "call 'specific HELP procedure'", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameHelp + "(v_schemaNamePattern, objNamePattern_in, text_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameHelp, ddlType, null, "'objNamePattern_in", "'text_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for HELP on "Catching SQL-Codes" via "db2pd"
// ####################################################################################################################

String qualProcedureNameHelpCatchSqlCode;
qualProcedureNameHelpCatchSqlCode = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexHelp, M01_ACM.spnHelpCatchSqlCode, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for HELP on \"Catching SQL-Codes\" via \"db2pd\"", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameHelpCatchSqlCode);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "OUT", "text_out", "CLOB(10000)", false, "returns help on 'how to catch SQL-Codes via \"db2pd\"'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET text_out = CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'#!/bin/sh' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# Place this script in file' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'#     $HOME/sqllob/db2cos' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# and activate it via' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'#     db2pd -catch -<sqlcCde>[,<errCode>]' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# e.g.:' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'#     db2pd -catch -911,2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# To reset use' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'#     db2pd -catch reset' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# Process the core arguments. Cycle through each argument until we find one that' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# does not have an ''='' sign' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'#' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# NOTE: the following core arguments are possible but should not be expected.' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# Be sure to check whether they are set before using them.' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'#' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# instance  : instance name' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# database  : database name' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# dbpart    : database partition number' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# pid       : process ID' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# tid       : thread ID' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# function  : function name of function that called the panic script' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# component : component of the function' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# probe     : probe point' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# timestamp : timestamp of when the script was called' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# appid     : application ID' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# apphld    : application handle' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'while [ \"$#\" -gt \"0\" ]' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'do' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   TAG=; VALUE=;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   TAG=`echo $1| sed ''s/=.*//''`; VALUE=`echo $1| sed ''s/''$TAG''=*//''`;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   if [ ! -n \"$VALUE\" ]' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   then' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      break' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   else' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      case $TAG in' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'         INSTANCE)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            instance=$VALUE' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'         DATABASE)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            database=$VALUE' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'         DBPART)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            dbpart=$VALUE' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'         PID)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            pid=$VALUE' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'         TID)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            tid=$VALUE' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'         FUNCTION)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            function=$VALUE' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'         COMPONENT)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            component=$VALUE' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'         PROBE)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            probe=$VALUE' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'         TIMESTAMP)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            timestamp=$VALUE' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'         APPID)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            appid=$VALUE' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'         APPHLD)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            apphld=$VALUE' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'         *)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            #echo unknown TAG:$TAG' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'            ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      esac' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   fi' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   shift' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'done' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'export HOME=`lsuser -f -a home $instance | grep home= | awk -F= ''{ print $2 }''`' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'outFile=$HOME/sqllib/db2dump/db2cos.rpt.\"$database\".`date ''+%Y.%m.%d-%H:%M:%S''`' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'# Process type ($1 is the type due to the ''shift'' in the above code)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'typeReason=$1' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'typeDesc=$2' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'shift;shift' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'case \"$typeReason\" in' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   DATA_COR)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        # data corruption area' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        # Order of input arguments' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        # 1- File/Lv name' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        # 2- Offset into file/lv in bytes.' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        # 3- Pagesize in bytes' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"**Corruption Details***\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"File/Lv name: $1\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Offset      : $2\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Page size   : $3\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Node Number : $dbpart\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      } >>  $outFile' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   TRAP)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      # trap area' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   DB2_TRC)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      # trace area - script was invoked from inside a trace point' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      # Uncomment this if you''d like trace to be turned off' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      # db2trc dump /tmp/trc.dmp' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      # db2trc off' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   LOCKTIMEOUT)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Lock Timeout Caught\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        date' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Instance:        \" $instance' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Database:        \" $database' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Partition Number:\" $dbpart' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"PID:             \" $pid' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"TID:             \" $tid' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Function:        \" $function' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Component:       \" $component' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Probe:           \" $probe' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Timestamp:       \" $timestamp' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"AppID:           \" $appid' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"AppHdl:          \" $apphld' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        db2 connect to $database' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        db2 \"CALL " + M01_Globals.g_qualProcNameGetSnapshot + "(NULL, 2, 0, NULL, NULL, 1, ?, ?)\" ' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      } >>  $outFile' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   DEADLOCK)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Lock Deadlock Caught\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        date' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Instance:        \" $instance' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Database:        \" $database' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Partition Number:\" $dbpart' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"PID:             \" $pid' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"TID:             \" $tid' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Function:        \" $function' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Component:       \" $component' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Probe:           \" $probe' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Timestamp:       \" $timestamp' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"AppID:           \" $appid' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"AppHdl:          \" $apphld' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        db2 connect to $database' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        db2 \"CALL " + M01_Globals.g_qualProcNameGetSnapshot + "(NULL, 2, 0, NULL, NULL, 1, ?, ?)\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      } >>  $outFile' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   SQLCODE)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      {' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"SQLCODE caught\"' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        date' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Instance:        \" $instance' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Database:        \" $database' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Partition Number:\" $dbpart' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"PID:             \" $pid' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"TID:             \" $tid' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Function:        \" $function' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Component:       \" $component' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Probe:           \" $probe' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"Timestamp:       \" $timestamp' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"AppID:           \" $appid' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'        echo \"AppHdl:          \" $apphld' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      } >>  $outFile' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   *)' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'     exit # unknown type' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'   ;;' || CHR(10) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'esac' || CHR(10)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for Explaining MDS error codes
// ####################################################################################################################

String qualProcedureNameErr;
qualProcedureNameErr = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexHelp, M01_ACM.spnError, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for Explaining MDS error codes", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameErr);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "sqlState_in", "INTEGER", true, "SQLSTATE of the MDS error");
M11_LRT.genProcParm(fileNo, "OUT", "text_out", "VARCHAR(4000)", false, "description of the MDS error");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_delimLine", "VARCHAR(80)", "'--------------------------------------------------------------------------------'", null, null);
M11_LRT.genVarDecl(fileNo, "v_offset", "VARCHAR(30)", "'                      '", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameErr, ddlType, null, "sqlState_in", "'text_out", null, null, null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET text_out = '';");

M11_LRT.genProcSectionHeader(fileNo, "identify error details", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR errorLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "E.TECHID,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "E.BUSID,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "E.MESSAGEPATTERN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "E.CONTEXT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameErrorMessage + " E");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "sqlState_in IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "E.TECHID = sqlState_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "add headline", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF text_out = '' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET text_out = CHR(10) || CHR(10) || v_delimLine;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET text_out = text_out || CHR(10) || CHR(10) || '------------' || CHR(10);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "add error details", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET text_out = text_out ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + " CHR(10) || CHR(10) || 'SQLSTATE            : '   || RTRIM(CAST(techID AS CHAR(20))) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + " CHR(10) || CHR(10) || 'Business Error Code : '   || COALESCE(RTRIM(CAST(BUSID AS CHAR(20))), '-') ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + " CHR(10) || CHR(10) || 'Message Pattern     : ''' || MESSAGEPATTERN || '''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + " CHR(10) || CHR(10) || 'Error Context       : '   ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + " (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " CASE WHEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(11) + " CONTEXT IS NULL OR CONTEXT = ''");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(11) + " '-'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(11) + " REPLACE(CONTEXT, '\\n', CHR(10) || v_offset)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + " END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + " ) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + " CHR(10);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF text_out = CAST('' AS VARCHAR(1)) THEN");
M11_LRT.genProcSectionHeader(fileNo, "no error details available", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET text_out = 'SQLSTATE ''' || RTRIM(CAST(sqlState_in AS CHAR(20))) || ''' unknown';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSE");
M11_LRT.genProcSectionHeader(fileNo, "add trailing line", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET text_out = text_out || CHR(10) || CHR(10) || v_delimLine || CHR(10) || CHR(10);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameErr, ddlType, null, "sqlState_in", "'text_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for activating a configuration profile
// ####################################################################################################################

String qualProcedureNameSetCfgProfile;
qualProcedureNameSetCfgProfile = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnSetCfg, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for activating a configuration profile", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameSetCfgProfile);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "profileName_in", "VARCHAR(20)", true, "(optional) name of the profile to apply");

M11_LRT.genProcParm(fileNo, "IN", "objectType_in", "VARCHAR(10)", true, "(optional) name of the object type to configure");
M11_LRT.genProcParm(fileNo, "IN", "objectSchema_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) name of the object schema to configure");
M11_LRT.genProcParm(fileNo, "IN", "objectName_in", "VARCHAR(50)", true, "(optional) name of the object to configure");
M11_LRT.genProcParm(fileNo, "IN", "parameter_in", "VARCHAR(20)", true, "(optional) name of the parameter to configure");

M11_LRT.genProcParm(fileNo, "OUT", "rowCountExec_out", "INTEGER", true, "number of configuration statements executed");
M11_LRT.genProcParm(fileNo, "OUT", "rowCountList_out", "INTEGER", false, "number of configuration statements not executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "notFound", "02000", null);
M11_LRT.genCondDecl(fileNo, "colNotKnown", "42703", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_ignoreError", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_ignoreWarning", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_parameter", "VARCHAR(20)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_valueDiffers", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_colNotKnown", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_valueStr", "VARCHAR(60)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_oldValueStr", "VARCHAR(60)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_db2Release", M01_Globals.g_dbtDbRelease, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_osPlatform", "VARCHAR(5)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare cursor", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE parmValueCursor CURSOR WITH RETURN TO CALLER FOR v_stmnt;");

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR notFound");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_ignoreError = 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RESIGNAL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR colNotKnown");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_colNotKnown = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_ignoreError = 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RESIGNAL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_ignoreWarning = 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RESIGNAL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLEXCEPTION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_ignoreError = 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RESIGNAL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M11_LRT.genProcSectionHeader(fileNo, "temporary table for statements", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "seqNo       INTEGER      GENERATED ALWAYS AS IDENTITY (START WITH 1 INCREMENT BY 1),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "mode        CHAR(1),     -- 'E' - execute (internally)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "                         -- 'e' - execute (externally)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "                         -- 'A' - already");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "                         -- 'I' - illegal (parameter not supported)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "useAdminCmd " + M01_Globals.g_dbtBoolean + "     DEFAULT 0,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objectType  VARCHAR(10),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "cmd         VARCHAR(10)  DEFAULT 'db2',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "statement   VARCHAR(120),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "oldsetting  VARCHAR(20)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, true, true, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameSetCfgProfile, ddlType, null, "mode_in", "'profileName_in", "'objectType_in", "'objectSchema_in", "'objectName_in", "'parameter_in", "rowCountExec_out", "rowCountList_out", null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCountExec_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCountList_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "determine OS-Platform", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CASE SERVER_PLATFORM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN  0 THEN 'UNK'   -- Unknown platform");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN  1 THEN 'OS2'   -- OS/2");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN  2 THEN 'DOS'   -- DOS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN  3 THEN 'WIN'   -- Windows");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN  4 THEN 'AIX'   -- AIX");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN  5 THEN 'NT'    -- NT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN  6 THEN 'HP'    -- HP");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN  7 THEN 'SUN'   -- Sun");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN  8 THEN 'MVS'   -- MVS (client via DRDA)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN  9 THEN '400'   -- AS400 (client via DRDA)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 10 THEN 'VM'    -- VM (client via DRDA)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 11 THEN 'VSE'   -- VSE (client via DRDA)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 12 THEN 'UDRD'  -- Unknown DRDA Client");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 13 THEN 'SNI'   -- Siemens Nixdorf");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 14 THEN 'MacC'  -- Macintosh Client");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 15 THEN 'W95'   -- Windows 95");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 16 THEN 'SCO'   -- SCO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 17 THEN 'SIGR'  -- Silicon Graphic");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 18 THEN 'LINUX' -- Linux");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 19 THEN 'DYNIX' -- DYNIX/ptx");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 20 THEN 'AIX64' -- AIX 64 bit");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 21 THEN 'SUN64' -- Sun 64 bit");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 22 THEN 'HP64'  -- HP 64 bit");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 23 THEN 'NT64'  -- NT 64 bit");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 24 THEN 'L390'  -- Linux for S/390");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 25 THEN 'L900'  -- Linux for z900");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 26 THEN 'LIA64' -- Linux for IA64");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 27 THEN 'LPPC'  -- Linux for PPC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 28 THEN 'LPP64' -- Linux for PPC64");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 29 THEN 'OS390' -- OS/390 Tools (CC, DW)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 30 THEN 'L8664' -- Linux for x86-64");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 31 THEN 'HPI32' -- HP-UX Itanium 32bit");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 32 THEN 'HPI64' -- HP-UX Itanium 64bit");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 33 THEN 'S8632' -- Sun x86 32bit");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHEN 34 THEN 'S8664' -- Sun x86-64 64bit");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELSE RTRIM(CAST(SERVER_PLATFORM AS CHAR(5)))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "v_osPlatform");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TABLE(SYSPROC.SNAPSHOT_DATABASE(CURRENT SERVER, -1)) X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_osPlatform = COALESCE(v_osPlatform, 'AIX64');");

M11_LRT.genProcSectionHeader(fileNo, "determine DB-release", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_db2Release = " + M01_Globals.g_qualFuncNameDb2Release + "();");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_ignoreError   = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_ignoreWarning = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR paramLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_Param");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "profileName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "objectType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "objectName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "parameter,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "value,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "prio");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P.PROFILENAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P.OBJECTTYPE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P.SCHEMANAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P.OBJECTNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P.PARAMETER,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals_IVK.g_anValue + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P.SEQUENCENO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ROWNUMBER() OVER (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "PARTITION BY P.OBJECTTYPE, P.SCHEMANAME, P.OBJECTNAME, P.PARAMETER");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ORDER BY COALESCE(P.MINDBRELEASE, 0) DESC, (CASE WHEN COALESCE(P.PROFILENAME, '') = '' THEN 1 ELSE 0 END) ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameDbCfgProfile + " P");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE(P.PROFILENAME, '') = ''");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "UPPER(P.PROFILENAME) = UPPER(profileName_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COALESCE(objectType_in, P.OBJECTTYPE) = P.OBJECTTYPE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(COALESCE(objectSchema_in, P.SCHEMANAME, '')) = UPPER(COALESCE(P.SCHEMANAME, ''))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(COALESCE(objectName_in, P.OBJECTNAME)) = UPPER(P.OBJECTNAME)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(COALESCE(parameter_in, P.PARAMETER)) = UPPER(P.PARAMETER)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COALESCE(P.MINDBRELEASE, v_db2Release) <= v_db2Release");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COALESCE(serverPlatform, v_osPlatform) = v_osPlatform");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "objectType AS c_objectType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "schemaName AS c_schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "objectName AS c_objectName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "parameter  AS c_parameter,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "value      AS c_value");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_Param");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "prio = 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CASE c_objectType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHEN 'DBM'        THEN 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHEN 'DB'         THEN 2");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHEN 'BUFFERPOOL' THEN 3");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHEN 'SEQUENCE'   THEN 4");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ELSE 5");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ") ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CASE WHEN COALESCE(profileName, '') = '' THEN 0 ELSE 10 END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ") ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COALESCE(sequenceNo,0) ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "parameter ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "schemaName ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "objectName ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "process object types individually", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF c_objectType = 'DBM' THEN");

M11_LRT.genProcSectionHeader(fileNo, "determine whether config parameter is set correctly", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_colNotKnown = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_oldValueStr = CAST(NULL AS VARCHAR(1));");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_valueStr =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CASE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN c_value = 'ON'  THEN '1'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN c_value = 'YES' THEN '1'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN c_value = 'OFF' THEN '0'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN c_value = 'NO'  THEN '0'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN " + M01_Globals_IVK.g_qualFuncNameIsNumeric + "(c_value) = 1 THEN c_value");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ELSE '''' || c_value || ''''");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'SELECT RTRIM(CAST(' || c_parameter || ' AS CHAR(20))), (CASE WHEN RTRIM(CHAR(' || c_parameter || ')) <> RTRIM(CHAR(' || v_valueStr || ')) THEN 1 ELSE 0 END) FROM TABLE(SYSFUN.GET_DBM_CONFIG()) AS DBMCFG WHERE DBMCONFIG_TYPE = 0';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF v_colNotKnown = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OPEN parmValueCursor;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "parmValueCursor");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_oldValueStr,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_valueDiffers");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CLOSE parmValueCursor WITH RELEASE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "determine update statement", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'UPDATE DBM CFG USING ' || c_parameter || ' ' || c_value;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "mode,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "objectType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "statement,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "oldSetting");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CASE WHEN v_colNotKnown = 1 THEN 'I' WHEN v_valueDiffers = 1 THEN 'e' ELSE 'A' END,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_objectType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CASE WHEN v_oldValueStr = '' THEN CAST(NULL AS VARCHAR(1)) ELSE v_oldValueStr END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSEIF c_objectType = 'DB' THEN");

M11_LRT.genProcSectionHeader(fileNo, "determine whether config parameter is set correctly", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_parameter = (CASE WHEN c_parameter = 'LOGFILSIZ' THEN 'LOGFILSZ' ELSE c_parameter END);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_colNotKnown = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_oldValueStr = CAST(NULL AS VARCHAR(1));");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_valueStr =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CASE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN c_value = 'ON'  THEN '1'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN c_value = 'YES' THEN '1'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN c_value = 'OFF' THEN '0'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN c_value = 'NO'  THEN '0'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN " + M01_Globals_IVK.g_qualFuncNameIsNumeric + "(c_value) = 1 THEN c_value");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ELSE '''' || c_value || ''''");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'SELECT RTRIM(CAST(' || v_parameter || ' AS CHAR(20))), (CASE WHEN RTRIM(CHAR(' || v_parameter || ')) <> RTRIM(CHAR(' || v_valueStr || ')) THEN 1 ELSE 0 END) FROM SESSION.DB_CONFIG WHERE DBCONFIG_TYPE = 0';");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CALL SYSPROC.GET_DB_CONFIG();");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF v_colNotKnown = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OPEN parmValueCursor;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "parmValueCursor");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_oldValueStr,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_valueDiffers");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CLOSE parmValueCursor WITH RELEASE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "determine update statement", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'UPDATE DB CFG FOR ' || CURRENT SERVER || ' USING ' || c_parameter || ' ' || c_value;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "mode,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "useAdminCmd,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "objectType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "statement,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "oldSetting");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CASE WHEN v_colNotKnown = 1 THEN 'I' WHEN v_valueDiffers = 1 THEN 'E' ELSE 'A' END,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "1,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_objectType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CASE WHEN v_oldValueStr = '' THEN CAST(NULL AS VARCHAR(1)) ELSE v_oldValueStr END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSEIF c_objectType = 'BUFFERPOOL' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF c_parameter = 'NPAGES' THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR bpSizeLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "B.BPNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "B.NPAGES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SYSCAT.BUFFERPOOLS B");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "B.BPNAME LIKE c_objectName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "if NPAGES does not match target value, update it", 5, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SET v_stmntTxt = 'ALTER BUFFERPOOL ' || c_objectName || ' SIZE ' || c_value;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 5, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "mode,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "objectType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "statement,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "oldSetting");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "CASE WHEN NPAGES = CAST(c_value AS INTEGER) THEN 'A' ELSE 'E' END,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "c_objectType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "RTRIM(CAST(NPAGES AS CHAR(20)))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSEIF c_objectType = 'SEQUENCE' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF c_parameter = 'CACHE SIZE' THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR seqCacheLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "S.SEQSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "S.SEQNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "S.CACHE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SYSCAT.SEQUENCES S");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "S.SEQSCHEMA LIKE c_schemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "S.SEQNAME LIKE c_objectName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "if CACHE size does not match target value, update it", 5, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IF CAST(c_value AS INTEGER) = 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SET v_stmntTxt = 'ALTER SEQUENCE ' || RTRIM(SEQSCHEMA) || '.' || SEQNAME || ' NO CACHE';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SET v_stmntTxt = 'ALTER SEQUENCE ' || RTRIM(SEQSCHEMA) || '.' || SEQNAME || ' CACHE ' || c_value;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 5, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "mode,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "objectType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "statement,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "oldSetting");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "CASE WHEN CACHE = CAST(c_value AS INTEGER) THEN 'A' ELSE 'E' END,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "c_objectType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "RTRIM(CAST(CACHE AS CHAR(20)))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSEIF c_objectType = 'DBPROFILE' THEN");

M11_LRT.genProcSectionHeader(fileNo, "determine whether config parameter is set correctly", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_colNotKnown = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_oldValueStr = CAST(NULL AS VARCHAR(1));");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_valueStr = COALESCE(c_value, '');");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LEFT(REG_VAR_VALUE, 100)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_oldValueStr");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE(SYSPROC.REG_LIST_VARIABLES()) AS REGISTRYINFO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RTRIM(LTRIM(UPPER(REG_VAR_NAME))) = RTRIM(LTRIM(UPPER(c_parameter)))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LEVEL = 'I'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FETCH FIRST 1 ROW ONLY;");

M11_LRT.genProcSectionHeader(fileNo, "determine update statement", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = RTRIM(LTRIM(UPPER(c_parameter))) || '=' || c_value;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "mode,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "useAdminCmd,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "objectType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "cmd,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "statement,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "oldSetting");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CASE WHEN (v_oldValueStr IS NULL) OR (v_oldValueStr <> v_valueStr) THEN 'e' ELSE 'A' END,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "0,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_objectType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'db2set',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_oldValueStr");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_ignoreError = " + M01_LDM.gc_dbFalse + ";");

M11_LRT.genProcSectionHeader(fileNo, "count number of statements", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCountExec_out = (SELECT COUNT(*) FROM SESSION.statements WHERE mode = 'E');");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCountList_out = (SELECT COUNT(*) FROM SESSION.statements WHERE mode NOT IN ('E','A'));");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR stmntLoop AS");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "useAdminCmd,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "MODE = 'E'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF useAdminCmd = 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CALL SYSPROC.ADMIN_CMD(statement);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE statement;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_ignoreWarning = " + M01_LDM.gc_dbFalse + ";");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "mode,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "oldSetting,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "cmd,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "seqNo ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmntCursor;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameSetCfgProfile, ddlType, null, "mode_in", "'profileName_in", "'objectType_in", "'objectSchema_in", "'objectName_in", "'parameter_in", "rowCountExec_out", "rowCountList_out", null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for activating a configuration profile", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameSetCfgProfile);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "profileName_in", "VARCHAR(20)", true, "(optional) name of the profile to apply");
M11_LRT.genProcParm(fileNo, "OUT", "rowCountExec_out", "INTEGER", true, "number of configuration statements executed");
M11_LRT.genProcParm(fileNo, "OUT", "rowCountList_out", "INTEGER", false, "number of configuration statements not executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameSetCfgProfile + "(mode_in, profileName_in, NULL, NULL, NULL, NULL, rowCountExec_out, rowCountList_out);");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for activating a configuration profile", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameSetCfgProfile);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "profileName_in", "VARCHAR(20)", true, "(optional) name of the profile to apply");
M11_LRT.genProcParm(fileNo, "IN", "objectType_in", "VARCHAR(10)", true, "(optional) name of the object type to configure");
M11_LRT.genProcParm(fileNo, "OUT", "rowCountExec_out", "INTEGER", true, "number of configuration statements executed");
M11_LRT.genProcParm(fileNo, "OUT", "rowCountList_out", "INTEGER", false, "number of configuration statements not executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameSetCfgProfile + "(mode_in, profileName_in, objectType_in, NULL, NULL, NULL, rowCountExec_out, rowCountList_out);");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for activating the 'default configuration profile'
// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for activating the default configuration profile", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameSetCfgProfile);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "rowCountExec_out", "INTEGER", true, "number of configuration statements executed");
M11_LRT.genProcParm(fileNo, "OUT", "rowCountList_out", "INTEGER", false, "number of configuration statements not executed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_profileName", "VARCHAR(20)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_server", "VARCHAR(20)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameSetCfgProfile, ddlType, null, "mode_in", "rowCountExec_out", "rowCountList_out", null, null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "determine current server", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_server = UPPER(CURRENT SERVER);");

M11_LRT.genProcSectionHeader(fileNo, "guess default profile", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF LEFT(v_server," + String.valueOf(M03_Config.productKey.length()) + ") = '" + M03_Config.productKey.toUpperCase() + "' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_profileName = 'DAI';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSEIF LEFT(v_server,3) = 'MDS' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_profileName = 'IBM-TEST';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_profileName = 'IBM-DEPLOYTEST';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "set profile", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameSetCfgProfile + "(mode_in, v_profileName, rowCountExec_out, rowCountList_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameSetCfgProfile, ddlType, null, "mode_in", "rowCountExec_out", "rowCountList_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
}


private static void genDdlSetTabCfg(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (M03_Config.generateFwkTest) {
return;
}

// ####################################################################################################################
// #    SP for configuring tables
// ####################################################################################################################

String qualProcedureNameSetTableCfg;
qualProcedureNameSetTableCfg = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnSetTableCfg, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for configuring tables", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameSetTableCfg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "tabSchema_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) schema name pattern of the table(s) to configure");
M11_LRT.genProcParm(fileNo, "IN", "tabName_in", M01_Globals.g_dbtDbTableName, true, "(optional) name pattern of the table to configure");
M11_LRT.genProcParm(fileNo, "IN", "cfgParmList_in", "VARCHAR(100)", true, "(optional) list of config parameter names to set");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of configuration statements");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_stmntText", "VARCHAR(2000)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_dbSupportsCompression", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_cfgPctFree", "SMALLINT", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_cfgIsVolatile", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_cfgUseCompression", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

String tempTabNameStatementTabCfg;
tempTabNameStatementTabCfg = M94_DBAdmin.tempTabNameStatement + "TabCfg";

M94_DBAdmin.genDdlForTempTableCfg(fileNo, 1, true, false, false);
M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, null, true, true, true, null, "TabCfg", null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameSetTableCfg, ddlType, null, "mode_in", "'tabSchema_in", "'tabName_in", "'cfgParmList_in", "rowCount_out", null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "determine whether DB supports row level compression", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_dbSupportsCompression = (CASE WHEN " + M01_Globals.g_qualFuncNameDb2Release + "() > 8 THEN 1 ELSE 0 END);");

M11_LRT.genProcSectionHeader(fileNo, "determine config parameters to deal with", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF cfgParmList_in IS NULL THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_cfgPctFree        = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_cfgIsVolatile     = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_cfgUseCompression = v_dbSupportsCompression;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSE");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR cfgParamLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(RTRIM(LTRIM(ELEM))) AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(cfgParmList_in, CAST(',' AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF POSSTR(c_elem, 'PCTFREE') > 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_cfgPctFree = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ELSEIF POSSTR(c_elem, 'VOLATILE') > 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_cfgIsVolatile = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ELSEIF POSSTR(c_elem, 'COMPRESSION') > 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_cfgUseCompression = v_dbSupportsCompression;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "collect all table names", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M94_DBAdmin.tempTabNameTableCfg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tabSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M11_LRT.genProcSectionHeader(fileNo, "loop over table configurations", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'UPDATE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'" + M94_DBAdmin.tempTabNameTableCfg + "' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "' SET ' ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'pctFree = '             || (CASE WHEN pctFree             IS NULL THEN 'pctFree'             ELSE RTRIM(CHAR(pctFree            )) END) || ',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'isVolatile = '          || (CASE WHEN isVolatile          IS NULL THEN 'isVolatile'          ELSE RTRIM(CHAR(isVolatile         )) END) || ',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'useCompression = '      || (CASE WHEN useCompression      IS NULL THEN 'useCompression'      ELSE RTRIM(CHAR(useCompression     )) END) || ',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'useIndexCompression = ' || (CASE WHEN useIndexCompression IS NULL THEN 'useIndexCompression' ELSE RTRIM(CHAR(useIndexCompression)) END) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "' WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'tabSchema LIKE ''' || COALESCE(SCHEMANAME, '%') || '''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "' AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'tabName LIKE ''' || COALESCE(TABLENAME, '%') || '''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "' AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'NOT (' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'tabSchema LIKE ''' || COALESCE(SCHEMANAMEEXCLUDED, '-') || '''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "' AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'tabName LIKE ''' || COALESCE(TABLENAMEEXCLUDED, '-') || '''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "')' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "' AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'tabSchema LIKE ''' || COALESCE(tabSchema_in, '" + M01_Globals.g_allSchemaNamePattern + "') || '''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "' AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'tabName LIKE ''' || COALESCE(tabName_in, '%') || ''''");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AS c_stmntTxt");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameTableCfg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SEQUENCENO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE c_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "loop over tables and update table configuration", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'ALTER TABLE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RTRIM(tabSchema) || '.' || RTRIM(tabName) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(CASE WHEN pctFree IS NULL OR v_cfgPctFree = 0 THEN '' ELSE ' PCTFREE ' || RTRIM(CHAR(pctFree)) END) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CASE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN isVolatile IS NULL OR v_cfgIsVolatile = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "THEN ''");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ELSE (CASE isVolatile WHEN 1 THEN '' ELSE ' NOT' END) || ' VOLATILE'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ") ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CASE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN useCompression IS NULL OR v_cfgUseCompression = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "THEN ''");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ELSE ' COMPRESS ' || (CASE useCompression WHEN 1 THEN 'YES' ELSE 'NO' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ") ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'' AS c_stmntTxt");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M94_DBAdmin.tempTabNameTableCfg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "NOT (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(pctFree IS NULL OR v_cfgPctFree = 0)");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(isVolatile IS NULL OR v_cfgIsVolatile = 0)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(useCompression IS NULL OR v_cfgUseCompression = 0)");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tabSchema ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tabName   ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "execute update of table configuration", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE c_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store update statement in temporary table", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + tempTabNameStatementTabCfg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "keep track of updated table", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "loop over indexes and update index configuration", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR indexLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'ALTER INDEX ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RTRIM(I.INDSCHEMA) || '.' || RTRIM(I.INDNAME) ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CASE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN C.useIndexCompression IS NULL OR v_cfgUseCompression = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "THEN ''");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "' COMPRESS ' ||(CASE C.useIndexCompression WHEN 1 THEN 'YES' ELSE 'NO' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ") ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'' AS c_stmntTxt");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M94_DBAdmin.tempTabNameTableCfg + " C");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.INDEXES I");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "C.tabSchema = I.TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "C.tabName = I.TABNAME");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "NOT (");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(C.useIndexCompression IS NULL OR v_cfgUseCompression = 0)");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "C.tabSchema ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "C.tabName   ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "I.TABSCHEMA ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "I.TABNAME   ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "execute update of index configuration", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE c_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store update statement in temporary table", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + tempTabNameStatementTabCfg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "keep track of updated index", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE resCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + tempTabNameStatementTabCfg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "seqNo ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN resCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameSetTableCfg, ddlType, null, "mode_in", "'tabSchema_in", "'tabName_in", "'cfgParmList_in", "rowCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for configuring tables", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameSetTableCfg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "tabSchema_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) schema name pattern of the table(s) to configure");
M11_LRT.genProcParm(fileNo, "IN", "tabName_in", M01_Globals.g_dbtDbTableName, true, "(optional) name pattern of the table to configure");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of configuration statements");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameSetTableCfg, ddlType, null, "mode_in", "'tabSchema_in", "'tabName_in", "rowCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameSetTableCfg + "(mode_in, tabSchema_in, tabName_in, NULL, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameSetTableCfg, ddlType, null, "mode_in", "'tabSchema_in", "'tabName_in", "rowCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for configuring tables", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameSetTableCfg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of configuration statements");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameSetTableCfg, ddlType, null, "mode_in", "rowCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameSetTableCfg + "(mode_in, NULL, NULL, NULL, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameSetTableCfg, ddlType, null, "mode_in", "rowCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
}


private static void genDbAdminDdlCompressionEstimation(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (!(M03_Config.supportCompresionEstimation)) {
return;
}

// ####################################################################################################################
// #    SP for estimating effectiveness of row compression
// ####################################################################################################################

String qualProcedureNameCompressEstimate;
qualProcedureNameCompressEstimate = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnCompressEstimate, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for estimating effectiveness of row compression", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameCompressEstimate);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "tabSchema_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) schema name pattern of the table(s) to estimate");
M11_LRT.genProcParm(fileNo, "IN", "tabName_in", M01_Globals.g_dbtDbTableName, true, "(optional) name pattern of the table to estimate");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of tables estimated");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 2");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_db2Release", M01_Globals.g_dbtDbRelease, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(600)", "NULL", null, null);
M79_Err.genSigMsgVarDecl(fileNo, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

String qualTabNameTempStatementInspect;
qualTabNameTempStatementInspect = M94_DBAdmin.tempTabNameStatement + "Inspect";

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 200, true, true, true, null, "Inspect", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "temporary table for compression estimate information", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.CompEstimate");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tabSchema         " + M01_Globals.g_dbtDbSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tabName           VARCHAR(50),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "dataPartitionId   INTEGER,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "compAttribute     CHAR(1),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "pagesSavedPercent SMALLINT,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "bytesSavedPercent SMALLINT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, true, true, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameCompressEstimate, ddlType, null, "'tabSchema_in", "'tabName_in", "rowCount_out", null, null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "Verify that this DB-Version supports Compression", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_db2Release = " + M01_Globals.g_qualFuncNameDb2Release + "();");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF (v_db2Release < 9.05)THEN");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameCompressEstimate, ddlType, -2, "'tabSchema_in", "'tabName_in", "rowCount_out", null, null, null, null, null, null, null, null, null);
M79_Err.genSignalDdlWithParms("featureNotSupported", fileNo, 2, "ROW COMPRESSION ESTIMATE", "9.5", null, null, null, null, null, null, null, null, null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "loop over tables and retrieve estimation data", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS csr CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABSCHEMA AS c_tabSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABNAME   AS c_tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UCASE(RTRIM(TABSCHEMA)) LIKE COALESCE(UCASE(tabSchema_in), '" + M01_Globals.g_allSchemaNamePattern + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UCASE(RTRIM(TABNAME)) LIKE COALESCE(UCASE(tabName_in), '%')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "retrieve statement for estimating this table", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'INSPECT ROWCOMPESTIMATE TABLE NAME ' || RTRIM(c_tabName) || ' SCHEMA ' || RTRIM(c_tabSchema) || ' RESULTS rowComResult.out';");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + qualTabNameTempStatementInspect);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "execute estimation", 3, true);

M11_LRT.genProcSectionHeader(fileNo, "use dynamic SQL here to make this compile in all DB2-versions", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'INSERT INTO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'SESSION.CompEstimate ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'(' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'tabSchema,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'tabName,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'dataPartitionId,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'compAttribute,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'pagesSavedPercent,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'bytesSavedPercent' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "') ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SELECT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'RTRIM(LEFT(TABSCHEMA, 30)),' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'RTRIM(LEFT(TABNAME, 50)),' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'RTRIM(CHAR(DATA_PARTITION_ID)),' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'COMPRESS_ATTR,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'PAGES_SAVED_PERCENT,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'BYTES_SAVED_PERCENT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'TABLE (SYSPROC.ADMIN_GET_TAB_COMPRESS_INFO(''' || c_tabSchema || ''', ''' || c_tabName || ''', ''ESTIMATE'')) AS T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "count estimated table", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET rowCount_out = rowCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare cursor(s)", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + qualTabNameTempStatementInspect);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "seqNo ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DECLARE resCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tabSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "dataPartitionId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "compAttribute     AS CA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "pagesSavedPercent AS \"PS[%]\",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "bytesSavedPercent AS \"BS[%]\"");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SESSION.CompEstimate");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tabSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor(s) open for application", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmntCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN resCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameCompressEstimate, ddlType, null, "'tabSchema_in", "'tabName_in", "rowCount_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for estimating effectiveness of row compression", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameCompressEstimate);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of tables estimated");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameCompressEstimate, ddlType, null, "mode_in", "rowCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameCompressEstimate + "(mode_in, NULL, NULL, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameCompressEstimate, ddlType, null, "mode_in", "rowCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
}


private static void genDbAdminDdl5(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

// ####################################################################################################################
// #    View for 'invalid' database object
// ####################################################################################################################

String qualViewNameInvalidDbObjects;
qualViewNameInvalidDbObjects = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnInvalidDbObjects, M01_ACM.vnInvalidDbObjects, ddlType, null, null, null, null, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("View for 'invalid' database object", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE VIEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualViewNameInvalidDbObjects);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "OBJTYPE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "OBJSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "OBJNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "STATUS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AS");

M11_LRT.genProcSectionHeader(fileNo, "check for invalid ROUTINEs (FUNCTION, METHOD, PROCEDURE)", null, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(CASE ROUTINETYPE WHEN 'F' THEN 'FUNCTION' WHEN 'M' THEN 'METHOD' ELSE 'PROCEDURE' END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROUTINESCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROUTINENAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(CASE VALID WHEN 'N' THEN 'invalid' ELSE 'inoperative' END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TEXT || CHR(10) || '" + M01_LDM.gc_sqlCmdDelim + "' || CHR(10)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.ROUTINES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALID <> 'Y'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORIGIN = 'Q'");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "check for invalid VIEWs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'VIEW',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VIEWSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VIEWNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'invalid',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TEXT || CHR(10) || '" + M01_LDM.gc_sqlCmdDelim + "' || CHR(10)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.VIEWS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALID <> 'Y'");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "check for invalid TRIGGERs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'TRIGGER',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TRIGSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TRIGNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'invalid',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TEXT || CHR(10) || '" + M01_LDM.gc_sqlCmdDelim + "' || CHR(10)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.TRIGGERS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALID <> 'Y'");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "UNION ALL");

M11_LRT.genProcSectionHeader(fileNo, "check for invalid PACKAGEs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'PACKAGE',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "PKGSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "PKGNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(CASE VALID WHEN 'N' THEN 'invalid' ELSE 'inoperative' END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'REBIND PACKAGE ' || RTRIM(PKGSCHEMA) || '.' || RTRIM(PKGNAME) || '" + M01_LDM.gc_sqlCmdDelim + "' || CHR(10)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.PACKAGES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALID <> 'Y'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    Procedure for checking validity of database objects
// ####################################################################################################################

String qualProcNameCheckValidity;
qualProcNameCheckValidity = M04_Utilities.genQualViewName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.vnInvalidDbObjects, M01_ACM.vnInvalidDbObjects, ddlType, null, null, null, null, null, null, null, null, null, null);

qualProcNameCheckValidity = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnCheckValidity, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("Procedure for checking validity of database objects", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcNameCheckValidity);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of database objects found invalid");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_rowCount", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M11_LRT.genProcSectionHeader(fileNo, "temporary table for status information", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.ObjStatus");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objType    VARCHAR(15),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objSchema  VARCHAR(128),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objName    VARCHAR(128),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "status     VARCHAR(40),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "statement  CLOB(32000)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, true, true, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcNameCheckValidity, ddlType, null, "rowCount_out", null, null, null, null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter 'rowCount_out'", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "check for invalid VIEWs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.ObjStatus");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "status,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'VIEW',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VIEWSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VIEWNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'invalid',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT(TEXT, 32000)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.VIEWS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALID <> 'Y'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = rowCount_out + v_rowCount;");

M11_LRT.genProcSectionHeader(fileNo, "check for invalid TRIGGERs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.ObjStatus");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "status,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'TRIGGER',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TRIGSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TRIGNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'invalid',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT(TEXT, 32000)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.TRIGGERS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALID <> 'Y'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = rowCount_out + v_rowCount;");

M11_LRT.genProcSectionHeader(fileNo, "check for invalid PACKAGEs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.ObjStatus");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "status,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'PACKAGE',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "PKGSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "PKGNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(CASE VALID WHEN 'N' THEN 'invalid' ELSE 'inoperative' END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'REBIND PACKAGE ' || RTRIM(PKGSCHEMA) || '.' || RTRIM(PKGNAME)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.PACKAGES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALID <> 'Y'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = rowCount_out + v_rowCount;");

M11_LRT.genProcSectionHeader(fileNo, "check for invalid ROUTINEs (FUNCTION, METHOD, PROCEDURE)", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.ObjStatus");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "status,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(CASE ROUTINETYPE WHEN 'F' THEN 'FUNCTION' WHEN 'M' THEN 'METHOD' ELSE 'PROCEDURE' END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROUTINESCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROUTINENAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(CASE VALID WHEN 'N' THEN 'invalid' ELSE 'inoperative' END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT(TEXT, 32000)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.ROUTINES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALID <> 'Y'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORIGIN = 'Q'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = rowCount_out + v_rowCount;");

M11_LRT.genProcSectionHeader(fileNo, "check for invalid TABLEs, ALIASes, etc", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.ObjStatus");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "status,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CASE TYPE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHEN 'A' THEN 'ALIAS'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHEN 'H' THEN 'HIERARCHY TABLE'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHEN 'N' THEN 'NICK NAME'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHEN 'S' THEN 'MATERIALIZED QUERY TABLE'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHEN 'T' THEN 'TABLE'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHEN 'U' THEN 'TYPED TABLE'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHEN 'V' THEN 'VIEW'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHEN 'W' THEN 'TYPED VIEW'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE '' END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "TABNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(CASE STATUS WHEN 'C' THEN 'check pending' ELSE 'inoperative' END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CAST(NULL AS VARCHAR(1))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "STATUS <> 'N'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = rowCount_out + v_rowCount;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "objType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CAST(RTRIM(LEFT(objSchema, 30)) AS " + M01_Globals.g_dbtDbSchemaName + ") AS objSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CAST(RTRIM(LEFT(objName,   50)) AS VARCHAR(50)) AS objName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "status");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SESSION.ObjStatus");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "objType    ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "objSchema  ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "objName    ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "OPEN stmntCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcNameCheckValidity, ddlType, null, "rowCount_out", null, null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    Procedure for revalidating views
// ####################################################################################################################

String qualProcNameRevalidateViews;
qualProcNameRevalidateViews = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRevalidate + "_VIEWS", ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("Procedure for revalidating database views", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcNameRevalidateViews);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas of views to revalidate");
M11_LRT.genProcParm(fileNo, "IN", "viewNamePattern_in", M01_Globals.g_dbtDbViewName, true, "determines the views to revalidate");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "viewCount_out", "INTEGER", false, "number of views revalidated");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, null);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_viewDropStmt", "VARCHAR(300)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, null, 32000, true, null, null, null, null, null, null, null, null, null, null, null, null);
M94_DBAdmin.genDdlForTempGrants(fileNo, 1, true, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcNameRevalidateViews, ddlType, null, "'schemaNamePattern_in", "'viewNamePattern_in", "mode_in", "viewCount_out", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter 'viewCount_out'", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET viewCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "revalidate invalid VIEWs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR viewLoop AS csr CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VIEWSCHEMA AS c_viewSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VIEWNAME   AS c_viewName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LEFT(TEXT, 128000) AS c_viewDefinition");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.VIEWS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(VIEWSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALID <> 'Y'");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(schemaNamePattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(VIEWSCHEMA LIKE schemaNamePattern_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(viewNamePattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(VIEWNAME LIKE viewNamePattern_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "determine DROP-Statement", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_viewDropStmt = 'DROP VIEW ' || c_viewSchema || '.' || c_viewName;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO SESSION.statements(STATEMENT) VALUES(v_viewDropStmt);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO SESSION.statements(STATEMENT) VALUES(LEFT(c_viewDefinition,32000));");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "keep track of GRANTs on View", 3, true);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M94_DBAdmin.tempTabNameGrant);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "objectName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "grantee,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "granteeType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "privilege");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.GRANTEE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.GRANTEETYPE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'SELECT'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABAUTH A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABSCHEMA = c_viewSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABNAME = c_viewName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.SELECTAUTH <> 'N'");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UNION ALL");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.GRANTEE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.GRANTEETYPE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'INSERT'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABAUTH A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABSCHEMA = c_viewSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABNAME = c_viewName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.INSERTAUTH <> 'N'");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UNION ALL");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.GRANTEE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.GRANTEETYPE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'DELETE'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABAUTH A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABSCHEMA = c_viewSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABNAME = c_viewName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.DELETEAUTH <> 'N'");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UNION ALL");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.GRANTEE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.GRANTEETYPE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'UPDATE'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABAUTH A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABSCHEMA = c_viewSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.TABNAME = c_viewName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.UPDATEAUTH <> 'N'");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "re-create View", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_viewDropStmt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE c_viewDefinition;");

M11_LRT.genProcSectionHeader(fileNo, "set GRANTs on re-created View", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR privLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'GRANT ' || G.privilege || ' ON ' || RTRIM(G.schemaName) || '.' || RTRIM(G.objectName) || ' TO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE G.granteeType WHEN 'P' THEN 'PUBLIC' WHEN 'G' THEN 'GROUP' ELSE 'USER' END) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE WHEN G.granteeType <> 'P' THEN ' ' || G.grantee ELSE '' END) AS grantStatement");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameGrant + " G");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 5, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "INSERT INTO SESSION.statements(STATEMENT) VALUES(grantStatement);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE grantStatement;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END FOR;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DELETE FROM " + M94_DBAdmin.tempTabNameGrant + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET viewCount_out = viewCount_out + 1;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcNameRevalidateViews, ddlType, null, "'schemaNamePattern_in", "'viewNamePattern_in", "mode_in", "viewCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    Procedure for revalidating triggers
// ####################################################################################################################

String qualProcNameRevalidateTriggers;
qualProcNameRevalidateTriggers = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRevalidate, ddlType, null, null, null, "TRIGGERS", null, null);

M22_Class_Utilities.printSectionHeader("Procedure for revalidating database triggers", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcNameRevalidateTriggers);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas of triggers to revalidate");
M11_LRT.genProcParm(fileNo, "IN", "triggerNamePattern_in", "VARCHAR(50)", true, "determines the triggers to revalidate");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "triggerCount_out", "INTEGER", false, "number of triggers revalidated");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, null);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_triggerDropStmt", "VARCHAR(300)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, null, 32000, true, null, null, null, null, null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcNameRevalidateTriggers, ddlType, null, "'schemaNamePattern_in", "'triggerNamePattern_in", "mode_in", "triggerCount_out", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter 'triggerCount_out'", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET triggerCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "revalidate invalid TRIGGERs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR trigLoop AS csr CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TRIGSCHEMA         AS c_triggerSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TRIGNAME           AS c_triggerName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LEFT(TEXT, 128000) AS c_triggerDefinition");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.TRIGGERS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(TRIGSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALID <> 'Y'");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(schemaNamePattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TRIGSCHEMA LIKE schemaNamePattern_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(triggerNamePattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TRIGNAME LIKE triggerNamePattern_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M11_LRT.genProcSectionHeader(fileNo, "determine DROP-Statement", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_triggerDropStmt = 'DROP TRIGGER ' || c_triggerSchema || '.' || c_triggerName;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO SESSION.statements(STATEMENT) VALUES(v_triggerDropStmt);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO SESSION.statements(STATEMENT) VALUES(LEFT(c_triggerDefinition,32000));");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_triggerDropStmt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE c_triggerDefinition;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET triggerCount_out = triggerCount_out + 1;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcNameRevalidateTriggers, ddlType, null, "'schemaNamePattern_in", "'triggerNamePattern_in", "mode_in", "triggerCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    Procedure for revalidating packages
// ####################################################################################################################

String qualProcNameReValidatePackages;
qualProcNameReValidatePackages = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRevalidate, ddlType, null, null, null, "PACKAGES", null, null);

M22_Class_Utilities.printSectionHeader("Procedure for revalidating database packages", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcNameReValidatePackages);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas of procedured to revalidate packages for");
M11_LRT.genProcParm(fileNo, "IN", "procNamePattern_in", M01_Globals.g_dbtDbProcName, true, "determines the procedured to revalidate packages for");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "procCount_out", "INTEGER", false, "number of procedures revalidated");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "inUse", "55006", null);
M11_LRT.genCondDecl(fileNo, "rebindFail", "38000", null);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);

M07_SpLogging.genSpLogDecl(fileNo, null, true);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR inUse");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore - this is a package corresponding to this procedure");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR rebindFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore - this is a package corresponding to this procedure");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, null, 32000, true, null, null, null, null, null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcNameReValidatePackages, ddlType, null, "'schemaNamePattern_in", "'procNamePattern_in", "mode_in", "procCount_out", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter 'procCount_out'", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET procCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "revalidate invalid packages corresponding to procedures", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR procLoop AS csr CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RT.ROUTINESCHEMA AS PROCSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RT.SPECIFICNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PA.PKGSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PA.PKGNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.ROUTINES RT");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.ROUTINEDEP RD");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RD.ROUTINESCHEMA = RT.ROUTINESCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RD.ROUTINENAME = RT.SPECIFICNAME");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.PACKAGES PA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RT.ROUTINESCHEMA = PA.PKGSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RD.BNAME = PA.PKGNAME");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RT.ROUTINETYPE = 'P'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "schemaNamePattern_in IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RTRIM(RT.ROUTINESCHEMA) LIKE COALESCE(UCASE(schemaNamePattern_in),'" + M01_Globals.g_allSchemaNamePattern + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "procNamePattern_in IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RTRIM(RT.ROUTINENAME) LIKE procNamePattern_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PA.VALID <> 'Y'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO SESSION.statements(STATEMENT) VALUES('REBIND PACKAGE ' || RTRIM(PKGSCHEMA) || '.' || RTRIM(PKGNAME) || ' ANY');");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CALL SYSPROC.REBIND_ROUTINE_PACKAGE('SP', RTRIM(PROCSCHEMA) || '.' || RTRIM(SPECIFICNAME), 'ANY');");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET procCount_out = procCount_out + 1;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcNameReValidatePackages, ddlType, null, "'schemaNamePattern_in", "'procNamePattern_in", "mode_in", "procCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    Procedure for revalidating routines
// ####################################################################################################################

String qualProcNameRevalidateRoutines;
qualProcNameRevalidateRoutines = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRevalidate, ddlType, null, null, null, "ROUTINES", null, null);

M22_Class_Utilities.printSectionHeader("Procedure for revalidating database routines", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcNameRevalidateRoutines);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas of routines to revalidate");
M11_LRT.genProcParm(fileNo, "IN", "routineNamePattern_in", "VARCHAR(50)", true, "determines the routines to revalidate");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "routineCount_out", "INTEGER", false, "number of routines revalidated");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, null);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_parmSignature", "VARCHAR(500)", "''", null, null);
M11_LRT.genVarDecl(fileNo, "v_routineDropStmt", "VARCHAR(300)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, null, 32000, true, null, null, null, null, null, null, null, null, null, null, null, null);
M94_DBAdmin.genDdlForTempGrants(fileNo, 1, true, null, null, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcNameRevalidateRoutines, ddlType, null, "'schemaNamePattern_in", "'routineNamePattern_in", "mode_in", "routineCount_out", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter 'routineCount_out'", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET routineCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "revalidate invalid ROUTINEs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR routineLoop AS csr CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ROUTINESCHEMA      AS c_routineSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ROUTINENAME        AS c_routineName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SPECIFICNAME       AS c_specificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ROUTINETYPE        AS c_routineType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LEFT(TEXT, 128000) AS c_routineDefinition");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.ROUTINES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(ROUTINESCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(VALID <> 'Y')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(ROUTINETYPE IN ('F', 'P'))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(LANGUAGE = 'SQL')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(schemaNamePattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(ROUTINESCHEMA LIKE schemaNamePattern_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(routineNamePattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(ROUTINENAME LIKE routineNamePattern_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "determine DROP-Statement", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_routineDropStmt = 'DROP SPECIFIC ' || (CASE c_routineType WHEN 'F' THEN 'FUNCTION ' ELSE 'PROCEDURE ' END) || c_routineSchema || '.' || c_specificName;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO SESSION.statements(STATEMENT) VALUES(v_routineDropStmt);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO SESSION.statements(STATEMENT) VALUES(LEFT(c_routineDefinition, 32000));");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "determine parameter signature of routine", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_parmSignature = '';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR parmLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TYPENAME || (CASE WHEN TYPENAME IN ('CHARACTER', 'VARCHAR') THEN '(' || RTRIM(CHAR(LENGTH)) || ')' ELSE '' END) AS v_type");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SYSCAT.ROUTINEPARMS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ROUTINESCHEMA = c_routineSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SPECIFICNAME = c_specificName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ROWTYPE NOT IN ('R', 'C')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ORDINAL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_parmSignature = v_parmSignature || (CASE WHEN v_parmSignature = '' THEN '' ELSE ',' END) || v_type;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "keep track of GRANTs on Procedure", 3, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M94_DBAdmin.tempTabNameGrant);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "objectName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "parmSignature,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "grantee,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "granteeType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "privilege");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_routineSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_routineName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_parmSignature,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.GRANTEE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.GRANTEETYPE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'EXECUTE'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.ROUTINEAUTH A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.SCHEMA = c_routineSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.SPECIFICNAME = c_specificName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.EXECUTEAUTH <> 'N'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "re-create Routine", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_routineDropStmt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE c_routineDefinition;");

M11_LRT.genProcSectionHeader(fileNo, "set GRANTs on re-created Routine", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR privLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'GRANT ' || G.privilege || ' ON ' || (CASE c_routineType WHEN 'F' THEN 'FUNCTION' ELSE 'PROCEDURE' END) || ' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "RTRIM(G.schemaName) || '.' || RTRIM(G.objectName) || '(' || G.parmSignature || ') TO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE G.granteeType WHEN 'P' THEN 'PUBLIC' WHEN 'G' THEN 'GROUP' ELSE 'USER' END) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE WHEN G.granteeType <> 'P' THEN ' ' || G.grantee ELSE '' END) AS grantStatement");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameGrant + " G");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 5, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "INSERT INTO SESSION.statements(STATEMENT) VALUES(grantStatement);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE grantStatement;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END FOR;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DELETE FROM " + M94_DBAdmin.tempTabNameGrant + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET routineCount_out = routineCount_out + 1;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcNameRevalidateRoutines, ddlType, null, "'schemaNamePattern_in", "'routineNamePattern_in", "mode_in", "routineCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    Procedure for revalidating database objects
// ####################################################################################################################

String qualProcNameRevalidate;
qualProcNameRevalidate = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRevalidate, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("Procedure for revalidating database objects", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcNameRevalidate);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas of objects to revalidate");
M11_LRT.genProcParm(fileNo, "IN", "objNamePattern_in", "VARCHAR(50)", true, "determines the object names to revalidate");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");

M11_LRT.genProcParm(fileNo, "OUT", "objCount_out", "INTEGER", false, "number of database objects revalidated");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, null);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_objCount", "INTEGER", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_failCount", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 32000, true, null, null, null, null, null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcNameRevalidate, ddlType, null, "'schemaNamePattern_in", "'objNamePattern_in", "mode_in", "objCount_out", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter 'objCount_out'", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET objCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "revalidate VIEWs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcNameRevalidateViews + "(schemaNamePattern_in, objNamePattern_in, mode_in, v_objCount);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET objCount_out = objCount_out + v_objCount;");

M11_LRT.genProcSectionHeader(fileNo, "revalidate TRIGGERs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcNameRevalidateTriggers + "(schemaNamePattern_in, objNamePattern_in, mode_in, v_objCount);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET objCount_out = objCount_out + v_objCount;");

M11_LRT.genProcSectionHeader(fileNo, "revalidate ROUTINEs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcNameRevalidateRoutines + "(schemaNamePattern_in, objNamePattern_in, mode_in, v_objCount);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET objCount_out = objCount_out + v_objCount;");

M11_LRT.genProcSectionHeader(fileNo, "revalidate PACKAGEs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcNameReValidatePackages + "(schemaNamePattern_in, objNamePattern_in, mode_in, v_objCount);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET objCount_out = objCount_out + v_objCount;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmntCursor;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcNameRevalidate, ddlType, null, "'schemaNamePattern_in", "'objNamePattern_in", "mode_in", "objCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("Procedure for revalidating database objects", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcNameRevalidate);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");

M11_LRT.genProcParm(fileNo, "OUT", "objCount_out", "INTEGER", false, "number of database objects revalidated");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcNameRevalidate, ddlType, null, "mode_in", "objCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcNameRevalidate + "(NULL, NULL, mode_in, objCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcNameRevalidate, ddlType, null, "mode_in", "objCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for rebinding Procedures
// ####################################################################################################################

String qualProcedureNameRebindProcs;
qualProcedureNameRebindProcs = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRebind, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for rebinding Procedures", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameRebindProcs);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas of procedures to rebind (default '" + M01_Globals.g_allSchemaNamePattern + "')");
M11_LRT.genProcParm(fileNo, "IN", "procNamePattern_in", M01_Globals.g_dbtDbProcName, true, "determines the procedures to rebind (default '%')");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePatternExcl_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schemas of procedures to exclude from rebind");
M11_LRT.genProcParm(fileNo, "IN", "procNamePatternExcl_in", M01_Globals.g_dbtDbProcName, true, "(optional) determines the procedures to exclude from rebind");
M11_LRT.genProcParm(fileNo, "IN", "force_in", M01_Globals.g_dbtBoolean, true, "either '0' (only invalid procedures) or '1' (all procedures)");
M11_LRT.genProcParm(fileNo, "OUT", "procCount_out", "INTEGER", true, "number of procedures successfully processed");
M11_LRT.genProcParm(fileNo, "OUT", "failCount_out", "INTEGER", false, "number of procedures failed due to lock-timeout");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "inUse", "55006", null);
M11_LRT.genCondDecl(fileNo, "rebindFail", "38000", null);
M11_LRT.genCondDecl(fileNo, "implicitBindFail", "56098", null);
M11_LRT.genCondDecl(fileNo, "lockTimeout", "40001", null);
M11_LRT.genCondDecl(fileNo, "cursorAtEnd", "24501", null);
M11_LRT.genCondDecl(fileNo, "objectNotExists", "42704", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_lastPkgSchema", M01_Globals.g_dbtDbSchemaName, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_lastPkgName", "VARCHAR(50)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_numRetriesToDo", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_doRetry", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_diagnostics", "VARCHAR(100)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_atEnd", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_retryLoop", "SMALLINT", "1", null, null);
M11_LRT.genVarDecl(fileNo, "v_lostTempTable", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "SQLCODE", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR inUse");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore - this is a package corresponding to this procedure");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR rebindFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore - this is a package corresponding to this procedure");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR implicitBindFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR lockTimeout");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_doRetry = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_numRetriesToDo = " + String.valueOf(M03_Config.numRetriesRunstatsRebindOnLockTimeout) + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET failCount_out = failCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR cursorAtEnd");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF SQLCODE = -501 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_retryLoop = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_atEnd = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR objectNotExists");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_lostTempTable = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLEXCEPTION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS EXCEPTION 1 v_diagnostics = DB2_TOKEN_STRING;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF SQLCODE = -2310 AND v_diagnostics = '-911' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_doRetry = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF v_numRetriesToDo = " + String.valueOf(M03_Config.numRetriesRunstatsRebindOnLockTimeout) + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET failCount_out = failCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSEIF SQLCODE = -2310 AND v_diagnostics = '-1477' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_numRetriesToDo = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET failCount_out    = failCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameRebindProcs, ddlType, 3, "mode_in", "'schemaNamePattern_in", "'procNamePattern_in", "'schemaNamePatternExcl_in", "'procNamePatternExcl_in", "force_in", "procCount_out", "failCount_out", null, null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RESIGNAL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

String qualTempTabNameRebind;
qualTempTabNameRebind = M94_DBAdmin.tempTabNameStatement + "Rebind";
M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 250, null, null, null, null, "Rebind", null, null, true, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameRebindProcs, ddlType, null, "mode_in", "'schemaNamePattern_in", "'procNamePattern_in", "'schemaNamePatternExcl_in", "'procNamePatternExcl_in", "force_in", "procCount_out", "failCount_out", null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output variables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET procCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET failCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "since calling REBIND this way may close cursors we apply some very cumbersome implementation pattern involving nested loops", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHILE v_retryLoop = 1 DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_retryLoop = " + M01_LDM.gc_dbFalse + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "procLoop: FOR procLoop AS csr CURSOR WITH HOLD FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RTRIM(RT.ROUTINESCHEMA) AS PKGSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RTRIM(PA.PKGNAME)       AS PKGNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RTRIM(RT.ROUTINESCHEMA) AS PROCSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RT.ROUTINENAME          AS PROCNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RT.SPECIFICNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.ROUTINES RT");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.ROUTINEDEP RD");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RD.ROUTINESCHEMA = RT.ROUTINESCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RD.ROUTINENAME = RT.SPECIFICNAME");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.PACKAGES PA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RT.ROUTINESCHEMA = PA.PKGSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RD.BNAME = PA.PKGNAME");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RT.ROUTINETYPE = 'P'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RT.ROUTINESCHEMA NOT LIKE COALESCE(schemaNamePatternExcl_in,'')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT (RT.ROUTINESCHEMA = '" + M04_Utilities.getSchemaName(qualProcedureNameRebindProcs) + "' AND RT.ROUTINENAME LIKE '%" + M04_Utilities.getUnqualObjName(qualProcedureNameRebindProcs) + "%')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RT.ROUTINENAME NOT LIKE COALESCE(procNamePatternExcl_in,'')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RT.ROUTINESCHEMA LIKE COALESCE(UCASE(schemaNamePattern_in),'" + M01_Globals.g_allSchemaNamePattern + "')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RT.ROUTINENAME LIKE COALESCE(UCASE(procNamePattern_in),'%')");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(v_lastPkgSchema is NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(RT.ROUTINESCHEMA > v_lastPkgSchema)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(RT.ROUTINESCHEMA = v_lastPkgSchema AND RD.BNAME > v_lastPkgName)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE(force_in," + M01_LDM.gc_dbTrue + ") = " + M01_LDM.gc_dbTrue);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "PA.VALID <> 'Y'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "leave or retry loop if requested", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF v_atEnd = 1 OR v_retryLoop = 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LEAVE procLoop;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_lastPkgSchema = PKGSCHEMA;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_lastPkgName   = PKGNAME;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET procCount_out   = procCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_numRetriesToDo = " + String.valueOf(M03_Config.numRetriesRunstatsRebindOnLockTimeout) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_doRetry = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHILE v_numRetriesToDo > 0 DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CALL SYSPROC.REBIND_ROUTINE_PACKAGE('SP', RTRIM(PROCSCHEMA) || '.' || RTRIM(SPECIFICNAME), 'ANY');");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SET v_numRetriesToDo = (CASE v_doRetry WHEN 0 THEN 0 ELSE v_numRetriesToDo - 1 END);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END WHILE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + qualTempTabNameRebind);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "seqNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "flag,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "procCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(CASE v_doRetry WHEN 1 THEN '-' ELSE '+' END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'REBIND PACKAGE ' || PKGSCHEMA || '.' || PKGNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END WHILE;");

M11_LRT.genProcSectionHeader(fileNo, "determine number of successful REBINDs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET procCount_out = procCount_out - failCount_out;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_lostTempTable = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "flag AS f,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + qualTempTabNameRebind);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 4, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OPEN stmntCursor;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "CAST('-' AS CHAR(1)) f,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "CAST('-- lost reference to table \"" + qualTempTabNameRebind + "\"' AS VARCHAR(150))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SYSIBM.SYSDUMMY1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 4, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OPEN stmntCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameRebindProcs, ddlType, null, "mode_in", "'schemaNamePattern_in", "'procNamePattern_in", "'schemaNamePatternExcl_in", "'procNamePatternExcl_in", "force_in", "procCount_out", "failCount_out", null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for rebinding Procedures", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameRebindProcs);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas of procedures to rebind");
M11_LRT.genProcParm(fileNo, "IN", "procNamePattern_in", M01_Globals.g_dbtDbProcName, true, "determines the procedures to rebind");
M11_LRT.genProcParm(fileNo, "IN", "force_in", M01_Globals.g_dbtBoolean, true, "either '0' (only invalid procedures) or '1' (all procedures)");
M11_LRT.genProcParm(fileNo, "OUT", "procCount_out", "INTEGER", false, "number of procedures successfully processed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_failCount", "INTEGER", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameRebindProcs, ddlType, null, "mode_in", "'schemaNamePattern_in", "'procNamePattern_in", "force_in", "procCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameRebindProcs + "(mode_in, schemaNamePattern_in, procNamePattern_in, NULL, NULL, force_in, procCount_out, v_failCount);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameRebindProcs, ddlType, null, "mode_in", "'schemaNamePattern_in", "'procNamePattern_in", "force_in", "procCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for rebinding Procedures", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameRebindProcs);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "force_in", M01_Globals.g_dbtBoolean, true, "either '0' (only invalid procedures) or '1' (all procedures)");
M11_LRT.genProcParm(fileNo, "OUT", "procCount_out", "INTEGER", false, "number of procedures successfully processed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_failCount", "INTEGER", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameRebindProcs, ddlType, null, "mode_in", "force_in", "procCount_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameRebindProcs + "(mode_in, NULL, NULL, NULL, NULL, force_in, procCount_out, v_failCount);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameRebindProcs, ddlType, null, "mode_in", "force_in", "procCount_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
}


private static void genDbAdminDdl6(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (M03_Config.generateFwkTest) {
return;
}

// ####################################################################################################################

String qualProcedureNameReorg;
qualProcedureNameReorg = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnReorg, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for REORG of tables / indexes", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameReorg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "objType_in", "CHAR(1)", true, "(optional) determines the type of objects to REORG ('I' = index, 'T' = table)");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schema of tables to REORG");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "(optional) determines the name of tables to REORG");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPatternExcl_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schemas of tables to exclude from REORG");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePatternExcl_in", M01_Globals.g_dbtDbTableName, true, "(optional) determines the tables to exclude from REORG");
M11_LRT.genProcParm(fileNo, "IN", "doRunStats_in", M01_Globals.g_dbtBoolean, true, "if set to '1': execute RUNSTATS on reorganized tables");
M11_LRT.genProcParm(fileNo, "IN", "force_in", M01_Globals.g_dbtBoolean, true, "if set to '1': REORG all objects, otherwise only those recommended");
M11_LRT.genProcParm(fileNo, "IN", "reorgLobData_in", M01_Globals.g_dbtBoolean, true, "if set to '1': REORG LOB data");

M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", true, "number of REORGS on tables");
M11_LRT.genProcParm(fileNo, "OUT", "failCount_out", "INTEGER", false, "number of procedures failed due to lock-timeout");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "lockTimeout", "40001", null);
M11_LRT.genCondDecl(fileNo, "reorgError", "01H52", null);
M11_LRT.genCondDecl(fileNo, "rsEmpty", "0F001", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M79_Err.genSigMsgVarDecl(fileNo, null);
M11_LRT.genVarDecl(fileNo, "v_execTime", "TIME", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_numRetriesToDo", "INTEGER", String.valueOf(M03_Config.numRetriesRunstatsRebindOnLockTimeout), null, null);
M11_LRT.genVarDecl(fileNo, "v_doRetry", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_rsEmpty", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_doIgnore", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_diagnostics", "VARCHAR(100)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_tempTbSpaceName", "VARCHAR(128)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "SQLCODE", "INTEGER", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_rc", "INTEGER", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_TABLE_SCHEMA", "VARCHAR(128)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_TABLE_NAME", "VARCHAR(128)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_INDEX_SCHEMA", "VARCHAR(128)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_INDEX_NAME", "VARCHAR(128)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_CARD", "BIGINT", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_OVERFLOW", "BIGINT", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_NLEAF", "BIGINT", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_NUM_EMPTY_LEAFS", "BIGINT", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_NLEVELS ", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_ISIZE  ", "BIGINT", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_NUMRIDS_DELETED  ", "BIGINT", "NULL", null, null);
// DB2 V9-specific
M11_LRT.genVarDecl(fileNo, "v_DATAPARTITIONNAME", "VARCHAR(128)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_LEAF_RECSIZE ", "BIGINT", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_NONLEAF_RECSIZE ", "BIGINT", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_LEAF_PAGE_OVERHEAD ", "BIGINT", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_NONLEAF_PAGE_OVERHEAD ", "BIGINT", "NULL", null, null);
// end DB2 V9-specific
M11_LRT.genVarDecl(fileNo, "v_FULLKEYCARD  ", "BIGINT", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_NPAGES", "BIGINT", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_FPAGES", "BIGINT", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_ACTIVE_BLOCKS", "BIGINT", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_TSIZE", "BIGINT", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_F1", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_F2", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_F3", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_F4", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_F5", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_F6", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_F7", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_F8", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_REORG_TAB", "CHAR(3)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_REORG_IND", "CHAR(5)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmtBegin", "TIMESTAMP", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmtEnd", "TIMESTAMP", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_db2Release", M01_Globals.g_dbtDbRelease, "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare result set locator for reorgCheck-data", null, null);
M11_LRT.genVarDecl(fileNo, "l_reorgChkResult", "RESULT_SET_LOCATOR VARYING", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare continue handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR lockTimeout");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_doRetry = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR reorgError");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF SQLCODE = -1146 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_doIgnore = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_doRetry = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR rsEmpty");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_rsEmpty = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLEXCEPTION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS EXCEPTION 1 v_diagnostics = DB2_TOKEN_STRING;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF SQLCODE = -2310 AND v_diagnostics = '-911' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_doRetry = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSEIF SQLCODE = -2310 AND v_diagnostics = '-1477' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_doRetry = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameReorg, ddlType, 3, "mode_in", "'objType_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "'tabSchemaPatternExcl_in", "'tabNamePatternExcl_in", "doRunStats_in", "force_in", "reorgLobData_in", "tabCount_out", "failCount_out", null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RESIGNAL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

String qualTempTabNameReorg;
qualTempTabNameReorg = M94_DBAdmin.tempTabNameStatement + "Reorg";
M94_DBAdmin.genDdlForTempStatement(fileNo, null, true, 400, false, true, true, false, "Reorg", true, true, false, null, "numRetries", "SMALLINT", "qualTabName", "VARCHAR(100)");

M11_LRT.genProcSectionHeader(fileNo, "temporary table for objects to reorganize", 1, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.reorgChk");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objType         CHAR(1),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tableSchemaName VARCHAR(128),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tableName       VARCHAR(128),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "indexName       VARCHAR(128),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tempTsName      VARCHAR(128)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, true, true, true);
M00_FileWriter.printToFile(fileNo, "");

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameReorg, ddlType, null, "mode_in", "'objType_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "'tabSchemaPatternExcl_in", "'tabNamePatternExcl_in", "doRunStats_in", "force_in", "reorgLobData_in", "tabCount_out", "failCount_out", null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET tabCount_out  = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET failCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "determine database manager version", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_db2Release = " + M01_Globals.g_qualFuncNameDb2Release + "();");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF force_in = 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "include all tables / indexes in REORG", 2, true);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF COALESCE(UPPER(objType_in), 'T') = 'T' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SESSION.reorgChk");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "objType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tableSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tableName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tempTsName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tableSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tableName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tempTsName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "seqNo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "T.TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "T.TABNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TEMPTS.TBSPACE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ROWNUMBER() OVER (PARTITION BY T.TABSCHEMA, T.TABNAME ORDER BY TEMPTS.CREATE_TIME DESC)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SYSCAT.TABLES T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SYSCAT.DATAPARTITIONS P");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "T.TABSCHEMA = P.TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "T.TABNAME = P.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "P.DATAPARTITIONID = 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SYSCAT.TABLESPACES TS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "P.TBSPACEID = TS.TBSPACEID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SYSCAT.TABLESPACES TEMPTS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TEMPTS.PAGESIZE = TS.PAGESIZE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TEMPTS.TBSPACETYPE = 'S'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TEMPTS.DATATYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "T.TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "UCASE(RTRIM(T.TABSCHEMA)) LIKE COALESCE(UCASE(tabSchemaPattern_in), '" + M01_Globals.g_allSchemaNamePattern + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "UCASE(RTRIM(T.TABNAME)) LIKE COALESCE(UCASE(tabNamePattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "UCASE(RTRIM(T.TABSCHEMA)) NOT LIKE COALESCE(UCASE(tabSchemaPatternExcl_in), '')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "UCASE(RTRIM(T.TABNAME)) NOT LIKE COALESCE(UCASE(tabNamePatternExcl_in), '')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "NOT EXISTS ( SELECT 1 FROM SYSCAT.EVENTTABLES AS event WHERE T.TABSCHEMA = event.TABSCHEMA AND T.TABNAME = event.TABNAME )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'T',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tableSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tableName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tempTsName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "seqNo = 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF UPPER(objType_in) = 'I' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SESSION.reorgChk");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "objType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tableSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tableName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'I',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "T.TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "T.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABLES T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "T.TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UCASE(RTRIM(T.TABSCHEMA)) LIKE COALESCE(UCASE(tabSchemaPattern_in), '" + M01_Globals.g_allSchemaNamePattern + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UCASE(RTRIM(T.TABNAME)) LIKE COALESCE(UCASE(tabNamePattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UCASE(RTRIM(T.TABSCHEMA)) NOT LIKE COALESCE(UCASE(tabSchemaPatternExcl_in), '')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UCASE(RTRIM(T.TABNAME)) NOT LIKE COALESCE(UCASE(tabNamePatternExcl_in), '')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXISTS(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SYSCAT.INDEXES I");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "T.TABSCHEMA = I.TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "T.TABNAME = I.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSE");

M11_LRT.genProcSectionHeader(fileNo, "determine table reorgChk data", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF COALESCE(UPPER(objType_in), 'T') = 'T' THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CALL SYSPROC.REORGCHK_TB_STATS('T','ALL');");

M11_LRT.genProcSectionHeader(fileNo, "associate result set locator", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ASSOCIATE RESULT SET LOCATORS(l_reorgChkResult) WITH PROCEDURE SYSPROC.REORGCHK_TB_STATS;");

M11_LRT.genProcSectionHeader(fileNo, "allocate result set locator", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_rsEmpty = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ALLOCATE rsCursorTab CURSOR FOR RESULT SET l_reorgChkResult;");

M11_LRT.genProcSectionHeader(fileNo, "retrieve result set records", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF v_rsEmpty = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "REPEAT");

M11_LRT.genProcSectionHeader(fileNo, "fetch next record", 5, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IF v_db2Release < 9.07 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "rsCursorTab");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_TABLE_SCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_TABLE_NAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_CARD,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_OVERFLOW,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_NPAGES,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_FPAGES,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_ACTIVE_BLOCKS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_TSIZE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_F1,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_F2,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_F3,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_REORG_TAB");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SET v_rc = SQLCODE;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ELSE");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "rsCursorTab");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_TABLE_SCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_TABLE_NAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_DATAPARTITIONNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_CARD,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_OVERFLOW,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_NPAGES,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_FPAGES,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_ACTIVE_BLOCKS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_TSIZE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_F1,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_F2,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_F3,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_REORG_TAB");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SET v_rc = SQLCODE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "check whether record matches filter criteria and recommends REORG", 5, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IF (UCASE(RTRIM(v_TABLE_SCHEMA))     LIKE COALESCE(UCASE(tabSchemaPattern_in), '" + M01_Globals.g_allSchemaNamePattern + "')) AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "   (UCASE(v_TABLE_NAME         )     LIKE COALESCE(UCASE(tabNamePattern_in),       '%')) AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "   (UCASE(RTRIM(v_TABLE_SCHEMA)) NOT LIKE COALESCE(UCASE(tabSchemaPatternExcl_in), '' )) AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "   (UCASE(v_TABLE_NAME         ) NOT LIKE COALESCE(UCASE(tabNamePatternExcl_in),   '' )) AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "   ( (v_F1 >= 5) OR (v_F2 BETWEEN 0 AND 70) OR (v_F3 BETWEEN 0 AND 80) ) AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "   ( v_NPAGES > 5 )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "THEN");
M11_LRT.genProcSectionHeader(fileNo, "determine suitable temporary tablespace to use", 6, true);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SET v_tempTbSpaceName = NULL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "tempTsName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_tempTbSpaceName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "TEMPTS.TBSPACE AS tempTsName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "ROWNUMBER() OVER (PARTITION BY TEMPTS.PAGESIZE ORDER BY TEMPTS.CREATE_TIME DESC) AS seqNo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "SYSCAT.TABLES T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "SYSCAT.DATAPARTITIONS P");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "T.TABSCHEMA = P.TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "T.TABNAME = P.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "P.DATAPARTITIONID = 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "SYSCAT.TABLESPACES TS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "P.TBSPACEID = TS.TBSPACEID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "SYSCAT.TABLESPACES TEMPTS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "TEMPTS.PAGESIZE = TS.PAGESIZE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "TEMPTS.TBSPACETYPE = 'S'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "TEMPTS.DATATYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "T.TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "T.TABSCHEMA = v_TABLE_SCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(9) + "T.TABNAME = v_TABLE_NAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + ") V");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "seqNo = 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + ";");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "SESSION.reorgChk");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "objType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "tableSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "tableName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "tempTsName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "'T',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_TABLE_SCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_TABLE_NAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_tempTbSpaceName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + ");");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNTIL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_rc <> 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END REPEAT;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CLOSE rsCursorTab;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "determine index reorgChk data", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF UPPER(objType_in) = 'I' THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CALL SYSPROC.REORGCHK_IX_STATS('T','ALL');");

M11_LRT.genProcSectionHeader(fileNo, "associate result set locator", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ASSOCIATE RESULT SET LOCATORS(l_reorgChkResult) WITH PROCEDURE SYSPROC.REORGCHK_IX_STATS;");

M11_LRT.genProcSectionHeader(fileNo, "allocate result set locator", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_rsEmpty = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ALLOCATE rsCursorInd CURSOR FOR RESULT SET l_reorgChkResult;");

M11_LRT.genProcSectionHeader(fileNo, "retrieve result set records", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF v_rsEmpty = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "REPEAT");

M11_LRT.genProcSectionHeader(fileNo, "fetch next record", 5, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IF INTEGER(v_db2Release) = 8 THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "rsCursorInd");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_TABLE_SCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_TABLE_NAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_INDEX_SCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_INDEX_NAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_CARD,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_NLEAF,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_NUM_EMPTY_LEAFS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_NLEVELS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_ISIZE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_NUMRIDS_DELETED,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_FULLKEYCARD,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_F4,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_F5,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_F6,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_F7,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_F8,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_REORG_IND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SET v_rc = SQLCODE;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ELSEIF INTEGER(v_db2Release) = 9 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "IF v_db2Release < 9.07 THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "rsCursorInd");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_TABLE_SCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_TABLE_NAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_INDEX_SCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_INDEX_NAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_CARD,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_NLEAF,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_NUM_EMPTY_LEAFS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_NLEVELS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_NUMRIDS_DELETED,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_FULLKEYCARD,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_LEAF_RECSIZE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_NONLEAF_RECSIZE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_LEAF_PAGE_OVERHEAD,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_NONLEAF_PAGE_OVERHEAD,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_F4,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_F5,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_F6,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_F7,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_F8,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_REORG_IND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "SET v_rc = SQLCODE;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ELSE");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "rsCursorInd");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_TABLE_SCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_TABLE_NAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_DATAPARTITIONNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_INDEX_SCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_INDEX_NAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_CARD,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_NLEAF,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_NUM_EMPTY_LEAFS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_NLEVELS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_NUMRIDS_DELETED,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_FULLKEYCARD,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_LEAF_RECSIZE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_NONLEAF_RECSIZE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_LEAF_PAGE_OVERHEAD,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_NONLEAF_PAGE_OVERHEAD,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_F4,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_F5,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_F6,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_F7,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_F8,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(8) + "v_REORG_IND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "SET v_rc = SQLCODE;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ELSE");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameReorg, ddlType, 6, "mode_in", "'objType_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "'tabSchemaPatternExcl_in", "'tabNamePatternExcl_in", "doRunStats_in", "force_in", "reorgLobData_in", "tabCount_out", "failCount_out", null);
M79_Err.genSignalDdlWithParms("dbVersNotSupported", fileNo, 6, null, null, null, null, null, null, null, null, null, "RTRIM(CHAR(v_db2Release))", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "check whether record matches filter criteria and recommends REORG", 6, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IF (UCASE(RTRIM(v_TABLE_SCHEMA))     LIKE COALESCE(UCASE(tabSchemaPattern_in),     '" + M01_Globals.g_allSchemaNamePattern + "')) AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "   (UCASE(v_TABLE_NAME         )     LIKE COALESCE(UCASE(tabNamePattern_in),       '%')) AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "   (UCASE(RTRIM(v_TABLE_SCHEMA)) NOT LIKE COALESCE(UCASE(tabSchemaPatternExcl_in), '' )) AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "   (UCASE(v_TABLE_NAME         ) NOT LIKE COALESCE(UCASE(tabNamePatternExcl_in),   '' )) AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "   ( (v_F5 BETWEEN 0 AND 50) OR (v_F7 >= 20) OR (v_F8 >= 20) )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "SESSION.reorgChk");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "objType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "tableSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "tableName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "indexName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "'I',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_TABLE_SCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_TABLE_NAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "v_INDEX_NAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + ");");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNTIL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_rc <> 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END REPEAT;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CLOSE rsCursorInd;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "ignore index-REORGs for tables not having indexes", 1, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DELETE FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.reorgChk RC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "RC.objType = 'I'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABLES T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "T.TABSCHEMA = RC.tableSchemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "T.TABNAME = RC.tableName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M11_LRT.genProcSectionHeader(fileNo, "determine REORG- and RUNSTATS-statements", 1, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualTempTabNameReorg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "seqNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "numRetries,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "qualTabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_ReorgChk");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "objType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tableSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tableName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tempTsName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "objType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tableSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tableName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tempTsName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SESSION.reorgChk");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "),");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_RunStats");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "onTable,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "onIndex,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tableSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tableName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_dbtBoolean + "(CASE WHEN T.tableName IS NULL THEN 0 ELSE 1 END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_dbtBoolean + "(CASE WHEN I.tableName IS NULL THEN 0 ELSE 1 END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A.tableSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A.tableName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SESSION.reorgChk A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "( SELECT DISTINCT tableSchemaName, tableName FROM SESSION.reorgChk WHERE objType = 'T' ) T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T.tableSchemaName = A.tableSchemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T.tableName = A.tableName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "( SELECT DISTINCT tableSchemaName, tableName FROM SESSION.reorgChk WHERE objType = 'I' ) I");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "I.tableSchemaName = A.tableSchemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "I.tableName = A.tableName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "),");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_Stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "type,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tableSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tableName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "stmt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_dbtEnumId + "(1),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tableSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tableName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CAST(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CASE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "objType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHEN 'T' THEN 'REORG TABLE ' || RTRIM(tableSchemaName) || '.' || RTRIM(tableName) || (CASE WHEN reorgLobData_in = 1 THEN ' LONGLOBDATA' ELSE '' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHEN 'I' THEN 'REORG INDEXES ALL FOR TABLE ' || RTRIM(tableSchemaName) || '.' || RTRIM(tableName)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ELSE CAST(NULL AS VARCHAR(1))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AS VARCHAR(200)) AS STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_ReorgChk");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_dbtEnumId + "(2),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tableSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tableName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CAST(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CASE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN onTable = 1 THEN 'RUNSTATS ON TABLE ' || RTRIM(tableSchemaName) || '.' || RTRIM(tableName) || ' WITH DISTRIBUTION AND DETAILED INDEXES ALL'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "WHEN onIndex = 1 THEN 'RUNSTATS ON TABLE ' || RTRIM(tableSchemaName) || '.' || RTRIM(tableName) || ' FOR DETAILED INDEXES ALL'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AS VARCHAR(400)) AS STMNT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_RunStats");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROWNUMBER() OVER (ORDER BY tableSchemaName ASC, tableName ASC, type ASC, stmt DESC),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "0,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT(tableSchemaName || '.' || tableName, 100),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "stmt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_Stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "COALESCE(doRunStats_in, " + M01_LDM.gc_dbFalse + ") = " + M01_LDM.gc_dbTrue);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "type = 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M11_LRT.genProcSectionHeader(fileNo, "execute REORGs (and RUNSTATs)", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "REPEAT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + qualTempTabNameReorg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "execTime IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "numRetries < v_numRetriesToDo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "numRetries <> -1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FETCH FIRST 1 ROW ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF v_stmntTxt IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmtBegin = CURRENT TIMESTAMP;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_doRetry   = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_doIgnore  = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CALL SYSPROC.ADMIN_CMD(v_stmntTxt);");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF v_doIgnore = 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "UPDATE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + qualTempTabNameReorg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SET");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "numRetries = -1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "statement = v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELSEIF v_doRetry = 1 THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "UPDATE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + qualTempTabNameReorg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SET");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "numRetries = numRetries + 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "statement = v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELSE");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SET v_stmtEnd = CURRENT TIMESTAMP;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "UPDATE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + qualTempTabNameReorg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SET");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "execTime = (TIME('00:00:00') + TIMESTAMPDIFF(2, CHAR(v_stmtEnd - v_stmtBegin)) SECONDS)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "statement = v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "UNTIL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_stmntTxt IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END REPEAT;");

M11_LRT.genProcSectionHeader(fileNo, "determine number of tables failed", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET failCount_out = (SELECT COUNT(DISTINCT qualTabName) FROM " + qualTempTabNameReorg + " WHERE execTime IS NULL AND numRetries <> -1);");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "count number of tables & indexes", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET tabCount_out  = (SELECT COUNT(DISTINCT qualTabName) FROM " + qualTempTabNameReorg + " WHERE numRetries <> -1) - failCount_out;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in < 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CAST(statement AS VARCHAR(150)) AS statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + qualTempTabNameReorg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "seqNo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmntCursor;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSEIF mode_in = 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CAST((CASE WHEN execTime IS NULL THEN '-' ELSE '+' END) AS CHAR(1)) AS F,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CAST(statement AS VARCHAR(150)) AS statement,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "execTime");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + qualTempTabNameReorg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "numRetries <> -1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "seqNo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmntCursor;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameReorg, ddlType, null, "mode_in", "'objType_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "'tabSchemaPatternExcl_in", "'tabNamePatternExcl_in", "doRunStats_in", "force_in", "reorgLobData_in", "tabCount_out", "failCount_out", null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameReorg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "objType_in", "CHAR(1)", true, "(optional) determines the type of objects to REORG ('I' = index, 'T' = table)");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schema of tables to REORG");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "(optional) determines the name of tables to REORG");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPatternExcl_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schemas of tables to exclude from REORG");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePatternExcl_in", M01_Globals.g_dbtDbTableName, true, "(optional) determines the tables to exclude from REORG");
M11_LRT.genProcParm(fileNo, "IN", "doRunStats_in", M01_Globals.g_dbtBoolean, true, "if set to '1': execute RUNSTATS on reorganized tables");
M11_LRT.genProcParm(fileNo, "IN", "force_in", M01_Globals.g_dbtBoolean, true, "if set to '1': REORG all objects, otherwise only those recommended");

M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", true, "number of REORGS on tables");
M11_LRT.genProcParm(fileNo, "OUT", "failCount_out", "INTEGER", false, "number of procedures failed due to lock-timeout");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_failCount", "INTEGER", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameReorg, ddlType, null, "mode_in", "'objType_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "'tabSchemaPatternExcl_in", "'tabNamePatternExcl_in", "doRunStats_in", "force_in", "tabCount_out", null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameReorg + "(mode_in, objType_in, tabSchemaPattern_in, tabNamePattern_in, tabSchemaPatternExcl_in, tabSchemaPatternExcl_in, doRunStats_in, force_in, 0, tabCount_out, v_failCount);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameReorg, ddlType, null, "mode_in", "'objType_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "'tabSchemaPatternExcl_in", "'tabNamePatternExcl_in", "doRunStats_in", "force_in", "tabCount_out", null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for REORG of tables / indexes", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameReorg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "objType_in", "CHAR(1)", true, "(optional) determines the type of objects to REORG ('I' = index, 'T' = table)");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schema of tables to REORG");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "(optional) determines the name of tables to REORG");
M11_LRT.genProcParm(fileNo, "IN", "doRunStats_in", M01_Globals.g_dbtBoolean, true, "if set to '1': execute RUNSTATS on reorganized tables");
M11_LRT.genProcParm(fileNo, "IN", "force_in", M01_Globals.g_dbtBoolean, true, "if set to '1': REORG all objects, otherwise only those recommended");
M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", false, "number of REORGS on tables");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_failCount", "INTEGER", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameReorg, ddlType, null, "mode_in", "'objType_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "doRunStats_in", "force_in", "tabCount_out", null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameReorg + "(mode_in, objType_in, tabSchemaPattern_in, tabNamePattern_in, NULL, NULL, doRunStats_in, force_in, 0, tabCount_out, v_failCount);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameReorg, ddlType, null, "mode_in", "'objType_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "doRunStats_in", "force_in", "tabCount_out", null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for REORG of tables / indexes", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameReorg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schema of tables to REORG");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "(optional) determines the name of tables to REORG");
M11_LRT.genProcParm(fileNo, "IN", "doRunStats_in", M01_Globals.g_dbtBoolean, true, "if set to '1': execute RUNSTATS on reorganized tables");
M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", false, "number of REORGS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_failCount", "INTEGER", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameReorg, ddlType, null, "mode_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "doRunStats_in", "tabCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameReorg + "(mode_in, NULL, tabSchemaPattern_in, tabNamePattern_in, NULL, NULL, doRunStats_in, 0, tabCount_out, v_failCount);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameReorg, ddlType, null, "mode_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "doRunStats_in", "tabCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for REORG of tables / indexes", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameReorg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "doRunStats_in", M01_Globals.g_dbtBoolean, true, "if set to '1': execute RUNSTATS on reorganized tables");
M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", false, "number of REORGS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_failCount", "INTEGER", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameReorg, ddlType, null, "mode_in", "doRunStats_in", "tabCount_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameReorg + "(mode_in, NULL, NULL, NULL, NULL, NULL, doRunStats_in, 0, tabCount_out, v_failCount);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameReorg, ddlType, null, "mode_in", "doRunStats_in", "tabCount_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for REORG of tables / indexes", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameReorg);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", false, "number of REORGS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_failCount", "INTEGER", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameReorg, ddlType, null, "mode_in", "tabCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameReorg + "(mode_in, NULL, NULL, NULL, NULL, NULL, 1, 0, tabCount_out, v_failCount);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameReorg, ddlType, null, "mode_in", "tabCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for retrieving status of statistics
// ####################################################################################################################

String qualProcedureNameGetStats;
qualProcedureNameGetStats = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGetstats, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for retrieving status of statistics", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameGetStats);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas of tables to retrieve status for");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "determines the tables to retrieve status for");
M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", false, "number of tables");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);

M11_LRT.genProcSectionHeader(fileNo, "declare cursor", 1, !(M03_Config.supportSpLogging | ! M03_Config.generateSpLogMessages));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE tabCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CAST(RTRIM(LEFT(TABSCHEMA,30)) AS " + M01_Globals.g_dbtDbSchemaName + ") TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CAST(RTRIM(LEFT(TABNAME,  50)) AS VARCHAR(50)) TABNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "STATS_TIME STATS_TIME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CARD       STATS_CARD");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UCASE(RTRIM(TABSCHEMA)) LIKE COALESCE(UCASE(tabSchemaPattern_in), '" + M01_Globals.g_allSchemaNamePattern + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UCASE(RTRIM(TABNAME)) LIKE COALESCE(UCASE(tabNamePattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameGetStats, ddlType, null, "'tabSchemaPattern_in", "'tabNamePattern_in", "tabCount_out", null, null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output variables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET tabCount_out = (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COUNT(*)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UCASE(RTRIM(TABSCHEMA)) LIKE COALESCE(UCASE(tabSchemaPattern_in), '" + M01_Globals.g_allSchemaNamePattern + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UCASE(RTRIM(TABNAME)) LIKE COALESCE(UCASE(tabNamePattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ");");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "OPEN tabCursor;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameGetStats, ddlType, null, "'tabSchemaPattern_in", "'tabNamePattern_in", "tabCount_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for updating statistics
// ####################################################################################################################

String qualProcedureNameRunstats;
qualProcedureNameRunstats = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRunstats, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for updating statistics", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameRunstats);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas of tables to 'runstats' (default '" + M01_Globals.g_allSchemaNamePattern + "')");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "determines the tables to 'runstats' (default '%')");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPatternExcl_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schemas of tables to exclude from 'runstats'");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePatternExcl_in", M01_Globals.g_dbtDbTableName, true, "(optional) determines the tables to exclude from 'runstats'");

M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", true, "number of tables successfully processed");
M11_LRT.genProcParm(fileNo, "OUT", "failCount_out", "INTEGER", false, "number of tables failed due to lock-timeout");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "cursorAtEnd", "24501", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_lastTabSchema", M01_Globals.g_dbtDbSchemaName, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_lastTabName", M01_Globals.g_dbtDbTableName, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_numRetriesToDo", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_doRetry", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_diagnostics", "VARCHAR(100)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_atEnd", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_retryLoop", "SMALLINT", "1", null, null);
M11_LRT.genVarDecl(fileNo, "SQLCODE", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR cursorAtEnd");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF SQLCODE = -501 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_retryLoop = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_atEnd = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLEXCEPTION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS EXCEPTION 1 v_diagnostics = DB2_TOKEN_STRING;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF SQLCODE = -2310 AND v_diagnostics = '-911' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_doRetry = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF v_numRetriesToDo = " + String.valueOf(M03_Config.numRetriesRunstatsRebindOnLockTimeout) + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET failCount_out = failCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSEIF SQLCODE = -2310 AND v_diagnostics = '-1477' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_numRetriesToDo = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET failCount_out    = failCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameRunstats, ddlType, 3, "mode_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "'tabSchemaPatternExcl_in", "'tabNamePatternExcl_in", "tabCount_out", "failCount_out", null, null, null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RESIGNAL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

String qualTempTabNameRunstats;
qualTempTabNameRunstats = M94_DBAdmin.tempTabNameStatement + "Runstats";
M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 250, null, null, null, null, "Runstats", null, null, true, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameRunstats, ddlType, null, "mode_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "'tabSchemaPatternExcl_in", "'tabNamePatternExcl_in", "tabCount_out", "failCount_out", null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output variables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET tabCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET failCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "since calling RUNSTATS via ADMIN_CMD may close cursors we apply some very cumbersome implementation pattern involving nested loops", 1, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHILE v_retryLoop = 1 DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_retryLoop = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tabLoop: FOR tabLoop AS csr CURSOR WITH HOLD FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA TS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME   TN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UCASE(RTRIM(TABSCHEMA)) LIKE COALESCE(UCASE(tabSchemaPattern_in), '" + M01_Globals.g_allSchemaNamePattern + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UCASE(RTRIM(TABNAME)) LIKE COALESCE(UCASE(tabNamePattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UCASE(RTRIM(TABSCHEMA)) NOT LIKE COALESCE(UCASE(tabSchemaPatternExcl_in), '')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UCASE(RTRIM(TABNAME)) NOT LIKE COALESCE(UCASE(tabNamePatternExcl_in), '')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(v_lastTabSchema is NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(TABSCHEMA > v_lastTabSchema)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(TABSCHEMA = v_lastTabSchema AND TABNAME > v_lastTabName)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "leave or retry loop if requested", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF v_atEnd = 1 OR v_retryLoop = 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LEAVE tabLoop;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_lastTabSchema = TS;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_lastTabName   = TN;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt      = 'RUNSTATS ON TABLE ' || RTRIM(TS) || '.' || RTRIM(TN) || ' WITH DISTRIBUTION ON ALL COLUMNS AND DETAILED INDEXES ALL';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET tabCount_out    = tabCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_numRetriesToDo = " + String.valueOf(M03_Config.numRetriesRunstatsRebindOnLockTimeout) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_doRetry = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHILE v_numRetriesToDo > 0 DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CALL SYSPROC.ADMIN_CMD(v_stmntTxt);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SET v_numRetriesToDo = (CASE v_doRetry WHEN 0 THEN 0 ELSE v_numRetriesToDo - 1 END);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END WHILE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'INSERT INTO " + qualTempTabNameRunstats + "(seqNo, flag, statement) VALUES (' || CHAR(tabCount_out) || ', ''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(11) + " (CASE v_doRetry WHEN 1 THEN '-' ELSE '+' END) || ''', ''' || v_stmntTxt || ''')';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END WHILE;");

M11_LRT.genProcSectionHeader(fileNo, "determine number of successful RUNSTATS", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET tabCount_out = tabCount_out - failCount_out;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "flag AS f,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + qualTempTabNameRunstats);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "seqNo ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmntCursor;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameRunstats, ddlType, null, "mode_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "'tabSchemaPatternExcl_in", "'tabNamePatternExcl_in", "tabCount_out", "failCount_out", null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for updating statistics", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameRunstats);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas of tables to 'runstats'");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "determines the tables to 'runstats'");
M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", false, "number of successfully tables processed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_failCount", "INTEGER", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameRunstats, ddlType, null, "mode_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "tabCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameRunstats + "(mode_in, tabSchemaPattern_in, tabNamePattern_in, NULL, NULL, tabCount_out, v_failCount);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameRunstats, ddlType, null, "mode_in", "'tabSchemaPattern_in", "'tabNamePattern_in", "tabCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for updating statistics", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameRunstats);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", false, "number of tables successfully processed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_failCount", "INTEGER", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameRunstats, ddlType, null, "mode_in", "tabCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameRunstats + "(mode_in, NULL, NULL, NULL, NULL, tabCount_out, v_failCount);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameRunstats, ddlType, null, "mode_in", "tabCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
return;
}

// ####################################################################################################################
// #    SP temporarily disabling triggers
// ####################################################################################################################

String qualProcedureNameTrigDisable;
qualProcedureNameTrigDisable = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnTriggerDisable, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP temporarily disabling triggers", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameTrigDisable);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the table schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "(optional) determines the table names that apply");
M11_LRT.genProcParm(fileNo, "IN", "trigSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the trigger schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "trigNamePattern_in", "VARCHAR(30)", true, "(optional) determines the trigger names that apply");
M11_LRT.genProcParm(fileNo, "IN", "orgId_in", M01_Globals.g_dbtEnumId, true, "(optional) determines the organization owning the tables that apply");
M11_LRT.genProcParm(fileNo, "IN", "accessModeId_in", M01_Globals.g_dbtEnumId, true, "(optional) determines the data pool holding the tables that apply");

M11_LRT.genProcParm(fileNo, "OUT", "trigCount_out", "INTEGER", true, "number of triggers disabled");
M11_LRT.genProcParm(fileNo, "OUT", "failCount_out", "INTEGER", false, "number of triggers failed to disable");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "authFail", "42501", null);
M11_LRT.genCondDecl(fileNo, "invocationFail", "42509", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_returnStatus", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR authFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42501;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR invocationFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42509;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameTrigDisable, ddlType, null, "'tabSchemaPattern_in", "'tabNamePattern_in", "'trigSchemaPattern_in", "'trigNamePattern_in", "orgId_in", "accessModeId_in", "trigCount_out", "failCount_out", null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output variables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET trigCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET failCount_out = 0;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR trigLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T.TRIGSCHEMA AS TS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T.TRIGNAME   AS TN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.TRIGGERS T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " P");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T.TABSCHEMA = P." + M01_Globals.g_anPdmFkSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T.TABNAME = P." + M01_Globals.g_anPdmTableName + "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RTRIM(T.TABSCHEMA) LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RTRIM(T.TRIGSCHEMA) LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RTRIM(T.TABSCHEMA) LIKE COALESCE(UCASE(tabSchemaPattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T.TABNAME LIKE COALESCE(UCASE(tabNamePattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RTRIM(T.TRIGSCHEMA) LIKE COALESCE(UCASE(trigSchemaPattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T.TRIGNAME LIKE COALESCE(UCASE(trigNamePattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(orgId_in IS NULL OR P." + M01_Globals.g_anOrganizationId + " = orgId_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(accessModeId_in IS NULL OR P." + M01_Globals.g_anPoolTypeId + " = accessModeId_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WITH UR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDisabledTriggers);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TRIGSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TRIGNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "QUALIFIER,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FUNCPATH,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TEXT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TR.TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TR.TABNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TR.QUALIFIER,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TR.FUNC_PATH,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CAST(TR.TEXT AS CLOB(2M))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.TRIGGERS TR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TR.TRIGSCHEMA = TS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TR.TRIGNAME = TN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'DROP TRIGGER ' || TS || '.' || TN;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET trigCount_out = trigCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET failCount_out = failCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameTrigDisable, ddlType, null, "'tabSchemaPattern_in", "'tabNamePattern_in", "'trigSchemaPattern_in", "'trigNamePattern_in", "orgId_in", "accessModeId_in", "trigCount_out", "failCount_out", null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
// the rest is not supported for LDM
return;
}

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP temporarily disabling triggers", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameTrigDisable);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "trigSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "trigNamePattern_in", "VARCHAR(30)", true, "(optional) determines the trigger names that apply");

M11_LRT.genProcParm(fileNo, "OUT", "trigCount_out", "INTEGER", true, "number of triggers disabled");
M11_LRT.genProcParm(fileNo, "OUT", "failCount_out", "INTEGER", false, "number of triggers failed to disable");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameTrigDisable + "(NULL, NULL, trigSchemaPattern_in, trigNamePattern_in, NULL, NULL, trigCount_out, failCount_out);");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP enabling disabled triggers
// ####################################################################################################################

String qualProcedureNameTrigEnable;
qualProcedureNameTrigEnable = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnTriggerEnable, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP enabling disabled triggers", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameTrigEnable);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the table schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "(optional) determines the table names that apply");
M11_LRT.genProcParm(fileNo, "IN", "trigSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the trigger schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "trigNamePattern_in", "VARCHAR(30)", true, "(optional) determines the trigger names that apply");
M11_LRT.genProcParm(fileNo, "IN", "orgId_in", M01_Globals.g_dbtEnumId, true, "(optional) determines the organization owning the tables that apply");
M11_LRT.genProcParm(fileNo, "IN", "accessModeId_in", M01_Globals.g_dbtEnumId, true, "(optional) determines the data pool holding the tables that apply");

M11_LRT.genProcParm(fileNo, "OUT", "trigCount_out", "INTEGER", true, "number of triggers sucessfully enabled");
M11_LRT.genProcParm(fileNo, "OUT", "failCount_out", "INTEGER", false, "number of triggers failed to enable");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "triggerAlreadyEnabled", "42710", null);
M11_LRT.genCondDecl(fileNo, "authFail", "42501", null);
M11_LRT.genCondDecl(fileNo, "invocationFail", "42509", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
//  genVarDecl fileNo, "v_qualifier", g_dbtDbSchemaName, "NULL"
//  genVarDecl fileNo, "v_funcPath", "VARCHAR(254)", "NULL"
M11_LRT.genVarDecl(fileNo, "v_curQualifier", M01_Globals.g_dbtDbSchemaName, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_curFuncPath", "VARCHAR(2048)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "CLOB(2448)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_returnStatus", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR triggerAlreadyEnabled");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42710;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR authFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42501;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR invocationFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42509;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameTrigEnable, ddlType, null, "'tabSchemaPattern_in", "'tabNamePattern_in", "'trigSchemaPattern_in", "'trigNamePattern_in", "orgId_in", "accessModeId_in", "trigCount_out", "failCount_out", null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output variables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET trigCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET failCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "save current environment settings", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_curQualifier = CURRENT SCHEMA;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_curFuncPath  = CURRENT FUNCTION PATH;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR trigLoop AS csr CURSOR WITH HOLD FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T.TRIGSCHEMA AS TS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T.TRIGNAME   AS TN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COALESCE(T.QUALIFIER, CURRENT SCHEMA) AS QUALIFIER,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COALESCE(T.FUNCPATH,  CURRENT FUNCTION PATH) AS FUNCPATH,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T.TEXT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDisabledTriggers + " T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " P");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T.TABSCHEMA = P." + M01_Globals.g_anPdmFkSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T.TABNAME = P." + M01_Globals.g_anPdmTableName + "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UCASE(RTRIM(T.TABSCHEMA)) LIKE COALESCE(UCASE(tabSchemaPattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UCASE(RTRIM(T.TABNAME)) LIKE COALESCE(UCASE(tabNamePattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UCASE(RTRIM(T.TRIGSCHEMA)) LIKE COALESCE(UCASE(trigSchemaPattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UCASE(RTRIM(T.TRIGNAME)) LIKE COALESCE(UCASE(trigNamePattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(orgId_in IS NULL OR P." + M01_Globals.g_anOrganizationId + " = orgId_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(accessModeId_in IS NULL OR P." + M01_Globals.g_anPoolTypeId + " = accessModeId_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WITH UR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'SET CURRENT SCHEMA = ' || QUALIFIER;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'SET CURRENT FUNCTION PATH = ' || FUNCPATH;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE TEXT;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET trigCount_out = trigCount_out + 1;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DELETE FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameDisabledTriggers + " TR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TR.TRIGSCHEMA = TS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TR.TRIGNAME = TN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET failCount_out = failCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "reset environment settings", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'SET CURRENT SCHEMA = ' || v_curQualifier;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'SET CURRENT FUNCTION PATH = ' || v_curFuncPath;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "EXECUTE IMMEDIATE v_stmntTxt;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameTrigEnable, ddlType, null, "'tabSchemaPattern_in", "'tabNamePattern_in", "'trigSchemaPattern_in", "'trigNamePattern_in", "orgId_in", "accessModeId_in", "trigCount_out", "failCount_out", null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "RETURN v_returnStatus;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP enabling disabled triggers", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameTrigEnable);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "trigSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "trigNamePattern_in", "VARCHAR(30)", true, "(optional) determines the trigger names that apply");

M11_LRT.genProcParm(fileNo, "OUT", "trigCount_out", "INTEGER", true, "number of triggers sucessfully enabled");
M11_LRT.genProcParm(fileNo, "OUT", "failCount_out", "INTEGER", false, "number of triggers failed to enable");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameTrigEnable + "(NULL, NULL, trigSchemaPattern_in, trigNamePattern_in, NULL, NULL, trigCount_out, failCount_out);");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

if (M03_Config.supportIndexMetrics) {
// ####################################################################################################################
// #    INSERT Trigger maintaining redundant columns in table for 'IndexMetrics'
// ####################################################################################################################

String qualTriggerName;
qualTriggerName = M04_Utilities.genQualTriggerNameByClassIndex(M01_Globals.g_classIndexIndexMetrics, ddlType, null, null, null, null, null, null, null, "INS", M04_Utilities.ObjNameDelimMode.eondmSuffix, null);

M22_Class_Utilities.printSectionHeader("Insert-Trigger for maintaining redundant columns in \"" + M01_Globals.g_qualTabNameIndexMetrics + "\"", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE TRIGGER");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualTriggerName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "AFTER INSERT ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + M01_Globals.g_qualTabNameIndexMetrics);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "REFERENCING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "NEW AS " + M01_Globals.gc_newRecordName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "FOR EACH ROW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN ATOMIC");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(NEWRECORD.INDSCHEMA IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(NEWRECORD.INDNAME IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(NEWRECORD.TABSCHEMA IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(NEWRECORD.TABNAME IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "UPDATE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameIndexMetrics + " IM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IM.INDSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IM.INDNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IM.TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IM.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "=");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IND.INDSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IND.INDNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TAB.TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TAB.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SYSCAT.INDEXES IND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SYSCAT.TABLES TAB");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IND.TABSCHEMA = TAB.TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IND.TABNAME = TAB.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IND.IID = NEWRECORD.INDEXID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TAB.TBSPACEID = NEWRECORD.TBSPACEID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TAB.TABLEID = NEWRECORD.TABLEID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FETCH FIRST 1 ROWS ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IM.TBSPACEID = NEWRECORD.TBSPACEID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IM.TABLEID = NEWRECORD.TABLEID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IM.INDEXID = NEWRECORD.INDEXID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
}
}


private static void genDbAdminDdl7(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (M03_Config.generateFwkTest) {
return;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
// we do not support this for LDM
return;
}

// ####################################################################################################################
// #    SP temporarily disabling indexes
// ####################################################################################################################

String qualProcedureNameIndexDisable;
qualProcedureNameIndexDisable = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnIndexDisable, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP temporarily disabling indexes", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameIndexDisable);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "indexSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the (index resp. table) schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "indexNamePattern_in", "VARCHAR(50)", true, "(optional) determines the index names resp. table names that apply");
if (M03_Config.supportIndexMetrics) {
M11_LRT.genProcParm(fileNo, "IN", "onlyUnUsedIndexes_in", M01_Globals.g_dbtBoolean, true, "if set to 1 disable only 'unused indexes' (wrt. table \"" + M01_Globals.g_qualTabNameIndexMetrics + "\")");
}
M11_LRT.genProcParm(fileNo, "OUT", "indexCount_out", "INTEGER", true, "number of indexes disabled");
M11_LRT.genProcParm(fileNo, "OUT", "failCount_out", "INTEGER", false, "number of indexes failed to disable");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "authFail", "42501", null);
M11_LRT.genCondDecl(fileNo, "invocationFail", "42509", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(2048)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_returnStatus", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR authFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42501;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR invocationFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42509;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

if (M03_Config.supportIndexMetrics) {
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameIndexDisable, ddlType, null, "'indexSchemaPattern_in", "'indexNamePattern_in", "onlyUnUsedIndexes_in", "indexCount_out", "failCount_out", null, null, null, null, null, null, null);
} else {
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameIndexDisable, ddlType, null, "'indexSchemaPattern_in", "'indexNamePattern_in", "indexCount_out", "failCount_out", null, null, null, null, null, null, null, null);
}

M11_LRT.genProcSectionHeader(fileNo, "initialize output variables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET indexCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET failCount_out = 0;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR indexLoop AS indCsr CURSOR WITH HOLD FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IND.INDSCHEMA  AS IS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IND.INDNAME    AS IN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IND.TABSCHEMA  AS TS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IND.TABNAME    AS TN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IND.UNIQUERULE AS UR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.INDEXES IND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.TABLES TAB");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TAB.TABSCHEMA = IND.TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TAB.TABNAME = IND.TABNAME");
if (M03_Config.supportIndexMetrics) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameIndexMetrics + " IM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IM.TABSCHEMA IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IM.TABNAME IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IM.INDSCHEMA IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IM.INDNAME IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TAB.TBSPACEID = IM.TBSPACEID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TAB.TABLEID = IM.TABLEID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IND.IID = IM.INDEXID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TAB.TABSCHEMA = IM.TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TAB.TABNAME = IM.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IND.INDSCHEMA = IM.INDSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IND.INDNAME = IM.INDNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IND.UNIQUERULE NOT IN ('U', 'P')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "((RTRIM(IND.INDSCHEMA) LIKE '" + M01_Globals.g_allSchemaNamePattern + "') OR (RTRIM(IND.TABSCHEMA) LIKE '" + M01_Globals.g_allSchemaNamePattern + "'))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "((RTRIM(IND.INDSCHEMA) LIKE COALESCE(UCASE(indexSchemaPattern_in), '%')) OR (RTRIM(IND.TABSCHEMA) LIKE COALESCE(UCASE(indexSchemaPattern_in), '%')))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "((IND.INDNAME LIKE COALESCE(UCASE(indexNamePattern_in), '%')) OR (IND.TABNAME LIKE COALESCE(UCASE(indexNamePattern_in), '%')))");
if (M03_Config.supportIndexMetrics) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(IM.NUMSCANS = 0 OR COALESCE(onlyUnUsedIndexes_in, 0) <> 1)");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF UR = 'P' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'ALTER TABLE ' || RTRIM(TS) || '.' || RTRIM(TN) || ' ADD CONSTRAINT ' || RTRIM(IN) || ' PRIMARY KEY (';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'CREATE' || (CASE WHEN UR = 'U' THEN ' UNIQUE' ELSE '' END) || ' INDEX ' || RTRIM(IS) || '.' || RTRIM(IN) || ' ON ' || RTRIM(TS) || '.' || RTRIM(TN) || ' (';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR colLoop AS colCsr CURSOR WITH HOLD FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COL.COLNAME  AS CN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COL.COLSEQ   AS CS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COL.COLORDER AS CO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.INDEXCOLUSE COL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COL.INDSCHEMA = IS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COL.INDNAME = IN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COL.COLSEQ");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt || (CASE WHEN CS = 1 THEN '' ELSE ', ' END) || CN || (CASE WHEN CO = 'A' THEN ' ASC' ELSE ' DESC' END);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = v_stmntTxt || ')';");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DELETE FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDisabledIndexes + " DIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DIN.INDSCHEMA = IS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DIN.INDNAME = IN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDisabledIndexes);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INDSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INDNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TEXT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ");");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'DROP INDEX ' || RTRIM(IS) || '.' || RTRIM(IN);");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET indexCount_out = indexCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET failCount_out = failCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DELETE FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameDisabledIndexes + " DIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DIN.INDSCHEMA = IS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DIN.INDNAME = IN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "COMMIT;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

if (M03_Config.supportIndexMetrics) {
M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameIndexDisable, ddlType, null, "'indexSchemaPattern_in", "'indexNamePattern_in", "onlyUnUsedIndexes_in", "indexCount_out", "failCount_out", null, null, null, null, null, null, null);
} else {
M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameIndexDisable, ddlType, null, "'indexSchemaPattern_in", "'indexNamePattern_in", "indexCount_out", "failCount_out", null, null, null, null, null, null, null, null);
}

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "RETURN v_returnStatus;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP enabling disabled indexes
// ####################################################################################################################

String qualProcedureNameIndexEnable;
qualProcedureNameIndexEnable = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnIndexEnable, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP enabling disabled indexes", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameIndexEnable);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "indexSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the (index resp. table) schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "indexNamePattern_in", "VARCHAR(50)", true, "(optional) determines the index names resp. table names that apply");

M11_LRT.genProcParm(fileNo, "OUT", "indexCount_out", "INTEGER", true, "number of indexes sucessfully enabled");
M11_LRT.genProcParm(fileNo, "OUT", "failCount_out", "INTEGER", false, "number of indexes failed to enable");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "indexAlreadyEnabled", "01550", null);
M11_LRT.genCondDecl(fileNo, "authFail", "42501", null);
M11_LRT.genCondDecl(fileNo, "invocationFail", "42509", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "CLOB(70000)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_returnStatus", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR indexAlreadyEnabled");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 01550;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR authFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42501;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR invocationFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42509;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameIndexEnable, ddlType, null, "'indexSchemaPattern_in", "'indexNamePattern_in", "indexCount_out", "failCount_out", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output variables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET indexCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET failCount_out = 0;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR indLoop AS indCsr CURSOR WITH HOLD FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INDSCHEMA AS IS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INDNAME   AS IN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TEXT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDisabledIndexes);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "((UCASE(RTRIM(INDSCHEMA)) LIKE COALESCE(UCASE(indexSchemaPattern_in), '%')) OR (UCASE(RTRIM(TABSCHEMA)) LIKE COALESCE(UCASE(indexSchemaPattern_in), '%')))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "((UCASE(RTRIM(INDNAME)) LIKE COALESCE(UCASE(indexNamePattern_in), '%')) OR (UCASE(RTRIM(TABNAME)) LIKE COALESCE(UCASE(indexNamePattern_in), '%')))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE TEXT;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET indexCount_out = indexCount_out + 1;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DELETE FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameDisabledIndexes + " DIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DIN.INDSCHEMA = IS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DIN.INDNAME = IN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET failCount_out = failCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameIndexEnable, ddlType, null, "'indexSchemaPattern_in", "'indexNamePattern_in", "indexCount_out", "failCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "RETURN v_returnStatus;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP temporarily disabling foreign keys
// ####################################################################################################################

String qualProcedureNameFkDisable;
qualProcedureNameFkDisable = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnFkDisable, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP temporarily disabling foreign Keys", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameFkDisable);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the table schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "(optional) determines the table names that apply");
M11_LRT.genProcParm(fileNo, "IN", "refTabSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schemas of referred tables that apply");
M11_LRT.genProcParm(fileNo, "IN", "refTabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "(optional) determines the names of referred tables that apply");

M11_LRT.genProcParm(fileNo, "OUT", "fkCount_out", "INTEGER", true, "number of foreign keys disabled");
M11_LRT.genProcParm(fileNo, "OUT", "failCount_out", "INTEGER", false, "number of foreign keys failed to disable");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "authFail", "42501", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(2048)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_returnStatus", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR authFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42501;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameFkDisable, ddlType, null, "'tabSchemaPattern_in", "'tabNamePattern_in", "'refTabSchemaPattern_in", "'refTabNamePattern_in", "fkCount_out", "failCount_out", null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output variables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET fkCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET failCount_out = 0;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR fkLoop AS fkCsr CURSOR WITH HOLD FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FK.CONSTNAME    AS CN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FK.TABSCHEMA    AS TS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FK.TABNAME      AS TN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FK.REFTABSCHEMA AS RS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FK.REFTABNAME   AS RN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FK.DELETERULE   AS DR,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FK.UPDATERULE   AS UR,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tc.enforced       AS l_enforced,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tc.enablequeryopt AS l_enablequeryopt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ", LISTAGG( fk_col.colname, ', ') WITHIN GROUP( ORDER BY fk_col.colseq ) AS l_fk_colname");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ", LISTAGG( pk_col.colname, ', ') WITHIN GROUP( ORDER BY pk_col.colseq ) AS l_pk_colname");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.REFERENCES FK");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "syscat.tabconst AS tc");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "fk.constname = tc.constname");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "fk.tabschema = tc.tabschema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "fk.tabname = tc.tabname");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "syscat.keycoluse as fk_col");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "fk.constname = fk_col.constname");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "fk.tabschema = fk_col.tabschema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "fk.tabname   = fk_col.tabname");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "syscat.keycoluse as pk_col");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "fk.refkeyname   = pk_col.constname");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "fk.reftabschema = pk_col.tabschema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "fk.reftabname   = pk_col.tabname");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AND");
M11_LRT.genProcSectionHeader(fileNo, "There must be the same number of foreign key columns as there are in the parent key  See CREATE TABLE references-clause under referential-constraint", 0, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "fk_col.colseq   = pk_col.colseq");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(RTRIM(FK.TABSCHEMA) LIKE '" + M01_Globals.g_allSchemaNamePattern + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(RTRIM(FK.TABSCHEMA) LIKE COALESCE(UCASE(tabSchemaPattern_in), '%'))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(FK.TABNAME LIKE COALESCE(UCASE(tabNamePattern_in), '%'))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(RTRIM(FK.REFTABSCHEMA) LIKE COALESCE(UCASE(refTabSchemaPattern_in), '%'))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(FK.REFTABNAME LIKE COALESCE(UCASE(refTabNamePattern_in), '%'))");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GROUP BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FK.CONSTNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FK.TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FK.TABNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FK.REFTABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FK.REFTABNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FK.DELETERULE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FK.UPDATERULE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tc.enforced,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tc.enablequeryopt");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'ALTER TABLE ' || RTRIM(TS) || '.' || RTRIM(TN) || ' ADD CONSTRAINT ' || RTRIM(CN) || ' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + "'FOREIGN KEY (' || RTRIM( l_fk_colname ) || ') ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(10) + "'REFERENCES ' || RTRIM(RS) || '.' || RTRIM(RN) || ' (' || RTRIM( l_pk_colname ) || ') ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "                 'ON DELETE ' || (CASE DR WHEN 'R' THEN 'RESTRICT' WHEN 'C' THEN 'CASCADE' WHEN 'N' THEN 'SET NULL' ELSE 'NO ACTION' END) || ' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "                 'ON UPDATE ' || (CASE UR WHEN 'R' THEN 'RESTRICT' ELSE 'NO ACTION' END) || ' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "                 CASE l_enforced WHEN 'N' THEN 'NOT ENFORCED' ELSE '' END || ' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "                 CASE l_enablequeryopt WHEN 'N' THEN 'DISABLE QUERY OPTIMIZATION' ELSE '' END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "                 ;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DELETE FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDisabledFks + " DFK");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DFK.TABSCHEMA = TS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DFK.TABNAME = TN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DFK.FKNAME = CN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDisabledFks);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FKNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "REFTABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "REFTABNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TEXT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "CN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ");");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'ALTER TABLE ' || RTRIM(TS) || '.' || RTRIM(TN) || ' DROP CONSTRAINT ' || RTRIM(CN);");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET fkCount_out = fkCount_out + 1;");

M11_LRT.genProcSectionHeader(fileNo, "SMM wohl nicht erforderlich", 0, true);
//  Print #fileNo,
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "--COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET failCount_out = failCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DELETE FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameDisabledFks + " DFK");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DFK.TABSCHEMA = TS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DFK.TABNAME = TN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DFK.FKNAME = CN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "SMM wohl nicht erforderlich", 0, true);
//  Print #fileNo,
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "--COMMIT;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameFkDisable, ddlType, null, "'tabSchemaPattern_in", "'tabNamePattern_in", "'refTabSchemaPattern_in", "'refTabNamePattern_in", "fkCount_out", "failCount_out", null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "RETURN v_returnStatus;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP enabling disabled foreign keys
// ####################################################################################################################

String qualProcedureNameFkEnable;
qualProcedureNameFkEnable = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnFkEnable, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP enabling disabled foreign keys", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameFkEnable);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the table schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "(optional) determines the table names that apply");
M11_LRT.genProcParm(fileNo, "IN", "refTabSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schemas of referred tables that apply");
M11_LRT.genProcParm(fileNo, "IN", "refTabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "(optional) determines the names of referred tables that apply");

M11_LRT.genProcParm(fileNo, "OUT", "fkCount_out", "INTEGER", true, "number of foreign feys sucessfully enabled");
M11_LRT.genProcParm(fileNo, "OUT", "failCount_out", "INTEGER", false, "number of foreign keys failed to enable");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "authFail", "42501", null);
M11_LRT.genCondDecl(fileNo, "fkAlreadyEnabled", "42710", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "CLOB(70000)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_returnStatus", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR fkAlreadyEnabled");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42710;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR authFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42501;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameFkEnable, ddlType, null, "'tabSchemaPattern_in", "'tabNamePattern_in", "'refTabSchemaPattern_in", "'refTabNamePattern_in", "fkCount_out", "failCount_out", null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output variables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET fkCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET failCount_out = 0;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR fkLoop AS indCsr CURSOR WITH HOLD FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FKNAME    AS FK,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABSCHEMA AS TS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABNAME   AS TN,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TEXT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDisabledFks);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UCASE(RTRIM(TABSCHEMA)) LIKE COALESCE(UCASE(tabSchemaPattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UCASE(RTRIM(TABNAME)) LIKE COALESCE(UCASE(tabNamePattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UCASE(RTRIM(REFTABSCHEMA)) LIKE COALESCE(UCASE(refTabSchemaPattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UCASE(RTRIM(REFTABNAME)) LIKE COALESCE(UCASE(refTabNamePattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE TEXT;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET fkCount_out = fkCount_out + 1;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DELETE FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameDisabledFks + " DFK");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DFK.FKNAME = FK");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DFK.TABSCHEMA = TS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DFK.TABNAME = TN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET failCount_out = failCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameFkEnable, ddlType, null, "'tabSchemaPattern_in", "'tabNamePattern_in", "'refTabSchemaPattern_in", "'refTabNamePattern_in", "fkCount_out", "failCount_out", null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "RETURN v_returnStatus;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
}


private static void genDbAdminDdl9(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
return;
}

// ####################################################################################################################
// #    SP temporarily disabling routines
// ####################################################################################################################

String qualProcedureNameRtDisable;
qualProcedureNameRtDisable = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRtDisable, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP temporarily disabling routines", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameRtDisable);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "routineSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schema(s) of routines to disable");
M11_LRT.genProcParm(fileNo, "IN", "routineNamePattern_in", "VARCHAR(50)", true, "(optional) determines the name(s) of routines to disable");
M11_LRT.genProcParm(fileNo, "IN", "refObjSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schema(s) of objects for which to disable dependent routines");
M11_LRT.genProcParm(fileNo, "IN", "refObjNamePattern_in", "VARCHAR(50)", true, "(optional) determines the name(s) of objects for which to disable dependent routines");

M11_LRT.genProcParm(fileNo, "OUT", "rtCount_out", "INTEGER", true, "number of routines disabled");
M11_LRT.genProcParm(fileNo, "OUT", "failCount_out", "INTEGER", false, "number of routines failed to disable");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "authFail", "42501", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(256)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_returnStatus", "INTEGER", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_lastRoutineSchema", M01_Globals.g_dbtDbSchemaName, "''", null, null);
M11_LRT.genVarDecl(fileNo, "v_lastRoutineSpecificName", "VARCHAR(50)", "''", null, null);
M11_LRT.genVarDecl(fileNo, "v_lastRoutineType", "CHAR(1)", "''", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR authFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42501;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M11_LRT.genProcSectionHeader(fileNo, "temporary table for data pool infos", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.ROUTINEDEP");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DRT.ROUTINESCHEMA       AS routineSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DRT.ROUTINENAME         AS routineName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DRT.ROUTINESPECIFICNAME AS routineSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DRT.ROUTINETYPE         AS routineType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DRT.CREATETIMESTAMP     AS routineCreateTime,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DRD.OBJSCHEMA           AS depObjSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DRT.ROUTINESPECIFICNAME AS depObjSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DRD.OBJNAME             AS depObjName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DRD.OBJTYPE             AS depObjType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTEGER(1)              AS depLevel");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDisabledRts + " DRT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameDisabledRtDep + " DRD");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DRT.ROUTINESCHEMA = DRD.ROUTINESCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DRT.ROUTINESPECIFICNAME = DRD.ROUTINESPECIFICNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DRT.ROUTINETYPE = DRD.ROUTINETYPE");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DEFINITION ONLY");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, true, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameRtDisable, ddlType, null, "'routineSchemaPattern_in", "'routineNamePattern_in", "'refObjSchemaPattern_in", "'refObjNamePattern_in", "rtCount_out", "failCount_out", null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output variables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rtCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET failCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "determine routine dependencies", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.ROUTINEDEP");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineCreateTime,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depLevel");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_RoutineDep");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ROUTINESCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ROUTINENAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "BSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "BNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "BTYPE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.ROUTINEDEP");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "BTYPE IN ('F','T')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "BSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_RoutineDepClosure");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depLevel");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "routineSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "routineSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "depObjSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "depObjName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "depObjType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V_RoutineDep");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "C.routineSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "C.routineSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "D.depObjSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "D.depObjName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "D.depObjType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "C.depLevel + 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V_RoutineDep D,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V_RoutineDepClosure C");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "D.routineSchema = C.depObjSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "D.routineSpecificName = C.depObjName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "C.depLevel < 500");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_RoutineDepClosureResolved");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineCreateTime,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depLevel");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V.routineSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "R.ROUTINENAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V.routineSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "R.ROUTINETYPE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "R.CREATE_TIME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V.depObjSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V.depObjName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(CASE V.depObjType WHEN 'F' THEN RD.ROUTINENAME ELSE V.depObjName END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V.depObjType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V.depLevel");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_RoutineDepClosure V");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.ROUTINES R");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V.routineSchema = R.ROUTINESCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V.routineSpecificName = R.SPECIFICNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "R.ROUTINETYPE IN ('F','P')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "R.LANGUAGE = 'SQL'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.ROUTINES RD");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V.depObjSchema = RD.ROUTINESCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V.depObjName = RD.SPECIFICNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V.depObjType = 'F'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RD.ROUTINETYPE IN ('F','P')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RD.LANGUAGE = 'SQL'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineCreateTime,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depLevel");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "V_RoutineDepClosureResolved");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineSchema LIKE COALESCE(routineSchemaPattern_in, '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "routineName LIKE COALESCE(routineNamePattern_in, '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjSchema LIKE COALESCE(refObjSchemaPattern_in, '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "depObjName LIKE COALESCE(refObjNamePattern_in, '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M11_LRT.genProcSectionHeader(fileNo, "disable each routine individually", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR routineLoop AS routineCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.routineSchema       AS c_routineSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.routineName         AS c_routineName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.routineSpecificName AS c_routineSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.routineType         AS c_routineType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "R.TEXT                AS c_routineText,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.routineCreateTime   AS c_routineCreateTime,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.depObjSchema        AS c_depObjSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.depObjSpecificName  AS c_depObjSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.depObjName          AS c_depObjName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.depObjType          AS c_depObjType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.depLevel            AS c_depLevel");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SESSION.ROUTINEDEP D");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.ROUTINES R");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "R.ROUTINESCHEMA = D.routineSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "R.SPECIFICNAME = D.routineSpecificName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "R.ROUTINETYPE = D.routineType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.routineCreateTime DESC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.depLevel DESC");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (v_lastRoutineSchema       <> c_routineSchema      ) OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "   (v_lastRoutineSpecificName <> c_routineSpecificName) OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "   (v_lastRoutineType         <> c_routineType        ) THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_lastRoutineSchema       = c_routineSchema;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_lastRoutineSpecificName = c_routineSpecificName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_lastRoutineType         = c_routineType;");

M11_LRT.genProcSectionHeader(fileNo, "keep track of deleted routine", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DELETE FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameDisabledRtDep + " DRT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DRT.ROUTINESCHEMA = c_routineSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DRT.ROUTINESPECIFICNAME = c_routineSpecificName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DRT.ROUTINETYPE = c_routineType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DELETE FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameDisabledRts + " DRT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DRT.ROUTINESCHEMA = c_routineSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DRT.ROUTINESPECIFICNAME = c_routineSpecificName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DRT.ROUTINETYPE = c_routineType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameDisabledRts);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ROUTINESCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ROUTINENAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ROUTINESPECIFICNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ROUTINETYPE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_anCreateTimestamp + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TEXT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_routineSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_routineName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_routineSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_routineType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_routineCreateTime,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_routineText");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");

M11_LRT.genProcSectionHeader(fileNo, "delete routine", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF c_routineType = 'P' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = 'DROP SPECIFIC PROCEDURE ' || RTRIM(c_routineSchema) || '.' || RTRIM(c_routineSpecificName);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = 'DROP SPECIFIC FUNCTION ' || RTRIM(c_routineSchema) || '.' || RTRIM(c_routineSpecificName);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_failed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET rtCount_out = rtCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET failCount_out = failCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DELETE FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M01_Globals.g_qualTabNameDisabledRtDep + " DRT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "DRT.ROUTINESCHEMA = c_routineSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "DRT.ROUTINESPECIFICNAME = c_routineSpecificName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "DRT.ROUTINETYPE = c_routineType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DELETE FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M01_Globals.g_qualTabNameDisabledRts + " DRT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "DRT.ROUTINESCHEMA = c_routineSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "DRT.ROUTINESPECIFICNAME = c_routineSpecificName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "DRT.ROUTINETYPE = c_routineType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "keep track of deleted routine dependency", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_failed = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameDisabledRtDep);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ROUTINESCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ROUTINESPECIFICNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ROUTINETYPE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OBJSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OBJNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OBJTYPE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_routineSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_routineSpecificName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_routineType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_depObjSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_depObjName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_depObjType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameRtDisable, ddlType, null, "'routineSchemaPattern_in", "'routineNamePattern_in", "'refObjSchemaPattern_in", "'refObjNamePattern_in", "rtCount_out", "failCount_out", null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP altering a table definition (not supported via 'ALTER TABLE')
// ####################################################################################################################

String qualProcedureNameAlterTable;
qualProcedureNameAlterTable = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnAlterTable, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP altering a table definition", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameAlterTable);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "tabSchema_in", M01_Globals.g_dbtDbSchemaName, true, "schema name of the table alter");
M11_LRT.genProcParm(fileNo, "IN", "tabName_in", M01_Globals.g_dbtDbTableName, true, "name of the table to alter");
M11_LRT.genProcParm(fileNo, "IN", "tabDefinition_in", "VARCHAR(4096)", true, "table definition (SQL-code following 'CREATE TABLE <tab> ')");

M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of records maintained in the table");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "tabNotExist", "42704", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "CLOB(8092)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_tabNameTmp", M01_Globals.g_dbtDbTableName, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_colList", "VARCHAR(2048)", "''", null, null);
M11_LRT.genVarDecl(fileNo, "v_rowCount", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR tabNotExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameAlterTable, ddlType, null, "'tabSchema_in", "'tabName_in", "'tabDefinition_in", "rowCount_out", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output variables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "create temporary table", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_tabNameTmp = UPPER(tabSchema_in) || '.TMP_' || UPPER(tabName_in);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'DROP TABLE ' || v_tabNameTmp;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CREATE TABLE ' || v_tabNameTmp || ' LIKE ' || UPPER(tabSchema_in) || '.' || UPPER(tabName_in);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "copy data to temporary table", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO ' || v_tabNameTmp || ' SELECT * FROM ' || UPPER(tabSchema_in) || '.' || UPPER(tabName_in);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "determine set of common columns", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR colLoop AS colCsr CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COL_OLD.COLNAME AS c_colName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.COLUMNS COL_OLD,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.COLUMNS COL_NEW");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COL_OLD.TABSCHEMA = tabSchema_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COL_OLD.TABNAME = tabName_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COL_NEW.TABSCHEMA = tabSchema_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COL_NEW.TABNAME = 'TMP_' || tabName_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COL_NEW.COLNAME = COL_OLD.COLNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COL_OLD.COLNO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_colList = (CASE WHEN v_colList = '' THEN '' ELSE v_colList || ',' END ) || c_colName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "drop table", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'DROP TABLE ' || UPPER(tabSchema_in) || '.' || UPPER(tabName_in);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "-- EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "re-create table", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CREATE TABLE ' || UPPER(tabSchema_in) || '.' || UPPER(tabName_in) || ' ' || tabDefinition_in;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "copy data back", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO ' || UPPER(tabSchema_in) || '.' || UPPER(tabName_in) || '('|| v_colList || ') SELECT '|| v_colList || ' FROM ' || v_tabNameTmp;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "EXECUTE IMMEDIATE v_stmntTxt;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameAlterTable, ddlType, null, "'tabSchema_in", "'tabName_in", "'tabDefinition_in", "rowCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP setting 'APPEND'-mode of tables
// ####################################################################################################################

String qualProcedureNameTabAppend;
qualProcedureNameTabAppend = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnSetTabAppend, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP setting 'APPEND'-mode of tables", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameTabAppend);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "tabSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) determines the schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "(optional) determines the table names that apply");
M11_LRT.genProcParm(fileNo, "IN", "appendMode_in", "INTEGER", true, "determines whether APPEND-mode is ON (1) or OFF (0)");

M11_LRT.genProcParm(fileNo, "OUT", "tabCount_out", "INTEGER", true, "number of tables sucessfully configured");
M11_LRT.genProcParm(fileNo, "OUT", "failCount_out", "INTEGER", false, "number of tables failed to configure");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "authFail", "42501", null);
M11_LRT.genCondDecl(fileNo, "invocationFail", "42509", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "CLOB(70000)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_failed", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_returnStatus", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR authFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42501;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR invocationFail");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_failed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnStatus = 42509;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameTabAppend, ddlType, null, "'tabSchemaPattern_in", "'tabNamePattern_in", "appendMode_in", "tabCount_out", "failCount_out", null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET tabCount_out  = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET failCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "process each table individually", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS tabCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABSCHEMA TS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABNAME   TN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RTRIM(TABSCHEMA) LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RTRIM(TABSCHEMA) LIKE COALESCE(UCASE(tabSchemaPattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "TABNAME LIKE COALESCE(UCASE(tabNamePattern_in), '%')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'ALTER TABLE ' || RTRIM(TS) || '.' || RTRIM(TN) || ' APPEND ' || (CASE appendMode_in WHEN 1 THEN 'ON' ELSE 'OFF' END);");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET tabCount_out  = tabCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "RETURN v_returnStatus;");

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameTabAppend, ddlType, null, "'tabSchemaPattern_in", "'tabNamePattern_in", "appendMode_in", "tabCount_out", "failCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for dropping all database objects except tables
// ####################################################################################################################

String qualProcedureNameStrip;
qualProcedureNameStrip = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnDbStrip, ddlType, null, null, null, null, null, null);

String unqualProcedureNameStrip;
unqualProcedureNameStrip = M04_Utilities.getUnqualObjName(qualProcedureNameStrip);

M22_Class_Utilities.printSectionHeader("SP for dropping all database objects except tables", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameStrip);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "degree_in", "INTEGER", true, "'0' - do NOT drop indexes and primary keys, '1' drop indexes and PKs, too");
M11_LRT.genProcParm(fileNo, "OUT", "objCount_out", "INTEGER", false, "number of objects dropped");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "udfDependency", "42893", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_finished", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(200)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR udfDependency");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_finished = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 200, null, null, null, null, null, null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameStrip, ddlType, null, "mode_in", "degree_in", "objCount_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHILE v_finished = 0 DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_finished = " + M01_LDM.gc_dbTrue + ";");

// ### drop Trigger

M11_LRT.genProcSectionHeader(fileNo, "drop Trigger", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR trigLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TRIGSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TRIGNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TRIGGERS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TRIGSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP TRIGGER ' || RTRIM(TRIGSCHEMA ) || '.' || TRIGNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

// ### drop Views

M11_LRT.genProcSectionHeader(fileNo, "drop Views", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR viewLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VIEWSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VIEWNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.VIEWS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VIEWSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP VIEW ' || RTRIM(VIEWSCHEMA ) || '.' || VIEWNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

// ### drop Procedures

M11_LRT.genProcSectionHeader(fileNo, "drop Procedures", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR procLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PROCSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SPECIFICNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.PROCEDURES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PROCSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LANGUAGE = 'SQL'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "PROCSCHEMA = '" + M01_Globals.g_schemaNameCtoDbAdmin + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "PROCNAME = '" + unqualProcedureNameStrip + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CREATE_TIME DESC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP SPECIFIC PROCEDURE ' || RTRIM(PROCSCHEMA ) || '.' || SPECIFICNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

// ### drop User Defined Functions

M11_LRT.genProcSectionHeader(fileNo, "drop User Defined Functions", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR udfLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FUNCSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SPECIFICNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.FUNCTIONS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FUNCSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CREATE_TIME DESC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP SPECIFIC FUNCTION ' || RTRIM(FUNCSCHEMA ) || '.' || SPECIFICNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

// ### drop Aliases

M11_LRT.genProcSectionHeader(fileNo, "drop Aliases", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR aliasLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TYPE = 'A'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP ALIAS ' || RTRIM(TABSCHEMA ) || '.' || TABNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

// ### drop Indexes

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF degree_in > 0 THEN");
M11_LRT.genProcSectionHeader(fileNo, "drop Indexes", 3, true);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR indLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "INDSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "INDNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SYSCAT.INDEXES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TABSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "INDSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "UNIQUERULE <> 'P'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "INDSCHEMA ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "INDNAME ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = 'DROP INDEX ' || RTRIM(INDSCHEMA ) || '.' || INDNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 5, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END FOR;");

// ### drop Foreign Keys

M11_LRT.genProcSectionHeader(fileNo, "drop Foreign Keys", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR fkLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CONSTNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SYSCAT.TABCONST");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TABSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TYPE = 'F'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TABSCHEMA ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TABNAME ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = 'ALTER TABLE ' || RTRIM(TABSCHEMA ) || '.' || TABNAME || ' DROP FOREIGN KEY ' || CONSTNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 5, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END FOR;");

// ### drop Primary Keys

M11_LRT.genProcSectionHeader(fileNo, "drop Primary Keys", 3, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR pkLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CONSTNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SYSCAT.TABCONST");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TABSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TYPE = 'P'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TABSCHEMA ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "TABNAME ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = 'ALTER TABLE ' || RTRIM(TABSCHEMA ) || '.' || TABNAME || ' DROP PRIMARY KEY';");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 5, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END WHILE;");

// ### return result

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmntCursor;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameStrip, ddlType, null, "mode_in", "degree_in", "objCount_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
}


private static void genDbAdminDdl10(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
return;
}

// ####################################################################################################################
// #    SP for selectively dropping database objects
// ####################################################################################################################

String qualProcedureNameDropObjects;
qualProcedureNameDropObjects = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnDropObjects, ddlType, null, null, null, null, null, null);

String unqualProcedureNameDropObjects;
unqualProcedureNameDropObjects = M04_Utilities.getUnqualObjName(qualProcedureNameDropObjects);
final String tabNameSuffix = "Drop";

boolean useExcludeList;
int i;
for (int i = 1; i <= 2; i++) {
useExcludeList = (i == 2);

M22_Class_Utilities.printSectionHeader("SP for selectively dropping database objects", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameDropObjects);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "objType_in", "VARCHAR(30)", true, "distinguishes between 'FUNCTION', 'PROCEDURE', 'TABLE', ...");
M11_LRT.genProcParm(fileNo, "IN", "objTypeFilter_in", "VARCHAR(50)", true, "(optional) filter specific for 'objType_in', e.g. LANGUAGE-filter for 'PROCEDURE'");
M11_LRT.genProcParm(fileNo, "IN", "objSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) - determines the object schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "objNamePattern_in", "VARCHAR(128)", true, "(optional) - determines the object names that apply");
if (useExcludeList) {
M11_LRT.genProcParm(fileNo, "IN", "objSchemaExclPatList_in", "VARCHAR(1024)", true, "(optional) - determines object schemas that are excluded");
M11_LRT.genProcParm(fileNo, "IN", "objNameExclPatList_in", "VARCHAR(1024)", true, "(optional) - determines object names that are excluded");
} else {
M11_LRT.genProcParm(fileNo, "IN", "objSchemaExclPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) - determines object schemas that are excluded");
M11_LRT.genProcParm(fileNo, "IN", "objNameExclPattern_in", "VARCHAR(128)", true, "(optional) - determines object names that are excluded");
}
M11_LRT.genProcParm(fileNo, "IN", "parentObjSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) - determines the 'parent' object schemas that apply (e.g table schema of a foreign / primary key)");
M11_LRT.genProcParm(fileNo, "IN", "parentObjNamePattern_in", "VARCHAR(128)", true, "(optional) - determines the 'parent' object names that apply");
M11_LRT.genProcParm(fileNo, "IN", "escape_in", "CHAR(1)", true, "(optional) - 'escape'-character used in patterns");
if (useExcludeList) {
M11_LRT.genProcParm(fileNo, "IN", "delim_in", "CHAR(1)", true, "(optional) - 'delimiter'-character used in exclude-lists (default '|')");
}
M11_LRT.genProcParm(fileNo, "OUT", "objCount_out", "INTEGER", true, "number of objects dropped");
M11_LRT.genProcParm(fileNo, "OUT", "objFailCount_out", "INTEGER", false, "number of objects failed to drop");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "objDependent", "42893", null);
M11_LRT.genCondDecl(fileNo, "objInUse", "55006", null);
if (M03_Config.supportSpLogging) {
M11_LRT.genCondDecl(fileNo, "implicitRebindFailed", "56098", null);
M11_LRT.genCondDecl(fileNo, "routineDoesNotExist", "42884", null);
}

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M79_Err.genSigMsgVarDecl(fileNo, null);
M11_LRT.genVarDecl(fileNo, "v_finished", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_objType", "VARCHAR(30)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(200)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_includeCommentCol", M01_Globals.g_dbtBoolean, M01_LDM.gc_dbFalse, null, null);
M11_LRT.genVarDecl(fileNo, "v_escape", "CHAR(1)", "'\\'", null, null);
M11_LRT.genVarDecl(fileNo, "v_dropFailed", M01_Globals.g_dbtBoolean, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_returnCode", "INTEGER", "0", null, null);
M11_LRT.genVarDecl(fileNo, "SQLCODE", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLWARNING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR objDependent");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_dropFailed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnCode = SQLCODE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET objFailCount_out = objFailCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR objInUse");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_dropFailed = " + M01_LDM.gc_dbTrue + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_returnCode = SQLCODE;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET objFailCount_out = objFailCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
if (M03_Config.supportSpLogging) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR implicitRebindFailed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore (SQLLOG does not exist);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR routineDoesNotExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore (SPLOG_EXIT does not exist);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
}

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 200, null, null, null, true, tabNameSuffix, null, null, true, null, null, null, null, null);
if (useExcludeList) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + pc_tempTabNameExcludeSchema);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "schemaName " + M01_Globals.g_dbtDbSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, true, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + pc_tempTabNameExcludeName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "name VARCHAR(128)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, true, null, null);
}

if (useExcludeList) {
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameDropObjects, ddlType, null, "mode_in", "'objType_in", "'objSchemaPattern_in", "'objNamePattern_in", "'objSchemaExclPatList_in", "'objNameExclPatList_in", "'parentObjSchemaPattern_in", "'parentObjNamePattern_in", "escape_in", "delim_in", "objCount_out", null);
} else {
M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameDropObjects, ddlType, null, "mode_in", "'objType_in", "'objSchemaPattern_in", "'objNamePattern_in", "'objSchemaExclPattern_in", "'objNameExclPattern_in", "'parentObjSchemaPattern_in", "'parentObjNamePattern_in", "escape_in", "objCount_out", "objFailCount_out", null);
}

M11_LRT.genProcSectionHeader(fileNo, "initialize parameters and variables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET objCount_out     = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET objFailCount_out = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_objType        = UPPER(REPLACE(objType_in, ' ', ''));");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_escape         = COALESCE(escape_in, v_escape);");

// ### drop Sequence

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF v_objType = 'SEQUENCE' THEN");

if (useExcludeList) {
M11_LRT.genProcSectionHeader(fileNo, "determine sequences to exclude", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR schemaPatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objSchemaExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeSchema);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "schemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.SEQUENCES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQSCHEMA LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR namePatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objNameExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "name");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.SEQUENCES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQNAME LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
}

M11_LRT.genProcSectionHeader(fileNo, "drop Sequences", 2, !(useExcludeList));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR seqLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.SEQUENCES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SEQSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(SEQSCHEMA LIKE COALESCE(objSchemaPattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(SEQNAME LIKE COALESCE(objNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
if (useExcludeList) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeSchema + " ES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ES.schemaName = SEQSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeName + " EN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "EN.Name = SEQNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objSchemaExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(SEQSCHEMA NOT LIKE objSchemaExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objNameExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(SEQNAME NOT LIKE objNameExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(SEQSCHEMA LIKE COALESCE(parentObjSchemaPattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(SEQNAME LIKE COALESCE(parentObjNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_dropFailed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP SEQUENCE ' || RTRIM(SEQSCHEMA ) || '.' || SEQNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement + tabNameSuffix);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FLAG");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE v_dropFailed WHEN 0 THEN '+' ELSE '-' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

// ### drop Trigger

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSEIF v_objType = 'TRIGGER' THEN");
if (useExcludeList) {
M11_LRT.genProcSectionHeader(fileNo, "determine triggers to exclude", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR schemaPatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objSchemaExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeSchema);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "schemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TRIGSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TRIGGERS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TRIGSCHEMA LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR namePatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objNameExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "name");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TRIGNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TRIGGERS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TRIGNAME LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
}

M11_LRT.genProcSectionHeader(fileNo, "drop Trigger", 2, !(useExcludeList));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR trigLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TRIGSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TRIGNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TRIGGERS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TRIGSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TRIGSCHEMA LIKE COALESCE(objSchemaPattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TRIGNAME LIKE COALESCE(objNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
if (useExcludeList) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeSchema + " ES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ES.schemaName = TRIGSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeName + " EN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "EN.Name = TRIGNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objSchemaExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(TRIGSCHEMA NOT LIKE objSchemaExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objNameExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(TRIGNAME NOT LIKE objNameExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TABSCHEMA LIKE COALESCE(parentObjSchemaPattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TABNAME LIKE COALESCE(parentObjNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TRIGSCHEMA ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TRIGNAME   ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_dropFailed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP TRIGGER ' || RTRIM(TRIGSCHEMA ) || '.' || TRIGNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement + tabNameSuffix);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FLAG");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE v_dropFailed WHEN 0 THEN '+' ELSE '-' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

// ### drop Views

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSEIF v_objType = 'VIEW' THEN");
if (useExcludeList) {
M11_LRT.genProcSectionHeader(fileNo, "determine views to exclude", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR schemaPatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objSchemaExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeSchema);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "schemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VIEWSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.VIEWS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VIEWSCHEMA LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR namePatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objNameExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "name");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VIEWNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.VIEWS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VIEWNAME LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
}

M11_LRT.genProcSectionHeader(fileNo, "drop Views", 2, !(useExcludeList));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR viewLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VIEWSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VIEWNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.VIEWS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VIEWSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(VIEWSCHEMA LIKE COALESCE(objSchemaPattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(VIEWNAME LIKE COALESCE(objNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
if (useExcludeList) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeSchema + " ES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ES.schemaName = VIEWSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeName + " EN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "EN.Name = VIEWNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objSchemaExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(VIEWSCHEMA NOT LIKE objSchemaExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objNameExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(VIEWNAME NOT LIKE objNameExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VIEWSCHEMA ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VIEWNAME   ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_dropFailed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP VIEW ' || RTRIM(VIEWSCHEMA ) || '.' || VIEWNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement + tabNameSuffix);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FLAG");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE v_dropFailed WHEN 0 THEN '+' ELSE '-' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

// ### drop Tables

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSEIF v_objType = 'TABLE' THEN");
if (useExcludeList) {
M11_LRT.genProcSectionHeader(fileNo, "determine tables to exclude", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR schemaPatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objSchemaExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeSchema);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "schemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR namePatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objNameExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "name");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
}

M11_LRT.genProcSectionHeader(fileNo, "drop Tables", 2, !(useExcludeList));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR tabLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TYPE = 'T'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TABSCHEMA LIKE COALESCE(objSchemaPattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TABNAME LIKE COALESCE(objNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
if (useExcludeList) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeSchema + " ES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ES.schemaName = TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeName + " EN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "EN.Name = TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objSchemaExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(TABSCHEMA NOT LIKE objSchemaExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objNameExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(TABNAME NOT LIKE objNameExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME   ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_dropFailed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP TABLE ' || RTRIM(TABSCHEMA ) || '.' || TABNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement + tabNameSuffix);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FLAG");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE v_dropFailed WHEN 0 THEN '+' ELSE '-' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

// ### drop Procedures

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSEIF v_objType = 'PROCEDURE' THEN");
if (useExcludeList) {
M11_LRT.genProcSectionHeader(fileNo, "determine procedures to exclude", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR schemaPatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objSchemaExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeSchema);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "schemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PROCSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.PROCEDURES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PROCSCHEMA LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR namePatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objNameExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "name");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PROCNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.PROCEDURES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PROCNAME LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
}

M11_LRT.genProcSectionHeader(fileNo, "drop Procedures", 2, !(useExcludeList));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR procLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PROCSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PROCNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SPECIFICNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.PROCEDURES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PROCSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(PROCSCHEMA LIKE COALESCE(objSchemaPattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(PROCNAME LIKE COALESCE(objNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
if (useExcludeList) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeSchema + " ES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ES.schemaName = PROCSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeName + " EN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "EN.Name = PROCNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objSchemaExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(PROCSCHEMA NOT LIKE objSchemaExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objNameExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(PROCNAME NOT LIKE objNameExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RTRIM(LANGUAGE) LIKE COALESCE(objTypeFilter_in, 'SQL')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "PROCSCHEMA = '" + M01_Globals.g_schemaNameCtoDbAdmin + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "PROCNAME = '" + unqualProcedureNameDropObjects + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PROCSCHEMA ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PROCNAME   ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_dropFailed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP SPECIFIC PROCEDURE ' || RTRIM(PROCSCHEMA ) || '.' || SPECIFICNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement + tabNameSuffix);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "seqNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "statement,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "flag,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "comment");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE v_dropFailed WHEN 0 THEN '+' ELSE '-' END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "LEFT(RTRIM(PROCSCHEMA) || '.' || PROCNAME, 100)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_includeCommentCol = " + M01_LDM.gc_dbTrue + ";");

// ### drop User Defined Functions
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSEIF v_objType = 'FUNCTION' THEN");
if (useExcludeList) {
M11_LRT.genProcSectionHeader(fileNo, "determine functions to exclude", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR schemaPatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objSchemaExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeSchema);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "schemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FUNCSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.FUNCTIONS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FUNCSCHEMA LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR namePatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objNameExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "name");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FUNCNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.FUNCTIONS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FUNCNAME LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
}

M11_LRT.genProcSectionHeader(fileNo, "drop User Defined Functions", 2, !(useExcludeList));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR udfLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FUNCSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FUNCNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SPECIFICNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.FUNCTIONS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FUNCSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(FUNCSCHEMA LIKE COALESCE(objSchemaPattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(FUNCNAME LIKE COALESCE(objNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
if (useExcludeList) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeSchema + " ES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ES.schemaName = FUNCSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeName + " EN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "EN.Name = FUNCNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objSchemaExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(FUNCSCHEMA NOT LIKE objSchemaExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objNameExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(FUNCNAME NOT LIKE objNameExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "RTRIM(LANGUAGE) LIKE COALESCE(objTypeFilter_in, 'SQL')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CREATE_TIME DESC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_dropFailed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP SPECIFIC FUNCTION ' || RTRIM(FUNCSCHEMA ) || '.' || SPECIFICNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement + tabNameSuffix);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "seqNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "statement,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "flag,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "comment");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE v_dropFailed WHEN 0 THEN '+' ELSE '-' END),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "LEFT(RTRIM(FUNCSCHEMA) || '.' || FUNCNAME, 100)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_includeCommentCol = " + M01_LDM.gc_dbTrue + ";");

// ### drop Aliases

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSEIF v_objType = 'ALIAS' THEN");
if (useExcludeList) {
M11_LRT.genProcSectionHeader(fileNo, "determine aliases to exclude", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR schemaPatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objSchemaExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeSchema);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "schemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TYPE = 'A'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR namePatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objNameExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "name");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TYPE = 'A'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
}

M11_LRT.genProcSectionHeader(fileNo, "drop Aliases", 2, !(useExcludeList));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR aliasLoop AS csr CURSOR FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABLES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TYPE = 'A'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TABSCHEMA LIKE COALESCE(objSchemaPattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TABNAME LIKE COALESCE(objNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
if (useExcludeList) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeSchema + " ES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ES.schemaName = TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeName + " EN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "EN.Name = TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objSchemaExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(TABSCHEMA NOT LIKE objSchemaExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objNameExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(TABNAME NOT LIKE objNameExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(BASE_TABSCHEMA LIKE COALESCE(parentObjSchemaPattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(BASE_TABNAME LIKE COALESCE(parentObjNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_dropFailed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP ALIAS ' || RTRIM(TABSCHEMA ) || '.' || TABNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement + tabNameSuffix);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FLAG");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE v_dropFailed WHEN 0 THEN '+' ELSE '-' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

// ### drop Indexes

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSEIF (v_objType = 'INDEX' OR v_objType = 'UNIQUE INDEX') THEN");
if (useExcludeList) {
M11_LRT.genProcSectionHeader(fileNo, "determine indexes to exclude", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR schemaPatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objSchemaExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeSchema);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "schemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INDSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.INDEXES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INDSCHEMA LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR namePatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objNameExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "name");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INDNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.INDEXES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INDNAME LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
}

M11_LRT.genProcSectionHeader(fileNo, "drop Indexes", 2, !(useExcludeList));

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR indLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INDSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INDNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.INDEXES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(INDSCHEMA LIKE COALESCE(objSchemaPattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(INDNAME LIKE COALESCE(objNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
if (useExcludeList) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeSchema + " ES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ES.schemaName = INDSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeName + " EN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "EN.Name = INDNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objSchemaExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(INDSCHEMA NOT LIKE objSchemaExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objNameExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(INDNAME NOT LIKE objNameExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TABSCHEMA LIKE COALESCE(parentObjSchemaPattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TABNAME LIKE COALESCE(parentObjNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(v_objType = 'INDEX' AND UNIQUERULE <> 'P')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(v_objType = 'UNIQUE INDEX' AND UNIQUERULE = 'U')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INDSCHEMA ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INDNAME ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_dropFailed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'DROP INDEX ' || RTRIM(INDSCHEMA ) || '.' || INDNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement + tabNameSuffix);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FLAG");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE v_dropFailed WHEN 0 THEN '+' ELSE '-' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

// ### drop Foreign Keys

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSEIF v_objType = 'FOREIGNKEY' THEN");
if (useExcludeList) {
M11_LRT.genProcSectionHeader(fileNo, "determine foreign key to exclude", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR schemaPatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objSchemaExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeSchema);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "schemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABCONST");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR namePatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objNameExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "name");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABCONST");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
}

M11_LRT.genProcSectionHeader(fileNo, "drop Foreign Keys", 2, !(useExcludeList));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR fkLoop AS csr CURSOR FOR");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CONSTNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABCONST");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(CONSTNAME LIKE COALESCE(objNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TABSCHEMA LIKE COALESCE(parentObjSchemaPattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TABNAME LIKE COALESCE(parentObjNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
if (useExcludeList) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeSchema + " ES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "ES.schemaName = TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeName + " EN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "EN.Name = TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objSchemaExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(TABSCHEMA NOT LIKE objSchemaExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objNameExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(TABNAME NOT LIKE objNameExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TYPE = 'F'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_dropFailed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'ALTER TABLE ' || RTRIM(TABSCHEMA ) || '.' || TABNAME || ' DROP FOREIGN KEY ' || CONSTNAME;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement + tabNameSuffix);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FLAG");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE v_dropFailed WHEN 0 THEN '+' ELSE '-' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

// ### drop Primary Keys

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSEIF v_objType = 'PRIMARYKEY' THEN");
if (useExcludeList) {
M11_LRT.genProcSectionHeader(fileNo, "determine foreign key to exclude", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR schemaPatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objSchemaExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeSchema);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "schemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABCONST");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR namePatternLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM AS c_elem");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE ( " + M01_Globals.g_qualFuncNameStrElems + "(objNameExclPatList_in, CAST(COALESCE(delim_in, '|') AS CHAR(1))) ) AS X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ELEM IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + pc_tempTabNameExcludeName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "name");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CONSTNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABCONST");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CONSTNAME LIKE c_elem ESCAPE escape_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
}

M11_LRT.genProcSectionHeader(fileNo, "drop Primary Keys", 2, !(useExcludeList));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR pkLoop AS csr CURSOR FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CONSTNAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.TABCONST");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA LIKE '" + M01_Globals.g_allSchemaNamePattern + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(CONSTNAME LIKE COALESCE(objNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
if (useExcludeList) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + pc_tempTabNameExcludeName + " EN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "EN.Name = CONSTNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(objNameExclPattern_in IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CONSTNAME NOT LIKE objNameExclPattern_in ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TABSCHEMA LIKE COALESCE(parentObjSchemaPattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(TABNAME LIKE COALESCE(parentObjNamePattern_in, '%') ESCAPE v_escape)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TYPE = 'P'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABSCHEMA ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABNAME ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_dropFailed = " + M01_LDM.gc_dbFalse + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'ALTER TABLE ' || RTRIM(TABSCHEMA ) || '.' || TABNAME || ' DROP PRIMARY KEY';");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET objCount_out = objCount_out + 1;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement + tabNameSuffix);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FLAG");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "objCount_out,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE v_dropFailed WHEN 0 THEN '+' ELSE '-' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSE");

if (useExcludeList) {
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameDropObjects, ddlType, null, "mode_in", "'objType_in", "'objSchemaPattern_in", "'objNamePattern_in", "'objSchemaExclPatList_in", "'objNameExclPatList_in", "'parentObjSchemaPattern_in", "'parentObjNamePattern_in", "escape_in", "delim_in", "objCount_out", null);
} else {
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameDropObjects, ddlType, null, "mode_in", "'objType_in", "'objSchemaPattern_in", "'objNamePattern_in", "'objSchemaExclPattern_in", "'objNameExclPattern_in", "'parentObjSchemaPattern_in", "'parentObjNamePattern_in", "escape_in", "objCount_out", "objFailCount_out", null);
}
M79_Err.genSignalDdlWithParms("objTypeNotSupported", fileNo, 2, null, null, null, null, null, null, null, null, null, "objType_in", null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ### return result

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_includeCommentCol = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "BEGIN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "CAST(FLAG AS CHAR(1)) AS F,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "CAST(RTRIM(LEFT(STATEMENT, 120)) AS VARCHAR(80)) AS STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + M94_DBAdmin.tempTabNameStatement + tabNameSuffix);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 4, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OPEN stmntCursor;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "BEGIN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "CAST(FLAG AS CHAR(1)) AS F,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "CAST(RTRIM(LEFT(STATEMENT, 120)) AS VARCHAR(80)) AS STATEMENT,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "CAST(RTRIM(LEFT(COMMENT,    60)) AS VARCHAR(60)) AS COMMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + M94_DBAdmin.tempTabNameStatement + tabNameSuffix);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 4, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OPEN stmntCursor;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

if (useExcludeList) {
M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameDropObjects, ddlType, null, "mode_in", "'objType_in", "'objSchemaPattern_in", "'objNamePattern_in", "'objSchemaExclPatList_in", "'objNameExclPatList_in", "'parentObjSchemaPattern_in", "'parentObjNamePattern_in", "escape_in", "delim_in", "objCount_out", null);
} else {
M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameDropObjects, ddlType, null, "mode_in", "'objType_in", "'objSchemaPattern_in", "'objNamePattern_in", "'objSchemaExclPattern_in", "'objNameExclPattern_in", "'parentObjSchemaPattern_in", "'parentObjNamePattern_in", "escape_in", "objCount_out", "objFailCount_out", null);
}
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "RETURN v_returnCode;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
}

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for selectively dropping database objects", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameDropObjects);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "objType_in", "VARCHAR(30)", true, "distinguishes between 'FUNCTION', 'PROCEDURE', 'TABLE', ...");
M11_LRT.genProcParm(fileNo, "IN", "objSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) - determines the object schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "objNamePattern_in", "VARCHAR(128)", true, "(optional) - determines the object names that apply");
M11_LRT.genProcParm(fileNo, "IN", "parentObjSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) - determines the 'parent' object schemas that apply (e.g table schema of a foreign / primary key)");
M11_LRT.genProcParm(fileNo, "IN", "parentObjNamePattern_in", "VARCHAR(128)", true, "(optional) - determines the 'parent' object names that apply");
M11_LRT.genProcParm(fileNo, "OUT", "objCount_out", "INTEGER", true, "number of objects dropped");
M11_LRT.genProcParm(fileNo, "OUT", "objFailCount_out", "INTEGER", false, "number of objects failed to drop");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");
M07_SpLogging.genSpLogDecl(fileNo, -1, true);

if (M03_Config.supportSpLogging) {
M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "implicitRebindFailed", "56098", null);
M11_LRT.genCondDecl(fileNo, "routineDoesNotExist", "42884", null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR implicitRebindFailed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore (SQLLOG does not exist);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR routineDoesNotExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore (SPLOG_EXIT does not exist);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
}

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameDropObjects, ddlType, null, "mode_in", "'objType_in", "'objSchemaPattern_in", "'objNamePattern_in", "'parentObjSchemaPattern_in", "'parentObjNamePattern_in", "objCount_out", "objFailCount_out", null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameDropObjects + "(mode_in, objType_in, NULL, objSchemaPattern_in, objNamePattern_in, ");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "NULL, NULL, parentObjSchemaPattern_in, parentObjNamePattern_in, '\\', objCount_out, objFailCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameDropObjects, ddlType, null, "mode_in", "'objType_in", "'objSchemaPattern_in", "'objNamePattern_in", "'parentObjSchemaPattern_in", "'parentObjNamePattern_in", "objCount_out", "objFailCount_out", null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for selectively dropping database objects", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameDropObjects);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "objType_in", "VARCHAR(30)", true, "distinguishes between 'FUNCTION', 'PROCEDURE', 'TABLE', ...");
M11_LRT.genProcParm(fileNo, "IN", "objTypeFilter_in", "VARCHAR(50)", true, "(optional) filter specific for 'objType_in', e.g. LANGUAGE-filter for 'PROCEDURE'");
M11_LRT.genProcParm(fileNo, "IN", "objSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) - determines the object schemas that apply");
M11_LRT.genProcParm(fileNo, "IN", "objNamePattern_in", "VARCHAR(128)", true, "(optional) - determines the object names that apply");
M11_LRT.genProcParm(fileNo, "IN", "parentObjSchemaPattern_in", M01_Globals.g_dbtDbSchemaName, true, "(optional) - determines the 'parent' object schemas that apply (e.g table schema of a foreign / primary key)");
M11_LRT.genProcParm(fileNo, "IN", "parentObjNamePattern_in", "VARCHAR(128)", true, "(optional) - determines the 'parent' object names that apply");
M11_LRT.genProcParm(fileNo, "OUT", "objCount_out", "INTEGER", true, "number of objects dropped");
M11_LRT.genProcParm(fileNo, "OUT", "objFailCount_out", "INTEGER", false, "number of objects failed to drop");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");
M07_SpLogging.genSpLogDecl(fileNo, -1, true);

if (M03_Config.supportSpLogging) {
M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "implicitRebindFailed", "56098", null);
M11_LRT.genCondDecl(fileNo, "routineDoesNotExist", "42884", null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR implicitRebindFailed");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore (SQLLOG does not exist);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR routineDoesNotExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore (SPLOG_EXIT does not exist);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
}

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameDropObjects, ddlType, null, "mode_in", "'objType_in", "'objTypeFilter_in", "'objSchemaPattern_in", "'objNamePattern_in", "'parentObjSchemaPattern_in", "'parentObjNamePattern_in", "objCount_out", "objFailCount_out", null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameDropObjects + "(mode_in, objType_in, objTypeFilter_in, objSchemaPattern_in, objNamePattern_in, ");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "NULL, NULL, parentObjSchemaPattern_in, parentObjNamePattern_in, '\\', objCount_out, objFailCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameDropObjects, ddlType, null, "mode_in", "'objType_in", "'objTypeFilter_in", "'objSchemaPattern_in", "'objNamePattern_in", "'parentObjSchemaPattern_in", "'parentObjNamePattern_in", "objCount_out", "objFailCount_out", null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
}


// ### IF IVK ###
private static void genDbAdminDdl11(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
return;
}

// ####################################################################################################################
// #    SP for cleaning up data inconsistencies
// ####################################################################################################################

String qualProcedureNameDataCleanup;
qualProcedureNameDataCleanup = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnDataInconsCleanup, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for cleaning up data inconsistencies", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameDataCleanup);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "schemaNamePattern_in", M01_Globals.g_dbtDbSchemaName, true, "determines the schemas of tables to cleanup");
M11_LRT.genProcParm(fileNo, "IN", "tabNamePattern_in", M01_Globals.g_dbtDbTableName, true, "determines the tables to cleanup");
M11_LRT.genProcParm(fileNo, "OUT", "stmntCount_out", "INTEGER", true, "number of cleanup-statements");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of rows cleaned up");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_rowCount", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(400)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 400, true, null, null, null, null, null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameDataCleanup, ddlType, null, "mode_in", "'schemaNamePattern_in", "'tabNamePattern_in", "stmntCount_out", "rowCount_out", null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output variables", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET stmntCount_out  = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out    = 0;");

M11_LRT.genProcSectionHeader(fileNo, "cleanup 'dangling LRT-private records'", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS tabCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPR." + M01_Globals.g_anPdmFkSchemaName + " AS c_schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPR." + M01_Globals.g_anPdmTableName + " AS c_privTabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPU." + M01_Globals.g_anPdmTableName + " AS c_pubTabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PLR." + M01_Globals.g_anPdmFkSchemaName + " AS c_lrtSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PLR." + M01_Globals.g_anPdmTableName + " AS c_lrtTableName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " LPR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " LPU");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPR." + M01_Globals.g_anAcmEntitySection + " = LPU." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPR." + M01_Globals.g_anAcmEntityName + " = LPU." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPR." + M01_Globals.g_anAcmEntityType + " = LPU." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPR." + M01_Globals.g_anLdmIsNl + " = LPU." + M01_Globals.g_anLdmIsNl);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPR." + M01_Globals.g_anLdmIsGen + " = LPU." + M01_Globals.g_anLdmIsGen);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPR." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbTrue);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPU." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LPR." + M01_Globals_IVK.g_anLdmIsMqt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " PPR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPR." + M01_Globals.g_anPdmLdmFkSchemaName + " = LPR." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPR." + M01_Globals.g_anPdmLdmFkTableName + " = LPR." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " PPU");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPU." + M01_Globals.g_anPdmLdmFkSchemaName + " = LPU." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPU." + M01_Globals.g_anPdmLdmFkTableName + " = LPU." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPU." + M01_Globals.g_anOrganizationId + " = PPR." + M01_Globals.g_anOrganizationId);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPU." + M01_Globals.g_anPoolTypeId + " = PPR." + M01_Globals.g_anPoolTypeId);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " PLR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PLR." + M01_Globals.g_anOrganizationId + " = PPR." + M01_Globals.g_anOrganizationId);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PLR." + M01_Globals.g_anPoolTypeId + " = PPR." + M01_Globals.g_anPoolTypeId);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " LLR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PLR." + M01_Globals.g_anPdmLdmFkSchemaName + " = LLR." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PLR." + M01_Globals.g_anPdmLdmFkTableName + " = LLR." + M01_Globals.g_anLdmTableName);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LLR." + M01_Globals.g_anAcmEntitySection + " = '" + M22_Class.g_classes.descriptors[M01_Globals.g_classIndexLrt].sectionName.toUpperCase() + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LLR." + M01_Globals.g_anAcmEntityName + " = '" + M22_Class.g_classes.descriptors[M01_Globals.g_classIndexLrt].className.toUpperCase() + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LLR." + M01_Globals.g_anAcmEntityType + " = '" + M01_Globals.gc_acmEntityTypeKeyClass + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LLR." + M01_Globals.g_anLdmIsNl + " = " + M01_LDM.gc_dbFalse);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPU." + M01_Globals.g_anOrganizationId + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PPU." + M01_Globals.g_anPoolTypeId);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'DELETE FROM ' || c_schemaName || '.' || c_privTabName || ' PRIV WHERE EXISTS (SELECT 1 FROM ' || c_lrtSchemaName || '.' || c_lrtTableName || ' LRT' || ' WHERE PRIV." + M01_Globals.g_anInLrt + " = LRT." + M01_Globals.g_anOid + " AND LRT." + M01_Globals.g_anEndTime + " IS NOT NULL)';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET stmntCount_out = stmntCount_out + 1;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO SESSION.statements ( STATEMENT ) VALUES ( v_stmntTxt );");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "count the number of rows cleaned up", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'UPDATE ' || c_schemaName || '.' || c_pubTabName || ' PUB SET PUB." + M01_Globals.g_anInLrt + " = NULL WHERE EXISTS (SELECT 1 FROM ' || c_lrtSchemaName || '.' || c_lrtTableName || ' LRT' || ' WHERE PUB." + M01_Globals.g_anInLrt + " = LRT." + M01_Globals.g_anOid + " AND LRT." + M01_Globals.g_anEndTime + " IS NOT NULL)';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET stmntCount_out = stmntCount_out + 1;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO SESSION.statements ( STATEMENT ) VALUES ( v_stmntTxt );");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "count the number of rows cleaned up", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmntCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M94_DBAdmin.tempTabNameStatement);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmntCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameDataCleanup, ddlType, null, "mode_in", "'schemaNamePattern_in", "'tabNamePattern_in", "stmntCount_out", "rowCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
}

private static void genDbAdminDdlOrgInitDupCode(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}


if (M03_Config.generateFwkTest) {
return;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
return;
}

int thisMpcId;
int thisPoolId;
thisMpcId = M01_Globals.g_primaryOrgIndex;
thisPoolId = M01_Globals.g_workDataPoolIndex;

String qualTabNameMdsUser;
qualTabNameMdsUser = M01_Globals.g_qualTabNameUser;

String qualTabNamePdmOrganizationEnum;
qualTabNamePdmOrganizationEnum = M01_Globals.g_qualTabNamePdmOrganization;

String qualTabNameGenericCode;
qualTabNameGenericCode = M04_Utilities.genQualTabNameByClassIndex(M01_Globals_IVK.g_classIndexGenericCode, ddlType, thisMpcId, thisPoolId, false, false, null, null, null, null, null);

String qualTabNameGenericCodePriv;
qualTabNameGenericCodePriv = M04_Utilities.genQualTabNameByClassIndex(M01_Globals_IVK.g_classIndexGenericCode, ddlType, thisMpcId, thisPoolId, false, true, null, null, null, null, null);

String qualTabNamecodevalidfororganization;
qualTabNamecodevalidfororganization = M04_Utilities.genQualTabNameByRelIndex(M01_Globals_IVK.g_relIndexCodeValidForOrganization, ddlType, thisMpcId, thisPoolId, null, null, null, null, null, null);

String qualTabNamecodevalidfororganizationPriv;
qualTabNamecodevalidfororganizationPriv = M04_Utilities.genQualTabNameByRelIndex(M01_Globals_IVK.g_relIndexCodeValidForOrganization, ddlType, thisMpcId, thisPoolId, true, null, null, null, null, null);

String qualTabNameLrtAffectedEntity;
qualTabNameLrtAffectedEntity = M04_Utilities.genQualTabNameByClassIndex(M01_Globals.g_classIndexLrtAffectedEntity, ddlType, thisMpcId, thisPoolId, null, null, null, null, null, null, null);

String qualTabNameLrt;
String qualTabNameLrtNlText;
String qualTabNameLdmLrt;
int classIndexLrt;
classIndexLrt = M22_Class.getClassIndexByName(M01_ACM.clxnLrt, M01_ACM.clnLrt, null);

qualTabNameLrt = M04_Utilities.genQualTabNameByClassIndex(classIndexLrt, ddlType, thisMpcId, thisPoolId, null, null, null, null, null, null, null);
qualTabNameLrtNlText = M04_Utilities.genQualNlTabNameByClassIndex(classIndexLrt, ddlType, thisMpcId, thisPoolId, null, null, null, null, null, null, null);
qualTabNameLdmLrt = M04_Utilities.genQualTabNameByClassIndex(classIndexLrt, M01_Common.DdlTypeId.edtLdm, thisMpcId, thisPoolId, null, null, null, null, null, null, null);

String qualTabNameProductStructure;
qualTabNameProductStructure = M01_Globals_IVK.g_qualTabNameProductStructure;

String oidSeqName;
oidSeqName = M71_Org.genQualOidSeqNameForOrg(M01_Globals.g_primaryOrgIndex, ddlType, null, null, null, null);

String qualProcNameLrtBegin;
qualProcNameLrtBegin = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexLrt, M01_ACM.spnLrtBegin, ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals.g_workDataPoolIndex, null, null, null, null);

String qualProcNameLrtLock_Genericcode;
qualProcNameLrtLock_Genericcode = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexCode, M01_ACM_IVK.spnLrtLock_Genericcode, ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals.g_workDataPoolIndex, null, null, null, null);

String qualProcNameLrtCommit;
qualProcNameLrtCommit = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexAliasLrt, M01_ACM.spnLrtCommit, ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals.g_workDataPoolIndex, null, null, null, null);


// ####################################################################################################################
// #    SP for initialization of organization's meta data DUP-Code
// ####################################################################################################################

String qualProcedureNameOrgInitDupCode;
qualProcedureNameOrgInitDupCode = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnOrgInitDupCode, ddlType, null, null, null, null, null, null);
//qualProcedureNameOrgInitDupCode = genQualObjName(snDbAdmin, ssnDbAdmin, spnOrgInitDupCode, spsnOrgInitDupCode, ddlType, , , schemaNameInfix)

M22_Class_Utilities.printSectionHeader("SP for initialization of organization's meta data DUP-Code", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameOrgInitDupCode);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "orgId_in", "SMALLINT", true, "ID of the organization to initialize");
M11_LRT.genProcParm(fileNo, "IN", "cdUserId_in", "VARCHAR( 16 )", true, "CD User Id of the mdsUser");
M11_LRT.genProcParm(fileNo, "OUT", "recordCount_out", "INTEGER", false, "number of Codes affected");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, null);
M11_LRT.genCondDecl(fileNo, "routineNotFound", "42884", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_lrtOid", M01_Globals.g_dbtOid, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_rowCount", "INTEGER", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_ignoreError", "SMALLINT", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR( 2000 )", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_gwspError", "VARCHAR(  256 )", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_gwspInfo", "VARCHAR( 1024 )", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_gwspWarning", "VARCHAR(  512 )", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_msg", "VARCHAR(   70 )", "NULL", null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statements", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler for routine not found", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR routineNotFound");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF ( v_ignoreError = 0 ) THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RESIGNAL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M11_LRT.genProcSectionHeader(fileNo, "declare continue handler for SQL-Exceptions", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLEXCEPTION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROLLBACK;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "RESIGNAL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

String tempTabNameStatementOrgInitDupCode;
tempTabNameStatementOrgInitDupCode = M94_DBAdmin.tempTabNameStatement + "OrgInitDupCode";

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 2000, true, true, true, null, "OrgInitDupCode", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "temporary table for Code-OIDs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "session.CodeOids");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "oid           BIGINT,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "cdidiv_oid    BIGINT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, true, true, true);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET recordCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "this procedure is supported starting with DB2 V9.7", null, null);
M11_LRT.genProcSectionHeader(fileNo, "in order to support deployability in earlier DB2-Releases, use dynamic SQL here and ignore error", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_ignoreError = 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CALL SYSPROC.WLM_SET_CLIENT_INFO( '''', '''', '''', NULL, NULL )';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_ignoreError = 0;");

M11_LRT.genProcSectionHeader(fileNo, "make sure we are not initializing a 'built-in' organization", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF ( SELECT 1 FROM " + qualTabNamePdmOrganizationEnum + " WHERE id = orgId_in ) IS NULL THEN");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameOrgInitDupCode, ddlType, 2, "mode_in", "orgId_in", "'orgBusName_in", "defaultCountryId_in", "primaryLanguageId_in", "fallbackLanguageId_in", "recordCount_out", null, null, null, null, null);
M79_Err.genSignalDdlWithParms("orgIdNotValid", fileNo, 2, null, null, null, null, null, null, null, null, null, "RTRIM( CHAR( orgId_in ) )", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF orgId_in < 3 THEN");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameOrgInitDupCode, ddlType, 2, "mode_in", "orgId_in", "'orgBusName_in", "defaultCountryId_in", "primaryLanguageId_in", "fallbackLanguageId_in", "recordCount_out", null, null, null, null, null);
M79_Err.genSignalDdlWithParms("orgIdBuiltIn", fileNo, 2, null, null, null, null, null, null, null, null, null, "RTRIM( CHAR( orgId_in ) )", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "make sure that CD-User is valid", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF ( SELECT 1 FROM " + qualTabNameMdsUser + " WHERE CDUSERID = cdUserId_in ) IS NULL THEN");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameOrgInitDupCode, ddlType, 2, "'codeNumberList_in", "'cdUserId_in", "divOid_in", "recordCount_out", null, null, null, null, null, null, null, null);
M79_Err.genSignalDdlWithParms("userUnknown", fileNo, 2, null, null, null, null, null, null, null, null, null, "cdUserId_in", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "for batch-script: set command options", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitDupCode + "( statement ) VALUES ( 'UPDATE COMMAND OPTIONS USING S ON' );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitDupCode + "( statement ) VALUES ( 'UPDATE COMMAND OPTIONS USING V ON' );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "determine Code-OIDs affected", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "session.CodeOids");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "oid,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "cdidiv_oid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "gc.oid,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "gc.cdidiv_oid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualTabNameGenericCode + " AS gc");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "gc.ctytyp_oid = 140");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "gc.isdeleted = 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "NOT EXISTS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + qualTabNamecodevalidfororganization + " AS cvfo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "cvfo.gco_oid = gc.oid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "cvfo.org_oid = ( SELECT orgoid FROM " + qualTabNamePdmOrganizationEnum + " WHERE id = orgId_in )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M11_LRT.genProcSectionHeader(fileNo, "determine number of affected Codes", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET recordCount_out = ( SELECT COUNT( * ) FROM session.CodeOids );");

M11_LRT.genProcSectionHeader(fileNo, "if no Code is effected, there is nothing to do", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF recordCount_out = 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_msg = RTRIM( LEFT( '[MDS]: No codes to relate to organization', 70 ) );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SIGNAL SQLSTATE '79999' SET MESSAGE_TEXT = v_msg;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "Loop over Devision", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tableLoop AS csr CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT pdidiv_oid AS c_divOid, ");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "MIN( oid ) AS c_psOid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + qualTabNameProductStructure);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GROUP BY pdidiv_oid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");
M11_LRT.genProcSectionHeader(fileNo, "determine Statement", 2, null);
M11_LRT.genProcSectionHeader(fileNo, "begin a new LRT", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'CALL " + qualProcNameLrtBegin + "( ?, ?, ?, ?, ? )';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + tempTabNameStatementOrgInitDupCode + "( statement ) VALUES ( v_stmntTxt );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_lrtOid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "USING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "cdUserId_in,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "1,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "c_psOid,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "lock codes", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR codeOidLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "oid AS c_Oid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "session.CodeOids");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "cdidiv_oid = c_divOid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'CALL " + qualProcNameLrtLock_Genericcode + "( ?, ?, ?, ? )';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO " + tempTabNameStatementOrgInitDupCode + "( statement ) VALUES ( v_stmntTxt );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "v_rowCount");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "USING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "v_lrtOid,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "c_psOid,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "c_Oid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END;");

M11_LRT.genProcSectionHeader(fileNo, "make sure that this Code could be locked", 4, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF v_rowCount = 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "ROLLBACK;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SET v_msg = RTRIM( LEFT( '[MDS]: failed to lock Code(' || RTRIM( CHAR( c_Oid ) ) || ')',  70 ) );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SIGNAL SQLSTATE '79999' SET MESSAGE_TEXT = v_msg;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "create Code-Organization - relationships", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'INSERT INTO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      " + qualTabNamecodevalidfororganizationPriv + " ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'( ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  oid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  inlrt, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  status_id, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  ahclassid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  ahoid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  lrtstate, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  createuser, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  createtimestamp, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  updateuser, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  lastupdatetimestamp, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  org_oid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  gco_oid ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "') ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SELECT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  NEXTVAL FOR " + oidSeqName + ", ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  ' || v_lrtOid || ', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  1, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  gc.ahclassid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  gc.ahoid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  1, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  ''' || cdUserId_in || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  CURRENT TIMESTAMP, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  ''' || cdUserId_in || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  CURRENT TIMESTAMP, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  ( SELECT orgoid FROM " + qualTabNamePdmOrganizationEnum + " WHERE id = ' || orgId_in  || ') AS org_oid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  gc.oid ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  " + qualTabNameGenericCode + " AS gc ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'INNER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  session.CodeOids AS co ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'ON ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  gc.OID = co.OID ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  gc.cdidiv_oid = ' || c_divOid || ' '");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + tempTabNameStatementOrgInitDupCode + "( statement ) VALUES ( v_stmntTxt );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "update Codes (there are only 'affeced' Codes in this LRT)", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'UPDATE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      " + qualTabNameGenericCodePriv + " ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    SET ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      updateuser          = ''' || cdUserId_in || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      lastupdatetimestamp = CURRENT TIMESTAMP, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      lrtstate            = 2, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      versionid           = versionid + 1 ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      inlrt = ' || v_lrtOid || ' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'        AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      cdidiv_oid = ' || c_divOid || ' '");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + tempTabNameStatementOrgInitDupCode + "( statement ) VALUES ( v_stmntTxt );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "register that ACM-Relationship CodeValidForOrganization is affected by this LRT", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'INSERT INTO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      " + qualTabNameLrtAffectedEntity + " ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    ( ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      lrtoid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      orparententityid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      entitytype, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      isgen, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      isnl, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      opid ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    ) ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    VALUES ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    ( ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      ' || v_lrtOid || ', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      ''05005'', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      ''R'', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      0, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      0, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      1 ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    ) '");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + tempTabNameStatementOrgInitDupCode + "( statement ) VALUES ( v_stmntTxt );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "register that ACM-Relationship CodeValidForOrganization is affected by this LRT", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'INSERT INTO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      " + qualTabNameLrtAffectedEntity + " ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    ( ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      lrtoid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      orparententityid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      entitytype, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      isgen, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      isnl, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      opid ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    ) ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    VALUES ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    ( ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      ' || v_lrtOid || ', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      ''05006'', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      ''C'', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      0, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      0, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      2 ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    ) '");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + tempTabNameStatementOrgInitDupCode + "( statement ) VALUES ( v_stmntTxt );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "commit LRT", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'INSERT INTO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      " + qualTabNameLrtNlText + " ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    ( ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      oid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      lrt_oid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      language_id, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      transactioncomment, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      ps_oid ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    ) ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    SELECT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      NEXTVAL FOR " + oidSeqName + ", ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      lrt.OID, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      1, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      ''DUP-Code fr MPC = ' || orgId_in || ' gltig gemacht.'', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      ' || c_psOid || ' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      " + qualTabNameLrt + " AS lrt ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'    WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      lrt.OID = ' || v_lrtOid || ' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'        AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'      lrt.endtime IS NULL '");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + tempTabNameStatementOrgInitDupCode + "( statement ) VALUES ( v_stmntTxt );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "commit LRT", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'CALL " + qualProcNameLrtCommit + "( ?, ?, ?, ?, ?, ? )';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + tempTabNameStatementOrgInitDupCode + "( statement ) VALUES ( v_stmntTxt );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_rowCount,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_gwspError,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_gwspInfo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_gwspWarning");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "USING");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_lrtOid,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmtCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + tempTabNameStatementOrgInitDupCode);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmtCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameOrgInitDupCode);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "orgId_in", "SMALLINT", true, "ID of the organization to initialize");
M11_LRT.genProcParm(fileNo, "IN", "cdUserId_in", "VARCHAR( 16 )", true, "CD User Id of the mdsUser");
M11_LRT.genProcParm(fileNo, "OUT", "recordCount_out", "INTEGER", false, "number of Codes affected");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameOrgInitDupCode + "( 2, orgId_in, cdUserId_in, recordCount_out );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

}

private static void genDbAdminDdlOrgInitMetaBus(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (M03_Config.generateFwkTest) {
return;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
return;
}

String qualTabNamePricePreferencesFac;
qualTabNamePricePreferencesFac = M04_Utilities.genQualTabNameByClassIndex(M01_Globals_IVK.g_classIndexPricePreferences, ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals_IVK.g_productiveDataPoolIndex, null, null, null, null, null, null, null);

String qualProcNameLrtBeginFactory;
qualProcNameLrtBeginFactory = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexLrt, M01_ACM.spnLrtBegin, ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals.g_workDataPoolIndex, null, null, null, null);

String qualProcNameRegStaticInit;
qualProcNameRegStaticInit = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexMeta, M01_ACM_IVK.spnRegStaticInit, ddlType, null, null, null, null, null, null);

String qualSeqNameOid;
qualSeqNameOid = M71_Org.genQualOidSeqNameForOrg(-1, ddlType, null, null, null, null);

// ####################################################################################################################
// #    SP for initialization of organization's meta data
// ####################################################################################################################

String qualProcedureNameOrgInitMeta;
qualProcedureNameOrgInitMeta = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnOrgInitMeta, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for initialization of organization's meta data", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameOrgInitMeta);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "orgId_in", M01_Globals.g_dbtEnumId, true, "ID of the organization to initialize");
M11_LRT.genProcParm(fileNo, "IN", "orgMetaName_in", "VARCHAR(20)", true, "'meta-name' of the organization to initialize");
M11_LRT.genProcParm(fileNo, "OUT", "orgOid_out", M01_Globals.g_dbtOid, true, "OID assigned to this organization");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of records INSERTED");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(2000)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_qualTabName", "VARCHAR(100)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_rowCount", "INTEGER", "0", null, null);
M79_Err.genSigMsgVarDecl(fileNo, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare continue handler for SQL-Exceptions", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLEXCEPTION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROLLBACK;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "RESIGNAL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

String tempTabNameStatementOrgInitMeta;
tempTabNameStatementOrgInitMeta = M94_DBAdmin.tempTabNameStatement + "OrgInitMeta";

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 2000, true, true, true, null, "OrgInitMeta", null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameOrgInitMeta, ddlType, null, "mode_in", "orgId_in", "'orgMetaName_in", "orgOid_out", "rowCount_out", null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "make sure we are not initializing a 'built-in' organization", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF orgId_in IS NULL THEN");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameOrgInitMeta, ddlType, 2, "mode_in", "orgId_in", "'orgMetaName_in", "orgOid_out", "rowCount_out", null, null, null, null, null, null, null);
M79_Err.genSignalDdlWithParms("orgIdNotValid", fileNo, 2, null, null, null, null, null, null, null, null, null, "'NULL'", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF orgId_in < 4 THEN");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameOrgInitMeta, ddlType, 2, "mode_in", "orgId_in", "'orgMetaName_in", "orgOid_out", "rowCount_out", null, null, null, null, null, null, null);
M79_Err.genSignalDdlWithParms("orgIdBuiltIn", fileNo, 2, null, null, null, null, null, null, null, null, null, "RTRIM(CHAR(orgId_in))", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "for batch-script: set command options", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('UPDATE COMMAND OPTIONS USING S ON');");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('UPDATE COMMAND OPTIONS USING X ON');");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('UPDATE COMMAND OPTIONS USING V ON');");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "cleanup meta data - if data exists", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_Tabs");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "seqNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "qualTabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "filterColName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES(1, '" + M01_Globals.g_qualTabNamePdmTable + "', '" + M01_Globals.g_anOrganizationId + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES(2, '" + M01_Globals.g_qualTabNamePdmSchema + "', '" + M01_Globals.g_anOrganizationId + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES(3, '" + M01_Globals.g_qualTabNamePdmPrimarySchema + "', '" + M01_Globals.g_anOrganizationId + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES(4, '" + M01_Globals.g_qualTabNamePdmOrganizationNl + "', 'REF_ID')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "qualTabName AS c_QualTabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "filterColName AS c_filterColName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_Tabs");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "seqNo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'DELETE FROM ' || c_qualTabName || ' WHERE ' || c_filterColName || ' = ' || RTRIM(CHAR(orgId_in));");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "determine OID of new Organization", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "MAX(OID) + " + String.valueOf(M01_LDM.gc_sequenceIncrementValue));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "orgOid_out");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_qualTabNameOrganization);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_anOid + "< 1" + M01_LDM.gc_sequenceMinValue);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WITH UR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET orgOid_out = COALESCE(orgOid_out, NEXTVAL FOR " + qualSeqNameOid + ");");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "setup organization-specific data in \"" + M01_Globals.g_qualTabNamePdmOrganization + "\"", null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'DELETE FROM " + M01_Globals.g_qualTabNamePdmOrganization + " WHERE ID = ' || RTRIM(CHAR(orgId_in));");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO " + M01_Globals.g_qualTabNamePdmOrganization + " (' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'ID,' ||");

M24_Attribute_Utilities.AttributeListTransformation transformation;
M24_Attribute_Utilities.EntityColumnDescriptors tabColumns;
tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 0, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals_IVK.g_enumIndexPdmOrganization, M24_Attribute_Utilities.AcmAttrContainerType.eactEnum, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

int k;
for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + tabColumns.descriptors[k].columnName + (k == tabColumns.numDescriptors ? "" : ",") + "' ||");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "') VALUES (' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "RTRIM(CHAR(orgId_in)) || ',' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 3, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conOrgOid, "RTRIM(CHAR(orgOid_out)) || ','", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conPdmSequenceSchemaName, "'''" + M01_Globals.g_schemaNameCtoMeta + "' || RIGHT(DIGITS(orgId_in), 2) || ''''", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM.conVersionId, "'1'", null, null, null);
M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals_IVK.g_enumIndexPdmOrganization, M24_Attribute_Utilities.AcmAttrContainerType.eactEnum, transformation, tabColumns, fileNo, ddlType, null, null, 3, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M04_Utilities.transformAttrName(tabColumns.descriptors[k].columnName, M24_Attribute_Utilities.AttrValueType.eavtDomain, tabColumns.descriptors[k].dbDomainIndex, transformation, ddlType, null, null, null, true, tabColumns.descriptors[k].acmAttributeIndex, M01_Common.DdlOutputMode.edomList, null, null, null, null) + " ||");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "')';");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "setup organization-specific data in \"" + M01_Globals.g_qualTabNamePdmOrganizationNl + "\"", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO " + M01_Globals.g_qualTabNamePdmOrganizationNl + " (' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 1, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conVersionId, "", null, null, null);
M24_Attribute.genNlsTransformedAttrListForEntityWithColReUse(M01_Globals_IVK.g_enumIndexPdmOrganization, M24_Attribute_Utilities.AcmAttrContainerType.eactEnum, transformation, tabColumns, fileNo, null, null, ddlType, null, null, 2, null, null, null, M01_Common.DdlOutputMode.edomNone, null, null, null, null, null, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + tabColumns.descriptors[k].columnName + (k == tabColumns.numDescriptors ? "" : ",") + "' ||");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "') SELECT ' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 5, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conOid, "'NEXTVAL FOR " + qualSeqNameOid + "'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conEnumRefId, "RTRIM(CHAR(orgId_in))", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM.conEnumLabelText, "'''' || orgMetaName_in || ''''", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 4, M01_ACM.conLanguageId, "'S.ID'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 5, M01_ACM.conVersionId, "", null, null, null);
M24_Attribute.genNlsTransformedAttrListForEntityWithColReUse(M01_Globals_IVK.g_enumIndexPdmOrganization, M24_Attribute_Utilities.AcmAttrContainerType.eactEnum, transformation, tabColumns, fileNo, null, null, ddlType, null, null, 2, null, null, null, M01_Common.DdlOutputMode.edomNone, null, null, null, null, null, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M04_Utilities.transformAttrName(tabColumns.descriptors[k].columnName, M24_Attribute_Utilities.AttrValueType.eavtDomain, tabColumns.descriptors[k].dbDomainIndex, transformation, ddlType, null, null, null, true, tabColumns.descriptors[k].acmAttributeIndex, M01_Common.DdlOutputMode.edomList, null, null, null, null) + " ||" + (k < tabColumns.numDescriptors ? " ',' ||" : ""));
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' FROM " + M21_Enum.getQualTabNameLanguageEnum(null, null, ddlType) + " S';");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "setup organization-specific data in \"" + M01_Globals.g_qualTabNamePdmPrimarySchema + "\"", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO " + M01_Globals.g_qualTabNamePdmPrimarySchema + " (' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 2, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conVersionId, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM_IVK.conIsReportingSchema, "", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals.g_classIndexPdmPrimarySchema, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + tabColumns.descriptors[k].columnName + (k == tabColumns.numDescriptors ? "" : ",") + "' ||");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "') SELECT ' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 11, null, true, null, "'PS.", null, null, null, null, null, null, "'", null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conVersionId, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM_IVK.conIsReportingSchema, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM.conPdmPrimSchemaName, "'LEFT(PS.SCHEMANAME, LENGTH(PS.SCHEMANAME)-3) || ''' || RIGHT(DIGITS(orgId_in), 2) || ''' || RIGHT(PS.SCHEMANAME, 1)'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 4, M01_ACM_IVK.conPsDpFilteredSchemaName, "'LEFT(PS.PSDPFILTEREDSCHEMANAME, LENGTH(PS.PSDPFILTEREDSCHEMANAME)-3) || ''' || RIGHT(DIGITS(orgId_in), 2) || ''' || RIGHT(PS.PSDPFILTEREDSCHEMANAME, 1)'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 5, M01_ACM_IVK.conPsDpFilteredSchemaNameSparte, "'LEFT(PS.PSDPFILTEREDSCHEMANAMESPARTE, LENGTH(PS.PSDPFILTEREDSCHEMANAMESPARTE)-3) || ''' || RIGHT(DIGITS(orgId_in), 2) || ''' || RIGHT(PS.PSDPFILTEREDSCHEMANAMESPARTE, 1)'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 6, M01_ACM_IVK.conPdmDeletedObjectSchemaName, "'LEFT(PS.DELETEDOBJECTSCHEMANAME, LENGTH(PS.DELETEDOBJECTSCHEMANAME)-3) || ''' || RIGHT(DIGITS(orgId_in), 2) || ''' || RIGHT(PS.DELETEDOBJECTSCHEMANAME, 1)'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 7, M01_ACM.conPdmNativeSchemaName, "'LEFT(PS." + M01_Globals.g_anPdmNativeSchemaName + ", LENGTH(PS." + M01_Globals.g_anPdmNativeSchemaName + ")-3) || ''' || RIGHT(DIGITS(orgId_in), 2) || ''' || RIGHT(PS." + M01_Globals.g_anPdmNativeSchemaName + ", 1)'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 8, conPdmPrivateSchemaName, "'LEFT(PS.PRIVATESCHEMANAME, LENGTH(PS.PRIVATESCHEMANAME)-3) || ''' || RIGHT(DIGITS(orgId_in), 2) || ''' || RIGHT(PS.PRIVATESCHEMANAME, 1)'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 9, M01_ACM.conPdmPublicSchemaName, "'LEFT(PS.PUBLICSCHEMANAME, LENGTH(PS.PUBLICSCHEMANAME)-3) || ''' || RIGHT(DIGITS(orgId_in), 2) || ''' || RIGHT(PS.PUBLICSCHEMANAME, 1)'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 10, M01_ACM.conOrganizationId, "RIGHT(DIGITS(orgId_in), 2)", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 11, M01_ACM.conPoolTypeId, "'PS." + M01_Globals.g_anPoolTypeId + "'", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals.g_classIndexPdmPrimarySchema, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M04_Utilities.transformAttrName(tabColumns.descriptors[k].columnName, M24_Attribute_Utilities.AttrValueType.eavtDomain, tabColumns.descriptors[k].dbDomainIndex, transformation, ddlType, null, null, null, true, tabColumns.descriptors[k].acmAttributeIndex, M01_Common.DdlOutputMode.edomList, null, null, null, null) + " ||" + (k < tabColumns.numDescriptors ? " ',' ||" : ""));
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals.g_qualTabNamePdmPrimarySchema + " PS' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' INNER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals.g_qualTabNamePdmOrganization + " PO' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' ON ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'PS." + M01_Globals.g_anOrganizationId + " = PO.ID' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'PO.ID = (SELECT MIN(ID) FROM " + M01_Globals.g_qualTabNamePdmOrganization + " WHERE ID <> " + String.valueOf(M01_Globals.g_primaryOrgId) + ")'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "setup organization-specific data in \"" + M01_Globals.g_qualTabNamePdmSchema + "\"", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO " + M01_Globals.g_qualTabNamePdmSchema + " (' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 1, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conVersionId, "", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals.g_classIndexPdmSchema, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + tabColumns.descriptors[k].columnName + (k == tabColumns.numDescriptors ? "" : ",") + "' ||");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "') SELECT ' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 3, null, true, null, "'PS.", null, null, null, null, null, null, "'", null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conVersionId, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conPdmPrimSchemaName, "'(CASE WHEN " + M01_Globals_IVK.g_qualFuncNameIsNumeric + "(RIGHT(PS.SCHEMANAME,3)) = 1 " + "THEN LEFT(PS.SCHEMANAME, LENGTH(PS.SCHEMANAME)-3) || RIGHT(DIGITS(' || RTRIM(CHAR(orgId_in)) || '), 2) || RIGHT(PS.SCHEMANAME, 1) " + "WHEN " + M01_Globals_IVK.g_qualFuncNameIsNumeric + "(RIGHT(PS.SCHEMANAME,2)) = 1 " + "THEN LEFT(PS.SCHEMANAME, LENGTH(PS.SCHEMANAME)-2) || RIGHT(DIGITS(' || RTRIM(CHAR(orgId_in)) || '), 2) " + "END)'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM.conOrganizationId, "RTRIM(CHAR(orgId_in))", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals.g_classIndexPdmSchema, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M04_Utilities.transformAttrName(tabColumns.descriptors[k].columnName, M24_Attribute_Utilities.AttrValueType.eavtDomain, tabColumns.descriptors[k].dbDomainIndex, transformation, ddlType, null, null, null, true, tabColumns.descriptors[k].acmAttributeIndex, M01_Common.DdlOutputMode.edomList, null, null, null, null) + " ||" + (k < tabColumns.numDescriptors ? " ',' ||" : ""));
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals.g_qualTabNamePdmSchema + " PS' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' INNER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals.g_qualTabNamePdmOrganization + " PO' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' ON ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'PS." + M01_Globals.g_anOrganizationId + " = PO.ID' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'PO.ID = (SELECT MIN(ID) FROM " + M01_Globals.g_qualTabNamePdmOrganization + " WHERE ID <> " + String.valueOf(M01_Globals.g_primaryOrgId) + ")'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "setup organization-specific data in \"" + M01_Globals.g_qualTabNamePdmTable + "\"", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO " + M01_Globals.g_qualTabNamePdmTable + " (' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 1, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conVersionId, "", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals.g_classIndexPdmTable, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + tabColumns.descriptors[k].columnName + (k == tabColumns.numDescriptors ? "" : ",") + "' ||");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "') SELECT ' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 3, null, true, null, "'PT.", null, null, null, null, null, null, "'", null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conVersionId, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conPdmFkSchemaName, "'(CASE WHEN " + M01_Globals_IVK.g_qualFuncNameIsNumeric + "(RIGHT(PT." + M01_Globals.g_anPdmFkSchemaName + ",3)) = 1 " + "THEN LEFT(PT." + M01_Globals.g_anPdmFkSchemaName + ", LENGTH(PT." + M01_Globals.g_anPdmFkSchemaName + ")-3) || RIGHT(DIGITS(' || RTRIM(CHAR(orgId_in)) || '), 2) || RIGHT(PT." + M01_Globals.g_anPdmFkSchemaName + ", 1) " + "WHEN " + M01_Globals_IVK.g_qualFuncNameIsNumeric + "(RIGHT(PT." + M01_Globals.g_anPdmFkSchemaName + ",2)) = 1 " + "THEN LEFT(PT." + M01_Globals.g_anPdmFkSchemaName + ", LENGTH(PT." + M01_Globals.g_anPdmFkSchemaName + ")-2) || RIGHT(DIGITS(' || RTRIM(CHAR(orgId_in)) || '), 2) " + "END)'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM.conOrganizationId, "RTRIM(CHAR(orgId_in))", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals.g_classIndexPdmTable, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M04_Utilities.transformAttrName(tabColumns.descriptors[k].columnName, M24_Attribute_Utilities.AttrValueType.eavtDomain, tabColumns.descriptors[k].dbDomainIndex, transformation, ddlType, null, null, null, true, tabColumns.descriptors[k].acmAttributeIndex, M01_Common.DdlOutputMode.edomList, null, null, null, null) + " ||" + (k < tabColumns.numDescriptors ? " ',' ||" : ""));
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals.g_qualTabNamePdmTable + " PT' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' INNER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals.g_qualTabNamePdmOrganization + " PO' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' ON ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'PT." + M01_Globals.g_anOrganizationId + " = PO.ID' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'PO.ID = (SELECT MIN(ID) FROM " + M01_Globals.g_qualTabNamePdmOrganization + " WHERE ID <> " + String.valueOf(M01_Globals.g_primaryOrgId) + ")'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "verify DDL-deployment for this organization", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P." + M01_Globals.g_anPdmFkSchemaName + " || '.' || P." + M01_Globals.g_anPdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_qualTabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " P");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SYSCAT.TABLES T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P." + M01_Globals.g_anPdmFkSchemaName + " = T.TABSCHEMA");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P." + M01_Globals.g_anPdmTableName + " = T.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P." + M01_Globals.g_anOrganizationId + " = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "T.TABNAME IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FETCH FIRST 1 ROW ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WITH UR;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_qualTabName IS NOT NULL THEN");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameOrgInitMeta, ddlType, 3, "mode_in", "orgId_in", "'orgMetaName_in", "orgOid_out", "rowCount_out", null, null, null, null, null, null, null);
M79_Err.genSignalDdlWithParms("pdmTabNotExist", fileNo, 3, null, null, null, null, null, null, null, null, null, "v_qualTabName", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "create LRT-related ALIASes for organization", null, null);

String qualProcNameCreateLrtAliases;
qualProcNameCreateLrtAliases = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnCreateLrtAliases, ddlType, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CALL " + qualProcNameCreateLrtAliases + "(2, ' || RTRIM(CHAR(orgId_in)) || ', NULL, ?, ?)';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M11_LRT.genProcSectionHeader(fileNo, "declare variables", 3, true);
M11_LRT.genVarDecl(fileNo, "v_aliasCount", "INTEGER", "NULL", 3, null);
M11_LRT.genVarDecl(fileNo, "v_viewCount", "INTEGER", "NULL", 3, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_aliasCount,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_viewCount");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################
M11_LRT.genProcSectionHeader(fileNo, "set GRANTs on new DB-objects", null, null);
String qualProcNameSetGrants;
qualProcNameSetGrants = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "Fltr", M04_Utilities.ObjNameDelimMode.eondmNone, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CALL " + qualProcNameSetGrants + "(2, ''" + M01_Globals.g_allSchemaNamePattern + "' || RIGHT(DIGITS(orgId_in),2) || '%'', NULL, ?)';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M11_LRT.genProcSectionHeader(fileNo, "declare statement", 3, true);
M11_LRT.genVarDecl(fileNo, "v_stmnt", "STATEMENT", null, 3, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_rowCount");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################

if (M03_Config.supportRangePartitioningByPsOid) {
String qualProcedureNameAddTablePartitionByPs;
qualProcedureNameAddTablePartitionByPs = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnAddTablePartitionByPs, ddlType, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "add range partitions for PS-tagged tables in new organization", null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CALL " + qualProcedureNameAddTablePartitionByPs + "(2, ?)';");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M11_LRT.genProcSectionHeader(fileNo, "declare variables", 3, true);
M11_LRT.genVarDecl(fileNo, "v_partitionCount", "INTEGER", "NULL", 3, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_partitionCount");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
}

// ############################################################

if (M03_Config.supportRangePartitioningByDivOid) {
String qualProcedureNameAddTablePartitionByDiv;
qualProcedureNameAddTablePartitionByDiv = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnAddTablePartitionByDiv, ddlType, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "add range partitions for Division-tagged tables in new organization", null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CALL " + qualProcedureNameAddTablePartitionByDiv + "(2, ?)';");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitMeta + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M11_LRT.genProcSectionHeader(fileNo, "declare variables", 3, true);
M11_LRT.genVarDecl(fileNo, "v_partitionCount", "INTEGER", "NULL", 3, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_partitionCount");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
}

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmtCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + tempTabNameStatementOrgInitMeta);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmtCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameOrgInitMeta, ddlType, null, "mode_in", "orgId_in", "'orgMetaName_in", "orgOid_out", "rowCount_out", null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################
// #    SP for initialization of organization's business data
// ####################################################################################################################

String qualProcedureNameOrgInitBus;
qualProcedureNameOrgInitBus = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnOrgInitBus, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for initialization of organization's business data", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameOrgInitBus);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "orgId_in", M01_Globals.g_dbtEnumId, true, "ID of the organization to initialize");
M11_LRT.genProcParm(fileNo, "IN", "orgBusName_in", "VARCHAR(255)", true, "business Name of the organization to initialize");
M11_LRT.genProcParm(fileNo, "IN", "defaultCountryId_in", M01_Globals.g_dbtEnumId, true, "ID of the organization's default country");
M11_LRT.genProcParm(fileNo, "IN", "primaryLanguageId_in", M01_Globals.g_dbtEnumId, true, "ID of the organization's primary language");
M11_LRT.genProcParm(fileNo, "IN", "fallbackLanguageId_in", M01_Globals.g_dbtEnumId, true, "ID of the organization's fallback language");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of records INSERTED / UPDATED");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(2000)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_defaultCountryOid", M01_Globals.g_dbtOid, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_orgOid", M01_Globals.g_dbtOid, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_rowCount", "INTEGER", "0", null, null);
M79_Err.genSigMsgVarDecl(fileNo, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare continue handler for SQL-Exceptions", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLEXCEPTION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROLLBACK;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "RESIGNAL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameOrgInitBus, ddlType, null, "mode_in", "orgId_in", "'orgBusName_in", "defaultCountryId_in", "primaryLanguageId_in", "fallbackLanguageId_in", "rowCount_out", null, null, null, null, null);

String tempTabNameStatementOrgInitBus;
tempTabNameStatementOrgInitBus = M94_DBAdmin.tempTabNameStatement + "OrgInitBus";

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 2000, true, true, true, null, "OrgInitBus", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "make sure we are not initializing a 'built-in' organization", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF orgId_in IS NULL THEN");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameOrgInitBus, ddlType, 2, "mode_in", "orgId_in", "'orgBusName_in", "defaultCountryId_in", "primaryLanguageId_in", "fallbackLanguageId_in", "rowCount_out", null, null, null, null, null);
M79_Err.genSignalDdlWithParms("orgIdNotValid", fileNo, 2, null, null, null, null, null, null, null, null, null, "'NULL'", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF orgId_in < 4 THEN");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameOrgInitBus, ddlType, 2, "mode_in", "orgId_in", "'orgBusName_in", "defaultCountryId_in", "primaryLanguageId_in", "fallbackLanguageId_in", "rowCount_out", null, null, null, null, null);
M79_Err.genSignalDdlWithParms("orgIdBuiltIn", fileNo, 2, null, null, null, null, null, null, null, null, null, "RTRIM(CHAR(orgId_in))", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "make sure that business name of the organization is new", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF ( SELECT 1 FROM " + M01_Globals.g_qualTabNameOrganization + " WHERE name = orgBusName_in ) IS NOT NULL THEN");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameOrgInitBus, ddlType, 2, "mode_in", "orgId_in", "'orgBusName_in", "defaultCountryId_in", "primaryLanguageId_in", "fallbackLanguageId_in", "rowCount_out", null, null, null, null, null);
M79_Err.genSignalDdlWithParms("orgBusNameIn", fileNo, 2, null, null, null, null, null, null, null, null, null, "RTRIM( orgBusName_in )", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

String qualProcNameAssertRebateDefault;
qualProcNameAssertRebateDefault = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexMeta, M01_ACM_IVK.spnAssertRebateDefault, ddlType, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "make sure that each ProductStructure has a default rebate (for type)", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR psLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_anOid + " AS c_psOid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals_IVK.g_qualTabNameProductStructure);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals_IVK.g_anIsUnderConstruction + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CALL " + qualProcNameAssertRebateDefault + "(c_psOid, 0);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "determine OID of new Organization", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORGOID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "v_orgOid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_qualTabNamePdmOrganization);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ID = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WITH UR;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF v_orgOid IS NULL THEN");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameOrgInitBus, ddlType, 2, "mode_in", "orgId_in", "'orgBusName_in", "defaultCountryId_in", "primaryLanguageId_in", "fallbackLanguageId_in", "rowCount_out", null, null, null, null, null);
M79_Err.genSignalDdlWithParms("orgIdNotValid", fileNo, 2, null, null, null, null, null, null, null, null, null, "RTRIM(CHAR(orgId_in))", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "determine OID of the default country", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "C." + M01_Globals.g_anOid);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "v_defaultCountryOid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M04_Utilities.genQualTabNameByClassIndex(M01_Globals_IVK.g_classIndexCountrySpec, ddlType, null, null, null, null, null, null, null, null, null) + " C");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "C.ID = defaultCountryId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "C." + M01_Globals.g_anCid + " = '" + M22_Class.getClassIdStrByIndex(M01_Globals_IVK.g_classIndexCountry) + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WITH UR;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF v_defaultCountryOid IS NULL THEN");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameOrgInitBus, ddlType, 2, "mode_in", "orgId_in", "'orgBusName_in", "defaultCountryId_in", "primaryLanguageId_in", "fallbackLanguageId_in", "rowCount_out", null, null, null, null, null);
M79_Err.genSignalDdlWithParms("countryIdNotValid", fileNo, 2, null, null, null, null, null, null, null, null, null, "RTRIM(CHAR(defaultCountryId_in))", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "for batch-script: set command options", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES ('UPDATE COMMAND OPTIONS USING S ON');");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES ('UPDATE COMMAND OPTIONS USING X ON');");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES ('UPDATE COMMAND OPTIONS USING V ON');");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "cleanup meta data - if data exists", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_Tabs");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "seqNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "qualTabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "filterColName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "filterSet");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES(1, '" + M01_Globals_IVK.g_qualTabNameLanguageSequenceElement + "', 'LSESEQ_OID', 'SELECT OID FROM " + M01_Globals_IVK.g_qualTabNameLanguageSequence + " WHERE LASFOR_OID = ' || RTRIM(CHAR(v_orgOid)))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES(2, '" + M01_Globals_IVK.g_qualTabNameLanguageSequence + "', 'LASFOR_OID', RTRIM(CHAR(v_orgOid)))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES(3, '" + M01_Globals.g_qualTabNameDataPool + "', 'DPOORG_OID', RTRIM(CHAR(v_orgOid)))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES(4, '" + M01_Globals.g_qualTabNameOrganization + "', 'OID', RTRIM(CHAR(v_orgOid)))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "qualTabName AS c_qualTabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "filterColName AS c_filterColName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "filterSet AS c_filterSet");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_Tabs");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "seqNo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'DELETE FROM ' || c_qualTabName || ' WHERE ' || c_filterColName || ' IN (' || c_filterSet || ')';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "setup organization-specific data in \"" + M01_Globals.g_qualTabNameOrganization + "\"", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO " + M01_Globals.g_qualTabNameOrganization + " (' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 4, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conCreateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conUpdateUser, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM.conLastUpdateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 4, M01_ACM.conVersionId, "", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals.g_classIndexOrganization, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + tabColumns.descriptors[k].columnName + (k == tabColumns.numDescriptors ? "" : ",") + "' ||");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "') VALUES (' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 13, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conCreateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conUpdateUser, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM.conLastUpdateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 4, M01_ACM.conVersionId, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 5, M01_ACM.conOid, "RTRIM(CHAR(v_orgOid))", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 6, M01_ACM_IVK.conName, "'''' || orgBusName_in || ''''", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 7, M01_ACM_IVK.conIsMpc, "'1'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 8, M01_ACM_IVK.conIsDcVd, "'0'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 9, M01_ACM.conPrimaryLanguage, "RTRIM(CHAR(primaryLanguageId_in))", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 10, M01_ACM.conFallBackLanguage, "RTRIM(CHAR(fallbackLanguageId_in))", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 11, "LASTARCHIVEDATE", "'NULL'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 12, "DFCHDC_OID", "RTRIM(CHAR(v_defaultCountryOid))", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 13, M01_ACM.conCreateUser, "'''' || RTRIM(CURRENT USER) || ''''", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals.g_classIndexOrganization, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M04_Utilities.transformAttrName(tabColumns.descriptors[k].columnName, M24_Attribute_Utilities.AttrValueType.eavtDomain, tabColumns.descriptors[k].dbDomainIndex, transformation, ddlType, null, null, null, true, tabColumns.descriptors[k].acmAttributeIndex, M01_Common.DdlOutputMode.edomList, null, null, null, null) + " ||" + (k < tabColumns.numDescriptors ? " ',' ||" : ""));
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "')';");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "setup organization-specific data in \"" + M01_Globals.g_qualTabNameDataPool + "\"", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO " + M01_Globals.g_qualTabNameDataPool + " (' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 5, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conCreateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conUpdateUser, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM.conLastUpdateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 4, M01_ACM.conVersionId, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 5, M01_ACM_IVK.conPaiEntitlementGroupId, "", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals.g_classIndexDataPool, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + tabColumns.descriptors[k].columnName + (k == tabColumns.numDescriptors ? "" : ",") + "' ||");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "') SELECT ' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 8, null, true, null, "'DP.", null, null, null, null, null, null, "'", null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conCreateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conUpdateUser, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM.conLastUpdateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 4, M01_ACM.conVersionId, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 5, M01_ACM.conOid, "'NEXTVAL FOR " + qualSeqNameOid + "'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 6, M01_ACM_IVK.conPaiEntitlementGroupId, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 7, "DPOORG_OID", "RTRIM(CHAR(v_orgOid))", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 8, M01_ACM.conCreateUser, "'''' || RTRIM(CURRENT USER) || ''''", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals.g_classIndexDataPool, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M04_Utilities.transformAttrName(tabColumns.descriptors[k].columnName, M24_Attribute_Utilities.AttrValueType.eavtDomain, tabColumns.descriptors[k].dbDomainIndex, transformation, ddlType, null, null, null, true, tabColumns.descriptors[k].acmAttributeIndex, M01_Common.DdlOutputMode.edomList, null, null, null, null) + " ||" + (k < tabColumns.numDescriptors ? " ',' ||" : ""));
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals.g_qualTabNameDataPool + " DP' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' INNER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals.g_qualTabNamePdmOrganization + " PO' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' ON ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'DP.DPOORG_OID = PO.ORGOID' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'PO.ID = " + String.valueOf(M01_Globals.g_primaryOrgId) + "' ");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");


// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "initialize PS-related data in table \"" + M01_Globals_IVK.g_qualTabNameRegistryStatic + "\"", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcNameRegStaticInit + "(v_orgOid, NULL, NULL, v_rowCount);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = rowCount_out + v_rowCount;");


// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "setup organization-specific data in \"" + M01_Globals_IVK.g_qualTabNameLanguageSequence + "\"", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO " + M01_Globals_IVK.g_qualTabNameLanguageSequence + " (' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 1, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conVersionId, "", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals_IVK.g_classIndexLanguageSequence, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + tabColumns.descriptors[k].columnName + (k == tabColumns.numDescriptors ? "" : ",") + "' ||");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "') SELECT ' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 3, null, true, null, "'LS.", null, null, null, null, null, null, "'", null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conVersionId, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conOid, "'NEXTVAL FOR " + qualSeqNameOid + "'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, "LASFOR_OID", "RTRIM(CHAR(v_orgOid))", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals_IVK.g_classIndexLanguageSequence, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M04_Utilities.transformAttrName(tabColumns.descriptors[k].columnName, M24_Attribute_Utilities.AttrValueType.eavtDomain, tabColumns.descriptors[k].dbDomainIndex, transformation, ddlType, null, null, null, true, tabColumns.descriptors[k].acmAttributeIndex, M01_Common.DdlOutputMode.edomList, null, null, null, null) + " ||" + (k < tabColumns.numDescriptors ? " ',' ||" : ""));
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals_IVK.g_qualTabNameLanguageSequence + " LS' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' INNER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals.g_qualTabNamePdmOrganization + " PO' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' ON ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'LS.LASFOR_OID = PO.ORGOID' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'PO.ID = (SELECT MIN(ID) FROM " + M01_Globals.g_qualTabNamePdmOrganization + ")'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "setup organization-specific data in \"" + M01_Globals_IVK.g_qualTabNameLanguageSequenceElement + "\"", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO " + M01_Globals_IVK.g_qualTabNameLanguageSequenceElement + " (' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 1, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conVersionId, "", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals_IVK.g_classIndexLanguageSequenceElement, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + tabColumns.descriptors[k].columnName + (k == tabColumns.numDescriptors ? "" : ",") + "' ||");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "') SELECT ' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 3, null, true, null, "'LSE.", null, null, null, null, null, null, "'", null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conVersionId, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conOid, "'NEXTVAL FOR " + qualSeqNameOid + "'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, "LSESEQ_OID", "'LS_T." + M01_Globals.g_anOid + "'", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals_IVK.g_classIndexLanguageSequenceElement, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M04_Utilities.transformAttrName(tabColumns.descriptors[k].columnName, M24_Attribute_Utilities.AttrValueType.eavtDomain, tabColumns.descriptors[k].dbDomainIndex, transformation, ddlType, null, null, null, true, tabColumns.descriptors[k].acmAttributeIndex, M01_Common.DdlOutputMode.edomList, null, null, null, null) + " ||" + (k < tabColumns.numDescriptors ? " ',' ||" : ""));
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals_IVK.g_qualTabNameLanguageSequenceElement + " LSE' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' INNER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals_IVK.g_qualTabNameLanguageSequence + " LS_S' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' ON ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'LSE.LSESEQ_OID = LS_S." + M01_Globals.g_anOid + "' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' INNER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals_IVK.g_qualTabNameLanguageSequence + " LS_T' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' ON ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'LS_S.TYPE_ID = LS_T.TYPE_ID' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' INNER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals.g_qualTabNamePdmOrganization + " PO' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' ON ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'LS_S.LASFOR_OID = PO.ORGOID' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'PO.ID = (SELECT MIN(ID) FROM " + M01_Globals.g_qualTabNamePdmOrganization + ")' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "' AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'LS_T.LASFOR_OID = ' || RTRIM(CHAR(v_orgOid))");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################
M11_LRT.genProcSectionHeader(fileNo, "setup organization-specific data in \"" + M04_Utilities.getUnqualObjName(M01_Globals_IVK.g_qualTabNamePricePreferencesCto) + "\"", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO " + M04_Utilities.getSchemaName(M01_Globals_IVK.g_qualTabNamePricePreferencesCto) + "' || RIGHT(DIGITS(orgId_in),2) || '." + M04_Utilities.getUnqualObjName(M01_Globals_IVK.g_qualTabNamePricePreferencesCto) + "(' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 1, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conVersionId, "", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals_IVK.g_classIndexPricePreferences, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, M01_Globals.g_primaryOrgIndex, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + tabColumns.descriptors[k].columnName + (k == tabColumns.numDescriptors ? "" : ",") + "' ||");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "') SELECT ' ||");

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 5, null, true, null, "'PPR.", null, null, null, null, null, null, "'", null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conVersionId, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conOid, "'NEXTVAL FOR " + qualSeqNameOid + "'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM_IVK.conPrimaryPriceTypeForTestId, "'" + String.valueOf(M01_LDM_IVK.gc_dfltPrimaryPriceTypeOrg) + "'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 4, M01_ACM_IVK.conPriceSelectionForOverlapId, "'" + String.valueOf(M01_LDM_IVK.gc_dfltPriceSelectionForOverlapOrg) + "'", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 5, M01_ACM_IVK.conRebateValueType, "'COALESCE((SELECT D.VALUETYPE FROM " + M01_Globals_IVK.g_qualTabNameRebateDefault + " D WHERE D." + M01_Globals_IVK.g_anPsOid + " = PS." + M01_Globals.g_anOid + "), PPR.REBATEVALUETYPE)'", null, null, null);

M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals_IVK.g_classIndexPricePreferences, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, M01_Globals.g_primaryOrgIndex, null, 2, null, null, M01_Common.DdlOutputMode.edomNone, null);

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M04_Utilities.transformAttrName(tabColumns.descriptors[k].columnName, M24_Attribute_Utilities.AttrValueType.eavtDomain, tabColumns.descriptors[k].dbDomainIndex, transformation, ddlType, null, null, null, true, tabColumns.descriptors[k].acmAttributeIndex, M01_Common.DdlOutputMode.edomList, null, null, null, null) + " ||" + (k < tabColumns.numDescriptors ? " ',' ||" : ""));
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + qualTabNamePricePreferencesFac + " PPR' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' INNER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals_IVK.g_qualTabNameProductStructure + " PS' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' ON ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'PPR." + M01_Globals_IVK.g_anPsOid + " = PS." + M01_Globals.g_anOid + "' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'PS." + M01_Globals_IVK.g_anIsUnderConstruction + " = 0'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInitBus + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmtCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + tempTabNameStatementOrgInitBus);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmtCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameOrgInitBus, ddlType, null, "mode_in", "orgId_in", "'orgBusName_in", "defaultCountryId_in", "primaryLanguageId_in", "fallbackLanguageId_in", "rowCount_out", null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
}


private static void genDbAdminDdlOrgInitEnp(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (M03_Config.generateFwkTest) {
return;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
return;
}

String qualTabNameGenericAspectFactoryProd;
qualTabNameGenericAspectFactoryProd = M04_Utilities.genQualTabNameByClassIndex(M01_Globals_IVK.g_classIndexGenericAspect, ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals_IVK.g_productiveDataPoolIndex, null, null, null, null, null, null, null);
String qualTabNamePropertyFactoryProd;
qualTabNamePropertyFactoryProd = M04_Utilities.genQualTabNameByClassIndex(M01_Globals_IVK.g_classIndexProperty, ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals_IVK.g_productiveDataPoolIndex, null, null, null, null, null, null, null);
String qualTabNamePropertyTemplateFactoryProd;
qualTabNamePropertyTemplateFactoryProd = M04_Utilities.genQualTabNameByClassIndex(M01_Globals_IVK.g_classIndexPropertyTemplate, ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals_IVK.g_productiveDataPoolIndex, null, null, null, null, null, null, null);

String qualProcedureNameOrgInitEnp;
qualProcedureNameOrgInitEnp = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnOrgInitEnp, ddlType, null, null, null, null, null, null);

String qualSeqNameOid;
qualSeqNameOid = M71_Org.genQualOidSeqNameForOrg(-1, ddlType, null, null, null, null);

// ####################################################################################################################
// #    SP for initialization of organization's ENPs in Work Datapool
// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for initialization of organization's ENPs in Work Datapool", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameOrgInitEnp);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "orgId_in", M01_Globals.g_dbtEnumId, true, "ID of the organization to initialize");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of records INSERTED / UPDATED");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_rebateValue", "INTEGER", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(32000)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_rowCount", "INTEGER", "0", null, null);
M79_Err.genSigMsgVarDecl(fileNo, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, null);
M11_LRT.genCondDecl(fileNo, "alreadyExist", "42710", null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare cursor", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE c CURSOR FOR v_stmnt;");

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR alreadyExist");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M87_FactoryTakeOver.genDdlForTempEnpOids(fileNo, null, true, true, true);
M12_ChangeLog.genDdlForTempChangeLogSummary(fileNo, null, true, true, true, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameOrgInitEnp, ddlType, null, "orgId_in", "rowCount_out", null, null, null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "loop over ProductStructures", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR psLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PS." + M01_Globals.g_anOid + " AS V_PSOID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals_IVK.g_qualTabNameProductStructure + " PS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PS." + M01_Globals_IVK.g_anIsUnderConstruction + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "determine rebate value", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_rebateValue = 0;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'SELECT REBATEVALUETYPE FROM " + M04_Utilities.getSchemaName(M01_Globals_IVK.g_qualTabNamePricePreferencesCto) + "' || RIGHT(DIGITS(orgId_in),2) || '." + M04_Utilities.getUnqualObjName(M01_Globals_IVK.g_qualTabNamePricePreferencesCto) + " WHERE " + M01_Globals_IVK.g_anPsOid + " = ' || RTRIM(CHAR(V_PSOID));");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "OPEN c;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "c");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_rebateValue");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CLOSE c;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_rebateValue = COALESCE(v_rebateValue, 25);");

M11_LRT.genProcSectionHeader(fileNo, "initialize " + M01_Globals_IVK.gc_tempTabNameChangeLogOrgSummary + " with EBP-Prices", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'INSERT INTO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'" + M01_Globals_IVK.gc_tempTabNameChangeLogOrgSummary + "' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'(' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'objectId,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'entityId,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'entityType,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'ahClassId,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'ahObjectId,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'aggregateType,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'ahIsCreated,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'ahIsUpdated,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'ahIsDeleted,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'isCreated,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'isUpdated,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'isDeleted' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "') ' ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SELECT ' ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'GAS." + M01_Globals.g_anOid + ",' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'GAS." + M01_Globals.g_anCid + ",' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'''" + M01_Globals.gc_acmEntityTypeKeyClass + "'',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'GAS." + M01_Globals.g_anCid + ",' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'GAS." + M01_Globals.g_anOid + ",' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'''" + M22_Class.g_classes.descriptors[M01_Globals_IVK.g_classIndexGenericAspect].aggHeadClassIdStr + "'',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'1,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'0,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'0,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'1,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'0,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'0' ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "' FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'" + qualTabNameGenericAspectFactoryProd + " GAS' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "' INNER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'" + qualTabNamePropertyFactoryProd + " PRP' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "' ON ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'GAS.PRPAPR_OID = PRP." + M01_Globals.g_anOid + "' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "' INNER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'" + qualTabNamePropertyTemplateFactoryProd + " PRT' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "' ON ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'PRP.PTMHTP_OID = PRT." + M01_Globals.g_anOid + "' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "' WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'GAS." + M01_Globals.g_anCid + " = ''" + M22_Class.g_classes.descriptors[M01_Globals_IVK.g_classIndexTypePriceAssignment].classIdStr + "''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "' AND ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'PRT.ID = " + String.valueOf(M87_FactoryTakeOver.propertyTemplateIdEbp) + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "determine ENP/EBP-Mapping", 2, null);
String qualProcedureNameGetEnpEbpMapping;
qualProcedureNameGetEnpEbpMapping = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexFactoryTakeover, M01_ACM_IVK.spnFtoGetEnpEbpMap, ddlType, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'CALL " + M04_Utilities.getSchemaName(qualProcedureNameGetEnpEbpMapping) + "' || RIGHT(DIGITS(orgId_in),2) || '" + String.valueOf(M01_Globals.g_workDataPoolId) + "." + M04_Utilities.getUnqualObjName(qualProcedureNameGetEnpEbpMapping) + "(' || RTRIM(CHAR(V_PSOID)) || ', ?)';");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_rowCount");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");

M11_LRT.genProcSectionHeader(fileNo, "accumulate number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + v_rowCount;");

M11_LRT.genProcSectionHeader(fileNo, "calculate EBP", 2, null);

String qualProcedureNameSetEnp;
qualProcedureNameSetEnp = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexFactoryTakeover, M01_ACM_IVK.spnFtoSetEnp, ddlType, null, null, null, "NoLrt", M04_Utilities.ObjNameDelimMode.eondmNone, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'CALL " + M04_Utilities.getSchemaName(qualProcedureNameSetEnp) + "' || RIGHT(DIGITS(orgId_in),2) || '" + String.valueOf(M01_Globals.g_workDataPoolId) + "." + M04_Utilities.getUnqualObjName(qualProcedureNameSetEnp) + "(' || RTRIM(CHAR(v_rebateValue)) || ', ?)';");

M11_LRT.genProcSectionHeader(fileNo, "accumulate number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + v_rowCount;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameOrgInitEnp, ddlType, null, "orgId_in", "rowCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
}


private static void genDbAdminDdlOrgInit(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (M03_Config.generateFwkTest) {
return;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
return;
}

String qualProcedureNameOrgInitEnp;
qualProcedureNameOrgInitEnp = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnOrgInitEnp, ddlType, null, null, null, null, null, null);

String qualTabNameGenericAspectFactoryProd;
qualTabNameGenericAspectFactoryProd = M04_Utilities.genQualTabNameByClassIndex(M01_Globals_IVK.g_classIndexGenericAspect, ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals_IVK.g_productiveDataPoolIndex, null, null, null, null, null, null, null);
String qualTabNamePropertyFactoryProd;
qualTabNamePropertyFactoryProd = M04_Utilities.genQualTabNameByClassIndex(M01_Globals_IVK.g_classIndexProperty, ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals_IVK.g_productiveDataPoolIndex, null, null, null, null, null, null, null);
String qualTabNamePropertyTemplateFactoryProd;
qualTabNamePropertyTemplateFactoryProd = M04_Utilities.genQualTabNameByClassIndex(M01_Globals_IVK.g_classIndexPropertyTemplate, ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals_IVK.g_productiveDataPoolIndex, null, null, null, null, null, null, null);

String qualSeqNameOid;
qualSeqNameOid = M71_Org.genQualOidSeqNameForOrg(-1, ddlType, null, null, null, null);

// ####################################################################################################################
// #    SP for initialization of organization's data
// ####################################################################################################################

String qualProcedureNameOrgInit;
qualProcedureNameOrgInit = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnOrgInit, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for initialization of organization's data (copy from factory)", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameOrgInit);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "orgId_in", M01_Globals.g_dbtEnumId, true, "ID of the organization to initialize");
M11_LRT.genProcParm(fileNo, "IN", "psOidList_in", "VARCHAR(400)", true, "(optional) ','-delimited list of OIDs of ProductStructures");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of rows being copied (sum over all tables)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 2");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "SQLCODE", "INTEGER", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_orgOid", M01_Globals.g_dbtOid, "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_psOidList", "VARCHAR(400)", "''", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(32000)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxtUtil", "VARCHAR(32000)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_numDataPools", "INTEGER", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_colList", "VARCHAR(8000)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_colListForSelect", "VARCHAR(8000)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_IsBlockedPriceExpression", "VARCHAR(1000)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_fltrTxt", "VARCHAR(1600)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_deleteFltrTxt", "VARCHAR(800)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_rowCount", "INTEGER", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_rowCount2", "INTEGER", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_qualTabNameView", "VARCHAR(128)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_qualTabNameGeneralSettings", "VARCHAR(128)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_qualTabNameEndSlot", "VARCHAR(128)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_qualTabNameNsrValidForOrganization", "VARCHAR(128)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_qualTabNameDisplaySlot", "VARCHAR(128)", "NULL", null, null);
M79_Err.genSigMsgVarDecl(fileNo, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare continue handler for SQL-Exceptions", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLEXCEPTION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROLLBACK;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "RESIGNAL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

String tempTabNameStatementOrgInit;
tempTabNameStatementOrgInit = M94_DBAdmin.tempTabNameStatement + "OrgInit";

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 32000, true, true, true, null, "OrgInit", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "temporary table for table statistics", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.TableData");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "seqNo            INTEGER,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "poolTypeId       INTEGER,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "numRowsDeleted   INTEGER,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "numRowsInserted  INTEGER,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "srcTabSchemaName " + M01_Globals.g_dbtDbSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tgtTabSchemaName " + M01_Globals.g_dbtDbSchemaName + ", ");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "tabName          VARCHAR(50)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, true, true, true);

M11_LRT.genProcSectionHeader(fileNo, "temporary table for CountryID-Lists", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.myCountryIdLists");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "countryIdListOid " + M01_Globals.g_dbtOid);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, true, true, true);

M11_LRT.genProcSectionHeader(fileNo, "temporary table for productstructure oids", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE GLOBAL TEMPORARY TABLE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.PsOids");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "oid " + M01_Globals.g_dbtOid);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ")");
M11_LRT.genDdlForTempTableDeclTrailer(fileNo, 1, true, true, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameOrgInit, ddlType, 1, "mode_in", "orgId_in", "rowCount_out", null, null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "make sure that a entry for 'countries managed by the new MPC' exists", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF NOT EXISTS ( SELECT 1 FROM " + M01_Globals_IVK.g_qualTabNameOrgManagesCountry + " WHERE org_oid = ( SELECT ORGOID FROM " + M01_Globals.g_qualTabNamePdmOrganization + " WHERE ID = orgId_in ) ) THEN");
M79_Err.genSignalDdlWithParms("OrgManagesCountryNotExist", fileNo, 2, null, null, null, null, null, null, null, null, null, "RTRIM(CHAR(orgId_in))", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "determine Organization's OID", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORGOID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "v_orgOid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_qualTabNamePdmOrganization);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ID = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M11_LRT.genProcSectionHeader(fileNo, "determine 'my' countryIdLists", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SESSION.myCountryIdLists");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "X.CIL_OID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals_IVK.g_qualTabNameOrgManagesCountry + " M");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals.g_qualTabNamePdmOrganization + " O");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "M.ORG_OID = O.ORGOID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + M01_Globals_IVK.g_qualTabNameCountryIdXRef + " X");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "X.CSP_OID = M.CNT_OID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "O.ID = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");


M11_LRT.genProcSectionHeader(fileNo, "store relevant ps_oids in temp table ", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF psOidList_in IS NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO SESSION.PsOids( oid ) SELECT P.OID FROM VL6CPST.PRODUCTSTRUCTURE P;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO SESSION.PsOids( oid )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT BIGINT(X.elem) FROM TABLE ( VL6CMET.F_STRELEMS(psOidList_in, CAST(',' AS CHAR(1))) ) AS X;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "check for valid ps oids", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR psLoop AS psCursor CURSOR FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT oid AS c_ps_oid FROM SESSION.PsOids DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF NOT (c_ps_oid IN (SELECT oid FROM VL6CPST.PRODUCTSTRUCTURE)) THEN");
M79_Err.genSignalDdlWithParms("psNotExist", fileNo, 4, null, null, null, null, null, null, null, null, null, "RTRIM(CHAR(c_ps_oid))", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_psOidList = v_psOidList || c_ps_oid || ',';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_psOidList = strip(v_psOidList, trailing, ',');");


M11_LRT.genProcSectionHeader(fileNo, "for batch-script: set command options", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES ('UPDATE COMMAND OPTIONS USING S ON');");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES ('UPDATE COMMAND OPTIONS USING X ON');");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES ('UPDATE COMMAND OPTIONS USING V ON');");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

String qualProcedureNameTrigDisable;
qualProcedureNameTrigDisable = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnTriggerDisable, ddlType, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "disable triggers for organization", null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CALL " + qualProcedureNameTrigDisable + "(NULL, NULL, NULL, NULL, ' || RTRIM(CHAR(orgId_in)) || ', NULL, ?, ?)';");

M00_FileWriter.printToFile(fileNo, "");
addStatementIntoTempTable(fileNo, 1, tempTabNameStatementOrgInit, false);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M11_LRT.genProcSectionHeader(fileNo, "declare variables", 3, true);
M11_LRT.genVarDecl(fileNo, "v_trigCount", "INTEGER", "NULL", 3, null);
M11_LRT.genVarDecl(fileNo, "v_failCount", "INTEGER", "NULL", 3, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_trigCount,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_failCount");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "delete all data in all organization's data pools - in case there is already some data", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS tabCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P." + M01_Globals.g_anPdmFkSchemaName + " AS c_tabschemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P." + M01_Globals.g_anPdmTableName + " AS c_tabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P." + M01_Globals.g_anPoolTypeId + " AS c_poolTypeId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals.g_anLdmFkSequenceNo + " AS c_fkSequenceNo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameAcmEntity + " A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " L");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntitySection + " = L." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityName + " = L." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityType + " = L." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " P");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P." + M01_Globals.g_anPdmLdmFkSchemaName + " = L." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P." + M01_Globals.g_anPdmLdmFkTableName + " = L." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");

boolean firstException;
String exceptionComment;
String thisExceptionComment;
firstException = true;
exceptionComment = "";
int i;
for (int i = 1; i <= M22_Class.g_classes.numDescriptors; i++) {
thisExceptionComment = "";
if (M22_Class.g_classes.descriptors[i].classIndex == M01_Globals_IVK.g_classIndexPricePreferences) {
thisExceptionComment = "exclude \"" + M22_Class.g_classes.descriptors[i].sectionName.toUpperCase() + "." + M22_Class.g_classes.descriptors[i].className.toUpperCase() + "\" (already initialized)";
}

if (!(thisExceptionComment.compareTo("") == 0)) {
if (firstException) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "NOT (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntityType + " = '" + M01_Globals.gc_acmEntityTypeKeyClass + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntityId + " IN (");
} else {
M00_FileWriter.printToFile(fileNo, "," + (!(exceptionComment.compareTo("") == 0) ? " -- " + exceptionComment : ""));
}
exceptionComment = thisExceptionComment;
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'" + M22_Class.g_classes.descriptors[i].classIdStr.toUpperCase() + "'");
firstException = false;
}
}

if (!(exceptionComment.compareTo("") == 0)) {
M11_LRT.genProcSectionHeader(fileNo, exceptionComment, 1, true);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "P." + M01_Globals.g_anOrganizationId + " = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals_IVK.g_anLdmIsMqt + " DESC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COALESCE(P." + M01_Globals.g_anPoolTypeId + ", 999) ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals.g_anLdmFkSequenceNo + " DESC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'DELETE FROM ' || RTRIM(c_tabschemaName) || '.' || RTRIM(c_tabName);");
M00_FileWriter.printToFile(fileNo, "");
addStatementIntoTempTable(fileNo, 2, tempTabNameStatementOrgInit, M03_Config.genTimeStampsDuringOrgInit);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "commit to toggle on logging again", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "UPDATE SESSION.TableData T SET T.numRowsDeleted = v_rowCount WHERE T.TgtTabSchemaName = c_tabschemaName AND T.tabName = c_tabName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF SQLCODE <> 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SESSION.TableData");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "seqNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "poolTypeId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "numRowsDeleted,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tgtTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_fkSequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_poolTypeId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_rowCount,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_tabschemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "REORG for Table GENERICASPECT because of DELETE-run time-problems for subsequent commands", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF c_tabName = 'GENERICASPECT' THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxtUtil = 'CALL VL6CDBA.REORG( ''1'', ''T'', ''' || RTRIM( c_tabschemaName ) || ''', ''' || RTRIM( c_tabName ) || ''', NULL, NULL, ''0'', ''1'', ?, ? )' ;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES (v_stmntTxtUtil);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxtUtil;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "lock all factory productive data pools", 1, null);
String qualProcNameSetLock;
qualProcNameSetLock = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbMeta, M01_ACM_IVK.spnSetRel2ProdLock, ddlType, null, null, null, "SHAREDREAD", null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR dpLoop AS csr CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OR.ORGOID AS c_orgOid,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SC." + M01_Globals.g_anPoolTypeId + "  AS c_accessModeId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PS." + M01_Globals.g_anOid + " AS c_psOid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SESSION.PsOids PS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmOrganization + " OR,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmPrimarySchema + " SC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(OR.ID = SC." + M01_Globals.g_anOrganizationId + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(SC." + M01_Globals.g_anPoolTypeId + " = " + String.valueOf(M01_Globals_IVK.g_productiveDataPoolId) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(SC." + M01_Globals.g_anOrganizationId + " = " + String.valueOf(M01_Globals.g_primaryOrgId) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "lock data pool", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'CALL " + qualProcNameSetLock + "(''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "RTRIM(CHAR(c_orgOid)) || ',' || RTRIM(CHAR(c_psOid)) || ',' || RTRIM(CHAR(c_accessModeId)) || ''',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'''<admin>'',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'''' || CAST(CASE COALESCE(CURRENT USER, '') WHEN '' THEN '<unknown>' ELSE CURRENT USER END AS " + M01_Globals.g_dbtUserId + ") || ''',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'''ORGINIT'',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'?)';");
M00_FileWriter.printToFile(fileNo, "");
addStatementIntoTempTable(fileNo, 2, tempTabNameStatementOrgInit, M03_Config.genTimeStampsDuringOrgInit);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_numDataPools");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "if lock on data pool could not be aquired, rollback and exit", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF v_numDataPools = 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ROLLBACK;");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameOrgInit, ddlType, 4, "mode_in", "orgId_in", "rowCount_out", null, null, null, null, null, null, null, null, null);
M79_Err.genSignalDdlWithParms("setRel2ProdLockFail", fileNo, 4, "SHAREDREAD", null, null, null, null, null, null, null, null, "RTRIM(CHAR(c_orgOid))", "RTRIM(CHAR(c_psOid))", "RTRIM(CHAR(c_accessModeId))", null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "lock all organization's data pools", 1, null);
//  Dim qualProcNameSetLock As String
qualProcNameSetLock = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbMeta, M01_ACM_IVK.spnSetRel2ProdLock, ddlType, null, null, null, "EXCLUSIVEWRITE", null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR dpLoop AS csr CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OR.ORGOID AS c_orgOid,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SC." + M01_Globals.g_anPoolTypeId + "  AS c_accessModeId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PS." + M01_Globals.g_anOid + " AS c_psOid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SESSION.PsOids PS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmOrganization + " OR,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmPrimarySchema + " SC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(OR.ID = SC." + M01_Globals.g_anOrganizationId + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(SC." + M01_Globals.g_anPoolTypeId + " IN ( " + String.valueOf(M01_Globals.g_workDataPoolId) + "," + String.valueOf(M01_Globals_IVK.g_productiveDataPoolId) + " ) )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(SC." + M01_Globals.g_anOrganizationId + " = orgId_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "lock data pool", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'CALL " + qualProcNameSetLock + "(''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "RTRIM(CHAR(c_orgOid)) || ',' || RTRIM(CHAR(c_psOid)) || ',' || RTRIM(CHAR(c_accessModeId)) || ''',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'''<admin>'',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'''' || CAST(CASE COALESCE(CURRENT USER, '') WHEN '' THEN '<unknown>' ELSE CURRENT USER END AS " + M01_Globals.g_dbtUserId + ") || ''',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'''ORGINIT'',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'?)';");
M00_FileWriter.printToFile(fileNo, "");
addStatementIntoTempTable(fileNo, 2, tempTabNameStatementOrgInit, M03_Config.genTimeStampsDuringOrgInit);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_numDataPools");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "if lock on data pool could not be aquired, rollback and exit", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF v_numDataPools = 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ROLLBACK;");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameOrgInit, ddlType, 4, "mode_in", "orgId_in", "rowCount_out", null, null, null, null, null, null, null, null, null);
M79_Err.genSignalDdlWithParms("setRel2ProdLockFail", fileNo, 4, "EXCLUSIVEWRITE", null, null, null, null, null, null, null, null, "RTRIM(CHAR(c_orgOid))", "RTRIM(CHAR(c_psOid))", "RTRIM(CHAR(c_accessModeId))", null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "copy data from factory productive data pool to organization's work data pool", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS tabCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntitySection + " AS c_entitySection,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityName + " AS c_entityName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityShortName + " AS c_entityShortName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityType + " AS c_entityType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals_IVK.g_anAcmIsPs + " AS c_isPs,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A1." + M01_ACM.conAcmEntityShortName + " AS c_divPrefix,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AH." + M01_Globals.g_anAcmEntityName + " AS c_ahClassName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PF." + M01_Globals.g_anPdmFkSchemaName + " AS c_srcTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PO." + M01_Globals.g_anPdmFkSchemaName + " AS c_tgtTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PO." + M01_Globals.g_anPdmTableName + " AS c_tabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PO." + M01_Globals.g_anPoolTypeId + " AS c_poolTypeId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PH." + M01_Globals.g_anPdmFkSchemaName + " AS c_ahTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PH." + M01_Globals.g_anPdmTableName + " AS c_ahTabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals.g_anLdmIsGen + " AS c_isGen,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals.g_anLdmIsNl + " AS c_isNl,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals.g_anLdmFkSequenceNo + " AS c_fkSequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(CASE WHEN D.SRC_SCHEMANAME IS NULL THEN 0 ELSE 1 END) AS c_hasSelfReference");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameAcmEntity + " A");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " L");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntitySection + " = L." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityName + " = L." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityType + " = L." + M01_Globals.g_anAcmEntityType);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " PO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PO." + M01_Globals.g_anPdmLdmFkSchemaName + " = L." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PO." + M01_Globals.g_anPdmLdmFkTableName + " = L." + M01_Globals.g_anLdmTableName);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " PF");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PF." + M01_Globals.g_anPdmLdmFkSchemaName + " = L." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PF." + M01_Globals.g_anPdmLdmFkTableName + " = L." + M01_Globals.g_anLdmTableName);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameAcmEntity + " AH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AH." + M01_Globals.g_anAcmEntityId + " = A." + M01_Globals.g_anAhCid + "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AH." + M01_Globals.g_anAcmEntityType + " = '" + M01_Globals.gc_acmEntityTypeKeyClass + "'");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " LH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AH." + M01_Globals.g_anAcmEntitySection + " = LH." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AH." + M01_Globals.g_anAcmEntityName + " = LH." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AH." + M01_Globals.g_anAcmEntityType + " = LH." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LH." + M01_Globals.g_anLdmIsGen + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LH." + M01_Globals.g_anLdmIsNl + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LH." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " PH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PH." + M01_Globals.g_anPdmLdmFkSchemaName + " = LH." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PH." + M01_Globals.g_anPdmLdmFkTableName + " = LH." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PH." + M01_Globals.g_anOrganizationId + " = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COALESCE(PH." + M01_Globals.g_anPoolTypeId + "," + String.valueOf(M01_Globals.g_workDataPoolId) + ") = " + String.valueOf(M01_Globals.g_workDataPoolId));

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameFkDependency + " D");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.SRC_SCHEMANAME = L." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.SRC_TABLENAME = L." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.DST_SCHEMANAME = L." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "D.DST_TABLENAME = L." + M01_Globals.g_anLdmTableName);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameAcmEntity + " A1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityName + " = A1." + M01_ACM.conAcmLeftEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A1." + M01_ACM.conAcmRightEntityName + " = 'DIVISION'");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");

firstException = true;
exceptionComment = "";
for (int i = 1; i <= M23_Relationship.g_relationships.numDescriptors; i++) {
thisExceptionComment = "";
if (!(M23_Relationship.g_relationships.descriptors[i].isUserTransactional &  ((M23_Relationship.g_relationships.descriptors[i].maxLeftCardinality == -1 &  M23_Relationship.g_relationships.descriptors[i].maxRightCardinality == -1) |  M23_Relationship.g_relationships.descriptors[i].isNl) & (M23_Relationship.g_relationships.descriptors[i].sectionName.toUpperCase() == M01_ACM_IVK.snOrder.toUpperCase() |  M23_Relationship.g_relationships.descriptors[i].sectionName.toUpperCase() == M01_ACM_IVK.snReport.toUpperCase() | M23_Relationship.g_relationships.descriptors[i].sectionName.toUpperCase() == M01_ACM_IVK.snPricing.toUpperCase()))) {
thisExceptionComment = "exclude \"" + M23_Relationship.g_relationships.descriptors[i].sectionName.toUpperCase() + "." + M23_Relationship.g_relationships.descriptors[i].relName.toUpperCase() + "\" (section \"" + M23_Relationship.g_relationships.descriptors[i].sectionName.toUpperCase() + "\")";
}

if (!(thisExceptionComment.compareTo("") == 0)) {
if (firstException) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "NOT (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntityType + " = '" + M01_Globals.gc_acmEntityTypeKeyRel + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntityId + " IN (");
} else {
M00_FileWriter.printToFile(fileNo, "," + (!(exceptionComment.compareTo("") == 0) ? " -- " + exceptionComment : ""));
}
exceptionComment = thisExceptionComment;
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'" + M23_Relationship.g_relationships.descriptors[i].relIdStr.toUpperCase() + "'");
firstException = false;
}
}

if (!(exceptionComment.compareTo("") == 0)) {
M11_LRT.genProcSectionHeader(fileNo, exceptionComment, 1, true);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
}

firstException = true;
exceptionComment = "";
for (int i = 1; i <= M22_Class.g_classes.numDescriptors; i++) {
thisExceptionComment = "";
if (M22_Class.g_classes.descriptors[i].classIndex == M01_Globals_IVK.g_classIndexPricePreferences) {
thisExceptionComment = "exclude \"" + M22_Class.g_classes.descriptors[i].sectionName.toUpperCase() + "." + M22_Class.g_classes.descriptors[i].className.toUpperCase() + "\" (already initialized)";
}

if ((M22_Class.g_classes.descriptors[i].superClassIndex <= 0 & ! M22_Class.g_classes.descriptors[i].isUserTransactional) |  M22_Class.g_classes.descriptors[i].classIndex == M01_Globals_IVK.g_classIndexTaxParameter | M22_Class.g_classes.descriptors[i].classIndex == M01_Globals_IVK.g_classIndexTaxType) {
if (M22_Class.g_classes.descriptors[i].sectionName.toUpperCase() == M01_ACM_IVK.snOrder.toUpperCase() |  M22_Class.g_classes.descriptors[i].sectionName.toUpperCase() == M01_ACM_IVK.snReport.toUpperCase() | M22_Class.g_classes.descriptors[i].sectionName.toUpperCase() == M01_ACM_IVK.snPricing.toUpperCase()) {
thisExceptionComment = "exclude \"" + M22_Class.g_classes.descriptors[i].sectionName.toUpperCase() + "." + M22_Class.g_classes.descriptors[i].className.toUpperCase() + "\" (section \"" + M22_Class.g_classes.descriptors[i].sectionName.toUpperCase() + "\")";
}
}

if (!(thisExceptionComment.compareTo("") == 0)) {
if (firstException) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "NOT (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntityType + " = '" + M01_Globals.gc_acmEntityTypeKeyClass + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntityId + " IN (");
} else {
M00_FileWriter.printToFile(fileNo, "," + (!(exceptionComment.compareTo("") == 0) ? " -- " + exceptionComment : ""));
}
exceptionComment = thisExceptionComment;
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'" + M22_Class.g_classes.descriptors[i].classIdStr.toUpperCase() + "'");
firstException = false;
}
}

if (!(exceptionComment.compareTo("") == 0)) {
M11_LRT.genProcSectionHeader(fileNo, exceptionComment, 1, true);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(A." + M01_Globals.g_anAcmIsLrt + " = 1 OR PO." + M01_Globals.g_anPoolTypeId + " IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals_IVK.g_anLdmIsMqt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PO." + M01_Globals.g_anOrganizationId + " = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COALESCE(PO." + M01_Globals.g_anPoolTypeId + "," + String.valueOf(M01_Globals.g_workDataPoolId) + ") = " + String.valueOf(M01_Globals.g_workDataPoolId));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PF." + M01_Globals.g_anOrganizationId + " = " + String.valueOf(M01_Globals.g_primaryOrgId));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COALESCE(PF." + M01_Globals.g_anPoolTypeId + "," + String.valueOf(M01_Globals_IVK.g_productiveDataPoolId) + ") = " + String.valueOf(M01_Globals_IVK.g_productiveDataPoolId));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(CASE WHEN A." + M01_Globals.g_anAhCid + " IS NULL THEN 0 ELSE 1 END) DESC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals.g_anLdmFkSequenceNo + " ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M11_LRT.genProcSectionHeader(fileNo, "determine common columns in source and target table", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_colList = '';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_colListForSelect = '';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR colLoop AS colCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "S.COLNAME AS V_COLNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.COLUMNS S");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.COLUMNS T");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "S.TABNAME = T.TABNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "S.COLNAME = T.COLNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "S.TABSCHEMA = c_tgtTabSchemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "T.TABSCHEMA = c_srcTabSchemaName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "T.TABNAME = c_tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "S.COLNO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_colList = v_colList || (CASE v_colList WHEN '' THEN '' ELSE ',' END) || V_COLNAME;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF c_tabName = 'GENERICASPECT' AND V_COLNAME = 'ISBLOCKEDPRICE' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_IsBlockedPriceExpression = 'CASE WHEN S.CLASSID = ''09006'' AND ((SELECT P.ISDPB FROM VL6CMET' || RIGHT(DIGITS(orgId_in),2) || '.PRICEPREFERENCES P WHERE P.PS_OID = S.PS_OID) = 0) THEN 1 ELSE S.ISBLOCKEDPRICE END';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_colListForSelect = v_colListForSelect || (CASE v_colListForSelect WHEN '' THEN '' ELSE ',' END) || v_IsBlockedPriceExpression;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_colListForSelect = v_colListForSelect || (CASE v_colListForSelect WHEN '' THEN '' ELSE ',' END) || V_COLNAME;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'INSERT INTO ' || RTRIM(c_tgtTabSchemaName) || '.' || RTRIM(c_tabName) || '(' || v_colList || ')' || ' SELECT ' || v_colListForSelect || ' FROM ' || RTRIM(c_srcTabSchemaName) || '.' || RTRIM(c_tabName) || ' S WHERE (1=1)';");

M11_LRT.genProcSectionHeader(fileNo, "for PS-tagged tables: exclude records corresponding to PRODUCTSTRUCTURE under construction or to not relevant product structures/divisions", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (c_isPs = 1) AND (c_isNl = 0) THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt  || ' AND EXISTS (SELECT 1 FROM " + M01_Globals_IVK.g_qualTabNameProductStructure + " PS WHERE S." + M01_Globals_IVK.g_anPsOid + " = PS." + M01_Globals.g_anOid + " AND PS." + M01_Globals.g_anOid + " IN (' || v_psOidList || ') AND PS." + M01_Globals_IVK.g_anIsUnderConstruction + " = 0)';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSEIF (c_isNl = 0) AND (c_isGen = 0) AND (c_divPrefix IS NOT NULL) THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt  || ' AND EXISTS (SELECT 1 FROM " + M01_Globals_IVK.g_qualTabNameProductStructure + " PS WHERE S.' || c_divPrefix ||  'DIV_OID = PS.PDIDIV_OID AND PS." + M01_Globals.g_anOid + " IN (' || v_psOidList || ') AND PS." + M01_Globals_IVK.g_anIsUnderConstruction + " = 0)';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "exclude records referring to aggregate heads not relevant for this organization", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (c_ahTabSchemaName IS NOT NULL AND c_ahTabName IS NOT NULL) AND (c_ahTabSchemaName <> c_tgtTabSchemaName OR c_ahTabName <> c_tabName) AND (c_ahClassName <> '" + M01_ACM_IVK.clnExpression.toUpperCase() + "') THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt  || ' AND EXISTS (SELECT 1 FROM ' || RTRIM(c_ahTabSchemaName) || '.' || RTRIM(c_ahTabName) || ' AH WHERE S." + M01_Globals.g_anAhOid + " = AH." + M01_Globals.g_anOid + ")';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "for GEN- and NL_TEXT-tables: exclude records referring to 'parent records' not relevant for this organization'", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (c_isNl = 1) THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt  || ' AND EXISTS (SELECT 1 FROM ' || RTRIM(c_tgtTabSchemaName) || '.' || RTRIM(REPLACE(c_tabName, '_NL_TEXT', '')) || ' PAR WHERE S.' || RTRIM(c_entityShortName) || '_OID = PAR." + M01_Globals.g_anOid + ")';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSEIF (c_isGen = 1) THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt  || ' AND EXISTS (SELECT 1 FROM ' || RTRIM(c_tgtTabSchemaName) || '.' || RTRIM(REPLACE(c_tabName, '_GEN', '')) || ' PAR WHERE S.' || RTRIM(c_entityShortName) || '_OID = PAR." + M01_Globals.g_anOid + ")';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "for relationship-tables: filter by foreign keys referring to records not relevant for this organization", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF c_entityType = '" + M01_Globals.gc_acmEntityTypeKeyRel + "' AND c_isNl = " + M01_LDM.gc_dbFalse + " THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_fltrTxt = NULL;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(CASE WHEN PL." + M01_Globals.g_anOrganizationId + " IS NULL THEN '' ELSE ' AND EXISTS (SELECT 1 FROM ' || RTRIM(PL." + M01_Globals.g_anPdmFkSchemaName + ") || '.' || RTRIM(PL." + M01_Globals.g_anPdmTableName + ") || ' L WHERE S.' || AL." + M01_Globals.g_anAcmEntityShortName + " || '_OID = L." + M01_Globals.g_anOid + ")' END) ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(CASE WHEN PR." + M01_Globals.g_anOrganizationId + " IS NULL THEN '' ELSE ' AND EXISTS (SELECT 1 FROM ' || RTRIM(PR." + M01_Globals.g_anPdmFkSchemaName + ") || '.' || RTRIM(PR." + M01_Globals.g_anPdmTableName + ") || ' R WHERE S.' || AR." + M01_Globals.g_anAcmEntityShortName + " || '_OID = R." + M01_Globals.g_anOid + ")' END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_fltrTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameAcmEntity + " A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameAcmEntity + " AL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmLeftEntitySection + " = AL." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmLeftEntityName + " = AL." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A.LEFT_" + M01_Globals.g_anAcmEntityType + " = AL." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameAcmEntity + " ALPar");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ALPar." + M01_Globals.g_anAcmEntitySection + " = COALESCE(AL." + M01_Globals.g_anAcmOrParEntitySection + ", AL." + M01_Globals.g_anAcmEntitySection + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ALPar." + M01_Globals.g_anAcmEntityName + " = COALESCE(AL." + M01_Globals.g_anAcmOrParEntityName + ", AL." + M01_Globals.g_anAcmEntityName + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ALPar." + M01_Globals.g_anAcmEntityType + " = AL." + M01_Globals.g_anAcmOrParEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameAcmEntity + " AR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmRightEntitySection + " = AR." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmRightEntityName + " = AR." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmRightEntityType + " = AR." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameAcmEntity + " ARPar");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ARPar." + M01_Globals.g_anAcmEntitySection + " = COALESCE(AR." + M01_Globals.g_anAcmOrParEntitySection + ", AR." + M01_Globals.g_anAcmEntitySection + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ARPar." + M01_Globals.g_anAcmEntityName + " = COALESCE(AR." + M01_Globals.g_anAcmOrParEntityName + ", AR." + M01_Globals.g_anAcmEntityName + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ARPar." + M01_Globals.g_anAcmEntityType + " = AR." + M01_Globals.g_anAcmOrParEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameLdmTable + " LL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LL." + M01_Globals.g_anAcmEntitySection + " = ALPar." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LL." + M01_Globals.g_anAcmEntityName + " = ALPar." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LL." + M01_Globals.g_anAcmEntityType + " = ALPar." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LL." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LL." + M01_Globals.g_anLdmIsGen + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LL." + M01_Globals.g_anLdmIsNl + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameLdmTable + " LR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LR." + M01_Globals.g_anAcmEntitySection + " = ARPar." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LR." + M01_Globals.g_anAcmEntityName + " = ARPar." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LR." + M01_Globals.g_anAcmEntityType + " = ARPar." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LR." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LR." + M01_Globals.g_anLdmIsGen + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "LR." + M01_Globals.g_anLdmIsNl + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNamePdmTable + " PL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PL." + M01_Globals.g_anPdmLdmFkSchemaName + " = LL." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PL." + M01_Globals.g_anPdmLdmFkTableName + " = LL." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COALESCE(PL." + M01_Globals.g_anOrganizationId + ",orgId_in) = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COALESCE(PL." + M01_Globals.g_anPoolTypeId + "," + String.valueOf(M01_Globals.g_workDataPoolId) + ") = " + String.valueOf(M01_Globals.g_workDataPoolId));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "LEFT OUTER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNamePdmTable + " PR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PR." + M01_Globals.g_anPdmLdmFkSchemaName + " = LR." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PR." + M01_Globals.g_anPdmLdmFkTableName + " = LR." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COALESCE(PR." + M01_Globals.g_anOrganizationId + ",orgId_in) = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COALESCE(PR." + M01_Globals.g_anPoolTypeId + "," + String.valueOf(M01_Globals.g_workDataPoolId) + ") = " + String.valueOf(M01_Globals.g_workDataPoolId));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntityType + " = c_entityType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntityName + " = c_entityName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntitySection + " = c_entitySection");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(A." + M01_Globals.g_anAcmMaxLeftCardinality + " IS NULL AND A." + M01_Globals.g_anAcmMaxRightCardinality + " IS NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(PL." + M01_Globals.g_anOrganizationId + " IS NOT NULL OR PR." + M01_Globals.g_anOrganizationId + " IS NOT NULL)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WITH UR;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF v_fltrTxt IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = v_stmntTxt || v_fltrTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "apply some table-specific filter", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR filterLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V_EntityFilter");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "entitySection,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "entityName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "entityType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "forGen,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "forNl,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "filter");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");

M11_LRT.genProcSectionHeader(fileNo, "dummy-entry - first record", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES('-none-', '-none-', 'X', 0, 0, '0=1')");

String qualFuncNameHasAlCountry;
for (int i = 1; i <= M22_Class.g_classes.numDescriptors; i++) {
if (M22_Class.g_classes.descriptors[i].className.toUpperCase() == M01_ACM_IVK.clnGenericCode.toUpperCase()) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNION ALL");
M11_LRT.genProcSectionHeader(fileNo, "exclude CODEs by type", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES('" + M22_Class.g_classes.descriptors[i].sectionName.toUpperCase() + "', '" + M22_Class.g_classes.descriptors[i].className.toUpperCase() + "', '" + M01_Globals.gc_acmEntityTypeKeyClass + "', 0, 0, 'S.CTYTYP_OID <> 128')");
} else if (M22_Class.g_classes.descriptors[i].className.toUpperCase() == M01_ACM_IVK.clnGenericAspect.toUpperCase()) {
qualFuncNameHasAlCountry = M04_Utilities.genQualFuncName(M22_Class.g_classes.descriptors[i].sectionIndex, "HASALCNTRY", ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals_IVK.g_productiveDataPoolIndex, null, null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNION ALL");
M11_LRT.genProcSectionHeader(fileNo, "exclude " + M22_Class.g_classes.descriptors[i].className + "s not valid for this organization", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES('" + M22_Class.g_classes.descriptors[i].sectionName.toUpperCase() + "', '" + M22_Class.g_classes.descriptors[i].className.toUpperCase() + "', '" + M01_Globals.gc_acmEntityTypeKeyClass + "', 0, 0, 'S.ACLACL_OID IS NULL OR (" + qualFuncNameHasAlCountry + "(S." + M01_Globals.g_anOid + ",S." + M01_Globals.g_anCid + ",' || RTRIM(CHAR(v_orgOid)) || ')=1)')");
} else if (M22_Class.g_classes.descriptors[i].className.toUpperCase() == M01_ACM_IVK.clnDecisionTable.toUpperCase()) {
qualFuncNameHasAlCountry = M04_Utilities.genQualFuncName(M22_Class.g_classes.descriptors[i].sectionIndex, "HASALCNTRY", ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals_IVK.g_productiveDataPoolIndex, null, null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNION ALL");
M11_LRT.genProcSectionHeader(fileNo, "exclude " + M22_Class.g_classes.descriptors[i].className + "s not valid for this organization", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES('" + M22_Class.g_classes.descriptors[i].sectionName.toUpperCase() + "', '" + M22_Class.g_classes.descriptors[i].className.toUpperCase() + "', '" + M01_Globals.gc_acmEntityTypeKeyClass + "', 0, 0, '" + qualFuncNameHasAlCountry + "(S." + M01_Globals.g_anOid + ",' || RTRIM(CHAR(v_orgOid)) || ')=1')");
}
if (M22_Class.g_classes.descriptors[i].className.toUpperCase() == M01_ACM_IVK.clnView.toUpperCase()) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNION ALL");
M11_LRT.genProcSectionHeader(fileNo, "exclude non SR1/SR0-VIEWS and deletable VIEWS", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES('" + M22_Class.g_classes.descriptors[i].sectionName.toUpperCase() + "', '" + M22_Class.g_classes.descriptors[i].className.toUpperCase() + "', '" + M01_Globals.gc_acmEntityTypeKeyClass + "', 0, 0, 'UPPER(S." + M01_Globals_IVK.g_anName + ") IN (''SR0'',''SR1'') AND S." + M01_Globals_IVK.g_anIsDeletable + " = 0')");
}
if (M22_Class.g_classes.descriptors[i].navPathToOrg.relRefIndex > 0) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNION ALL");

String qualRelTabOrg;
String relOrgEntityIdStr;
qualRelTabOrg = M04_Utilities.genQualTabNameByRelIndex(M22_Class.g_classes.descriptors[i].navPathToOrg.relRefIndex, ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals_IVK.g_productiveDataPoolIndex, null, null, null, null, null, null);

String fkAttrToOrg;
String fkAttrToAh;
if (M22_Class.g_classes.descriptors[i].navPathToOrg.navDirection == M01_Common.RelNavigationDirection.etLeft) {
fkAttrToOrg = M23_Relationship.g_relationships.descriptors[M22_Class.g_classes.descriptors[i].navPathToOrg.relRefIndex].leftFkColName[ddlType];
fkAttrToAh = M23_Relationship.g_relationships.descriptors[M22_Class.g_classes.descriptors[i].navPathToOrg.relRefIndex].rightFkColName[ddlType];
} else {
fkAttrToOrg = M23_Relationship.g_relationships.descriptors[M22_Class.g_classes.descriptors[i].navPathToOrg.relRefIndex].rightFkColName[ddlType];
fkAttrToAh = M23_Relationship.g_relationships.descriptors[M22_Class.g_classes.descriptors[i].navPathToOrg.relRefIndex].leftFkColName[ddlType];
}

M11_LRT.genProcSectionHeader(fileNo, "exclude '" + M22_Class.g_classes.descriptors[i].className.toUpperCase() + "s not relevant for this organization'", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES('" + M22_Class.g_classes.descriptors[i].sectionName.toUpperCase() + "', '" + M22_Class.g_classes.descriptors[i].className.toUpperCase() + "', '" + M01_Globals.gc_acmEntityTypeKeyClass + "', 0, 0, 'NOT EXISTS (SELECT 1 FROM " + qualRelTabOrg + " V WHERE V." + fkAttrToAh + " = S." + M01_Globals.g_anOid + ") OR EXISTS (SELECT 1 FROM " + qualRelTabOrg + " V WHERE V." + fkAttrToAh + " = S." + M01_Globals.g_anOid + " AND V." + fkAttrToOrg + " = ' || RTRIM(CHAR(v_orgOid)) || ')')");
}
if (M22_Class.g_classes.descriptors[i].containsIsNotPublishedInclSubClasses &  M22_Class.g_classes.descriptors[i].superClassIndex <= 0) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNION ALL");
M11_LRT.genProcSectionHeader(fileNo, "exclude 'not published " + M22_Class.g_classes.descriptors[i].className.toUpperCase() + "s'", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES('" + M22_Class.g_classes.descriptors[i].sectionName.toUpperCase() + "', '" + M22_Class.g_classes.descriptors[i].className.toUpperCase() + "', '" + M01_Globals.gc_acmEntityTypeKeyClass + "', 0, 0, 'S." + M01_Globals_IVK.g_anIsNotPublished + " = 0')");
}
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V.filter AS c_filter");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V_EntityFilter V");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V.entitySection = c_entitySection");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V.entityName = c_entityName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V.entityType = c_entityType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V.forGen = c_isGen");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V.forNl = c_isNl");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF c_filter = '0=1' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = NULL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = v_stmntTxt  || ' AND (' || c_filter || ')';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "apply Foreign-Key-based filter", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_deleteFltrTxt = '';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR fkLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V_FkCandidates");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "srcOrParentEntitySection,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "srcOrParentEntityName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "srcEntityType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tgtOrParentEntitySection,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tgtOrParentEntityName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tgtEntityType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "fkColName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "isEnforced");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT DISTINCT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE WHEN E." + M01_Globals.g_anAcmMaxRightCardinality + " = 1 THEN COALESCE(L." + M01_Globals.g_anAcmOrParEntitySection + ", L." + M01_Globals.g_anAcmEntitySection + ") ELSE COALESCE(R." + M01_Globals.g_anAcmOrParEntitySection + ", R." + M01_Globals.g_anAcmEntitySection + ") END ),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE WHEN E." + M01_Globals.g_anAcmMaxRightCardinality + " = 1 THEN COALESCE(L." + M01_Globals.g_anAcmOrParEntityName + ",    L." + M01_Globals.g_anAcmEntityName + ")    ELSE COALESCE(R." + M01_Globals.g_anAcmOrParEntityName + ",    R." + M01_Globals.g_anAcmEntityName + ")    END ),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE WHEN E." + M01_Globals.g_anAcmMaxRightCardinality + " = 1 THEN L." + M01_Globals.g_anAcmEntityType + " ELSE R." + M01_Globals.g_anAcmEntityType + " END ),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE WHEN E." + M01_Globals.g_anAcmMaxRightCardinality + " = 1 THEN COALESCE(R." + M01_Globals.g_anAcmOrParEntitySection + ", R." + M01_Globals.g_anAcmEntitySection + ") ELSE COALESCE(L." + M01_Globals.g_anAcmOrParEntitySection + ", L." + M01_Globals.g_anAcmEntitySection + ") END ),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE WHEN E." + M01_Globals.g_anAcmMaxRightCardinality + " = 1 THEN COALESCE(R." + M01_Globals.g_anAcmOrParEntityName + ",    R." + M01_Globals.g_anAcmEntityName + ")    ELSE COALESCE(L." + M01_Globals.g_anAcmOrParEntityName + ",    L." + M01_Globals.g_anAcmEntityName + ")    END ),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(CASE WHEN E." + M01_Globals.g_anAcmMaxRightCardinality + " = 1 THEN R." + M01_Globals.g_anAcmEntityType + " ELSE L." + M01_Globals.g_anAcmEntityType + " END ),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE(E." + M01_Globals.g_anAcmAliasShortName + ", E." + M01_Globals.g_anAcmEntityShortName + ") ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "(CASE WHEN E." + M01_Globals.g_anAcmMaxRightCardinality + " = 1 THEN E." + M01_Globals.g_anAcmLrShortName + " ELSE E." + M01_Globals.g_anAcmRlShortName + " END ) || '_OID',");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "E." + M01_Globals.g_anAcmIsEnforced);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M01_Globals.g_qualTabNameAcmEntity + " E");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M01_Globals.g_qualTabNameAcmEntity + " L");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E." + M01_Globals.g_anAcmLeftEntitySection + " = L." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E." + M01_Globals.g_anAcmLeftEntityName + " = L." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E." + M01_Globals.g_anAcmLeftEntityType + " = L." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M01_Globals.g_qualTabNameAcmEntity + " R");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E." + M01_Globals.g_anAcmRightEntitySection + " = R." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E." + M01_Globals.g_anAcmRightEntityName + " = R." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E." + M01_Globals.g_anAcmRightEntityType + " = R." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E." + M01_Globals.g_anAcmEntityType + " = '" + M01_Globals.gc_acmEntityTypeKeyRel + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "(CASE WHEN E." + M01_Globals.g_anAcmMaxRightCardinality + " = 1 THEN COALESCE(L." + M01_Globals.g_anAcmOrParEntitySection + ", L." + M01_Globals.g_anAcmEntitySection + ") ELSE COALESCE(R." + M01_Globals.g_anAcmOrParEntitySection + ", R." + M01_Globals.g_anAcmEntitySection + ") END) = c_entitySection");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "(CASE WHEN E." + M01_Globals.g_anAcmMaxRightCardinality + " = 1 THEN COALESCE(L." + M01_Globals.g_anAcmOrParEntityName + ", L." + M01_Globals.g_anAcmEntityName + ") ELSE COALESCE(R." + M01_Globals.g_anAcmOrParEntityName + ", R." + M01_Globals.g_anAcmEntityName + ") END) = c_entityName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "(CASE WHEN E." + M01_Globals.g_anAcmMaxRightCardinality + " = 1 THEN L." + M01_Globals.g_anAcmEntityType + " ELSE R." + M01_Globals.g_anAcmEntityType + " END) = c_entityType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "COALESCE(E." + M01_Globals.g_anAcmMaxLeftCardinality + ",0) = 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "COALESCE(E." + M01_Globals.g_anAcmMaxRightCardinality + ",0) = 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V_FksByTab");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "srcOrParentEntitySection,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "srcOrParentEntityName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "srcEntityType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tgtOrParentEntitySection,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tgtOrParentEntityName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tgtEntityType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "fkColName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "isEnforced,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "srcTabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "srcTabSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tgtTabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tgtTabSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "isSelfReference");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.srcOrParentEntitySection,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.srcOrParentEntityName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.srcEntityType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.tgtOrParentEntitySection,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.tgtOrParentEntityName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.tgtEntityType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.fkColName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.isEnforced,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "P_SRC." + M01_Globals.g_anPdmTableName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "P_SRC." + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "P_TGT." + M01_Globals.g_anPdmTableName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "P_TGT." + M01_Globals.g_anPdmFkSchemaName + ",");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "CAST((CASE WHEN P_TGT." + M01_Globals.g_anPdmFkSchemaName + " = P_SRC." + M01_Globals.g_anPdmFkSchemaName + " AND P_TGT." + M01_Globals.g_anPdmTableName + " = P_SRC." + M01_Globals.g_anPdmTableName + " THEN 1 ELSE 0 END) AS " + M01_Globals.g_dbtBoolean + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "V_FkCandidates E");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M01_Globals.g_qualTabNameLdmTable + " L_SRC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.srcEntityType = L_SRC." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.srcOrParentEntityName = L_SRC." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.srcOrParentEntitySection = L_SRC." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M01_Globals.g_qualTabNamePdmTable + " P_SRC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "L_SRC." + M01_Globals.g_anLdmTableName + " = P_SRC." + M01_Globals.g_anPdmLdmFkTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "L_SRC." + M01_Globals.g_anLdmSchemaName + " = P_SRC." + M01_Globals.g_anPdmLdmFkSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M01_Globals.g_qualTabNameLdmTable + " L_TGT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.tgtEntityType = L_TGT." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.tgtOrParentEntityName = L_TGT." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "E.tgtOrParentEntitySection = L_TGT." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M01_Globals.g_qualTabNamePdmTable + " P_TGT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "L_TGT." + M01_Globals.g_anLdmTableName + " = P_TGT." + M01_Globals.g_anPdmLdmFkTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "L_TGT." + M01_Globals.g_anLdmSchemaName + " = P_TGT." + M01_Globals.g_anPdmLdmFkSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "L_SRC." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "L_TGT." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "L_TGT." + M01_Globals.g_anLdmIsGen + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "L_TGT." + M01_Globals.g_anLdmIsNl + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE(P_SRC." + M01_Globals.g_anPoolTypeId + ", " + String.valueOf(M01_Globals.g_workDataPoolId) + ") = " + String.valueOf(M01_Globals.g_workDataPoolId));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE(P_TGT." + M01_Globals.g_anPoolTypeId + ", " + String.valueOf(M01_Globals.g_workDataPoolId) + ") = " + String.valueOf(M01_Globals.g_workDataPoolId));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "P_SRC." + M01_Globals.g_anOrganizationId + " = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "P_TGT." + M01_Globals.g_anOrganizationId + " = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "CAST(C.COLNAME AS VARCHAR(10)) AS c_fkColName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V.tgtTabSchema                 AS c_tgtTabSchema,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V.tgtTabName                   AS c_tgtTabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V.isSelfReference              AS c_hasSelfReference");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SYSCAT.COLUMNS C");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V_FksByTab V");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "C.COLNAME = V.fkColName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "C.TABNAME = V.srcTabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "C.TABSCHEMA = V.srcTabSchema");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_isNl = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_isGen = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "C.COLNAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF c_hasSelfReference = 1 THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_deleteFltrTxt = v_deleteFltrTxt || (CASE WHEN v_deleteFltrTxt = '' THEN '' ELSE ' AND ' END) ||' (T.' || c_fkColName || ' IS NOT NULL AND NOT EXISTS(SELECT 1 FROM ' || RTRIM(c_tgtTabSchema) || '.' || RTRIM(c_tgtTabName) || ' T2 WHERE T.' || c_fkColName || ' = T2.oid))';");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ELSE");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = v_stmntTxt || ' AND (S.' || c_fkColName || ' IS NULL OR EXISTS(SELECT 1 FROM ' || RTRIM(c_tgtTabSchema) || '.' || RTRIM(c_tgtTabName) || ' T WHERE S.' || c_fkColName || ' = T.oid))';");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_stmntTxt IS NOT NULL THEN");
addStatementIntoTempTable(fileNo, 3, tempTabNameStatementOrgInit, M03_Config.genTimeStampsDuringOrgInit);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 4, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "if table has some 'self-reference' we need to do some specific cleanup", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF c_hasSelfReference = 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "ignore records if they correspond to the same aggregate as other ignored records", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF (c_entityType <> '" + M01_Globals.gc_acmEntityTypeKeyClass + "' OR c_entityName <> c_ahClassName OR c_isGen = 1 OR c_isNl = 1) THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SET v_stmntTxt = 'DELETE FROM ' || RTRIM(c_tgtTabSchemaName) || '.' || RTRIM(c_tabName) || ' WHERE " + M01_Globals.g_anAhOid + " IN (' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "'SELECT DISTINCT S." + M01_Globals.g_anAhOid + " FROM ' || RTRIM(c_srcTabSchemaName) || '.' || RTRIM(c_tabName) || ' S LEFT OUTER JOIN ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(7) + "RTRIM(c_tgtTabSchemaName) || '.' || RTRIM(c_tabName) || ' T ON S." + M01_Globals.g_anOid + " = T." + M01_Globals.g_anOid + " WHERE T." + M01_Globals.g_anOid + " IS NULL)';");

M00_FileWriter.printToFile(fileNo, "");
addStatementIntoTempTable(fileNo, 5, tempTabNameStatementOrgInit, M03_Config.genTimeStampsDuringOrgInit);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 6, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "GET DIAGNOSTICS v_rowCount2 = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SET v_rowCount = v_rowCount - v_rowCount2;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "ignore records referring to other ignored records", 4, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF c_entityType = '" + M01_Globals.gc_acmEntityTypeKeyClass + "' AND c_entityName = c_ahClassName AND c_isGen = 0 AND c_isNl = 0 AND v_deleteFltrTxt <> '' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SET v_stmntTxt = 'DELETE FROM ' || RTRIM(c_tgtTabSchemaName) || '.' || RTRIM(c_tabName) || ' T WHERE ' || v_deleteFltrTxt;");

M00_FileWriter.printToFile(fileNo, "");
addStatementIntoTempTable(fileNo, 5, tempTabNameStatementOrgInit, M03_Config.genTimeStampsDuringOrgInit);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 6, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "GET DIAGNOSTICS v_rowCount2 = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SET v_rowCount = v_rowCount - v_rowCount2;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "update table statistics", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPDATE SESSION.TableData T SET T.numRowsInserted = v_rowCount, T.srcTabSchemaName = c_srcTabSchemaName WHERE T.TgtTabSchemaName = c_tgtTabSchemaName AND T.tabName = c_tabName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF SQLCODE <> 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "SESSION.TableData");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "seqNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "poolTypeId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "numRowsInserted,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "srcTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "TgtTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "c_fkSequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "c_poolTypeId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "v_rowCount,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "c_srcTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "c_tgtTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "c_tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "commit to toggle on logging again", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "RUNSTATS because of run time-problems for subsequent commands", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxtUtil = 'CALL VL6CDBA.RUNSTATS( ''1'', ''' || RTRIM( c_tgtTabSchemaName ) || ''', ''' || RTRIM( c_tabName ) || ''', NULL, NULL, ?, ? )' ;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO " + tempTabNameStatementOrgInit + "( statement ) VALUES( v_stmntTxtUtil );");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxtUtil;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "determine some table names in organization's work data pool", 1, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityName + " AS c_entityName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RTRIM(PTGT." + M01_Globals.g_anPdmFkSchemaName + ") || '.' || RTRIM(PTGT." + M01_Globals.g_anPdmTableName + ") AS c_qualTabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameAcmEntity + " A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " L");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntitySection + " = L." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityName + " = L." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityType + " = L." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " PTGT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PTGT." + M01_Globals.g_anPdmLdmFkSchemaName + " = L." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PTGT." + M01_Globals.g_anPdmLdmFkTableName + " = L." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(A." + M01_Globals.g_anAcmEntityType + " = '" + String.valueOf(M01_Globals.gc_acmEntityTypeKeyClass) + "' AND A." + M01_Globals.g_anAcmEntitySection + " = '" + M22_Class.g_classes.descriptors[M01_Globals_IVK.g_classIndexView].sectionName.toUpperCase() + "' AND A." + M01_Globals.g_anAcmEntityName + " = '" + M22_Class.g_classes.descriptors[M01_Globals_IVK.g_classIndexView].className.toUpperCase() + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(A." + M01_Globals.g_anAcmEntityType + " = '" + String.valueOf(M01_Globals.gc_acmEntityTypeKeyClass) + "' AND A." + M01_Globals.g_anAcmEntitySection + " = '" + M22_Class.g_classes.descriptors[M01_Globals_IVK.g_classIndexEndSlot].sectionName.toUpperCase() + "' AND A." + M01_Globals.g_anAcmEntityName + " = '" + M22_Class.g_classes.descriptors[M01_Globals_IVK.g_classIndexEndSlot].className.toUpperCase() + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(A." + M01_Globals.g_anAcmEntityType + " = '" + String.valueOf(M01_Globals.gc_acmEntityTypeKeyClass) + "' AND A." + M01_Globals.g_anAcmEntitySection + " = '" + M22_Class.g_classes.descriptors[M01_Globals_IVK.g_classIndexGeneralSettings].sectionName.toUpperCase() + "' AND A." + M01_Globals.g_anAcmEntityName + " = '" + M22_Class.g_classes.descriptors[M01_Globals_IVK.g_classIndexGeneralSettings].className.toUpperCase() + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(A." + M01_Globals.g_anAcmEntityType + " = '" + String.valueOf(M01_Globals.gc_acmEntityTypeKeyRel) + "' AND A." + M01_Globals.g_anAcmEntitySection + " = '" + M23_Relationship.g_relationships.descriptors[M01_Globals_IVK.g_relIndexNsr1ValidForOrganization].sectionName.toUpperCase() + "' AND A." + M01_Globals.g_anAcmEntityName + " = '" + M23_Relationship.g_relationships.descriptors[M01_Globals_IVK.g_relIndexNsr1ValidForOrganization].relName.toUpperCase() + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(A." + M01_Globals.g_anAcmEntityType + " = '" + String.valueOf(M01_Globals.gc_acmEntityTypeKeyRel) + "' AND A." + M01_Globals.g_anAcmEntitySection + " = '" + M23_Relationship.g_relationships.descriptors[M01_Globals_IVK.g_relIndexDisplaySlot].sectionName.toUpperCase() + "' AND A." + M01_Globals.g_anAcmEntityName + " = '" + M23_Relationship.g_relationships.descriptors[M01_Globals_IVK.g_relIndexDisplaySlot].relName.toUpperCase() + "')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals_IVK.g_anLdmIsMqt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals.g_anLdmIsGen + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PTGT." + M01_Globals.g_anOrganizationId + " = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COALESCE(PTGT." + M01_Globals.g_anPoolTypeId + "," + String.valueOf(M01_Globals.g_workDataPoolId) + ") = " + String.valueOf(M01_Globals.g_workDataPoolId));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF c_entityName = '" + M01_ACM_IVK.clnView.toUpperCase() + "' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_qualTabNameView = c_qualTabName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSEIF c_entityName = '" + M01_ACM_IVK.clnEndSlot.toUpperCase() + "' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_qualTabNameEndSlot = c_qualTabName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSEIF c_entityName = '" + M01_ACM_IVK.clnGeneralSettings.toUpperCase() + "' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_qualTabNameGeneralSettings = c_qualTabName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSEIF c_entityName = '" + M01_ACM_IVK.rnDisplaySlot.toUpperCase() + "' THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_qualTabNameDisplaySlot = c_qualTabName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_qualTabNameNsrValidForOrganization = c_qualTabName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");
M00_FileWriter.printToFile(fileNo, "");

M11_LRT.genProcSectionHeader(fileNo, "create NSR1-Views", 1, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO ' || v_qualTabNameView || '(' ||");

M24_Attribute_Utilities.AttributeListTransformation transformation;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 4, null, true, null, "'", null, null, null, null, null, null, ",' ||", null, null, null, null);
transformation.suppressAllComma = true;
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM_IVK.conIsDeletable, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, "OVWOWB_OID", "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM_IVK.conPsOid, "'" + M01_Globals_IVK.g_anPsOid + "' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 4, M01_ACM.conVersionId, "", null, null, null);
M24_Attribute_Utilities.EntityColumnDescriptors tabColumns;
tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals_IVK.g_classIndexView, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomList, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "') SELECT ' ||");

M24_Attribute_Utilities.initAttributeTransformation(transformation, 7, null, true, null, "'", null, null, null, null, null, null, "' ||", null, null, null, null);
transformation.suppressAllComma = true;
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM_IVK.conIsDeletable, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, "OVWOWB_OID", "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM_IVK.conIsStandard, "'1,' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 4, M01_ACM_IVK.conName, "'''NSR1'',' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 5, M01_ACM.conOid, "'NEXTVAL FOR " + qualSeqNameOid + ",' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 6, M01_ACM_IVK.conPsOid, "'PS." + M01_Globals.g_anOid + " ' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 7, M01_ACM.conVersionId, "", null, null, null);
tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute.genTransformedAttrListForEntityWithColReuse(M01_Globals_IVK.g_classIndexView, M24_Attribute_Utilities.AcmAttrContainerType.eactClass, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomList, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "'FROM ' ||");
//  Print #fileNo, addTab(2); "'"; "SESSION.PsOids"; " PS '"
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'" + M01_Globals_IVK.g_qualTabNameProductStructure + " PS WHERE PS." + M01_Globals.g_anOid + " IN (' || v_psOidList || ') AND PS." + M01_Globals_IVK.g_anIsUnderConstruction + " = 0 ' ");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M00_FileWriter.printToFile(fileNo, "");
addStatementIntoTempTable(fileNo, 1, tempTabNameStatementOrgInit, M03_Config.genTimeStampsDuringOrgInit);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount2 = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_rowCount = v_rowCount + v_rowCount2;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

int relIndexDisplaySlot;
relIndexDisplaySlot = M23_Relationship.getRelIndexByName(M01_ACM_IVK.rxnDisplaySlot, M01_ACM_IVK.rnDisplaySlot, null);

M11_LRT.genProcSectionHeader(fileNo, "Create DisplaySlots for NSR1-Slots", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO ' || v_qualTabNameDisplaySlot || '(' ||");

M24_Attribute_Utilities.initAttributeTransformation(transformation, 4, null, true, null, "'", null, null, null, null, null, null, ",' ||", null, null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conCreateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conLastUpdateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM_IVK.conPsOid, "'" + M01_Globals_IVK.g_anPsOid + "' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 4, M01_ACM.conVersionId, "", null, null, null);
tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute.genTransformedAttrListForEntityWithColReuse(relIndexDisplaySlot, M24_Attribute_Utilities.AcmAttrContainerType.eactRelationship, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomList, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "') SELECT ' ||");

M24_Attribute_Utilities.initAttributeTransformation(transformation, 12, null, true, null, "'", null, null, null, null, null, null, "' ||", null, null, null, null);
transformation.suppressAllComma = true;
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conCreateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conLastUpdateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM_IVK.conIsDeletable, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 4, "OVWOWB_OID", "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 5, M01_ACM.conOid, "'NEXTVAL FOR " + qualSeqNameOid + ",' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 6, M01_ACM_IVK.conSequenceNumber, "'E.NSR1ORDER,' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 7, "VIW_OID", "'V." + M01_Globals.g_anOid + ",' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 8, "ESL_OID", "'E." + M01_Globals.g_anOid + ",' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 9, M01_ACM.conCreateUser, "'N." + M01_Globals.g_anCreateUser + ",' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 10, M01_ACM.conUpdateUser, "'N." + M01_Globals.g_anUpdateUser + ",' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 11, M01_ACM_IVK.conPsOid, "'V." + M01_Globals_IVK.g_anPsOid + " ' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 12, M01_ACM.conVersionId, "", null, null, null);

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute.genTransformedAttrListForEntityWithColReuse(relIndexDisplaySlot, M24_Attribute_Utilities.AcmAttrContainerType.eactRelationship, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomList, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "'FROM ' || v_qualTabNameView || ' V ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "'INNER JOIN ' || v_qualTabNameNsrValidForOrganization || ' N ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "'ON V." + M01_Globals_IVK.g_anPsOid + " = N." + M01_Globals_IVK.g_anPsOid + " ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "'AND N.ORG_OID = ' || v_orgOid || ' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "'INNER JOIN ' || v_qualTabNameEndSlot || ' E ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "'ON N.ESL_OID = E." + M01_Globals.g_anOid + " ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "'WHERE V." + M01_Globals_IVK.g_anName + " = ''NSR1''';");

M00_FileWriter.printToFile(fileNo, "");
addStatementIntoTempTable(fileNo, 1, tempTabNameStatementOrgInit, M03_Config.genTimeStampsDuringOrgInit);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount2 = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_rowCount = v_rowCount + v_rowCount2;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "Create DisplaySlots for DUP-Slots", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO ' || v_qualTabNameDisplaySlot || '(' ||");

M24_Attribute_Utilities.initAttributeTransformation(transformation, 4, null, true, null, "'", null, null, null, null, null, null, ",' ||", null, null, null, null);
transformation.suppressAllComma = true;
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conCreateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conLastUpdateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM_IVK.conPsOid, "'" + M01_Globals_IVK.g_anPsOid + "' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 4, M01_ACM.conVersionId, "", null, null, null);
tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute.genTransformedAttrListForEntityWithColReuse(relIndexDisplaySlot, M24_Attribute_Utilities.AcmAttrContainerType.eactRelationship, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomList, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "') SELECT ' ||");

M24_Attribute_Utilities.initAttributeTransformation(transformation, 12, null, true, null, "'", null, null, null, null, null, null, "' ||", null, null, null, null);
transformation.suppressAllComma = true;
M24_Attribute_Utilities.setAttributeMapping(transformation, 1, M01_ACM.conCreateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 2, M01_ACM.conLastUpdateTimestamp, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 3, M01_ACM_IVK.conIsDeletable, "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 4, "OVWOWB_OID", "", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 5, M01_ACM.conOid, "'NEXTVAL FOR " + qualSeqNameOid + ",' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 6, M01_ACM_IVK.conSequenceNumber, "'(SELECT MAX(" + M01_Globals_IVK.g_anSequenceNumber + ") +1 FROM ' || v_qualTabNameDisplaySlot || ' S WHERE S." + M01_Globals_IVK.g_anPsOid + " = E." + M01_Globals_IVK.g_anPsOid + "),' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 7, "VIW_OID", "'V." + M01_Globals.g_anOid + ",' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 8, "ESL_OID", "'E." + M01_Globals.g_anOid + ",' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 9, M01_ACM.conCreateUser, "'E." + M01_Globals.g_anCreateUser + ",' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 10, M01_ACM.conUpdateUser, "'E." + M01_Globals.g_anUpdateUser + ",' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 11, M01_ACM_IVK.conPsOid, "'E." + M01_Globals_IVK.g_anPsOid + " ' ||", null, null, null);
M24_Attribute_Utilities.setAttributeMapping(transformation, 12, M01_ACM.conVersionId, "", null, null, null);

tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;
M24_Attribute.genTransformedAttrListForEntityWithColReuse(relIndexDisplaySlot, M24_Attribute_Utilities.AcmAttrContainerType.eactRelationship, transformation, tabColumns, fileNo, ddlType, null, null, 2, null, null, M01_Common.DdlOutputMode.edomList, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "'FROM ' || v_qualTabNameView || ' V ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "'INNER JOIN ' || v_qualTabNameEndSlot || ' E ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "'ON V." + M01_Globals_IVK.g_anPsOid + " = E." + M01_Globals_IVK.g_anPsOid + " ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "'WHERE E." + M01_Globals_IVK.g_anIsDuplicating + " = 1 AND V." + M01_Globals_IVK.g_anName + " = ''NSR1''';");

M00_FileWriter.printToFile(fileNo, "");
addStatementIntoTempTable(fileNo, 1, tempTabNameStatementOrgInit, M03_Config.genTimeStampsDuringOrgInit);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount2 = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_rowCount = v_rowCount + v_rowCount2;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "map ENP <-> EBP in organization's work datapool", 1, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CALL " + qualProcedureNameOrgInitEnp + "(' || RTRIM(CHAR(orgId_in)) || ', ?)';");
M00_FileWriter.printToFile(fileNo, "");
addStatementIntoTempTable(fileNo, 1, tempTabNameStatementOrgInit, M03_Config.genTimeStampsDuringOrgInit);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "PREPARE v_stmnt FROM v_stmntTxt;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_rowCount2");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");

M11_LRT.genProcSectionHeader(fileNo, "accumulate the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_rowCount = v_rowCount + v_rowCount2;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "report timestamp of last FTO in GENERALSETTINGS", 1, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'UPDATE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "v_qualTabNameGeneralSettings ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "' SET ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'LASTCENTRALDATATRANSFERBEGIN = CURRENT TIMESTAMP,' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'LASTCENTRALDATATRANSFERCOMMIT = CURRENT TIMESTAMP'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");
M00_FileWriter.printToFile(fileNo, "");
addStatementIntoTempTable(fileNo, 1, tempTabNameStatementOrgInit, M03_Config.genTimeStampsDuringOrgInit);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "accumulate the number of affected rows", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_rowCount = v_rowCount + v_rowCount2;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "unlock all factory productive data pools", 1, null);
String qualProcNameResetLock;
qualProcNameResetLock = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbMeta, M01_ACM_IVK.spnResetRel2ProdLock, ddlType, null, null, null, "SHAREDREAD", null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR dpLoop AS csr CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OR.ORGOID AS c_orgOid,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SC." + M01_Globals.g_anPoolTypeId + " AS c_accessModeId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PS." + M01_Globals.g_anOid + " AS c_psOid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SESSION.PsOids" + " PS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmOrganization + " OR,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmPrimarySchema + " SC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(OR.ID = SC." + M01_Globals.g_anOrganizationId + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(SC." + M01_Globals.g_anPoolTypeId + " = " + String.valueOf(M01_Globals_IVK.g_productiveDataPoolId) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(SC." + M01_Globals.g_anOrganizationId + " = " + String.valueOf(M01_Globals.g_primaryOrgId) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "unlock data pool", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'CALL " + qualProcNameResetLock + "(''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "RTRIM(CHAR(c_orgOid)) || ',' || RTRIM(CHAR(c_psOid)) || ',' || RTRIM(CHAR(c_accessModeId)) || ''',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'''<admin>'',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'''' || CAST(CASE COALESCE(CURRENT USER, '') WHEN '' THEN '<unknown>' ELSE CURRENT USER END AS " + M01_Globals.g_dbtUserId + ") || ''',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'''ORGINIT'',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'?)';");
M00_FileWriter.printToFile(fileNo, "");
addStatementIntoTempTable(fileNo, 2, tempTabNameStatementOrgInit, M03_Config.genTimeStampsDuringOrgInit);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_numDataPools");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "ignore if lock on data pool could not be released - should not happen", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "unlock all organization's data pools", 1, null);
//  Dim qualProcNameResetLock As String
qualProcNameResetLock = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbMeta, M01_ACM_IVK.spnResetRel2ProdLock, ddlType, null, null, null, "EXCLUSIVEWRITE", null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR dpLoop AS csr CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OR.ORGOID AS c_orgOid,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SC." + M01_Globals.g_anPoolTypeId + " AS c_accessModeId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PS." + M01_Globals.g_anOid + " AS c_psOid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SESSION.PsOids" + " PS,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmOrganization + " OR,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmPrimarySchema + " SC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(OR.ID = SC." + M01_Globals.g_anOrganizationId + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(SC." + M01_Globals.g_anPoolTypeId + " IN ( " + String.valueOf(M01_Globals.g_workDataPoolId) + "," + String.valueOf(M01_Globals_IVK.g_productiveDataPoolId) + " ) )");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(SC." + M01_Globals.g_anOrganizationId + " = orgId_in)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "unlock data pool", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'CALL " + qualProcNameResetLock + "(''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "RTRIM(CHAR(c_orgOid)) || ',' || RTRIM(CHAR(c_psOid)) || ',' || RTRIM(CHAR(c_accessModeId)) || ''',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'''<admin>'',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'''' || CAST(CASE COALESCE(CURRENT USER, '') WHEN '' THEN '<unknown>' ELSE CURRENT USER END AS " + M01_Globals.g_dbtUserId + ") || ''',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'''ORGINIT'',' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + "'?)';");
M00_FileWriter.printToFile(fileNo, "");
addStatementIntoTempTable(fileNo, 2, tempTabNameStatementOrgInit, M03_Config.genTimeStampsDuringOrgInit);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_numDataPools");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "ignore if lock on data pool could not be released - should not happen", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "copy data to organization's non-work data pools", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tabLoop AS tabCursor CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PSRC." + M01_Globals.g_anPdmFkSchemaName + " AS c_srcTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PTGT." + M01_Globals.g_anPdmFkSchemaName + " AS c_tgtTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PTGT." + M01_Globals.g_anPdmTableName + " AS c_tabName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PTGT." + M01_Globals.g_anPoolTypeId + " AS c_poolTypeId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals.g_anLdmFkSequenceNo + " AS c_fkSequenceNo");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameAcmEntity + " A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNameLdmTable + " L");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntitySection + " = L." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityName + " = L." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmEntityType + " = L." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " PTGT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PTGT." + M01_Globals.g_anPdmLdmFkSchemaName + " = L." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PTGT." + M01_Globals.g_anPdmLdmFkTableName + " = L." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + M01_Globals.g_qualTabNamePdmTable + " PSRC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PSRC." + M01_Globals.g_anPdmLdmFkSchemaName + " = L." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PSRC." + M01_Globals.g_anPdmLdmFkTableName + " = L." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "A." + M01_Globals.g_anAcmIsLrt + " = " + M01_LDM.gc_dbTrue);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals_IVK.g_anLdmIsMqt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PTGT." + M01_Globals.g_anOrganizationId + " = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PTGT." + M01_Globals.g_anPoolTypeId + " IN (" + String.valueOf(M01_Globals_IVK.g_productiveDataPoolId) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PSRC." + M01_Globals.g_anOrganizationId + " = orgId_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PSRC." + M01_Globals.g_anPoolTypeId + " = " + M04_Utilities.genPoolId(M01_Globals.g_workDataPoolIndex, ddlType));
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(CASE WHEN A." + M01_Globals.g_anAhCid + " IS NULL THEN 0 ELSE 1 END) DESC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "L." + M01_Globals.g_anLdmFkSequenceNo + " ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PTGT." + M01_Globals.g_anPoolTypeId + " ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'INSERT INTO ' || RTRIM(c_tgtTabSchemaName) || '.' || RTRIM(c_tabName) || ' SELECT S.* FROM ' || RTRIM(c_srcTabSchemaName) || '.' || RTRIM(c_tabName) || ' S';");
M00_FileWriter.printToFile(fileNo, "");
addStatementIntoTempTable(fileNo, 2, tempTabNameStatementOrgInit, M03_Config.genTimeStampsDuringOrgInit);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");

M11_LRT.genProcSectionHeader(fileNo, "count the number of affected rows", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET rowCount_out = rowCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "update table statistics", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "UPDATE SESSION.TableData T SET T.numRowsInserted = v_rowCount, T.srcTabSchemaName = c_srcTabSchemaName WHERE T.TgtTabSchemaName = c_tgtTabSchemaName AND T.tabName = c_tabName;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF SQLCODE <> 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SESSION.TableData");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "seqNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "poolTypeId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "numRowsInserted,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "srcTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tgtTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_fkSequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_poolTypeId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_rowCount,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_srcTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_tgtTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "c_tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "RUNSTATS because of run time-problems for subsequent commands", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxtUtil = 'CALL VL6CDBA.RUNSTATS( ''1'', ''' || RTRIM( c_tgtTabSchemaName ) || ''', ''' || RTRIM( c_tabName ) || ''', NULL, NULL, ?, ? )' ;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO " + tempTabNameStatementOrgInit + "( statement ) VALUES( v_stmntTxtUtil );");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxtUtil;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "commit to toggle on logging again", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "COMMIT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "synchronize MQTs", fileNo, null);

String qualProcNameMqtSync;
qualProcNameMqtSync = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnLrtMqtSync, ddlType, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CALL " + qualProcNameMqtSync + "(' || RTRIM(CHAR(orgId_in)) || ', ?, ?, ?)';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M11_LRT.genProcSectionHeader(fileNo, "declare variables", 3, true);
M11_LRT.genVarDecl(fileNo, "v_orgCountMqt", "INTEGER", "NULL", 3, null);
M11_LRT.genVarDecl(fileNo, "v_tabCountMqt", "INTEGER", "NULL", 3, null);
M11_LRT.genVarDecl(fileNo, "v_rowCountMqt", "BIGINT", "NULL", 3, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_orgCountMqt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_tabCountMqt,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_rowCountMqt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET rowCount_out = rowCount_out + v_rowCountMqt;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "re-enable disabled triggers for organization", null, null);

String qualProcedureNameTrigEnable;
qualProcedureNameTrigEnable = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnTriggerEnable, ddlType, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CALL " + qualProcedureNameTrigEnable + "(NULL, NULL, NULL, NULL, ' || RTRIM(CHAR(orgId_in)) || ', NULL, ?, ?)';");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M11_LRT.genProcSectionHeader(fileNo, "declare variables", 3, true);
M11_LRT.genVarDecl(fileNo, "v_trigCount", "INTEGER", "NULL", 3, null);
M11_LRT.genVarDecl(fileNo, "v_failCount", "INTEGER", "NULL", 3, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_trigCount,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_failCount");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");


}




private static void genDbAdminDdlOrgInit2(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (M03_Config.generateFwkTest) {
return;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
return;
}


String qualProcedureNameOrgInit;
qualProcedureNameOrgInit = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnOrgInit, ddlType, null, null, null, null, null, null);

String tempTabNameStatementOrgInit;
tempTabNameStatementOrgInit = M94_DBAdmin.tempTabNameStatement + "OrgInit";

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "revalidate any object which may be invalidated", null, null);

String qualProcedureNameRevalidate;
qualProcedureNameRevalidate = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnRevalidate, ddlType, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CALL " + qualProcedureNameRevalidate + "(2, ?)';");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_rowCount");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "set GRANTs on new DB-objects", null, null);

String qualProcNameSetGrants;
qualProcNameSetGrants = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "Fltr", M04_Utilities.ObjNameDelimMode.eondmNone, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CALL " + qualProcNameSetGrants + "(2, ''" + M01_Globals.g_allSchemaNamePattern + "' || RIGHT(DIGITS(orgId_in),2) || '%'', NULL, ?)';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_rowCount");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "call \"GENWORKSPACE\"", fileNo, null);

String qualProcNameGenWs;
qualProcNameGenWs = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexMeta, M01_ACM_IVK.spnGenWorkspaceWrapper, ddlType, null, null, null, "_WITHERROR", false, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CALL " + qualProcNameGenWs + "(1, ' || RTRIM(CHAR(orgId_in)) || ', NULL, NULL, 0, 0, ?)';");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES (v_stmntTxt);");
if (M03_Config.genTimeStampsDuringOrgInit) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementOrgInit + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M11_LRT.genProcSectionHeader(fileNo, "declare variables", 3, true);
M11_LRT.genVarDecl(fileNo, "v_callCount", "INTEGER", "NULL", 3, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_callCount");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

// ############################################################

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmtCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + tempTabNameStatementOrgInit);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE tabCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "poolTypeId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "numRowsDeleted,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "numRowsInserted,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "srcTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "tgtTabSchemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "tabName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SESSION.TableData");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "srcTabSchemaName IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "poolTypeId ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "tgtTabSchemaName ASC,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "tabName ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor(s) open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmtCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "OPEN tabCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameOrgInit, ddlType, 1, "mode_in", "orgId_in", "rowCount_out", null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

}


private static void genDbAdminDdlMessageUpdate(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (M03_Config.generateFwkTest) {
return;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
return;
}

int relIndexMessageSeverity;
relIndexMessageSeverity = M23_Relationship.getRelIndexByName(M01_ACM_IVK.rxnMessageSeverity, M01_ACM_IVK.rnMessageSeverity, null);

String qualProcedureNameSetMessageSeverity;
qualProcedureNameSetMessageSeverity = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnSetMessageSeverity, ddlType, null, null, null, null, null, null);

// ####################################################################################################################
// #    SP for setting message severity in ALL MPCs
// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP for setting message severity in ALL MPCs", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameSetMessageSeverity);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' list cleanup-statements, '1' list and execute statements, '2' execute statements only");
M11_LRT.genProcParm(fileNo, "IN", "orgOid_in", M01_Globals.g_dbtOid, true, "(optional) OID of the Organization to set message severity for (default: ALL)");
M11_LRT.genProcParm(fileNo, "IN", "oid_in", M01_Globals.g_dbtOid, true, "OID to use for new record");
M11_LRT.genProcParm(fileNo, "IN", "msgOid_in", M01_Globals.g_dbtOid, true, "OID to Message to set severity for");
M11_LRT.genProcParm(fileNo, "IN", "divOid_in", M01_Globals.g_dbtOid, true, "OID to Division to set severity for");
M11_LRT.genProcParm(fileNo, "IN", "severityId_in", "BIGINT", true, "ID of the Severity to set");
M11_LRT.genProcParm(fileNo, "IN", "cdUserId_in", M01_Globals.g_dbtUserId, true, "UserId of the user used for " + M01_Globals.g_anCreateUser + " / " + M01_Globals.g_anUpdateUser);
M11_LRT.genProcParm(fileNo, "IN", "timestamp_in", "TIMESTAMP", true, "(optional) timestamp to use for " + M01_Globals.g_anCreateTimestamp + " / " + M01_Globals.g_anLastUpdateTimestamp + " (default: CURRENT TIMESTAMP)");
M11_LRT.genProcParm(fileNo, "IN", "overwrite_in", M01_Globals.g_dbtBoolean, true, "if set to '1' overwrite severity if record exists for given MSG_OID and DIV_OID");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of records INSERTED / UPDATED");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(32000)", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_recordCount", "INTEGER", "0", null, null);
M79_Err.genSigMsgVarDecl(fileNo, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare cursor", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE c CURSOR FOR v_stmnt;");

String tempTabNameStatementSetMsgSev;
tempTabNameStatementSetMsgSev = M94_DBAdmin.tempTabNameStatement + "SetMsgSev";

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 400, true, true, true, null, "SetMsgSev", null, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameSetMessageSeverity, ddlType, null, "mode_in", "orgOid_in", "oid_in", "msgOid_in", "divOid_in", "severityId_in", "'cdUserId_in", "timestamp_in", "overwrite_in", "rowCount_out", null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "verify timestamp", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET timestamp_in = COALESCE(timestamp_in, CURRENT TIMESTAMP);");

M11_LRT.genProcSectionHeader(fileNo, "loop over Organizations", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR orgLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anPdmFkSchemaName + " AS c_schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anPdmTableName + " AS c_tableName");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameAcmEntity + " A");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNameLdmTable + " L");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntitySection + " = L." + M01_Globals.g_anAcmEntitySection);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntityName + " = L." + M01_Globals.g_anAcmEntityName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntityType + " = L." + M01_Globals.g_anAcmEntityType);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "L." + M01_Globals.g_anLdmIsNl + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "L." + M01_Globals.g_anLdmIsGen + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "L." + M01_Globals.g_anLdmIsLrt + " = " + M01_LDM.gc_dbFalse);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNamePdmTable + " P");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anPdmLdmFkSchemaName + " = L." + M01_Globals.g_anLdmSchemaName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anPdmLdmFkTableName + " = L." + M01_Globals.g_anLdmTableName);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + M01_Globals.g_qualTabNamePdmOrganization + " O");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anOrganizationId + " = O.ID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "COALESCE(orgOid_in, O.ORGOID) = O.ORGOID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "P." + M01_Globals.g_anPoolTypeId + " IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntityType + " = '" + M01_Globals.gc_acmEntityTypeKeyRel + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "A." + M01_Globals.g_anAcmEntityId + " = '" + M23_Relationship.getRelIdStrByIndex(relIndexMessageSeverity) + "'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "O.ORGOID");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "check whether record exists for this organization and given MSG_OID and DIV_OID", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'SELECT COUNT(*) FROM ' || RTRIM(c_schemaName) || '.' || c_tableName || ' WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'MSG_OID = ' || RTRIM(CHAR(msgOid_in)) || ' AND DIV_OID = ' || RTRIM(CHAR(divOid_in));");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "OPEN c;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FETCH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "c");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "v_recordCount");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "CLOSE c;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = NULL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_recordCount > 0 THEN");
M11_LRT.genProcSectionHeader(fileNo, "if record exists overwrite if requested", 3, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF overwrite_in = 1 THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = 'UPDATE ' || RTRIM(c_schemaName) || '.' || c_tableName || ' SET ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'SEVERITY_ID = ' || RTRIM(CHAR(severityId_in)) || ', " + M01_Globals.g_anUpdateUser + " = ''' || cdUserId_in || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'" + M01_Globals.g_anLastUpdateTimestamp + " = ''' || CHAR(timestamp_in) || ''', " + M01_Globals.g_anVersionId + " = " + M01_Globals.g_anVersionId + "+1 ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'WHERE MSG_OID = ' || RTRIM(CHAR(msgOid_in)) || ' AND DIV_OID = ' || RTRIM(CHAR(divOid_in));");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ELSE");
M11_LRT.genProcSectionHeader(fileNo, "if record does not exist insert it", 3, true);

M24_Attribute_Utilities.EntityColumnDescriptors tabColumns;
tabColumns = M24_Attribute_Utilities.nullEntityColumnDescriptors;

M24_Attribute_Utilities.AttributeListTransformation transformation;
M24_Attribute_Utilities.initAttributeTransformation(transformation, 0, null, true, null, null, null, null, null, null, null, null, null, null, null, null, null);
transformation.trimRight = false;
M24_Attribute.genTransformedAttrListForEntityWithColReuse(relIndexMessageSeverity, M24_Attribute_Utilities.AcmAttrContainerType.eactRelationship, transformation, tabColumns, fileNo, ddlType, null, null, 3, null, null, M01_Common.DdlOutputMode.edomNone, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'INSERT INTO ' || RTRIM(c_schemaName) || '.' || c_tableName || '(' ||");

int k;
for (int k = 1; k <= tabColumns.numDescriptors; k++) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'" + tabColumns.descriptors[k].columnName + (k == tabColumns.numDescriptors ? "" : ",") + "' ||");
}

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "') VALUES (' ||");

for (int k = 1; k <= tabColumns.numDescriptors; k++) {
if (tabColumns.descriptors[k].columnName.compareTo(M01_Globals.g_anOid) == 0) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "RTRIM(CHAR(oid_in))");
} else if (tabColumns.descriptors[k].columnName.compareTo("SEVERITY_ID") == 0) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "RTRIM(CHAR(severityId_in))");
} else if ((tabColumns.descriptors[k].columnName.compareTo(M01_Globals.g_anCreateUser) == 0 |  tabColumns.descriptors[k].columnName.compareTo(M01_Globals.g_anUpdateUser) == 0)) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'''' || cdUserId_in || ''''");
} else if ((tabColumns.descriptors[k].columnName.compareTo(M01_Globals.g_anCreateTimestamp) == 0 |  tabColumns.descriptors[k].columnName.compareTo(M01_Globals.g_anLastUpdateTimestamp) == 0)) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'TIMESTAMP(''' || CHAR(timestamp_in) || ''')'");
} else if (tabColumns.descriptors[k].columnName.compareTo("MSG_OID") == 0) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "RTRIM(CHAR(msgOid_in))");
} else if (tabColumns.descriptors[k].columnName.compareTo("DIV_OID") == 0) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "RTRIM(CHAR(divOid_in))");
} else if (tabColumns.descriptors[k].columnName.compareTo(M01_Globals.g_anVersionId) == 0) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'1'");
} else {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'" + tabColumns.descriptors[k].columnName + "'");
}

M00_FileWriter.printToFile(fileNo, " ||" + (k == tabColumns.numDescriptors ? "" : " ',' ||"));
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "')'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_stmntTxt IS NOT NULL THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in <= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + tempTabNameStatementSetMsgSev);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "STATEMENT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in >= 1 THEN");
M11_LRT.genProcSectionHeader(fileNo, "update record", 4, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET rowCount_out = rowCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "DECLARE resCursor CURSOR WITH RETURN FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + tempTabNameStatementSetMsgSev);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "seqNo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "OPEN resCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameSetMessageSeverity, ddlType, null, "mode_in", "orgOid_in", "oid_in", "msgOid_in", "divOid_in", "severityId_in", "'cdUserId_in", "timestamp_in", "overwrite_in", "rowCount_out", null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);
}


// ### ENDIF IVK ###
public static void genDbAdminDdlByPool( Integer thisOrgIndexW,  Integer thisPoolIndexW, Integer ddlTypeW) {
int thisOrgIndex; 
if (thisOrgIndexW == null) {
thisOrgIndex = -1;
} else {
thisOrgIndex = thisOrgIndexW;
}

int thisPoolIndex; 
if (thisPoolIndexW == null) {
thisPoolIndex = -1;
} else {
thisPoolIndex = thisPoolIndexW;
}

Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtLdm;
} else {
ddlType = ddlTypeW;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
return;
}

if (thisOrgIndex < 1 |  thisPoolIndex < 1) {
return;
}

if (!(M72_DataPool.g_pools.descriptors[thisPoolIndex].supportAcm)) {
return;
}

//On Error GoTo ErrorExit 

int fileNo;
fileNo = M04_Utilities.openDdlFile(M01_Globals.g_targetDir, M01_Globals.g_sectionIndexDbAdmin, processingStepAdmin, ddlType, thisOrgIndex, thisPoolIndex, null, M01_Common.phaseDbSupport, null);

String qualProcedureNameCleanupGlobal;
qualProcedureNameCleanupGlobal = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnCleanData, ddlType, null, null, null, null, null, null);

String qualProcedureNameCleanupLocal;
qualProcedureNameCleanupLocal = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexAliasLrt, M01_ACM.spnCleanData, ddlType, thisOrgIndex, thisPoolIndex, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for executing data cleanup jobs (wrapper with unique name / no overloadding)", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameCleanupLocal);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' list cleanup-statements, '1' list and execute statements, '2' execute statements only");
M11_LRT.genProcParm(fileNo, "IN", "jobCategory_in", "VARCHAR(20)", true, "category of the clean-job to execute");
M11_LRT.genProcParm(fileNo, "IN", "jobName_in", "VARCHAR(20)", true, "name of the clean-job to execute");
M11_LRT.genProcParm(fileNo, "IN", "level_in", "INTEGER", true, "(optional) level to use for column filtering");
M11_LRT.genProcParm(fileNo, "IN", "parameter1_in", "VARCHAR(30)", true, "(optional) parameter 1 to use in condition term for job");
M11_LRT.genProcParm(fileNo, "IN", "parameter2_in", "VARCHAR(30)", true, "(optional) parameter 2 to use in condition term for job");
M11_LRT.genProcParm(fileNo, "IN", "parameter3_in", "VARCHAR(30)", true, "(optional) parameter 3 to use in condition term for job");

M11_LRT.genProcParm(fileNo, "OUT", "stmntCount_out", "INTEGER", true, "number of statements for this job");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of rows deleted in any table");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M07_SpLogging.genSpLogDecl(fileNo, -1, true);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameCleanupLocal, ddlType, null, "mode_in", "'jobCategory_in", "'jobName_in", "level_in", "'parameter1_in", "'parameter2_in", "'parameter3_in", "stmntCount_out", "rowCount_out", null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameCleanupGlobal + "(mode_in, jobCategory_in, jobName_in, level_in, parameter1_in, parameter2_in, parameter3_in, stmntCount_out, rowCount_out);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameCleanupLocal, ddlType, null, "mode_in", "'jobCategory_in", "'jobName_in", "level_in", "'parameter1_in", "'parameter2_in", "'parameter3_in", "stmntCount_out", "rowCount_out", null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

NormalExit:
//On Error Resume Next 
M00_FileWriter.closeFile(fileNo);
return;

ErrorExit:
errMsgBox(Err.description);
Resume(NormalExit);
}


// ### IF IVK ###
private static void genDdlAddTestUser(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (!(M03_Config.supportAddTestUser)) {
return;
}

//On Error GoTo ErrorExit 

String qualTabNameMdsUserNlText;
qualTabNameMdsUserNlText = M04_Utilities.genQualNlTabNameByClassIndex(M01_Globals.g_classIndexUser, ddlType, null, null, null, null, null, null, null, null, null);

// ####################################################################################################################
// #    SP creating Test-UserIDs
// ####################################################################################################################

String qualProcedureNameCreateTestUser;
qualProcedureNameCreateTestUser = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM_IVK.spnAddTestUser, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP creating Test-UserIDs", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameCreateTestUser);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "userCount_out", "INTEGER", true, "number of userIDs created");
M11_LRT.genProcParm(fileNo, "OUT", "privCount_out", "INTEGER", true, "number of privileges created");
M11_LRT.genProcParm(fileNo, "OUT", "grantCount_out", "INTEGER", false, "number of grants set");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, true);
M11_LRT.genCondDecl(fileNo, "dupKey", "23505", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_userIdNum", "INTEGER", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(2000)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR dupKey");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "-- just ignore");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

String qualTempTabNameAddUser;
qualTempTabNameAddUser = M94_DBAdmin.tempTabNameStatement + "AddTestUser";
M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 400, true, true, true, null, "AddTestUser", true, null, null, null, null, null, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameCreateTestUser, ddlType, null, "mode_in", "userCount_out", "privCount_out", "grantCount_out", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET userCount_out  = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET privCount_out  = 0;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET grantCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "create 251 P-user + 51 D-User", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHILE v_userIdNum <= 250 DO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF v_userIdNum <= 50 THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF NOT EXISTS (SELECT 1 FROM " + M01_Globals.g_qualTabNameUser + " WHERE " + M01_Globals.g_anUserId + " = CAST('D' || RIGHT(DIGITS(v_userIdNum), 6) AS " + M01_Globals.g_dbtUserId + ") OR OID = 140 + v_userIdNum) THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = 'INSERT INTO " + M01_Globals.g_qualTabNameUser + " (OID, " + M01_Globals.g_anUserId + ", " + M01_Globals.g_anUserName + ", " + M01_Globals_IVK.g_anIsActive + ", " + M01_Globals.g_anCreateUser + ", " + M01_Globals.g_anUpdateUser + ") ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + " 'VALUES (' || RTRIM(CHAR(140 + v_userIdNum)) || ', ''D' || RIGHT(DIGITS(v_userIdNum), 6) || ''', ''NAME_D' || RIGHT(DIGITS(v_userIdNum), 6) || ''', 1, ''1'', ''MIG'')';");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF mode_in < 2 THEN INSERT INTO " + qualTempTabNameAddUser + "(statement) VALUES (v_stmntTxt); END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF mode_in > 0 THEN EXECUTE IMMEDIATE v_stmntTxt; END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = 'INSERT INTO " + qualTabNameMdsUserNlText + " (OID, USR_OID, " + M01_Globals.g_anLanguageId + ", COMMENT, RESPONSIBILITY) ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + " 'VALUES (' || RTRIM(CHAR(1100 + v_userIdNum)) || ', ' || RTRIM(CHAR(140 + v_userIdNum)) || ', 1, ''Devtestuser' || RIGHT(DIGITS(v_userIdNum), 2) || ''', '''')';");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF mode_in < 2 THEN INSERT INTO " + qualTempTabNameAddUser + "(statement) VALUES (v_stmntTxt); END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF mode_in > 0 THEN EXECUTE IMMEDIATE v_stmntTxt; END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET v_stmntTxt = 'INSERT INTO " + qualTabNameMdsUserNlText + " (OID, USR_OID, " + M01_Globals.g_anLanguageId + ", COMMENT, RESPONSIBILITY) ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(12) + " 'VALUES (' || RTRIM(CHAR(1200 + v_userIdNum)) || ', ' || RTRIM(CHAR(140 + v_userIdNum)) || ', 1, ''Devtestuser' || RIGHT(DIGITS(v_userIdNum), 2) || ' engl.'', '''')';");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF mode_in < 2 THEN INSERT INTO " + qualTempTabNameAddUser + "(statement) VALUES (v_stmntTxt); END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "IF mode_in > 0 THEN EXECUTE IMMEDIATE v_stmntTxt; END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SET userCount_out = userCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF NOT EXISTS (SELECT 1 FROM " + M01_Globals.g_qualTabNameUser + "  WHERE " + M01_Globals.g_anUserId + " = CAST('P' || RIGHT(DIGITS(v_userIdNum), 6) AS " + M01_Globals.g_dbtUserId + ") OR OID = 240 + v_userIdNum) THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'INSERT INTO " + M01_Globals.g_qualTabNameUser + " (OID, " + M01_Globals.g_anUserId + ", " + M01_Globals.g_anUserName + ", " + M01_Globals_IVK.g_anIsActive + ", " + M01_Globals.g_anCreateUser + ", " + M01_Globals.g_anUpdateUser + ") ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(11) + " 'VALUES (' || RTRIM(CHAR(240 + v_userIdNum)) || ', ''P' || RIGHT(DIGITS(v_userIdNum), 6) || ''', ''NAME_P' || RIGHT(DIGITS(v_userIdNum), 6) || ''', 1, ''1'', ''MIG'')';");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in < 2 THEN INSERT INTO " + qualTempTabNameAddUser + "(statement) VALUES (v_stmntTxt); END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in > 0 THEN EXECUTE IMMEDIATE v_stmntTxt; END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'INSERT INTO " + qualTabNameMdsUserNlText + " (OID, USR_OID, " + M01_Globals.g_anLanguageId + ", COMMENT, RESPONSIBILITY) ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(11) + " 'VALUES (' || RTRIM(CHAR(1300 + v_userIdNum)) || ', ' || RTRIM(CHAR(240 + v_userIdNum)) || ', 1, ''Testuser' || RIGHT(DIGITS(v_userIdNum), 3) || ''', '''')';");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in < 2 THEN INSERT INTO " + qualTempTabNameAddUser + "(statement) VALUES (v_stmntTxt); END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in > 0 THEN EXECUTE IMMEDIATE v_stmntTxt; END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'INSERT INTO " + qualTabNameMdsUserNlText + " (OID, USR_OID, " + M01_Globals.g_anLanguageId + ", COMMENT, RESPONSIBILITY) ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(11) + " 'VALUES (' || RTRIM(CHAR(1600 + v_userIdNum)) || ', ' || RTRIM(CHAR(240 + v_userIdNum)) || ', 1, ''Testuser' || RIGHT(DIGITS(v_userIdNum), 3) || ' engl.'', '''')';");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in < 2 THEN INSERT INTO " + qualTempTabNameAddUser + "(statement) VALUES (v_stmntTxt); END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in > 0 THEN EXECUTE IMMEDIATE v_stmntTxt; END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET userCount_out = userCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_userIdNum = v_userIdNum + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END WHILE;");

M11_LRT.genProcSectionHeader(fileNo, "create some extra user", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR usrLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_User");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "numId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "cdUserId");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES(1, 'PWEISSB')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES(2, 'PESCHAI')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES(3, 'STESTOC')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES(4, 'CHGALST')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "UNION ALL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES(5, 'RBENDRI')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "numId    AS c_numId,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "cdUserId AS c_cdUserId");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_User");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "numId");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF NOT EXISTS (SELECT 1 FROM " + M01_Globals.g_qualTabNameUser + "  WHERE " + M01_Globals.g_anUserId + " = c_cdUserId OR OID = 490 + c_numId) THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'INSERT INTO " + M01_Globals.g_qualTabNameUser + " (OID, " + M01_Globals.g_anUserId + ", " + M01_Globals.g_anUserName + ", " + M01_Globals_IVK.g_anIsActive + ", " + M01_Globals.g_anCreateUser + ", " + M01_Globals.g_anUpdateUser + ") VALUES (' || RTRIM(CHAR(490 + c_numId)) || ', ''' || c_cdUserId || ''', ''NAME_' || c_cdUserId || ''', 1, ''1'', ''MIG'')';");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in < 2 THEN INSERT INTO " + qualTempTabNameAddUser + "(statement) VALUES (v_stmntTxt); END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in > 0 THEN EXECUTE IMMEDIATE v_stmntTxt; END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'INSERT INTO " + qualTabNameMdsUserNlText + " (OID, USR_OID, " + M01_Globals.g_anLanguageId + ", COMMENT, RESPONSIBILITY, " + M01_Globals.g_anVersionId + ") values (' || RTRIM(CHAR(1550 + c_numId)) || ', ' || RTRIM(CHAR(490 + c_numId)) || ', 1, ''' || c_cdUserId || ''', '''', 1)';");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in < 2 THEN INSERT INTO " + qualTempTabNameAddUser + "(statement) VALUES (v_stmntTxt); END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in > 0 THEN EXECUTE IMMEDIATE v_stmntTxt; END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = 'INSERT INTO " + qualTabNameMdsUserNlText + " (OID, USR_OID, " + M01_Globals.g_anLanguageId + ", COMMENT, RESPONSIBILITY, " + M01_Globals.g_anVersionId + ") values (' || RTRIM(CHAR(1850 + c_numId)) || ', ' || RTRIM(CHAR(490 + c_numId)) || ', 2, ''' || c_cdUserId || ' engl.'', '''', 1)';");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in < 2 THEN INSERT INTO " + qualTempTabNameAddUser + "(statement) VALUES (v_stmntTxt); END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in > 0 THEN EXECUTE IMMEDIATE v_stmntTxt; END IF;");

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET userCount_out = userCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "add DB-Privileges", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR usrLoop AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_Priv");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "environment,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "opType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "objectType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "objectName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "filter,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "granteeType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "grantee,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "privilege,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "withGrant");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");

int i;
boolean firstPriv;
firstPriv = true;
for (int i = 1; i <= M79_Privileges.g_privileges.numDescriptors; i++) {
if (M79_Privileges.g_privileges.descriptors[i].environment.compareTo("T") == 0) {
if (!(firstPriv)) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UNION ALL");
} else {
firstPriv = false;
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES(" + (M79_Privileges.g_privileges.descriptors[i].sequenceNumber < 0 ? "CAST(NULL AS SMALLINT)" : "SMALLINT(" + String.valueOf(M79_Privileges.g_privileges.descriptors[i].sequenceNumber) + ")") + ", " + "'" + M79_Privileges.g_privileges.descriptors[i].environment + "', " + "'" + M79_Privileges.g_privileges.descriptors[i].operation + "', " + "'" + M79_Privileges.g_privileges.descriptors[i].objectType + "', " + (M79_Privileges.g_privileges.descriptors[i].schemaName.compareTo("") == 0 ? "CAST(NULL AS VARCHAR(1))" : "'" + M79_Privileges.g_privileges.descriptors[i].schemaName + "'") + ", " + (M79_Privileges.g_privileges.descriptors[i].objectName.compareTo("") == 0 ? "CAST(NULL AS VARCHAR(1))" : "'" + M79_Privileges.g_privileges.descriptors[i].objectName + "'") + ", " + (M79_Privileges.g_privileges.descriptors[i].filter.compareTo("") == 0 ? "CAST(NULL AS VARCHAR(1))" : "'" + M79_Privileges.g_privileges.descriptors[i].filter + "'") + ", " + "'" + M79_Privileges.g_privileges.descriptors[i].granteeType + "', " + (M79_Privileges.g_privileges.descriptors[i].grantee.compareTo("") == 0 ? "CAST(NULL AS VARCHAR(1))" : "'" + M79_Privileges.g_privileges.descriptors[i].grantee + "'") + ", " + "'" + M79_Privileges.g_privileges.descriptors[i].privilege + "', " + (M79_Privileges.g_privileges.descriptors[i].withGrantOption ? M01_LDM.gc_dbTrue : M01_LDM.gc_dbFalse) + ")");
}
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "sequenceNo  AS c_sequenceNo,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "environment AS c_environment,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "opType      AS c_opType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "objectType  AS c_objectType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "schemaName  AS c_schemaName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "objectName  AS c_objectName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "filter      AS c_filter,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "granteeType AS c_granteeType,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "grantee     AS c_grantee,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "privilege   AS c_privilege,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "withGrant   AS c_withGrant");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_Priv");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "NOT EXISTS (");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + M01_Globals.g_qualTabNameDbPrivileges + " P");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE(RTRIM(CHAR(P.SEQUENCENO)), '') = COALESCE(RTRIM(CHAR(c_sequenceNo)), '')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "P.ENVIRONMENT = c_environment");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "P.OPTYPE = c_opType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "P.OBJECTTYPE = c_objectType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE(P.SCHEMANAME, '') = COALESCE(c_schemaName, '')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE(P.OBJECTNAME, '') = COALESCE(c_objectName, '')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE(P.FILTER, '') = COALESCE(c_filter, '')");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "P.GRANTEETYPE = c_granteeType");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE(P.GRANTEE, '') = c_grantee");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "P.PRIVILEGE = c_privilege");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "P.WITHGRANT = c_withGrant");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ") THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt =");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'INSERT INTO ' ||");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'" + M01_Globals.g_qualTabNameDbPrivileges + " ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'(' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'SEQUENCENO, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'ENVIRONMENT, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'OPTYPE, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'OBJECTTYPE, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'SCHEMANAME, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'OBJECTNAME, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'FILTER, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'GRANTEETYPE, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'GRANTEE, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'PRIVILEGE, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'WITHGRANT' || ");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "') ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'VALUES ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "'(' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE('''' || RTRIM(CHAR(c_sequenceNo)) || '''', 'CAST(NULL AS SMALLINT)') || ', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'''' || c_environment || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'''' || c_opType || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'''' || c_objectType || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE('''' || c_schemaName || '''', 'CAST(NULL AS VARCHAR(1))') || ', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE('''' || c_objectName || '''', 'CAST(NULL AS VARCHAR(1))') || ', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE('''' || c_filter || '''', 'CAST(NULL AS VARCHAR(1))') || ', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'''' || c_granteeType || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "COALESCE('''' || c_grantee || '''', 'CAST(NULL AS VARCHAR(1))') || ', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'''' || c_privilege || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "'''' || RTRIM(CHAR(c_withGrant)) || '''' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "')';");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in < 2 THEN INSERT INTO " + qualTempTabNameAddUser + "(statement) VALUES (v_stmntTxt); END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "IF mode_in > 0 THEN EXECUTE IMMEDIATE v_stmntTxt; END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET privCount_out = privCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

String qualProcedureNameGrantByEnv;
qualProcedureNameGrantByEnv = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnGrant, ddlType, null, null, null, "ByEnv", M04_Utilities.ObjNameDelimMode.eondmNone, null);

M11_LRT.genProcSectionHeader(fileNo, "if new privileges were defined, apply them", 1, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF privCount_out > 0 THEN");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'CALL " + qualProcedureNameGrantByEnv + " (''T'', 2, ?)';");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in < 2 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + qualTempTabNameAddUser + "(statement) VALUES (v_stmntTxt);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in > 0 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "BEGIN");
M11_LRT.genProcSectionHeader(fileNo, "declare statement", 4, true);
M11_LRT.genVarDecl(fileNo, "v_stmnt", "STATEMENT", null, 4, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "PREPARE v_stmnt FROM v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "EXECUTE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "v_stmnt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "grantCount_out");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ";");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "END;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", 1, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in < 2 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE resCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + qualTempTabNameAddUser);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "seqNo");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN resCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameCreateTestUser, ddlType, null, "mode_in", "userCount_out", "privCount_out", "grantCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

// ####################################################################################################################

M22_Class_Utilities.printSectionHeader("SP creating Test-UserIDs", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameCreateTestUser);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "OUT", "userCount_out", "INTEGER", false, "number of userIDs created");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, true);
M11_LRT.genVarDecl(fileNo, "v_privCount", "INTEGER", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_grantCount", "INTEGER", "0", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameCreateTestUser, ddlType, null, "mode_in", "userCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "CALL " + qualProcedureNameCreateTestUser + "(mode_in, userCount_out, v_privCount, v_grantCount);");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameCreateTestUser, ddlType, null, "mode_in", "userCount_out", null, null, null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

NormalExit:
return;

ErrorExit:
errMsgBox(Err.description);
Resume(NormalExit);
}


// ### ENDIF IVK ###
private static void genDdlDbCompact(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}

if (!(M03_Config.supportDbCompact)) {
return;
}

//On Error GoTo ErrorExit 

// ####################################################################################################################
// #    SP compacting database
// ####################################################################################################################

String qualProcedureNameDbCompact;
qualProcedureNameDbCompact = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnDbCompact, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP compacting database", fileNo, null, null);
M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameDbCompact);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");

M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "tsNamePattern_in", "VARCHAR(30)", true, "(optional) name (pattern) of tablespace(s) to compact");
M11_LRT.genProcParm(fileNo, "IN", "contingencyPercent_in", "INTEGER", true, "(optional) minimum amount of 'free space' left in tablespace (default 10)");
M11_LRT.genProcParm(fileNo, "IN", "minPages_in", "INTEGER", true, "(optional) minimum number of 'free space' left in tablespace (default 0)");
M11_LRT.genProcParm(fileNo, "OUT", "rowCount_out", "INTEGER", false, "number of statements executed / created");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR(200)", "NULL", null, null);
M07_SpLogging.genSpLogDecl(fileNo, null, null);

String qualTempTabNameDbCompact;
qualTempTabNameDbCompact = M94_DBAdmin.tempTabNameStatement + "DbCompact";
M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 200, true, true, true, null, "DbCompact", true, null, true, null, "msg", "VARCHAR(30)", null, null);

M07_SpLogging.genSpLogProcEnter(fileNo, qualProcedureNameDbCompact, ddlType, null, "mode_in", "'tsNamePattern_in", "contingencyPercent_in", "rowCount_out", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "verify input parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET contingencyPercent_in = COALESCE(contingencyPercent_in, 10);");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET tsNamePattern_in      = COALESCE(UPPER(tsNamePattern_in), '%');");

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET rowCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "loop over tablespaces", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tsLoop AS tsCsr CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WITH");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_TabSpaces");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tsName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tsAutoStorage,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "usablePages,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "targetPages,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "maxDeltaTech,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "maxDeltaTarget");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TSS.TBSP_NAME,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TSS.TBSP_USING_AUTO_STORAGE,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TSP.TBSP_USABLE_PAGES,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "INTEGER(FLOAT(TSP.TBSP_USED_PAGES) * (1+(FLOAT(contingencyPercent_in)/100))) + 1,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TSP.TBSP_USABLE_PAGES - TSP.TBSP_PAGE_TOP,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TSP.TBSP_USABLE_PAGES - (INTEGER(FLOAT(TSP.TBSP_USED_PAGES) * (1+(FLOAT(contingencyPercent_in)/100))) + 1)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE(SYSPROC.SNAP_GET_TBSP_V91(CURRENT SERVER,-1)) AS TSS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INNER JOIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TABLE(SYSPROC.SNAP_GET_TBSP_PART_V97(CURRENT SERVER,-1)) AS TSP");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "ON");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "TSS.TBSP_NAME = TSP.TBSP_NAME");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "UPPER(TSS.TBSP_NAME) LIKE tsNamePattern_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "),");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_TabSpacesDelta");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tsName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tsAutoStorage,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "maxDelta");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "AS");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tsName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "tsAutoStorage,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(CASE WHEN maxDeltaTech > maxDeltaTarget THEN maxDeltaTarget ELSE maxDeltaTech END)");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "V_TabSpaces");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "targetPages < usablePages");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "minPages_in IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(6) + "OR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "targetPages > minPages_in");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tsName        AS c_tsName,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "tsAutoStorage AS c_tsAutoStorage,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "maxDelta      AS c_maxDelta");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "V_TabSpacesDelta");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "maxDelta > 0");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "assemble ALTER TABLESPACE statement", 2, true);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'ALTER TABLESPACE ' || RTRIM(c_tsName) || ' REDUCE';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF (c_tsAutoStorage = '0') THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET v_stmntTxt = v_stmntTxt || ' (ALL CONTAINERS ' || RTRIM(CHAR(c_maxDelta)) || ')';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "store statement in temporary table", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + qualTempTabNameDbCompact);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "VALUES");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "(");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "v_stmntTxt");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ");");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "execute configuration", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "count statement", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET rowCount_out = rowCount_out + 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE resCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + qualTempTabNameDbCompact);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "seqNo ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN resCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M07_SpLogging.genSpLogProcExit(fileNo, qualProcedureNameDbCompact, ddlType, null, "mode_in", "'tsNamePattern_in", "contingencyPercent_in", "rowCount_out", null, null, null, null, null, null, null, null);

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

NormalExit:
return;

ErrorExit:
errMsgBox(Err.description);
Resume(NormalExit);
}


private static void genDbAdminDdlDivCreate(int fileNo, Integer ddlTypeW) {
Integer ddlType; 
if (ddlTypeW == null) {
ddlType = M01_Common.DdlTypeId.edtPdm;
} else {
ddlType = ddlTypeW;
}


if (M03_Config.generateFwkTest) {
return;
}

if (ddlType != M01_Common.DdlTypeId.edtPdm) {
return;
}

String qualTabNameMdsUser;
qualTabNameMdsUser = M01_Globals.g_qualTabNameUser;

String qualTabNameDivision;
qualTabNameDivision = M01_Globals_IVK.g_qualTabNameDivision;

String qualTabNameDivisionNlText;
qualTabNameDivisionNlText = M04_Utilities.genQualTabNameByClassIndex(M01_Globals_IVK.g_classIndexDivision, ddlType, M01_Globals.g_primaryOrgIndex, M01_Globals.g_workDataPoolIndex, null, null, null, true, null, null, null);

String qualTabNamePdmSchema;
qualTabNamePdmSchema = M01_Globals.g_qualTabNamePdmSchema;

String qualTabNameMessage;
qualTabNameMessage = M01_Globals_IVK.g_qualTabNameMessage;

String oidSeqName;
oidSeqName = M71_Org.genQualOidSeqNameForOrg(-1, ddlType, null, null, null, null);


// ####################################################################################################################
// #    SP for Create a new division
// ####################################################################################################################

String qualProcedureNameDivCreate;
qualProcedureNameDivCreate = M04_Utilities.genQualProcName(M01_Globals.g_sectionIndexDbAdmin, M01_ACM.spnDivCreate, ddlType, null, null, null, null, null, null);

M22_Class_Utilities.printSectionHeader("SP for initialization of organization's meta data DUP-Code", fileNo, null, null);

M00_FileWriter.printToFile(fileNo, "");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "CREATE OR REPLACE PROCEDURE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + qualProcedureNameDivCreate);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "(");
M11_LRT.genProcParm(fileNo, "IN", "mode_in", "INTEGER", true, "'0' - only list statements, '1' list and execute, '2' execute only");
M11_LRT.genProcParm(fileNo, "IN", "cdUserId_in", "VARCHAR(  16 )", true, "CD User Id of the mdsUser");
M11_LRT.genProcParm(fileNo, "IN", "label1_in", "VARCHAR( 255 )", true, "label of Division            (corresponding to languageId1_in)");
M11_LRT.genProcParm(fileNo, "IN", "description1_in", "VARCHAR( 382 )", true, "description text of Division (corresponding to languageId1_in)");
M11_LRT.genProcParm(fileNo, "IN", "label2_in", "VARCHAR( 255 )", true, "label of Division            (corresponding to languageId2_in)");
M11_LRT.genProcParm(fileNo, "IN", "description2_in", "VARCHAR( 382 )", true, "description text of Division (corresponding to languageId2_in)");
M11_LRT.genProcParm(fileNo, "OUT", "divOid_out", "BIGINT", true, "new division Oid");
M11_LRT.genProcParm(fileNo, "OUT", "recordCount_out", "INTEGER", false, "number of Rows inserted");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + ")");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "RESULT SETS 1");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "LANGUAGE SQL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "BEGIN");
M11_LRT.genProcSectionHeader(fileNo, "declare conditions", null, null);
M11_LRT.genCondDecl(fileNo, "routineNotFound", "42884", null);

M11_LRT.genProcSectionHeader(fileNo, "declare variables", null, null);
M11_LRT.genVarDecl(fileNo, "v_rowCount", "INTEGER        ", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_ignoreError", "SMALLINT       ", "0", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmntTxt", "VARCHAR( 2000 )", "NULL", null, null);
M11_LRT.genVarDecl(fileNo, "v_msg", "VARCHAR(   70 )", "NULL", null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare statement", null, null);
M11_LRT.genVarDecl(fileNo, "v_stmnt", "STATEMENT", null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "declare condition handler for routine not found", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR routineNotFound");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF ( v_ignoreError = 0 ) THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "RESIGNAL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");
M11_LRT.genProcSectionHeader(fileNo, "declare continue handler for SQL-Exceptions", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DECLARE CONTINUE HANDLER FOR SQLEXCEPTION");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "ROLLBACK;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "RESIGNAL;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END;");

String tempTabNameStatementDivCreate;
tempTabNameStatementDivCreate = M94_DBAdmin.tempTabNameStatement + "DivCreate";

M94_DBAdmin.genDdlForTempStatement(fileNo, 1, true, 2000, true, true, true, null, "DivCreate", null, null, null, null, null, null, null, null);

M11_LRT.genProcSectionHeader(fileNo, "initialize output parameter", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET recordCount_out = 0;");

M11_LRT.genProcSectionHeader(fileNo, "this procedure is supported starting with DB2 V9.7", null, null);
M11_LRT.genProcSectionHeader(fileNo, "in order to support deployability in earlier DB2-Releases, use dynamic SQL here and ignore error", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_ignoreError = 1;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'CALL SYSPROC.WLM_SET_CLIENT_INFO( '''', '''', '''', NULL, NULL )';");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_ignoreError = 0;");

M11_LRT.genProcSectionHeader(fileNo, "make sure that CD-User is valid", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF ( SELECT 1 FROM " + qualTabNameMdsUser + " WHERE cduserid = cdUserId_in ) IS NULL THEN");
M07_SpLogging.genSpLogProcEscape(fileNo, qualProcedureNameDivCreate, ddlType, 2, "'codeNumberList_in", "'cdUserId_in", "divOid_in", "recordCount_out", null, null, null, null, null, null, null, null);
M79_Err.genSignalDdlWithParms("userUnknown", fileNo, 2, null, null, null, null, null, null, null, null, null, "cdUserId_in", null, null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "for batch-script: set command options", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementDivCreate + "( statement ) VALUES ( 'UPDATE COMMAND OPTIONS USING S ON' );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementDivCreate + "( statement ) VALUES ( 'UPDATE COMMAND OPTIONS USING V ON' );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "determine new Division OID", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "MAX( oid ) + 4");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "INTO");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "divOid_out");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + qualTabNameDivision);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "oid < 10000");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + ";");

M11_LRT.genProcSectionHeader(fileNo, "create a new division", null, null);
M11_LRT.genProcSectionHeader(fileNo, "insert new division Oid into table division", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      " + qualTabNameDivision + " ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'( ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  oid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  createuser, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  createtimestamp, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  updateuser, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  lastupdatetimestamp, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  versionid ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "') ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'VALUES ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'( ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ' || divOid_out || ', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ''' || cdUserId_in || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  CURRENT TIMESTAMP, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ''' || cdUserId_in || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  CURRENT TIMESTAMP, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  1 ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "') '");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementDivCreate + "( statement ) VALUES ( v_stmntTxt );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET recordCount_out = recordCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "insert division description into table division_nl_text", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      " + qualTabNameDivisionNlText + " ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'( ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  oid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  div_oid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  language_id, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  label, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  description, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  versionid ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "') ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'VALUES ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'( ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  NEXTVAL FOR " + oidSeqName + ", ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ' || divOid_out || ', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  1, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ''' || label1_in || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ''' || description1_in || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  1 ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "') '");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementDivCreate + "( statement ) VALUES ( v_stmntTxt );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET recordCount_out = recordCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "SET v_stmntTxt = 'INSERT INTO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'      " + qualTabNameDivisionNlText + " ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'( ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  oid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  div_oid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  language_id, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  label, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  description, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  versionid ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "') ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'VALUES ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'( ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  NEXTVAL FOR " + oidSeqName + ", ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ' || divOid_out || ', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  2, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ''' || label2_in || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  ''' || description2_in || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "'  1 ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "') '");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "INSERT INTO " + tempTabNameStatementDivCreate + "( statement ) VALUES ( v_stmntTxt );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET recordCount_out = recordCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");

M11_LRT.genProcSectionHeader(fileNo, "Loop over MPCs", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "FOR tableLoop AS tblCrsr CURSOR WITH HOLD FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "schemaname AS l_schemaname,");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SUBSTR( schemaname, 8, 2 ) AS l_schemaname_orgid");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + qualTabNamePdmSchema);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "WHERE");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "schemaname LIKE 'VL6CERR%'");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "pooltype_id IS NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "AND");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "organization_id IS NOT NULL");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "GROUP BY schemaname");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "DO");

M11_LRT.genProcSectionHeader(fileNo, "insert rows into table messageseverity", 2, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "SET v_stmntTxt = 'INSERT INTO ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  ' || l_schemaname || '.messageseverity' || ' ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'( ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  oid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  severity_id, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  createuser, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  createtimestamp, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  updateuser, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  lastupdatetimestamp, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  msg_oid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  div_oid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  versionid ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "') ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'SELECT ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  NEXTVAL FOR vl6cmet' || l_schemaname_orgid || '.oidsequence, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  defaultseverity_id, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  ''' || cdUserId_in || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  CURRENT TIMESTAMP, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  ''' || cdUserId_in || ''', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  CURRENT TIMESTAMP, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  oid, ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  ' || divOid_out || ', ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  1 ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'FROM ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  " + qualTabNameMessage + " ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'WHERE ' ||");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "'  isseverityeditable = 1 '");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "INSERT INTO " + tempTabNameStatementDivCreate + "( statement ) VALUES ( v_stmntTxt );");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "IF mode_in >= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "EXECUTE IMMEDIATE v_stmntTxt;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "GET DIAGNOSTICS v_rowCount = ROW_COUNT;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "SET recordCount_out = recordCount_out + v_rowCount;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END IF;");

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END FOR;");

M11_LRT.genProcSectionHeader(fileNo, "return result to application", null, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "BEGIN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "DECLARE stmtCursor CURSOR WITH RETURN TO CLIENT FOR");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "SELECT");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "statement");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FROM");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + tempTabNameStatementDivCreate);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "ORDER BY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(5) + "SEQNO ASC");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(4) + "FOR READ ONLY");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + ";");

M11_LRT.genProcSectionHeader(fileNo, "leave cursor open for application", 3, null);
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(3) + "OPEN stmtCursor;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(2) + "END;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(1) + "END IF;");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + "END");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(0) + M01_LDM.gc_sqlCmdDelim);

}

private static void addStatementIntoTempTable(int fileNo, int tabIndex, String tableName, boolean genTimestamps) {

M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(tabIndex) + "IF mode_in <= 1 THEN");
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(tabIndex + 1) + "INSERT INTO " + tableName + "(statement) VALUES (v_stmntTxt);");
if (genTimestamps) {
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(tabIndex + 1) + "INSERT INTO " + tableName + "(statement) VALUES ('VALUES CURRENT TIMESTAMP');");
}
M00_FileWriter.printToFile(fileNo, M04_Utilities.addTab(tabIndex) + "END IF;");
}

}